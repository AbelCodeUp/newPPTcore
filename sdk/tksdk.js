var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var b=0;return function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+b++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var a=0;return $jscomp.iteratorPrototype(function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.iteratorFromArray=function(b,a){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var c=0,e={next:function(){if(c<b.length){var d=c++;return{value:a(d,b[d]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(b,a,c,e){if(a){c=$jscomp.global;b=b.split(".");for(e=0;e<b.length-1;e++){var d=b[e];d in c||(c[d]={});c=c[d]}b=b[b.length-1];e=c[b];a=a(e);a!=e&&null!=a&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.makeIterator=function(b){$jscomp.initSymbolIterator();var a=b[Symbol.iterator];return a?a.call(b):$jscomp.arrayIterator(b)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(b){function a(){this.batch_=null}function c(a){return a instanceof d?a:new d(function(b,c){b(a)})}if(b&&!$jscomp.FORCE_POLYFILL_PROMISE)return b;a.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};a.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var e=$jscomp.global.setTimeout;a.prototype.asyncExecuteFunction=function(a){e(a,
0)};a.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(m){this.asyncThrow_(m)}}}this.batch_=null};a.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var d=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(f){b.reject(f)}};d.prototype.createResolveAndReject_=
function(){function a(a){return function(q){c||(c=!0,a.call(b,q))}}var b=this,c=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};d.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof d)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};d.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(f){this.reject_(f);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};d.prototype.reject_=function(a){this.settle_(2,a)};d.prototype.fulfill_=function(a){this.settle_(1,a)};d.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};d.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var l=new a;d.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};d.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(m){c.reject(m)}};d.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{e(a(b))}catch(K){q(K)}}:b}var e,q,w=new d(function(a,
b){e=a;q=b});this.callWhenSettled_(c(a,e),c(b,q));return w};d.prototype.catch=function(a){return this.then(void 0,a)};d.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?l.asyncExecute(c):this.onSettledCallbacks_.push(function(){l.asyncExecute(c)})};d.resolve=c;d.reject=function(a){return new d(function(b,c){c(a)})};d.race=function(a){return new d(function(b,
d){for(var e=$jscomp.makeIterator(a),q=e.next();!q.done;q=e.next())c(q.value).callWhenSettled_(b,d)})};d.all=function(a){var b=$jscomp.makeIterator(a),e=b.next();return e.done?c([]):new d(function(a,q){function d(b){return function(r){u[b]=r;h--;0==h&&a(u)}}var u=[],h=0;do u.push(void 0),h++,c(e.value).callWhenSettled_(d(u.length-1),q),e=b.next();while(!e.done)})};return d},"es6","es3");
(function(){function b(b){return new Promise(function(c,q){a(b,c,q)})}var a=null,c=null,e={log:function(){"undefined"!==typeof module||"function"===typeof require&&"function"===typeof define||(window.webrtcLogDebug=void 0!=window.webrtcLogDebug&&"boolean"===typeof window.webrtcLogDebug?window.webrtcLogDebug:!0,window.webrtcLogDebug&&console.log.apply(console,arguments))},extractVersion:function(a,b,c){return(a=a.match(b))&&a.length>=c&&parseInt(a[c],10)}};"object"===typeof window&&(!window.HTMLMediaElement||
"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return"mozSrcObject"in this?this.mozSrcObject:this._srcObject},set:function(a){"mozSrcObject"in this?this.mozSrcObject=a:(this._srcObject=a,this.src=URL.createObjectURL(a))}}),a=window.navigator&&window.navigator.getUserMedia);if("undefined"!==typeof window&&window.navigator)if(navigator.mozGetUserMedia){if(e.log("This appears to be Firefox"),c=e.extractVersion(navigator.userAgent,
/Firefox\/([0-9]+)\./,1),window.RTCPeerConnection||(window.RTCPeerConnection=function(a,b){if(38>c&&a&&a.iceServers){for(var q=[],h=0;h<a.iceServers.length;h++){var r=a.iceServers[h];if(r.hasOwnProperty("urls"))for(var d=0;d<r.urls.length;d++){var e={url:r.urls[d]};0===r.urls[d].indexOf("turn")&&(e.username=r.username,e.credential=r.credential);q.push(e)}else q.push(a.iceServers[h])}a.iceServers=q}return new mozRTCPeerConnection(a,b)},mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,
"generateCertificate",{get:function(){return arguments.length?mozRTCPeerConnection.generateCertificate.apply(null,arguments):mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),a=function(a,b,d){var h=function(a){if("object"!==typeof a||a.require)return a;var b=[];Object.keys(a).forEach(function(h){if("require"!==h&&"advanced"!==h&&"mediaSource"!==h){var r=a[h]="object"===typeof a[h]?a[h]:{ideal:a[h]};void 0===
r.min&&void 0===r.max&&void 0===r.exact||b.push(h);void 0!==r.exact&&("number"===typeof r.exact?r.min=r.max=r.exact:a[h]=r.exact,delete r.exact);if(void 0!==r.ideal){a.advanced=a.advanced||[];var c={};c[h]="number"===typeof r.ideal?{min:r.ideal,max:r.ideal}:r.ideal;a.advanced.push(c);delete r.ideal;Object.keys(r).length||delete a[h]}}});b.length&&(a.require=b);return a};38>c&&(e.log("spec: "+JSON.stringify(a)),a.audio&&(a.audio=h(a.audio)),a.video&&(a.video=h(a.video)),e.log("ff37: "+JSON.stringify(a)));
return navigator.mozGetUserMedia(a,b,d)},navigator.getUserMedia=a,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:b,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(a){a([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},41>c){var d=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);
navigator.mediaDevices.enumerateDevices=function(){return d().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a;})}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){e.log("This appears to be Chrome");c=e.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2);window.RTCPeerConnection=function(a,b){a&&a.iceTransportPolicy&&(a.iceTransports=a.iceTransportPolicy);a=new webkitRTCPeerConnection(a,b);var c=a.getStats.bind(a);a.getStats=function(a,b,d){var h=
this,r=arguments;if(0<arguments.length&&"function"===typeof a)return c(a,b);var q=function(a){var b={};a.result().forEach(function(a){var h={id:a.id,timestamp:a.timestamp,type:a.type};a.names().forEach(function(b){h[b]=a.stat(b)});b[h.id]=h});return b};return 2<=arguments.length?c.apply(this,[function(a){r[1](q(a))},arguments[0]]):new Promise(function(b,d){1===r.length&&null===a?c.apply(h,[function(a){b.apply(null,[q(a)])},d]):c.apply(h,[b,d])})};return a};webkitRTCPeerConnection.generateCertificate&&
Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return arguments.length?webkitRTCPeerConnection.generateCertificate.apply(null,arguments):webkitRTCPeerConnection.generateCertificate}});["createOffer","createAnswer"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=this;if(1>arguments.length||1===arguments.length&&"object"===typeof arguments[0]){var h=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,
c){b.apply(a,[r,c,h])})}return b.apply(this,arguments)}});["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=arguments,h=this;return new Promise(function(r,c){b.apply(h,[a[0],function(){r();2<=a.length&&a[1].apply(null,[])},function(b){c(b);3<=a.length&&a[2].apply(null,[b])}])})}});var l=function(a){if("object"!==typeof a||a.mandatory||a.optional)return a;var b={};Object.keys(a).forEach(function(c){if("require"!==
c&&"advanced"!==c&&"mediaSource"!==c){var h="object"===typeof a[c]?a[c]:{ideal:a[c]};void 0!==h.exact&&"number"===typeof h.exact&&(h.min=h.max=h.exact);var r=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==h.ideal){b.optional=b.optional||[];var d={};"number"===typeof h.ideal?(d[r("min",c)]=h.ideal,b.optional.push(d),d={},d[r("max",c)]=h.ideal):d[r("",c)]=h.ideal;b.optional.push(d)}void 0!==h.exact&&"number"!==typeof h.exact?(b.mandatory=b.mandatory||
{},b.mandatory[r("",c)]=h.exact):["min","max"].forEach(function(a){void 0!==h[a]&&(b.mandatory=b.mandatory||{},b.mandatory[r(a,c)]=h[a])})}});a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced));return b};a=function(a,b,c){a.audio&&(a.audio=l(a.audio));a.video&&(a.video=l(a.video));e.log("chrome: "+JSON.stringify(a));return navigator.webkitGetUserMedia(a,b,c)};navigator.getUserMedia=a;navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:b,enumerateDevices:function(){return new Promise(function(a){var b=
{audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(c){a(c.map(function(a){return{label:a.label,kind:b[a.kind],deviceId:a.id,groupId:""}}))})})}});if(navigator.mediaDevices.getUserMedia){var p=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(a){e.log("spec:   "+JSON.stringify(a));a.audio=l(a.audio);a.video=l(a.video);e.log("chrome: "+JSON.stringify(a));return p(a)}}else navigator.mediaDevices.getUserMedia=
function(a){return b(a)};"undefined"===typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){e.log("Dummy mediaDevices.addEventListener called.")});"undefined"===typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){e.log("Dummy mediaDevices.removeEventListener called.")})}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)){if(e.log("This appears to be Edge"),c=e.extractVersion(navigator.userAgent,
/Edge\/(\d+).(\d+)$/,2),window.RTCIceGatherer){var k=Math.random().toString(36).substr(2,10),f={splitLines:function(a){return a.trim().split("\n").map(function(a){return a.trim()})},splitSections:function(a){return a.split("\r\nm\x3d").map(function(a,b){return(0<b?"m\x3d"+a:a).trim()+"\r\n"})},matchPrefix:function(a,b){return f.splitLines(a).filter(function(a){return 0===a.indexOf(b)})},parseCandidate:function(a){a=0===a.indexOf("a\x3dcandidate:")?a.substring(12).split(" "):a.substring(10).split(" ");
for(var b={foundation:a[0],component:a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],port:parseInt(a[5],10),type:a[7]},c=8;c<a.length;c+=2)switch(a[c]){case "raddr":b.relatedAddress=a[c+1];break;case "rport":b.relatedPort=parseInt(a[c+1],10);break;case "tcptype":b.tcpType=a[c+1]}return b},writeCandidate:function(a){var b=[];b.push(a.foundation);b.push(a.component);b.push(a.protocol.toUpperCase());b.push(a.priority);b.push(a.ip);b.push(a.port);var c=a.type;b.push("typ");b.push(c);
"host"!==c&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort));a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType));return"candidate:"+b.join(" ")},parseRtpMap:function(a){a=a.substr(9).split(" ");var b={payloadType:parseInt(a.shift(),10)};a=a[0].split("/");b.name=a[0];b.clockRate=parseInt(a[1],10);b.numChannels=3===a.length?parseInt(a[2],10):1;return b},writeRtpMap:function(a){var b=a.payloadType;void 0!==
a.preferredPayloadType&&(b=a.preferredPayloadType);return"a\x3drtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==a.numChannels?"/"+a.numChannels:"")+"\r\n"},parseFmtp:function(a){for(var b={},c=a.substr(a.indexOf(" ")+1).split(";"),h=0;h<c.length;h++)a=c[h].trim().split("\x3d"),b[a[0].trim()]=a[1];return b},writeFtmp:function(a){var b="",c=a.payloadType;void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType);if(a.parameters&&a.parameters.length){var h=[];Object.keys(a.parameters).forEach(function(b){h.push(b+
"\x3d"+a.parameters[b])});b+="a\x3dfmtp:"+c+" "+h.join(";")+"\r\n"}return b},parseRtcpFb:function(a){a=a.substr(a.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},writeRtcpFb:function(a){var b="",c=a.payloadType;void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType);a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a\x3drtcp-fb:"+c+" "+a.type+" "+a.parameter+"\r\n"});return b},parseSsrcMedia:function(a){var b=a.indexOf(" "),c={ssrc:a.substr(7,
b-7)},h=a.indexOf(":",b);-1<h?(c.attribute=a.substr(b+1,h-b-1),c.value=a.substr(h+1)):c.attribute=a.substr(b+1);return c},getDtlsParameters:function(a,b){a=f.splitLines(a);a=a.concat(f.splitLines(b));b=a.filter(function(a){return 0===a.indexOf("a\x3dfingerprint:")})[0].substr(14);return{role:"auto",fingerprints:[{algorithm:b.split(" ")[0],value:b.split(" ")[1]}]}},writeDtlsParameters:function(a,b){var c="a\x3dsetup:"+b+"\r\n";a.fingerprints.forEach(function(a){c+="a\x3dfingerprint:"+a.algorithm+" "+
a.value+"\r\n"});return c},getIceParameters:function(a,b){a=f.splitLines(a);a=a.concat(f.splitLines(b));return{usernameFragment:a.filter(function(a){return 0===a.indexOf("a\x3dice-ufrag:")})[0].substr(12),password:a.filter(function(a){return 0===a.indexOf("a\x3dice-pwd:")})[0].substr(10)}},writeIceParameters:function(a){return"a\x3dice-ufrag:"+a.usernameFragment+"\r\na\x3dice-pwd:"+a.password+"\r\n"},parseRtpParameters:function(a){for(var b={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},
c=f.splitLines(a)[0].split(" "),h=3;h<c.length;h++){var r=c[h],d=f.matchPrefix(a,"a\x3drtpmap:"+r+" ")[0];if(d){d=f.parseRtpMap(d);var e=f.matchPrefix(a,"a\x3dfmtp:"+r+" ");d.parameters=e.length?f.parseFmtp(e[0]):{};d.rtcpFeedback=f.matchPrefix(a,"a\x3drtcp-fb:"+r+" ").map(f.parseRtcpFb);b.codecs.push(d)}}return b},writeRtpDescription:function(a,b){var c="";c+="m\x3d"+a+" ";c+=0<b.codecs.length?"9":"0";c+=" UDP/TLS/RTP/SAVPF ";c+=b.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:
a.payloadType}).join(" ")+"\r\n";c+="c\x3dIN IP4 0.0.0.0\r\n";c+="a\x3drtcp:9 IN IP4 0.0.0.0\r\n";b.codecs.forEach(function(a){c+=f.writeRtpMap(a);c+=f.writeFtmp(a);c+=f.writeRtcpFb(a)});return c+="a\x3drtcp-mux\r\n"},writeSessionBoilerplate:function(){return"v\x3d0\r\no\x3dthisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns\x3d-\r\nt\x3d0 0\r\n"},writeMediaSection:function(a,b,c,h){b=f.writeRtpDescription(a.kind,b);b+=f.writeIceParameters(a.iceGatherer.getLocalParameters());b+=f.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),
"offer"===c?"actpass":"active");b+="a\x3dmid:"+a.mid+"\r\n";b=a.rtpSender&&a.rtpReceiver?b+"a\x3dsendrecv\r\n":a.rtpSender?b+"a\x3dsendonly\r\n":a.rtpReceiver?b+"a\x3drecvonly\r\n":b+"a\x3dinactive\r\n";a.rtpSender&&(c="msid:"+h.id+" "+a.rtpSender.track.id+"\r\n",b=b+("a\x3d"+c)+("a\x3dssrc:"+a.sendSsrc+" "+c));return b+="a\x3dssrc:"+a.sendSsrc+" cname:"+k+"\r\n"},getDirection:function(a,b){a=f.splitLines(a);for(var c=0;c<a.length;c++)switch(a[c]){case "a\x3dsendrecv":case "a\x3dsendonly":case "a\x3drecvonly":case "a\x3dinactive":return a[c].substr(2)}return b?
f.getDirection(b):"sendrecv"}};window.RTCIceCandidate||(window.RTCIceCandidate=function(a){return a});window.RTCSessionDescription||(window.RTCSessionDescription=function(a){return a});window.RTCPeerConnection=function(a){var b=this;this.ondatachannel=this.onnegotiationneeded=this.oniceconnectionstatechange=this.onsignalingstatechange=this.onremovestream=this.onaddstream=this.onicecandidate=null;this.localStreams=[];this.remoteStreams=[];this.getLocalStreams=function(){return b.localStreams};this.getRemoteStreams=
function(){return b.remoteStreams};this.localDescription=new RTCSessionDescription({type:"",sdp:""});this.remoteDescription=new RTCSessionDescription({type:"",sdp:""});this.signalingState="stable";this.iceConnectionState="new";this.iceOptions={gatherPolicy:"all",iceServers:[]};if(a&&a.iceTransportPolicy)switch(a.iceTransportPolicy){case "all":case "relay":this.iceOptions.gatherPolicy=a.iceTransportPolicy;break;case "none":throw new TypeError('iceTransportPolicy "none" not supported');}a&&a.iceServers&&
a.iceServers.forEach(function(a){if(a.urls){var c="string"===typeof a.urls?a.urls:a.urls[0];-1!==c.indexOf("transport\x3dudp")&&b.iceServers.push({username:a.username,credential:a.credential,urls:c})}});this.transceivers=[];this._localIceCandidatesBuffer=[]};window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var a=this;this._localIceCandidatesBuffer.forEach(function(b){if(null!==a.onicecandidate)a.onicecandidate(b)});this._localIceCandidatesBuffer=[]};window.RTCPeerConnection.prototype.addStream=
function(a){this.localStreams.push(a.clone());this._maybeFireNegotiationNeeded()};window.RTCPeerConnection.prototype.removeStream=function(a){a=this.localStreams.indexOf(a);-1<a&&(this.localStreams.splice(a,1),this._maybeFireNegotiationNeeded())};window.RTCPeerConnection.prototype._getCommonCapabilities=function(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]};a.codecs.forEach(function(a){for(var h=0;h<b.codecs.length;h++){var d=b.codecs[h];if(a.name.toLowerCase()===d.name.toLowerCase()&&
a.clockRate===d.clockRate&&a.numChannels===d.numChannels){c.codecs.push(d);break}}});a.headerExtensions.forEach(function(a){for(var h=0;h<b.headerExtensions.length;h++){var d=b.headerExtensions[h];if(a.uri===d.uri){c.headerExtensions.push(d);break}}});return c};window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(a,b){var c=this,h=new RTCIceGatherer(c.iceOptions),r=new RTCIceTransport(h);h.onlocalcandidate=function(d){var e={};e.candidate={sdpMid:a,sdpMLineIndex:b};(d=d.candidate)&&
0!==Object.keys(d).length?(d.component="RTCP"===r.component?2:1,e.candidate.candidate=f.writeCandidate(d)):(void 0===h.state&&(h.state="completed"),e.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates");d=c.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});if(null!==c.onicecandidate)if(c.localDescription&&""===c.localDescription.type)c._localIceCandidatesBuffer.push(e),d&&c._localIceCandidatesBuffer.push({});else if(c.onicecandidate(e),d)c.onicecandidate({})};
r.onicestatechange=function(){c._updateConnectionState()};var d=new RTCDtlsTransport(r);d.ondtlsstatechange=function(){c._updateConnectionState()};d.onerror=function(){d.state="failed";c._updateConnectionState()};return{iceGatherer:h,iceTransport:r,dtlsTransport:d}};window.RTCPeerConnection.prototype._transceive=function(a,b,c){var h=this._getCommonCapabilities(a.localCapabilities,a.remoteCapabilities);b&&a.rtpSender&&(h.encodings=[{ssrc:a.sendSsrc}],h.rtcp={cname:k,ssrc:a.recvSsrc},a.rtpSender.send(h));
c&&a.rtpReceiver&&(h.encodings=[{ssrc:a.recvSsrc}],h.rtcp={cname:a.cname,ssrc:a.sendSsrc},a.rtpReceiver.receive(h))};window.RTCPeerConnection.prototype.setLocalDescription=function(a){var b=this;if("offer"===a.type)this._pendingOffer&&(this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===a.type){var c=f.splitSections(b.remoteDescription.sdp),h=c.shift();c.forEach(function(a,c){c=b.transceivers[c];var r=c.iceGatherer,d=c.iceTransport,e=c.dtlsTransport,u=c.localCapabilities,
k=c.remoteCapabilities;if("0"!==a.split("\n",1)[0].split(" ",2)[1]){var m=f.getIceParameters(a,h);d.start(r,m,"controlled");a=f.getDtlsParameters(a,h);e.start(a);a=b._getCommonCapabilities(u,k);b._transceive(c,0<a.codecs.length,!1)}})}this.localDescription=a;switch(a.type){case "offer":this._updateSignalingState("have-local-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"');}var r=1<arguments.length&&"function"===typeof arguments[1];
if(r){var d=arguments[1];window.setTimeout(function(){d();b._emitBufferedCandidates()},0)}c=Promise.resolve();c.then(function(){r||window.setTimeout(b._emitBufferedCandidates.bind(b),0)});return c};window.RTCPeerConnection.prototype.setRemoteDescription=function(a){var b=this,c=new MediaStream,h=f.splitSections(a.sdp),r=h.shift();h.forEach(function(h,d){var e=f.splitLines(h)[0].substr(2).split(" "),u=e[0],k="0"===e[1];e=f.getDirection(h,r);var m=f.parseRtpParameters(h);if(!k){var p=f.getIceParameters(h,
r);var q=f.getDtlsParameters(h,r)}var w=f.matchPrefix(h,"a\x3dmid:")[0].substr(6);if(h=f.matchPrefix(h,"a\x3dssrc:").map(function(a){return f.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0]){var l=parseInt(h.ssrc,10);var K=h.value}if("offer"===a.type){p=b._createIceAndDtlsTransports(w,d);var V=RTCRtpReceiver.getCapabilities(u);k=1001*(2*d+2);h=new RTCRtpReceiver(p.dtlsTransport,u);c.addTrack(h.track);if(0<b.localStreams.length&&b.localStreams[0].getTracks().length>=d){var oa=
b.localStreams[0].getTracks()[d];oa=new RTCRtpSender(oa,p.dtlsTransport)}b.transceivers[d]={iceGatherer:p.iceGatherer,iceTransport:p.iceTransport,dtlsTransport:p.dtlsTransport,localCapabilities:V,remoteCapabilities:m,rtpSender:oa,rtpReceiver:h,kind:u,mid:w,cname:K,sendSsrc:k,recvSsrc:l};b._transceive(b.transceivers[d],!1,"sendrecv"===e||"sendonly"===e)}else if("answer"===a.type&&!k){u=b.transceivers[d];w=u.iceGatherer;var Qa=u.iceTransport;var Ra=u.dtlsTransport;oa=u.rtpSender;h=u.rtpReceiver;k=u.sendSsrc;
V=u.localCapabilities;b.transceivers[d].recvSsrc=l;b.transceivers[d].remoteCapabilities=m;b.transceivers[d].cname=K;Qa.start(w,p,"controlling");Ra.start(q);b._transceive(u,"sendrecv"===e||"recvonly"===e,"sendrecv"===e||"sendonly"===e);!h||"sendrecv"!==e&&"sendonly"!==e?delete u.rtpReceiver:c.addTrack(h.track)}});this.remoteDescription=a;switch(a.type){case "offer":this._updateSignalingState("have-remote-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+
a.type+'"');}window.setTimeout(function(){null!==b.onaddstream&&c.getTracks().length&&(b.remoteStreams.push(c),window.setTimeout(function(){b.onaddstream({stream:c})},0))},0);1<arguments.length&&"function"===typeof arguments[1]&&window.setTimeout(arguments[1],0);return Promise.resolve()};window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop();a.dtlsTransport&&a.dtlsTransport.stop();a.rtpSender&&a.rtpSender.stop();a.rtpReceiver&&
a.rtpReceiver.stop()});this._updateSignalingState("closed")};window.RTCPeerConnection.prototype._updateSignalingState=function(a){this.signalingState=a;if(null!==this.onsignalingstatechange)this.onsignalingstatechange()};window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){if(null!==this.onnegotiationneeded)this.onnegotiationneeded()};window.RTCPeerConnection.prototype._updateConnectionState=function(){var a={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};
this.transceivers.forEach(function(b){a[b.iceTransport.state]++;a[b.dtlsTransport.state]++});a.connected+=a.completed;var b="new";if(0<a.failed)b="failed";else if(0<a.connecting||0<a.checking)b="connecting";else if(0<a.disconnected)b="disconnected";else if(0<a.new)b="new";else if(0<a.connecting||0<a.completed)b="connected";if(b!==this.iceConnectionState&&(this.iceConnectionState=b,null!==this.oniceconnectionstatechange))this.oniceconnectionstatechange()};window.RTCPeerConnection.prototype.createOffer=
function(){var a=this;if(this._pendingOffer)throw Error("createOffer called while there is a pending offer.");var b;1===arguments.length&&"function"!==typeof arguments[0]?b=arguments[0]:3===arguments.length&&(b=arguments[2]);var c=[],h=0,r=0;this.localStreams.length&&(h=this.localStreams[0].getAudioTracks().length,r=this.localStreams[0].getVideoTracks().length);if(b){if(b.mandatory||b.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==b.offerToReceiveAudio&&
(h=b.offerToReceiveAudio);void 0!==b.offerToReceiveVideo&&(r=b.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(a){c.push({kind:a.kind,track:a,wantReceive:"audio"===a.kind?0<h:0<r});"audio"===a.kind?h--:"video"===a.kind&&r--});0<h||0<r;)0<h&&(c.push({kind:"audio",wantReceive:!0}),h--),0<r&&(c.push({kind:"video",wantReceive:!0}),r--);var d=f.writeSessionBoilerplate(),e=[];c.forEach(function(b,c){var h=b.track,r=b.kind,u=Math.random().toString(36).substr(2,
10),k=a._createIceAndDtlsTransports(u,c),m=RTCRtpSender.getCapabilities(r),p,l,w=1001*(2*c+1);h&&(p=new RTCRtpSender(h,k.dtlsTransport));b.wantReceive&&(l=new RTCRtpReceiver(k.dtlsTransport,r));e[c]={iceGatherer:k.iceGatherer,iceTransport:k.iceTransport,dtlsTransport:k.dtlsTransport,localCapabilities:m,remoteCapabilities:null,rtpSender:p,rtpReceiver:l,kind:r,mid:u,sendSsrc:w,recvSsrc:null};b=e[c];d+=f.writeMediaSection(b,b.localCapabilities,"offer",a.localStreams[0])});this._pendingOffer=e;b=new RTCSessionDescription({type:"offer",
sdp:d});arguments.length&&"function"===typeof arguments[0]&&window.setTimeout(arguments[0],0,b);return Promise.resolve(b)};window.RTCPeerConnection.prototype.createAnswer=function(){var a=this,b=f.writeSessionBoilerplate();this.transceivers.forEach(function(c){var h=a._getCommonCapabilities(c.localCapabilities,c.remoteCapabilities);b+=f.writeMediaSection(c,h,"answer",a.localStreams[0])});var c=new RTCSessionDescription({type:"answer",sdp:b});arguments.length&&"function"===typeof arguments[0]&&window.setTimeout(arguments[0],
0,c);return Promise.resolve(c)};window.RTCPeerConnection.prototype.addIceCandidate=function(a){var b=a.sdpMLineIndex;if(a.sdpMid)for(var c=0;c<this.transceivers.length;c++)if(this.transceivers[c].mid===a.sdpMid){b=c;break}if(b=this.transceivers[b]){c=0<Object.keys(a.candidate).length?f.parseCandidate(a.candidate):{};if("tcp"===c.protocol&&0===c.port||"1"!==c.component)return;"endOfCandidates"===c.type&&(c={});b.iceTransport.addRemoteCandidate(c)}1<arguments.length&&"function"===typeof arguments[1]&&
window.setTimeout(arguments[1],0);return Promise.resolve()};window.RTCPeerConnection.prototype.getStats=function(){var a=[];this.transceivers.forEach(function(b){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(c){b[c]&&a.push(b[c].getStats())})});var b=1<arguments.length&&"function"===typeof arguments[1]&&arguments[1];return new Promise(function(c){var h={};Promise.all(a).then(function(a){a.forEach(function(a){Object.keys(a).forEach(function(b){h[b]=a[b]})});
b&&window.setTimeout(b,0,h);c(h)})})}}}else e.log("Browser does not appear to be WebRTC-capable");else e.log("This does not appear to be a browser");var m={};try{Object.defineProperty(m,"version",{set:function(a){c=a}})}catch(q){}})();(function(){var b=!1;if(void 0!==window.__SDKDEV__&&null!==window.__SDKDEV__&&"boolean"===typeof window.__SDKDEV__)try{b=window.__SDKDEV__}catch(c){b=!1}if(!b){b=decodeURIComponent(window.location.href);var a=b.indexOf("?");b=b.substring(a+1).match(/(^|&)debug=([^&]*)(&|$)/i);b=null!=b?b[2]:""}window.__TkSdkBuild__=!b;try{window.localStorage?window.localStorage.setItem("debug",b?"*":"none"):console.warn("[tk-sdk]window.localStorage is not exist!")}catch(c){console.warn("[tk-sdk]Browser does not support localStorage!")}})();
!function(b,a){"object"==typeof exports&&"object"==typeof module?module.exports=a():"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?exports.io=a():b.io=a()}(this,function(){return function(b){function a(e){if(c[e])return c[e].exports;var d=c[e]={exports:{},id:e,loaded:!1};return b[e].call(d.exports,d,d.exports,a),d.loaded=!0,d.exports}var c={};return a.m=b,a.c=c,a.p="",a(0)}([function(b,a,c){function e(a,b){"object"===("undefined"==typeof a?"undefined":d(a))&&(b=a,a=void 0);
b=b||{};var c;a=l(a);var h=a.source,r=a.id,e=a.path;e=m[r]&&e in m[r].nsps;return b.forceNew||b["force new connection"]||!1===b.multiplex||e?(f("ignoring socket cache for %s",h),c=k(h,b)):(m[r]||(f("new io instance for %s",h),m[r]=k(h,b)),c=m[r]),a.query&&!b.query&&(b.query=a.query),c.socket(a.path,b)}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":
typeof a},l=c(1),p=c(7),k=c(13),f=c(3)("socket.io-client");b.exports=a=e;var m=a.managers={};a.protocol=p.protocol;a.connect=e;a.Manager=c(13);a.Socket=c(39)},function(b,a,c){(function(a){var d=c(2),e=c(3)("socket.io-client:url");b.exports=function(b,c){var f=b;c=c||a.location;null==b&&(b=c.protocol+"//"+c.host);"string"==typeof b&&("/"===b.charAt(0)&&(b="/"===b.charAt(1)?c.protocol+b:c.host+b),/^(https?|wss?):\/\//.test(b)||(e("protocol-less url %s",b),b="undefined"!=typeof c?c.protocol+"//"+b:"https://"+
b),e("parse %s",b),f=d(b));f.port||(/^(http|ws)$/.test(f.protocol)?f.port="80":/^(http|ws)s$/.test(f.protocol)&&(f.port="443"));f.path=f.path||"/";b=-1!==f.host.indexOf(":")?"["+f.host+"]":f.host;return f.id=f.protocol+"://"+b+":"+f.port,f.href=f.protocol+"://"+b+(c&&c.port===f.port?"":":"+f.port),f}}).call(a,function(){return this}())},function(b,a){var c=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
e="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");b.exports=function(a){var b=a,d=a.indexOf("["),k=a.indexOf("]");-1!=d&&-1!=k&&(a=a.substring(0,d)+a.substring(d,k).replace(/:/g,";")+a.substring(k,a.length));a=c.exec(a||"");for(var f={},m=14;m--;)f[e[m]]=a[m]||"";return-1!=d&&-1!=k&&(f.source=b,f.host=f.host.substring(1,f.host.length-1).replace(/;/g,":"),f.authority=f.authority.replace("[","").replace("]","").replace(/;/g,":"),f.ipv6uri=
!0),f}},function(b,a,c){(function(e){function d(){try{var b=a.storage.debug}catch(f){}return!b&&"undefined"!=typeof e&&"env"in e&&(b=e.env.DEBUG),b}a=b.exports=c(5);a.log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)};a.formatArgs=function(b){var c=this.useColors;if(b[0]=(c?"%c":"")+this.namespace+(c?" %c":" ")+b[0]+(c?"%c ":" ")+"+"+a.humanize(this.diff),c){c="color: "+this.color;b.splice(1,0,c,"color: inherit");var d=0,e=0;b[0].replace(/%[a-zA-Z%]/g,
function(a){"%%"!==a&&(d++,"%c"===a&&(e=d))});b.splice(e,0,c)}};a.save=function(b){try{null==b?a.storage.removeItem("debug"):a.storage.debug=b}catch(f){}};a.load=d;a.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&
window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var l=a;if("undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage)var p=chrome.storage.local;else a:{try{p=window.localStorage;break a}catch(k){}p=void 0}l.storage=p;a.colors="lightseagreen forestgreen goldenrod dodgerblue darkorchid crimson".split(" ");
a.formatters.j=function(a){try{return JSON.stringify(a)}catch(f){return"[UnexpectedJSONParseError]: "+f.message}};a.enable(d())}).call(a,c(4))},function(b,a){function c(){throw Error("setTimeout has not been defined");}function e(){throw Error("clearTimeout has not been defined");}function d(a){if(q===setTimeout)return setTimeout(a,0);if((q===c||!q)&&setTimeout)return q=setTimeout,setTimeout(a,0);try{return q(a,0)}catch(E){try{return q.call(null,a,0)}catch(T){return q.call(this,a,0)}}}function l(a){if(w===
clearTimeout)return clearTimeout(a);if((w===e||!w)&&clearTimeout)return w=clearTimeout,clearTimeout(a);try{return w(a)}catch(E){try{return w.call(null,a)}catch(T){return w.call(this,a)}}}function p(){r&&u&&(r=!1,u.length?h=u.concat(h):K=-1,h.length&&k())}function k(){if(!r){var a=d(p);r=!0;for(var b=h.length;b;){u=h;for(h=[];++K<b;)u&&u[K].run();K=-1;b=h.length}u=null;r=!1;l(a)}}function f(a,b){this.fun=a;this.array=b}function m(){}b=b.exports={};try{var q="function"==typeof setTimeout?setTimeout:
c}catch(V){q=c}try{var w="function"==typeof clearTimeout?clearTimeout:e}catch(V){w=e}!0;var u,h=[],r=!1,K=-1;b.nextTick=function(a){var b=Array(arguments.length-1);if(1<arguments.length)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];h.push(new f(a,b));1!==h.length||r||d(k)};f.prototype.run=function(){this.fun.apply(null,this.array)};b.title="browser";b.browser=!0;b.env={};b.argv=[];b.version="";b.versions={};b.on=m;b.addListener=m;b.once=m;b.off=m;b.removeListener=m;b.removeAllListeners=m;
b.emit=m;b.prependListener=m;b.prependOnceListener=m;b.listeners=function(a){return[]};b.binding=function(a){throw Error("process.binding is not supported");};b.cwd=function(){return"/"};b.chdir=function(a){throw Error("process.chdir is not supported");};b.umask=function(){return 0}},function(b,a,c){function e(b){var c,d=0;for(c in b)d=(d<<5)-d+b.charCodeAt(c),d|=0;return a.colors[Math.abs(d)%a.colors.length]}function d(b){function c(){if(c.enabled){var b=+new Date;c.diff=b-(l||b);c.prev=l;l=c.curr=
b;var d=Array(arguments.length);for(b=0;b<d.length;b++)d[b]=arguments[b];d[0]=a.coerce(d[0]);"string"!=typeof d[0]&&d.unshift("%O");var e=0;d[0]=d[0].replace(/%([a-zA-Z%])/g,function(b,f){if("%%"===b)return b;e++;f=a.formatters[f];"function"==typeof f&&(b=f.call(c,d[e]),d.splice(e,1),e--);return b});a.formatArgs.call(c,d);(c.log||a.log||console.log.bind(console)).apply(c,d)}}return c.namespace=b,c.enabled=a.enabled(b),c.useColors=a.useColors(),c.color=e(b),"function"==typeof a.init&&a.init(c),c}a=
b.exports=d.debug=d["default"]=d;a.coerce=function(a){return a instanceof Error?a.stack||a.message:a};a.disable=function(){a.enable("")};a.enable=function(b){a.save(b);a.names=[];a.skips=[];for(var c=("string"==typeof b?b:"").split(/[\s,]+/),d=c.length,e=0;e<d;e++)c[e]&&(b=c[e].replace(/\*/g,".*?"),"-"===b[0]?a.skips.push(new RegExp("^"+b.substr(1)+"$")):a.names.push(new RegExp("^"+b+"$")))};a.enabled=function(b){var c;var d=0;for(c=a.skips.length;d<c;d++)if(a.skips[d].test(b))return!1;d=0;for(c=
a.names.length;d<c;d++)if(a.names[d].test(b))return!0;return!1};a.humanize=c(6);a.names=[];a.skips=[];a.formatters={};var l},function(b,a){function c(a){if(a=String(a),!(100<a.length))if(a=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a)){var b=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case "years":case "year":case "yrs":case "yr":case "y":return b*f;case "days":case "day":case "d":return b*k;case "hours":case "hour":case "hrs":case "hr":case "h":return b*
p;case "minutes":case "minute":case "mins":case "min":case "m":return b*l;case "seconds":case "second":case "secs":case "sec":case "s":return b*d;case "milliseconds":case "millisecond":case "msecs":case "msec":case "ms":return b}}}function e(a,b,c){if(!(a<b))return a<1.5*b?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var d=1E3,l=60*d,p=60*l,k=24*p,f=365.25*k;b.exports=function(a,b){b=b||{};var f=typeof a;if("string"===f&&0<a.length)return c(a);if("number"===f&&!1===isNaN(a))return b["long"]?e(a,
k,"day")||e(a,p,"hour")||e(a,l,"minute")||e(a,d,"second")||a+" ms":a>=k?Math.round(a/k)+"d":a>=p?Math.round(a/p)+"h":a>=l?Math.round(a/l)+"m":a>=d?Math.round(a/d)+"s":a+"ms";throw Error("val is not a non-empty string or a valid number. val\x3d"+JSON.stringify(a));}},function(b,a,c){function e(){}function d(b){var c=""+b.type;return a.BINARY_EVENT!==b.type&&a.BINARY_ACK!==b.type||(c+=b.attachments+"-"),b.nsp&&"/"!==b.nsp&&(c+=b.nsp+","),null!=b.id&&(c+=b.id),null!=b.data&&(c+=JSON.stringify(b.data)),
m("encoded %j as %s",b,c),c}function l(a,b){w.removeBlobs(a,function(a){var c=w.deconstructPacket(a);a=d(c.packet);c=c.buffers;c.unshift(a);b(c)})}function p(){this.reconstructor=null}function k(a){this.reconPack=a;this.buffers=[]}function f(){return{type:a.ERROR,data:"parser error"}}var m=c(3)("socket.io-parser");b=c(8);var q=c(9),w=c(11),u=c(12);a.protocol=4;a.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" ");a.CONNECT=0;a.DISCONNECT=1;a.EVENT=2;a.ACK=3;a.ERROR=4;a.BINARY_EVENT=
5;a.BINARY_ACK=6;a.Encoder=e;a.Decoder=p;e.prototype.encode=function(b,c){(b.type!==a.EVENT&&b.type!==a.ACK||!q(b.data)||(b.type=b.type===a.EVENT?a.BINARY_EVENT:a.BINARY_ACK),m("encoding packet %j",b),a.BINARY_EVENT===b.type||a.BINARY_ACK===b.type)?l(b,c):(b=d(b),c([b]))};b(p.prototype);p.prototype.add=function(b){if("string"==typeof b){var c=0,d={type:Number(b.charAt(0))};if(null==a.types[d.type])b=f();else{if(a.BINARY_EVENT===d.type||a.BINARY_ACK===d.type){for(var h="";"-"!==b.charAt(++c)&&(h+=
b.charAt(c),c!=b.length););if(h!=Number(h)||"-"!==b.charAt(c))throw Error("Illegal attachments");d.attachments=Number(h)}if("/"===b.charAt(c+1))for(d.nsp="";++c;){h=b.charAt(c);if(","===h)break;if(d.nsp+=h,c===b.length)break}else d.nsp="/";h=b.charAt(c+1);if(""!==h&&Number(h)==h){for(d.id="";++c;){h=b.charAt(c);if(null==h||Number(h)!=h){--c;break}if(d.id+=b.charAt(c),c===b.length)break}d.id=Number(d.id)}if(b.charAt(++c)){b:{c=b.substr(c);try{d.data=JSON.parse(c)}catch(E){c=f();break b}c=d}d=c}b=(m("decoded %s as %j",
b,d),d)}a.BINARY_EVENT===b.type||a.BINARY_ACK===b.type?(this.reconstructor=new k(b),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",b)):this.emit("decoded",b)}else{if(!u(b)&&!b.base64)throw Error("Unknown type: "+b);if(!this.reconstructor)throw Error("got binary data when not reconstructing a packet");(b=this.reconstructor.takeBinaryData(b))&&(this.reconstructor=null,this.emit("decoded",b))}};p.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};
k.prototype.takeBinaryData=function(a){return(this.buffers.push(a),this.buffers.length===this.reconPack.attachments)?(a=w.reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),a):null};k.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]}},function(b,a,c){function e(a){if(a){for(var b in e.prototype)a[b]=e.prototype[b];return a}}b.exports=e;e.prototype.on=e.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks["$"+
a]=this._callbacks["$"+a]||[]).push(b),this};e.prototype.once=function(a,b){function c(){this.off(a,c);b.apply(this,arguments)}return c.fn=b,this.on(a,c),this};e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks["$"+a];if(!c)return this;if(1==arguments.length)return delete this._callbacks["$"+a],this;for(var d,e=0;e<c.length;e++)if(d=
c[e],d===b||d.fn===b){c.splice(e,1);break}return this};e.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks["$"+a];if(c){c=c.slice(0);for(var d=0,e=c.length;d<e;++d)c[d].apply(this,b)}return this};e.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks["$"+a]||[]};e.prototype.hasListeners=function(a){return!!this.listeners(a).length}},function(b,a,c){(function(a){function d(b){if(!b||"object"!=typeof b)return!1;
if(e(b)){for(var c=0,l=b.length;c<l;c++)if(d(b[c]))return!0;return!1}if("function"==typeof a.Buffer&&a.Buffer.isBuffer&&a.Buffer.isBuffer(b)||"function"==typeof a.ArrayBuffer&&b instanceof ArrayBuffer||k&&b instanceof Blob||f&&b instanceof File)return!0;if(b.toJSON&&"function"==typeof b.toJSON&&1===arguments.length)return d(b.toJSON(),!0);for(c in b)if(Object.prototype.hasOwnProperty.call(b,c)&&d(b[c]))return!0;return!1}var e=c(10),p=Object.prototype.toString,k="function"==typeof a.Blob||"[object BlobConstructor]"===
p.call(a.Blob),f="function"==typeof a.File||"[object FileConstructor]"===p.call(a.File);b.exports=d}).call(a,function(){return this}())},function(b,a){var c={}.toString;b.exports=Array.isArray||function(a){return"[object Array]"==c.call(a)}},function(b,a,c){(function(b){function d(a,b){if(!a)return a;if(k(a)){var c={_placeholder:!0,num:b.length};return b.push(a),c}if(p(a)){c=Array(a.length);for(var r=0;r<a.length;r++)c[r]=d(a[r],b);return c}if("object"==typeof a&&!(a instanceof Date)){c={};for(r in a)c[r]=
d(a[r],b);return c}return a}function e(a,b){if(!a)return a;if(a&&a._placeholder)return b[a.num];if(p(a))for(var c=0;c<a.length;c++)a[c]=e(a[c],b);else if("object"==typeof a)for(c in a)a[c]=e(a[c],b);return a}var p=c(10),k=c(12),f=Object.prototype.toString,m="function"==typeof b.Blob||"[object BlobConstructor]"===f.call(b.Blob),q="function"==typeof b.File||"[object FileConstructor]"===f.call(b.File);a.deconstructPacket=function(a){var b=[];return a.data=d(a.data,b),a.attachments=b.length,{packet:a,
buffers:b}};a.reconstructPacket=function(a,b){return a.data=e(a.data,b),a.attachments=void 0,a};a.removeBlobs=function(a,b){function c(a,h,r){if(!a)return a;if(m&&a instanceof Blob||q&&a instanceof File){d++;var f=new FileReader;f.onload=function(){r?r[h]=this.result:e=this.result;--d||b(e)};f.readAsArrayBuffer(a)}else if(p(a))for(f=0;f<a.length;f++)c(a[f],f,a);else if("object"==typeof a&&!k(a))for(f in a)c(a[f],f,a)}var d=0,e=a;c(e);d||b(e)}}).call(a,function(){return this}())},function(b,a){(function(a){b.exports=
function(b){return a.Buffer&&a.Buffer.isBuffer(b)||a.ArrayBuffer&&b instanceof ArrayBuffer}}).call(a,function(){return this}())},function(b,a,c){function e(a,b){if(!(this instanceof e))return new e(a,b);a&&"object"===("undefined"==typeof a?"undefined":d(a))&&(b=a,a=void 0);b=b||{};b.path=b.path||"/socket.io";this.nsps={};this.subs=[];this.opts=b;this.reconnection(!1!==b.reconnection);this.reconnectionAttempts(b.reconnectionAttempts||1/0);this.reconnectionDelay(b.reconnectionDelay||1E3);this.reconnectionDelayMax(b.reconnectionDelayMax||
5E3);this.randomizationFactor(b.randomizationFactor||.5);this.backoff=new u({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==b.timeout?2E4:b.timeout);this.readyState="closed";this.uri=a;this.connecting=[];this.lastPing=null;this.encoding=!1;this.packetBuffer=[];a=b.parser||k;this.encoder=new a.Encoder;this.decoder=new a.Decoder;(this.autoConnect=!1!==b.autoConnect)&&this.open()}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?
function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},l=c(14),p=c(39);a=c(8);var k=c(7),f=c(41),m=c(42),q=c(3)("socket.io-client:manager"),w=c(37),u=c(43),h=Object.prototype.hasOwnProperty;b.exports=e;e.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var a in this.nsps)h.call(this.nsps,a)&&this.nsps[a].emit.apply(this.nsps[a],arguments)};e.prototype.updateSocketIds=function(){for(var a in this.nsps)h.call(this.nsps,
a)&&(this.nsps[a].id=this.generateId(a))};e.prototype.generateId=function(a){return("/"===a?"":a+"#")+this.engine.id};a(e.prototype);e.prototype.reconnection=function(a){return arguments.length?(this._reconnection=!!a,this):this._reconnection};e.prototype.reconnectionAttempts=function(a){return arguments.length?(this._reconnectionAttempts=a,this):this._reconnectionAttempts};e.prototype.reconnectionDelay=function(a){return arguments.length?(this._reconnectionDelay=a,this.backoff&&this.backoff.setMin(a),
this):this._reconnectionDelay};e.prototype.randomizationFactor=function(a){return arguments.length?(this._randomizationFactor=a,this.backoff&&this.backoff.setJitter(a),this):this._randomizationFactor};e.prototype.reconnectionDelayMax=function(a){return arguments.length?(this._reconnectionDelayMax=a,this.backoff&&this.backoff.setMax(a),this):this._reconnectionDelayMax};e.prototype.timeout=function(a){return arguments.length?(this._timeout=a,this):this._timeout};e.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&
this._reconnection&&0===this.backoff.attempts&&this.reconnect()};e.prototype.open=e.prototype.connect=function(a,b){if(q("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;q("opening %s",this.uri);var c=this.engine=l(this.uri,this.opts),d=this;this.readyState="opening";this.skipReconnect=!1;var h=f(c,"open",function(){d.onopen();a&&a()});b=f(c,"error",function(b){if(q("connect_error"),d.cleanup(),d.readyState="closed",d.emitAll("connect_error",b),a){var c=Error("Connection error");
c.data=b;a(c)}else d.maybeReconnectOnOpen()});if(!1!==this._timeout){var r=this._timeout;q("connect attempt will timeout after %d",r);var e=setTimeout(function(){q("connect attempt timed out after %d",r);h.destroy();c.close();c.emit("error","timeout");d.emitAll("connect_timeout",r)},r);this.subs.push({destroy:function(){clearTimeout(e)}})}return this.subs.push(h),this.subs.push(b),this};e.prototype.onopen=function(){q("open");this.cleanup();this.readyState="open";this.emit("open");var a=this.engine;
this.subs.push(f(a,"data",m(this,"ondata")));this.subs.push(f(a,"ping",m(this,"onping")));this.subs.push(f(a,"pong",m(this,"onpong")));this.subs.push(f(a,"error",m(this,"onerror")));this.subs.push(f(a,"close",m(this,"onclose")));this.subs.push(f(this.decoder,"decoded",m(this,"ondecoded")))};e.prototype.onping=function(){this.lastPing=new Date;this.emitAll("ping")};e.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)};e.prototype.ondata=function(a){this.decoder.add(a)};e.prototype.ondecoded=
function(a){this.emit("packet",a)};e.prototype.onerror=function(a){q("error",a);this.emitAll("error",a)};e.prototype.socket=function(a,b){function c(){~w(h.connecting,d)||h.connecting.push(d)}var d=this.nsps[a];if(!d){d=new p(this,a,b);this.nsps[a]=d;var h=this;d.on("connecting",c);d.on("connect",function(){d.id=h.generateId(a)});this.autoConnect&&c()}return d};e.prototype.destroy=function(a){a=w(this.connecting,a);~a&&this.connecting.splice(a,1);this.connecting.length||this.close()};e.prototype.packet=
function(a){q("writing packet %j",a);var b=this;a.query&&0===a.type&&(a.nsp+="?"+a.query);b.encoding?b.packetBuffer.push(a):(b.encoding=!0,this.encoder.encode(a,function(c){for(var d=0;d<c.length;d++)b.engine.write(c[d],a.options);b.encoding=!1;b.processPacketQueue()}))};e.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var a=this.packetBuffer.shift();this.packet(a)}};e.prototype.cleanup=function(){q("cleanup");for(var a=this.subs.length,b=0;b<a;b++)this.subs.shift().destroy();
this.packetBuffer=[];this.encoding=!1;this.lastPing=null;this.decoder.destroy()};e.prototype.close=e.prototype.disconnect=function(){q("disconnect");this.skipReconnect=!0;this.reconnecting=!1;"opening"===this.readyState&&this.cleanup();this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};e.prototype.onclose=function(a){q("onclose");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",a);this._reconnection&&!this.skipReconnect&&this.reconnect()};
e.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var a=this;if(this.backoff.attempts>=this._reconnectionAttempts)q("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var b=this.backoff.duration();q("will wait %dms before reconnect attempt",b);this.reconnecting=!0;var c=setTimeout(function(){a.skipReconnect||(q("attempting reconnect"),a.emitAll("reconnect_attempt",a.backoff.attempts),a.emitAll("reconnecting",a.backoff.attempts),
a.skipReconnect||a.open(function(b){b?(q("reconnect attempt error"),a.reconnecting=!1,a.reconnect(),a.emitAll("reconnect_error",b.data)):(q("reconnect success"),a.onreconnect())}))},b);this.subs.push({destroy:function(){clearTimeout(c)}})}};e.prototype.onreconnect=function(){var a=this.backoff.attempts;this.reconnecting=!1;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",a)}},function(b,a,c){b.exports=c(15)},function(b,a,c){b.exports=c(16);b.exports.parser=c(23)},function(b,a,
c){(function(a){function d(b,c){if(!(this instanceof d))return new d(b,c);c=c||{};b&&"object"==typeof b&&(c=b,b=null);b?(b=q(b),c.hostname=b.host,c.secure="https"===b.protocol||"wss"===b.protocol,c.port=b.port,b.query&&(c.query=b.query)):c.host&&(c.hostname=q(c.host).host);this.secure=null!=c.secure?c.secure:a.location&&"https:"===location.protocol;c.hostname&&!c.port&&(c.port=this.secure?"443":"80");this.agent=c.agent||!1;this.hostname=c.hostname||(a.location?location.hostname:"localhost");this.port=
c.port||(a.location&&location.port?location.port:this.secure?443:80);this.query=c.query||{};"string"==typeof this.query&&(this.query=u.decode(this.query));this.upgrade=!1!==c.upgrade;this.path=(c.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!c.forceJSONP;this.jsonp=!1!==c.jsonp;this.forceBase64=!!c.forceBase64;this.enablesXDR=!!c.enablesXDR;this.timestampParam=c.timestampParam||"t";this.timestampRequests=c.timestampRequests;this.transports=c.transports||["polling","websocket"];this.transportOptions=
c.transportOptions||{};this.readyState="";this.writeBuffer=[];this.prevBufferLen=0;this.policyPort=c.policyPort||843;this.rememberUpgrade=c.rememberUpgrade||!1;this.binaryType=null;this.onlyBinaryUpgrades=c.onlyBinaryUpgrades;this.perMessageDeflate=!1!==c.perMessageDeflate&&(c.perMessageDeflate||{});!0===this.perMessageDeflate&&(this.perMessageDeflate={});this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024);this.pfx=c.pfx||null;this.key=c.key||null;
this.passphrase=c.passphrase||null;this.cert=c.cert||null;this.ca=c.ca||null;this.ciphers=c.ciphers||null;this.rejectUnauthorized=void 0===c.rejectUnauthorized||c.rejectUnauthorized;this.forceNode=!!c.forceNode;b="object"==typeof a&&a;b.global===b&&(c.extraHeaders&&0<Object.keys(c.extraHeaders).length&&(this.extraHeaders=c.extraHeaders),c.localAddress&&(this.localAddress=c.localAddress));this.pingTimeoutTimer=this.pingIntervalTimer=this.pingTimeout=this.pingInterval=this.upgrades=this.id=null;this.open()}
var e=c(17),p=c(8),k=c(3)("engine.io-client:socket"),f=c(37),m=c(23),q=c(2),w=c(38),u=c(31);b.exports=d;d.priorWebsocketSuccess=!1;p(d.prototype);d.protocol=m.protocol;d.Socket=d;d.Transport=c(22);d.transports=c(17);d.parser=c(23);d.prototype.createTransport=function(a){k('creating transport "%s"',a);var b=this.query,c={},d;for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);c.EIO=m.protocol;c.transport=a;b=this.transportOptions[a]||{};this.id&&(c.sid=this.id);return new e[a]({query:c,socket:this,agent:b.agent||
this.agent,hostname:b.hostname||this.hostname,port:b.port||this.port,secure:b.secure||this.secure,path:b.path||this.path,forceJSONP:b.forceJSONP||this.forceJSONP,jsonp:b.jsonp||this.jsonp,forceBase64:b.forceBase64||this.forceBase64,enablesXDR:b.enablesXDR||this.enablesXDR,timestampRequests:b.timestampRequests||this.timestampRequests,timestampParam:b.timestampParam||this.timestampParam,policyPort:b.policyPort||this.policyPort,pfx:b.pfx||this.pfx,key:b.key||this.key,passphrase:b.passphrase||this.passphrase,
cert:b.cert||this.cert,ca:b.ca||this.ca,ciphers:b.ciphers||this.ciphers,rejectUnauthorized:b.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:b.perMessageDeflate||this.perMessageDeflate,extraHeaders:b.extraHeaders||this.extraHeaders,forceNode:b.forceNode||this.forceNode,localAddress:b.localAddress||this.localAddress,requestTimeout:b.requestTimeout||this.requestTimeout,protocols:b.protocols||void 0})};d.prototype.open=function(){if(this.rememberUpgrade&&d.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))var a=
"websocket";else{if(0===this.transports.length){var b=this;return void setTimeout(function(){b.emit("error","No transports available")},0)}a=this.transports[0]}this.readyState="opening";try{a=this.createTransport(a)}catch(K){return this.transports.shift(),void this.open()}a.open();this.setTransport(a)};d.prototype.setTransport=function(a){k("setting transport %s",a.name);var b=this;this.transport&&(k("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());this.transport=
a;a.on("drain",function(){b.onDrain()}).on("packet",function(a){b.onPacket(a)}).on("error",function(a){b.onError(a)}).on("close",function(){b.onClose("transport close")})};d.prototype.probe=function(a){function b(){if(q.onlyBinaryUpgrades){var b=!this.supportsBinary&&q.transport.supportsBinary;p=p||b}p||(k('probe transport "%s" opened',a),m.send([{type:"ping",data:"probe"}]),m.once("packet",function(b){if(!p)if("pong"===b.type&&"probe"===b.data){if(k('probe transport "%s" pong',a),q.upgrading=!0,
q.emit("upgrading",m),m)d.priorWebsocketSuccess="websocket"===m.name,k('pausing current transport "%s"',q.transport.name),q.transport.pause(function(){p||"closed"!==q.readyState&&(k("changing transport and sending upgrade packet"),l(),q.setTransport(m),m.send([{type:"upgrade"}]),q.emit("upgrade",m),m=null,q.upgrading=!1,q.flush())})}else k('probe transport "%s" failed',a),b=Error("probe error"),b.transport=m.name,q.emit("upgradeError",b)}))}function c(){p||(p=!0,l(),m.close(),m=null)}function h(b){var d=
Error("probe error: "+b);d.transport=m.name;c();k('probe transport "%s" failed because of error: %s',a,b);q.emit("upgradeError",d)}function e(){h("transport closed")}function f(){h("socket closed")}function u(a){m&&a.name!==m.name&&(k('"%s" works - aborting "%s"',a.name,m.name),c())}function l(){m.removeListener("open",b);m.removeListener("error",h);m.removeListener("close",e);q.removeListener("close",f);q.removeListener("upgrading",u)}k('probing transport "%s"',a);var m=this.createTransport(a,{probe:1}),
p=!1,q=this;d.priorWebsocketSuccess=!1;m.once("open",b);m.once("error",h);m.once("close",e);this.once("close",f);this.once("upgrading",u);m.open()};d.prototype.onOpen=function(){if(k("socket open"),this.readyState="open",d.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){k("starting upgrade probes");for(var a=0,b=this.upgrades.length;a<b;a++)this.probe(this.upgrades[a])}};d.prototype.onPacket=function(a){if("opening"===
this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(k('socket receive: type "%s", data "%s"',a.type,a.data),this.emit("packet",a),this.emit("heartbeat"),a.type){case "open":this.onHandshake(w(a.data));break;case "pong":this.setPing();this.emit("pong");break;case "error":var b=Error("server error");b.code=a.data;this.onError(b);break;case "message":this.emit("data",a.data),this.emit("message",a.data)}else k('packet received with socket readyState "%s"',this.readyState)};d.prototype.onHandshake=
function(a){this.emit("handshake",a);this.id=a.sid;this.transport.query.sid=a.sid;this.upgrades=this.filterUpgrades(a.upgrades);this.pingInterval=a.pingInterval;this.pingTimeout=a.pingTimeout;this.onOpen();"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))};d.prototype.onHeartbeat=function(a){clearTimeout(this.pingTimeoutTimer);var b=this;b.pingTimeoutTimer=setTimeout(function(){"closed"!==b.readyState&&b.onClose("ping timeout")},
a||b.pingInterval+b.pingTimeout)};d.prototype.setPing=function(){var a=this;clearTimeout(a.pingIntervalTimer);a.pingIntervalTimer=setTimeout(function(){k("writing ping packet - expecting pong within %sms",a.pingTimeout);a.ping();a.onHeartbeat(a.pingTimeout)},a.pingInterval)};d.prototype.ping=function(){var a=this;this.sendPacket("ping",function(){a.emit("ping")})};d.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;0===this.writeBuffer.length?this.emit("drain"):
this.flush()};d.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(k("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};d.prototype.write=d.prototype.send=function(a,b,c){return this.sendPacket("message",a,b,c),this};d.prototype.sendPacket=function(a,b,c,d){if("function"==typeof b&&(d=b,b=void 0),"function"==typeof c&&(d=
c,c=null),"closing"!==this.readyState&&"closed"!==this.readyState)c=c||{},c.compress=!1!==c.compress,a={type:a,data:b,options:c},this.emit("packetCreate",a),this.writeBuffer.push(a),d&&this.once("flush",d),this.flush()};d.prototype.close=function(){function a(){d.onClose("forced close");k("socket closing - telling transport to close");d.transport.close()}function b(){d.removeListener("upgrade",b);d.removeListener("upgradeError",b);a()}function c(){d.once("upgrade",b);d.once("upgradeError",b)}if("opening"===
this.readyState||"open"===this.readyState){this.readyState="closing";var d=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?c():a()}):this.upgrading?c():a()}return this};d.prototype.onError=function(a){k("socket error %j",a);d.priorWebsocketSuccess=!1;this.emit("error",a);this.onClose("transport error",a)};d.prototype.onClose=function(a,b){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)k('socket close with reason: "%s"',a),clearTimeout(this.pingIntervalTimer),
clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",a,b),this.writeBuffer=[],this.prevBufferLen=0};d.prototype.filterUpgrades=function(a){for(var b=[],c=0,d=a.length;c<d;c++)~f(this.transports,a[c])&&b.push(a[c]);return b}}).call(a,function(){return this}())},function(b,a,c){(function(b){var d=c(18),e=c(20),p=c(34),k=c(35);a.polling=function(a){var c,f=!1,k=
!1,u=!1!==a.jsonp;b.location&&(k="https:"===location.protocol,(f=location.port)||(f=k?443:80),f=a.hostname!==location.hostname||f!==a.port,k=a.secure!==k);if(a.xdomain=f,a.xscheme=k,c=new d(a),"open"in c&&!a.forceJSONP)return new e(a);if(!u)throw Error("JSONP disabled");return new p(a)};a.websocket=k}).call(a,function(){return this}())},function(b,a,c){(function(a){var d=c(19);b.exports=function(b){var c=b.xdomain,e=b.xscheme;b=b.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!c||d))return new XMLHttpRequest}catch(f){}try{if("undefined"!=
typeof XDomainRequest&&!e&&b)return new XDomainRequest}catch(f){}if(!c)try{return new (a[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(f){}}}).call(a,function(){return this}())},function(b,a){try{b.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(c){b.exports=!1}},function(b,a,c){(function(a){function d(){}function e(b){if(m.call(this,b),this.requestTimeout=b.requestTimeout,this.extraHeaders=b.extraHeaders,a.location){var c="https:"===location.protocol,
d=location.port;d||(d=c?443:80);this.xd=b.hostname!==a.location.hostname||d!==b.port;this.xs=b.secure!==c}}function p(a){this.method=a.method||"GET";this.uri=a.uri;this.xd=!!a.xd;this.xs=!!a.xs;this.async=!1!==a.async;this.data=void 0!==a.data?a.data:null;this.agent=a.agent;this.isBinary=a.isBinary;this.supportsBinary=a.supportsBinary;this.enablesXDR=a.enablesXDR;this.requestTimeout=a.requestTimeout;this.pfx=a.pfx;this.key=a.key;this.passphrase=a.passphrase;this.cert=a.cert;this.ca=a.ca;this.ciphers=
a.ciphers;this.rejectUnauthorized=a.rejectUnauthorized;this.extraHeaders=a.extraHeaders;this.create()}function k(){for(var a in p.requests)p.requests.hasOwnProperty(a)&&p.requests[a].abort()}var f=c(18),m=c(21),q=c(8),w=c(32),u=c(3)("engine.io-client:polling-xhr");b.exports=e;b.exports.Request=p;w(e,m);e.prototype.supportsBinary=!0;e.prototype.request=function(a){return a=a||{},a.uri=this.uri(),a.xd=this.xd,a.xs=this.xs,a.agent=this.agent||!1,a.supportsBinary=this.supportsBinary,a.enablesXDR=this.enablesXDR,
a.pfx=this.pfx,a.key=this.key,a.passphrase=this.passphrase,a.cert=this.cert,a.ca=this.ca,a.ciphers=this.ciphers,a.rejectUnauthorized=this.rejectUnauthorized,a.requestTimeout=this.requestTimeout,a.extraHeaders=this.extraHeaders,new p(a)};e.prototype.doWrite=function(a,b){a=this.request({method:"POST",data:a,isBinary:"string"!=typeof a&&void 0!==a});var c=this;a.on("success",b);a.on("error",function(a){c.onError("xhr post error",a)});this.sendXhr=a};e.prototype.doPoll=function(){u("xhr poll");var a=
this.request(),b=this;a.on("data",function(a){b.onData(a)});a.on("error",function(a){b.onError("xhr poll error",a)});this.pollXhr=a};q(p.prototype);p.prototype.create=function(){var b={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;var c=this.xhr=new f(b),d=this;try{u("xhr open %s: %s",this.method,this.uri);c.open(this.method,
this.uri,this.async);try{if(this.extraHeaders){c.setDisableHeaderCheck&&c.setDisableHeaderCheck(!0);for(var e in this.extraHeaders)this.extraHeaders.hasOwnProperty(e)&&c.setRequestHeader(e,this.extraHeaders[e])}}catch(E){}if("POST"===this.method)try{this.isBinary?c.setRequestHeader("Content-type","application/octet-stream"):c.setRequestHeader("Content-type","text/plain;charset\x3dUTF-8")}catch(E){}try{c.setRequestHeader("Accept","*/*")}catch(E){}"withCredentials"in c&&(c.withCredentials=!0);this.requestTimeout&&
(c.timeout=this.requestTimeout);this.hasXDR()?(c.onload=function(){d.onLoad()},c.onerror=function(){d.onError(c.responseText)}):c.onreadystatechange=function(){if(2===c.readyState){try{var a=c.getResponseHeader("Content-Type")}catch(T){}"application/octet-stream"===a&&(c.responseType="arraybuffer")}4===c.readyState&&(200===c.status||1223===c.status?d.onLoad():setTimeout(function(){d.onError(c.status)},0))};u("xhr data %s",this.data);c.send(this.data)}catch(E){return void setTimeout(function(){d.onError(E)},
0)}a.document&&(this.index=p.requestsCount++,p.requests[this.index]=this)};p.prototype.onSuccess=function(){this.emit("success");this.cleanup()};p.prototype.onData=function(a){this.emit("data",a);this.onSuccess()};p.prototype.onError=function(a){this.emit("error",a);this.cleanup(!0)};p.prototype.cleanup=function(b){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=d:this.xhr.onreadystatechange=d,b)try{this.xhr.abort()}catch(r){}a.document&&delete p.requests[this.index];
this.xhr=null}};p.prototype.onLoad=function(){try{try{var a=this.xhr.getResponseHeader("Content-Type")}catch(K){}var b="application/octet-stream"===a?this.xhr.response||this.xhr.responseText:this.xhr.responseText}catch(K){this.onError(K)}null!=b&&this.onData(b)};p.prototype.hasXDR=function(){return"undefined"!=typeof a.XDomainRequest&&!this.xs&&this.enablesXDR};p.prototype.abort=function(){this.cleanup()};p.requestsCount=0;p.requests={};a.document&&(a.attachEvent?a.attachEvent("onunload",k):a.addEventListener&&
a.addEventListener("beforeunload",k,!1))}).call(a,function(){return this}())},function(b,a,c){function e(a){var b=a&&a.forceBase64;m&&!b||(this.supportsBinary=!1);d.call(this,a)}var d=c(22),l=c(31),p=c(23);a=c(32);var k=c(33),f=c(3)("engine.io-client:polling");b.exports=e;var m=null!=(new (c(18))({xdomain:!1})).responseType;a(e,d);e.prototype.name="polling";e.prototype.doOpen=function(){this.poll()};e.prototype.pause=function(a){function b(){f("paused");c.readyState="paused";a()}var c=this;if(this.readyState=
"pausing",this.polling||!this.writable){var d=0;this.polling&&(f("we are currently polling - waiting to pause"),d++,this.once("pollComplete",function(){f("pre-pause polling complete");--d||b()}));this.writable||(f("we are currently writing - waiting to pause"),d++,this.once("drain",function(){f("pre-pause writing complete");--d||b()}))}else b()};e.prototype.poll=function(){f("polling");this.polling=!0;this.doPoll();this.emit("poll")};e.prototype.onData=function(a){var b=this;f("polling got data %s",
a);p.decodePayload(a,this.socket.binaryType,function(a,c,d){return"opening"===b.readyState&&b.onOpen(),"close"===a.type?(b.onClose(),!1):void b.onPacket(a)});"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():f('ignoring poll - transport state "%s"',this.readyState))};e.prototype.doClose=function(){function a(){f("writing close packet");b.write([{type:"close"}])}var b=this;"open"===this.readyState?(f("transport open - closing"),a()):(f("transport not open - deferring close"),
this.once("open",a))};e.prototype.write=function(a){var b=this;this.writable=!1;var c=function(){b.writable=!0;b.emit("drain")};p.encodePayload(a,this.supportsBinary,function(a){b.doWrite(a,c)})};e.prototype.uri=function(){var a=this.query||{},b=this.secure?"https":"http",c="";!1!==this.timestampRequests&&(a[this.timestampParam]=k());this.supportsBinary||a.sid||(a.b64=1);a=l.encode(a);this.port&&("https"===b&&443!==Number(this.port)||"http"===b&&80!==Number(this.port))&&(c=":"+this.port);a.length&&
(a="?"+a);var d=-1!==this.hostname.indexOf(":");return b+"://"+(d?"["+this.hostname+"]":this.hostname)+c+this.path+a}},function(b,a,c){function e(a){this.path=a.path;this.hostname=a.hostname;this.port=a.port;this.secure=a.secure;this.query=a.query;this.timestampParam=a.timestampParam;this.timestampRequests=a.timestampRequests;this.readyState="";this.agent=a.agent||!1;this.socket=a.socket;this.enablesXDR=a.enablesXDR;this.pfx=a.pfx;this.key=a.key;this.passphrase=a.passphrase;this.cert=a.cert;this.ca=
a.ca;this.ciphers=a.ciphers;this.rejectUnauthorized=a.rejectUnauthorized;this.forceNode=a.forceNode;this.extraHeaders=a.extraHeaders;this.localAddress=a.localAddress}var d=c(23);a=c(8);b.exports=e;a(e.prototype);e.prototype.onError=function(a,b){a=Error(a);return a.type="TransportError",a.description=b,this.emit("error",a),this};e.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this};e.prototype.close=function(){return"opening"!==
this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this};e.prototype.send=function(a){if("open"!==this.readyState)throw Error("Transport not open");this.write(a)};e.prototype.onOpen=function(){this.readyState="open";this.writable=!0;this.emit("open")};e.prototype.onData=function(a){a=d.decodePacket(a,this.socket.binaryType);this.onPacket(a)};e.prototype.onPacket=function(a){this.emit("packet",a)};e.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},
function(b,a,c){(function(b){function d(b,c,d){if(!c)return a.encodeBase64Packet(b,d);var e=new FileReader;return e.onload=function(){b.data=e.result;a.encodePacket(b,c,!0,d)},e.readAsArrayBuffer(b.data)}function e(a,b,c){var d=Array(a.length);c=q(a.length,c);for(var e=function(a,c,e){b(c,function(b,c){d[a]=c;e(b,d)})},h=0;h<a.length;h++)e(h,a[h],c)}var p,k=c(24),f=c(9),m=c(25),q=c(26),w=c(27);b&&b.ArrayBuffer&&(p=c(29));var u="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),h=
"undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),r=u||h;a.protocol=3;var K=a.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},V=k(K),E={type:"error",data:"parser error"},T=c(30);a.encodePacket=function(c,e,h,f){"function"==typeof e&&(f=e,e=!1);"function"==typeof h&&(f=h,h=null);var u=void 0===c.data?void 0:c.data.buffer||c.data;if(b.ArrayBuffer&&u instanceof ArrayBuffer){if(e){h=c.data;e=new Uint8Array(h);h=new Uint8Array(1+h.byteLength);h[0]=K[c.type];for(c=
0;c<e.length;c++)h[c+1]=e[c];c=f(h.buffer)}else c=a.encodeBase64Packet(c,f);return c}if(T&&u instanceof b.Blob)return e?r?c=d(c,e,f):(e=new Uint8Array(1),e[0]=K[c.type],c=new T([e.buffer,c.data]),c=f(c)):c=a.encodeBase64Packet(c,f),c;if(u&&u.base64)return f("b"+a.packets[c.type]+c.data.data);e=K[c.type];return void 0!==c.data&&(e+=h?w.encode(String(c.data),{strict:!1}):String(c.data)),f(""+e)};a.encodeBase64Packet=function(c,d){var e="b"+a.packets[c.type];if(T&&c.data instanceof b.Blob){var h=new FileReader;
return h.onload=function(){var a=h.result.split(",")[1];d(e+a)},h.readAsDataURL(c.data)}try{var f=String.fromCharCode.apply(null,new Uint8Array(c.data))}catch(sa){c=new Uint8Array(c.data);f=Array(c.length);for(var u=0;u<c.length;u++)f[u]=c[u];f=String.fromCharCode.apply(null,f)}return e+=b.btoa(f),d(e)};a.decodePacket=function(b,c,d){if(void 0===b)return E;if("string"==typeof b){if("b"===b.charAt(0))return a.decodeBase64Packet(b.substr(1),c);if(c=d){c=b;try{c=w.decode(c,{strict:!1})}catch(X){c=!1}c=
(b=c,!1===b)}if(c)return E;d=b.charAt(0);return Number(d)==d&&V[d]?1<b.length?{type:V[d],data:b.substring(1)}:{type:V[d]}:E}d=(new Uint8Array(b))[0];b=m(b,1);return T&&"blob"===c&&(b=new T([b])),{type:V[d],data:b}};a.decodeBase64Packet=function(a,b){var c=V[a.charAt(0)];if(!p)return{type:c,data:{base64:!0,data:a.substr(1)}};a=p.decode(a.substr(1));return"blob"===b&&T&&(a=new T([a])),{type:c,data:a}};a.encodePayload=function(b,c,d){function h(b,d){a.encodePacket(b,!!u&&c,!1,function(a){d(null,a.length+
":"+a)})}"function"==typeof c&&(d=c,c=null);var u=f(b);return c&&u?T&&!r?a.encodePayloadAsBlob(b,d):a.encodePayloadAsArrayBuffer(b,d):b.length?void e(b,h,function(a,b){return d(b.join(""))}):d("0:")};a.decodePayload=function(b,c,d){if("string"!=typeof b)return a.decodePayloadAsBinary(b,c,d);"function"==typeof c&&(d=c,c=null);var e;if(""===b)return d(E,0,1);for(var h,f,u="",r=0,k=b.length;r<k;r++){var m=b.charAt(r);if(":"===m){if(""===u||u!=(h=Number(u))||(f=b.substr(r+1,h),u!=f.length))return d(E,
0,1);if(f.length){if(e=a.decodePacket(f,c,!1),E.type===e.type&&E.data===e.data)return d(E,0,1);if(!1===d(e,r+h,k))return}r+=h;u=""}else u+=m}return""!==u?d(E,0,1):void 0};a.encodePayloadAsArrayBuffer=function(b,c){function d(b,c){a.encodePacket(b,!0,!0,function(a){return c(null,a)})}return b.length?void e(b,d,function(a,b){a=b.reduce(function(a,b){var c;return c="string"==typeof b?b.length:b.byteLength,a+c.toString().length+c+2},0);var d=new Uint8Array(a),e=0;return b.forEach(function(a){var b="string"==
typeof a,c=a;if(b){c=new Uint8Array(a.length);for(var h=0;h<a.length;h++)c[h]=a.charCodeAt(h);c=c.buffer}b?d[e++]=0:d[e++]=1;a=c.byteLength.toString();for(h=0;h<a.length;h++)d[e++]=parseInt(a[h]);d[e++]=255;c=new Uint8Array(c);for(h=0;h<c.length;h++)d[e++]=c[h]}),c(d.buffer)}):c(new ArrayBuffer(0))};a.encodePayloadAsBlob=function(b,c){e(b,function(b,c){a.encodePacket(b,!0,!0,function(a){var b=new Uint8Array(1);if(b[0]=1,"string"==typeof a){for(var d=new Uint8Array(a.length),e=0;e<a.length;e++)d[e]=
a.charCodeAt(e);a=d.buffer;b[0]=0}d=(a instanceof ArrayBuffer?a.byteLength:a.size).toString();var h=new Uint8Array(d.length+1);for(e=0;e<d.length;e++)h[e]=parseInt(d[e]);if(h[d.length]=255,T)a=new T([b.buffer,h.buffer,a]),c(null,a)})},function(a,b){return c(new T(b))})};a.decodePayloadAsBinary=function(b,c,d){"function"==typeof c&&(d=c,c=null);for(var e=[];0<b.byteLength;){for(var h=new Uint8Array(b),f=0===h[0],u="",r=1;255!==h[r];r++){if(310<u.length)return d(E,0,1);u+=h[r]}b=m(b,2+u.length);u=parseInt(u);
h=m(b,0,u);if(f)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(Qa){for(f=new Uint8Array(h),h="",r=0;r<f.length;r++)h+=String.fromCharCode(f[r])}e.push(h);b=m(b,u)}var k=e.length;e.forEach(function(b,e){d(a.decodePacket(b,c,!0),e,k)})}}).call(a,function(){return this}())},function(b,a){b.exports=Object.keys||function(a){var b=[],c=Object.prototype.hasOwnProperty,l;for(l in a)c.call(a,l)&&b.push(l);return b}},function(b,a){b.exports=function(a,b,d){var c=a.byteLength;if(b=b||0,d=d||c,
a.slice)return a.slice(b,d);if(0>b&&(b+=c),0>d&&(d+=c),d>c&&(d=c),b>=c||b>=d||0===c)return new ArrayBuffer(0);a=new Uint8Array(a);c=new Uint8Array(d-b);for(var e=0;b<d;b++,e++)c[e]=a[b];return c.buffer}},function(b,a){function c(){}b.exports=function(a,b,l){function d(a,c){if(0>=d.count)throw Error("after called too many times");--d.count;a?(e=!0,b(a),b=l):0!==d.count||e||b(null,c)}var e=!1;return l=l||c,d.count=a,0===a?b():d}},function(b,a,c){var e;(function(b,c){!function(c){function d(a){for(var b,
c,d=[],e=0,h=a.length;e<h;)b=a.charCodeAt(e++),55296<=b&&56319>=b&&e<h?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function f(a,b){if(55296<=a&&57343>=a){if(b)throw Error("Lone surrogate U+"+a.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function m(){if(h>=u)throw Error("Invalid byte index");var a=255&l[h];if(h++,128==(192&a))return 63&a;throw Error("Invalid continuation byte");}function p(a){var b,c,d,e,
r;if(h>u)throw Error("Invalid byte index");if(h==u)return!1;if(b=255&l[h],h++,0==(128&b))return b;if(192==(224&b)){if(c=m(),r=(31&b)<<6|c,128<=r)return r;throw Error("Invalid continuation byte");}if(224==(240&b)){if(c=m(),d=m(),r=(15&b)<<12|c<<6|d,2048<=r)return f(r,a)?r:65533;throw Error("Invalid continuation byte");}if(240==(248&b)&&(c=m(),d=m(),e=m(),r=(7&b)<<18|c<<12|d<<6|e,65536<=r&&1114111>=r))return r;throw Error("Invalid UTF-8 detected");}c="object"==typeof a&&a;"object"==typeof b&&b&&b.exports==
c&&b;var l,u,h,r=String.fromCharCode;e={version:"2.1.2",encode:function(a,b){b=b||{};b=!1!==b.strict;a=d(a);for(var c=a.length,e=-1,h="";++e<c;){var u=a[e];var m=b;if(0==(4294967168&u))m=r(u);else{var k="";m=(0==(4294965248&u)?k=r(u>>6&31|192):0==(4294901760&u)?(f(u,m)||(u=65533),k=r(u>>12&15|224),k+=r(u>>6&63|128)):0==(4292870144&u)&&(k=r(u>>18&7|240),k+=r(u>>12&63|128),k+=r(u>>6&63|128)),k+r(63&u|128))}h+=m}return h},decode:function(a,b){b=b||{};b=!1!==b.strict;l=d(a);u=l.length;h=0;var c;for(a=
[];!1!==(c=p(b));)a.push(c);c=a.length;for(var e=-1,f="";++e<c;)b=a[e],65535<b&&(b-=65536,f+=r(b>>>10&1023|55296),b=56320|1023&b),f+=r(b);return f}};!(void 0!==e&&(b.exports=e))}(this)}).call(a,c(28)(b),function(){return this}())},function(b,a){b.exports=function(a){return a.webpackPolyfill||(a.deprecate=function(){},a.paths=[],a.children=[],a.webpackPolyfill=1),a}},function(b,a){!function(){for(var b=new Uint8Array(256),e=0;64>e;e++)b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=
e;a.encode=function(a){var b=new Uint8Array(a),c=b.length,d="";for(a=0;a<c;a+=3)d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b[a]>>2],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&b[a])<<4|b[a+1]>>4],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&b[a+1])<<2|b[a+2]>>6],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&b[a+2]];return 2===c%3?d=d.substring(0,d.length-1)+"\x3d":1===c%3&&(d=d.substring(0,
d.length-2)+"\x3d\x3d"),d};a.decode=function(a){var c=.75*a.length;var d=a.length,e=0;"\x3d"===a[a.length-1]&&(c--,"\x3d"===a[a.length-2]&&c--);var f=new ArrayBuffer(c),m=new Uint8Array(f);for(c=0;c<d;c+=4){var q=b[a.charCodeAt(c)];var w=b[a.charCodeAt(c+1)];var u=b[a.charCodeAt(c+2)];var h=b[a.charCodeAt(c+3)];m[e++]=q<<2|w>>4;m[e++]=(15&w)<<4|u>>2;m[e++]=(3&u)<<6|63&h}return f}}()},function(b,a){(function(a){function c(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.buffer instanceof ArrayBuffer){var d=
c.buffer;if(c.byteLength!==d.byteLength){var e=new Uint8Array(c.byteLength);e.set(new Uint8Array(d,c.byteOffset,c.byteLength));d=e.buffer}a[b]=d}}}function d(a,b){b=b||{};var d=new p;c(a);for(var e=0;e<a.length;e++)d.append(a[e]);return b.type?d.getBlob(b.type):d.getBlob()}function l(a,b){return c(a),new Blob(a,b||{})}var p=a.BlobBuilder||a.WebKitBlobBuilder||a.MSBlobBuilder||a.MozBlobBuilder;try{var k=2===(new Blob(["hi"])).size}catch(q){k=!1}var f;if(f=k)try{f=2===(new Blob([new Uint8Array([1,2])])).size}catch(q){f=
!1}var m=p&&p.prototype.append&&p.prototype.getBlob;b.exports=k?f?a.Blob:l:m?d:void 0}).call(a,function(){return this}())},function(b,a){a.encode=function(a){var b="",c;for(c in a)a.hasOwnProperty(c)&&(b.length&&(b+="\x26"),b+=encodeURIComponent(c)+"\x3d"+encodeURIComponent(a[c]));return b};a.decode=function(a){var b={};a=a.split("\x26");for(var c=0,l=a.length;c<l;c++){var p=a[c].split("\x3d");b[decodeURIComponent(p[0])]=decodeURIComponent(p[1])}return b}},function(b,a){b.exports=function(a,b){var c=
function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a}},function(b,a){function c(a){var b="";do b=l[a%p]+b,a=Math.floor(a/p);while(0<a);return b}function e(){var a=c(+new Date);return a!==d?(f=0,d=a):a+"."+c(f++)}for(var d,l="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),p=64,k={},f=0,m=0;m<p;m++)k[l[m]]=m;e.encode=c;e.decode=function(a){var b=0;for(m=0;m<a.length;m++)b=b*p+k[a.charAt(m)];return b};b.exports=e},function(b,a,c){(function(a){function d(){}
function e(b){p.call(this,b);this.query=this.query||{};f||(a.___eio||(a.___eio=[]),f=a.___eio);this.index=f.length;var c=this;f.push(function(a){c.onData(a)});this.query.j=this.index;a.document&&a.addEventListener&&a.addEventListener("beforeunload",function(){c.script&&(c.script.onerror=d)},!1)}var p=c(21),k=c(32);b.exports=e;var f,m=/\n/g,q=/\\n/g;k(e,p);e.prototype.supportsBinary=!1;e.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);this.form&&
(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null);p.prototype.doClose.call(this)};e.prototype.doPoll=function(){var a=this,b=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);b.async=!0;b.src=this.uri();b.onerror=function(b){a.onError("jsonp poll error",b)};var c=document.getElementsByTagName("script")[0];c?c.parentNode.insertBefore(b,c):(document.head||document.body).appendChild(b);this.script=b;"undefined"!=
typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a);document.body.removeChild(a)},100)};e.prototype.doWrite=function(a,b){function c(){d();b()}function d(){if(e.iframe)try{e.form.removeChild(e.iframe)}catch(C){e.onError("jsonp polling iframe removal error",C)}try{f=document.createElement('\x3ciframe src\x3d"javascript:0" name\x3d"'+e.iframeId+'"\x3e')}catch(C){f=document.createElement("iframe"),f.name=e.iframeId,
f.src="javascript:0"}f.id=e.iframeId;e.form.appendChild(f);e.iframe=f}var e=this;if(!this.form){var f,u=document.createElement("form"),k=document.createElement("textarea"),p=this.iframeId="eio_iframe_"+this.index;u.className="socketio";u.style.position="absolute";u.style.top="-1000px";u.style.left="-1000px";u.target=p;u.method="POST";u.setAttribute("accept-charset","utf-8");k.name="d";u.appendChild(k);document.body.appendChild(u);this.form=u;this.area=k}this.form.action=this.uri();d();a=a.replace(q,
"\\\n");this.area.value=a.replace(m,"\\n");try{this.form.submit()}catch(C){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===e.iframe.readyState&&c()}:this.iframe.onload=c}}).call(a,function(){return this}())},function(b,a,c){(function(a){function d(a){a&&a.forceBase64&&(this.supportsBinary=!1);this.perMessageDeflate=a.perMessageDeflate;this.usingBrowserWebSocket=w&&!a.forceNode;this.protocols=a.protocols;this.usingBrowserWebSocket||(h=u);e.call(this,a)}var e=c(22),p=
c(23),k=c(31),f=c(32),m=c(33),q=c(3)("engine.io-client:websocket"),w=a.WebSocket||a.MozWebSocket;if("undefined"==typeof window)try{var u=c(36)}catch(r){}var h=w;h||"undefined"!=typeof window||(h=u);b.exports=d;f(d,e);d.prototype.name="websocket";d.prototype.supportsBinary=!0;d.prototype.doOpen=function(){if(this.check()){var a=this.uri(),b=this.protocols,c={agent:this.agent,perMessageDeflate:this.perMessageDeflate};c.pfx=this.pfx;c.key=this.key;c.passphrase=this.passphrase;c.cert=this.cert;c.ca=this.ca;
c.ciphers=this.ciphers;c.rejectUnauthorized=this.rejectUnauthorized;this.extraHeaders&&(c.headers=this.extraHeaders);this.localAddress&&(c.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?b?new h(a,b):new h(a):new h(a,b,c)}catch(E){return this.emit("error",E)}void 0===this.ws.binaryType&&(this.supportsBinary=!1);this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer";this.addEventListeners()}};d.prototype.addEventListeners=
function(){var a=this;this.ws.onopen=function(){a.onOpen()};this.ws.onclose=function(){a.onClose()};this.ws.onmessage=function(b){a.onData(b.data)};this.ws.onerror=function(b){a.onError("websocket error",b)}};d.prototype.write=function(b){function c(){d.emit("flush");setTimeout(function(){d.writable=!0;d.emit("drain")},0)}var d=this;this.writable=!1;for(var e=b.length,h=0,f=e;h<f;h++)!function(b){p.encodePacket(b,d.supportsBinary,function(h){if(!d.usingBrowserWebSocket){var f={};(b.options&&(f.compress=
b.options.compress),d.perMessageDeflate)&&("string"==typeof h?a.Buffer.byteLength(h):h.length)<d.perMessageDeflate.threshold&&(f.compress=!1)}try{d.usingBrowserWebSocket?d.ws.send(h):d.ws.send(h,f)}catch(R){q("websocket closed before onclose event")}--e||c()})}(b[h])};d.prototype.onClose=function(){e.prototype.onClose.call(this)};d.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()};d.prototype.uri=function(){var a=this.query||{},b=this.secure?"wss":"ws",c="";this.port&&("wss"===
b&&443!==Number(this.port)||"ws"===b&&80!==Number(this.port))&&(c=":"+this.port);this.timestampRequests&&(a[this.timestampParam]=m());this.supportsBinary||(a.b64=1);a=k.encode(a);a.length&&(a="?"+a);var d=-1!==this.hostname.indexOf(":");return b+"://"+(d?"["+this.hostname+"]":this.hostname)+c+this.path+a};d.prototype.check=function(){return!(!h||"__initialize"in h&&this.name===d.prototype.name)}}).call(a,function(){return this}())},function(b,a){},function(b,a){var c=[].indexOf;b.exports=function(a,
b){if(c)return a.indexOf(b);for(var d=0;d<a.length;++d)if(a[d]===b)return d;return-1}},function(b,a){(function(a){var c=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,l=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,p=/(?:^|:|,)(?:\s*\[)+/g,k=/^\s+/,f=/\s+$/;b.exports=function(b){return"string"==typeof b&&b?(b=b.replace(k,"").replace(f,""),a.JSON&&JSON.parse?JSON.parse(b):c.test(b.replace(d,"@").replace(l,"]").replace(p,""))?(new Function("return "+b))():void 0):null}}).call(a,
function(){return this}())},function(b,a,c){function e(a,b,c){this.io=a;this.nsp=b;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0;c&&c.query&&(this.query=c.query);this.io.autoConnect&&this.open()}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},l=c(7);a=c(8);var p=c(40),
k=c(41),f=c(42),m=c(3)("socket.io-client:socket"),q=c(31);b.exports=e;var w={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},u=a.prototype.emit;a(e.prototype);e.prototype.subEvents=function(){if(!this.subs){var a=this.io;this.subs=[k(a,"open",f(this,"onopen")),k(a,"packet",f(this,"onpacket")),k(a,"close",f(this,"onclose"))]}};e.prototype.open=e.prototype.connect=function(){return this.connected?
this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)};e.prototype.send=function(){var a=p(arguments);return a.unshift("message"),this.emit.apply(this,a),this};e.prototype.emit=function(a){if(w.hasOwnProperty(a))return u.apply(this,arguments),this;var b=p(arguments),c={type:l.EVENT,data:b};return c.options={},c.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof b[b.length-1]&&(m("emitting packet with ack id %d",this.ids),
this.acks[this.ids]=b.pop(),c.id=this.ids++),this.connected?this.packet(c):this.sendBuffer.push(c),delete this.flags,this};e.prototype.packet=function(a){a.nsp=this.nsp;this.io.packet(a)};e.prototype.onopen=function(){if(m("transport is open - connecting"),"/"!==this.nsp)if(this.query){var a="object"===d(this.query)?q.encode(this.query):this.query;m("sending connect packet with query %s",a);this.packet({type:l.CONNECT,query:a})}else this.packet({type:l.CONNECT})};e.prototype.onclose=function(a){m("close (%s)",
a);this.connected=!1;this.disconnected=!0;delete this.id;this.emit("disconnect",a)};e.prototype.onpacket=function(a){if(a.nsp===this.nsp)switch(a.type){case l.CONNECT:this.onconnect();break;case l.EVENT:this.onevent(a);break;case l.BINARY_EVENT:this.onevent(a);break;case l.ACK:this.onack(a);break;case l.BINARY_ACK:this.onack(a);break;case l.DISCONNECT:this.ondisconnect();break;case l.ERROR:this.emit("error",a.data)}};e.prototype.onevent=function(a){var b=a.data||[];m("emitting event %j",b);null!=
a.id&&(m("attaching ack callback to event"),b.push(this.ack(a.id)));this.connected?u.apply(this,b):this.receiveBuffer.push(b)};e.prototype.ack=function(a){var b=this,c=!1;return function(){if(!c){c=!0;var d=p(arguments);m("sending ack %j",d);b.packet({type:l.ACK,id:a,data:d})}}};e.prototype.onack=function(a){var b=this.acks[a.id];"function"==typeof b?(m("calling ack %s with %j",a.id,a.data),b.apply(this,a.data),delete this.acks[a.id]):m("bad ack %s",a.id)};e.prototype.onconnect=function(){this.connected=
!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};e.prototype.emitBuffered=function(){var a;for(a=0;a<this.receiveBuffer.length;a++)u.apply(this,this.receiveBuffer[a]);this.receiveBuffer=[];for(a=0;a<this.sendBuffer.length;a++)this.packet(this.sendBuffer[a]);this.sendBuffer=[]};e.prototype.ondisconnect=function(){m("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};e.prototype.destroy=function(){if(this.subs){for(var a=0;a<this.subs.length;a++)this.subs[a].destroy();
this.subs=null}this.io.destroy(this)};e.prototype.close=e.prototype.disconnect=function(){return this.connected&&(m("performing disconnect (%s)",this.nsp),this.packet({type:l.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this};e.prototype.compress=function(a){return this.flags=this.flags||{},this.flags.compress=a,this}},function(b,a){b.exports=function(a,b){for(var c=[],e=(b=b||0)||0;e<a.length;e++)c[e-b]=a[e];return c}},function(b,a){b.exports=function(a,b,d){return a.on(b,
d),{destroy:function(){a.removeListener(b,d)}}}},function(b,a){var c=[].slice;b.exports=function(a,b){if("string"==typeof b&&(b=a[b]),"function"!=typeof b)throw Error("bind() requires a function");var d=c.call(arguments,2);return function(){return b.apply(a,d.concat(c.call(arguments)))}}},function(b,a){function c(a){a=a||{};this.ms=a.min||100;this.max=a.max||1E4;this.factor=a.factor||2;this.jitter=0<a.jitter&&1>=a.jitter?a.jitter:0;this.attempts=0}b.exports=c;c.prototype.duration=function(){var a=
this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var b=Math.random(),c=Math.floor(b*this.jitter*a);a=0==(1&Math.floor(10*b))?a-c:a+c}return 0|Math.min(a,this.max)};c.prototype.reset=function(){this.attempts=0};c.prototype.setMin=function(a){this.ms=a};c.prototype.setMax=function(a){this.max=a};c.prototype.setJitter=function(a){this.jitter=a}}])});window.TK=window.TK||{};
TK.EventDispatcher=function(b){var a={};b=b||{};b.dispatcher={};b.dispatcher.eventListeners={};b.dispatcher.backupListerners={};a.addEventListener=function(a,e,d){void 0!==a&&null!==a&&(void 0===b.dispatcher.eventListeners[a]&&(b.dispatcher.eventListeners[a]=[]),b.dispatcher.eventListeners[a].push(e),d&&(void 0===b.dispatcher.backupListerners[d]&&(b.dispatcher.backupListerners[d]=[]),b.dispatcher.backupListerners[d].push({eventType:a,listener:e})))};a.removeEventListener=function(a,e){b.dispatcher.eventListeners[a]?
(e=b.dispatcher.eventListeners[a].indexOf(e),-1!==e&&b.dispatcher.eventListeners[a].splice(e,1)):L.Logger.info("[tk-sdk]not event type: "+a)};a.removeAllEventListener=function(c){if(c&&"object"===typeof c&&"number"===typeof c.length&&"function"===typeof c.splice&&!c.propertyIsEnumerable("length"))for(var e in c){var d=c[e];delete b.dispatcher.eventListeners[d]}else if("string"===typeof c)delete b.dispatcher.eventListeners[c];else if("object"===typeof c)for(var l in c)d=l,a.removeEventListener(d,c[l])};
a.dispatchEvent=function(a,e){var c;(void 0!=e?e:1)&&L.Logger.debug("sdk-dispatchEvent , event type: "+a.type);for(c in b.dispatcher.eventListeners[a.type])if(b.dispatcher.eventListeners[a.type].hasOwnProperty(c))b.dispatcher.eventListeners[a.type][c](a)};a.removeBackupListerner=function(c){if(c&&b.dispatcher.backupListerners[c]){for(var e=0;e<b.dispatcher.backupListerners[c].length;e++){var d=b.dispatcher.backupListerners[c][e];a.removeEventListener(d.eventType,d.listener)}b.dispatcher.backupListerners[c].length=
0;delete b.dispatcher.backupListerners[c]}};return a};TK.TalkEvent=function(b){var a={};a.type=b.type;a.data=b.data;return a};TK.RoomEvent=function(b,a){var c=TK.TalkEvent(b);c.streams=b.streams;c.message=b.message;c.user=b.user;c.userid=b.user?b.user.id:void 0;if(a&&"object"===typeof a)for(var e in a)c[e]=a[e];return c};
TK.StreamEvent=function(b,a){var c=TK.TalkEvent(b);c.stream=b.stream;c.message=b.message;c.bandwidth=b.bandwidth;c.attrs=b.attrs;c.userid=b.stream&&b.stream.extensionId&&b.stream.getAttributes&&b.stream.getAttributes()&&b.stream.getAttributes().type?b.stream.extensionId.replace(new RegExp(":"+b.stream.getAttributes().type,"g"),""):void 0;c.streamType=b.stream&&b.stream.extensionId&&b.stream.getAttributes&&b.stream.getAttributes()&&b.stream.getAttributes().type?b.stream.getAttributes().type:void 0;
c.streamInfo={audio:b.stream&&b.stream.hasAudio?b.stream.hasAudio():!1,video:b.stream&&b.stream.hasVideo?b.stream.hasVideo():!1,attributes:b.stream&&b.stream.getAttributes?b.stream.getAttributes():{}};if(a&&"object"===typeof a)for(var e in a)c[e]=a[e];return c};TK.PublisherEvent=function(b,a){b=TK.TalkEvent(b);if(a&&"object"===typeof a)for(var c in a)b[c]=a[c];return b};TK.coreEventController=TK.EventDispatcher({});window.TK=window.TK||{};
TK.FcStack=function(b){var a={pcConfig:{},peerConnection:{},desc:{},signalCallback:void 0};window.L=window.L||{};a.close=function(){L.Logger.debug("[tk-sdk]Close FcStack")};a.createOffer=function(){L.Logger.debug("[tk-sdk]FCSTACK: CreateOffer")};a.addStream=function(a){L.Logger.debug("[tk-sdk]FCSTACK: addStream",a)};a.removeStream=function(a){L.Logger.debug("[tk-sdk]FCSTACK: removeStream",a)};a.processSignalingMessage=function(b){L.Logger.debug("[tk-sdk]FCSTACK: processSignaling",b);void 0!==a.signalCallback&&
a.signalCallback(b)};a.sendSignalingMessage=function(a){L.Logger.debug("[tk-sdk]FCSTACK: Sending signaling Message",a);b.callback(a)};a.setSignalingCallback=function(b){L.Logger.debug("[tk-sdk]FCSTACK: Setting signalling callback");a.signalCallback=b};return a};window.TK=window.TK||{};
TK.FirefoxStack=function(b){var a={},c=mozRTCPeerConnection,e=mozRTCSessionDescription,d=mozRTCIceCandidate;a.pcConfig={iceServers:[]};void 0!==b.iceServers&&(a.pcConfig.iceServers=b.iceServers);void 0===b.audio&&(b.audio=!0);void 0===b.video&&(b.video=!0);a.mediaConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0,mozDontOfferDataChannel:!0};var l=function(a){L.Logger.error("[tk-sdk]Error in Stack ",a)},p=function(){b.video&&b.simulcast&&a.peerConnection.getSenders().forEach(function(a){"video"===a.track.kind&&
(a.getParameters(),a.setParameters({encodings:[{rid:"spam",active:!0,priority:"high",maxBitrate:4E4,maxHeight:640,maxWidth:480},{rid:"egg",active:!0,priority:"medium",maxBitrate:1E4,maxHeight:320,maxWidth:240}]}))})},k=!1;a.peerConnection=new c(a.pcConfig,a.con);b.localCandidates=[];a.peerConnection.onicecandidate=function(a){a.candidate?(k=!0,a.candidate.candidate.match(/a=/)||(a.candidate.candidate="a\x3d"+a.candidate.candidate),a=a.candidate,b.remoteDescriptionSet?b.callback({type:"candidate",
candidate:a}):(b.localCandidates.push(a),L.Logger.debug("[tk-sdk]Local Candidates stored: ",b.localCandidates.length,b.localCandidates))):L.Logger.debug("[tk-sdk]Gathered all candidates. Sending END candidate")};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.target.iceConnectionState)};
var f=function(a){if(TK.isHiFi){a=a.replace(/a=fmtp:111 minptime=10;useinbandfec=1;maxaveragebitrate=128000;maxplaybackrate=48000;stereo=1\r\n/g,"");var b=a.match(/a=rtpmap:111.*\r\n/);null==b&&(b=a.match(/a=rtpmap:111.*\n/));if(b&&0<b.length){var c=b[0]+"a\x3dfmtp:111 minptime\x3d10;useinbandfec\x3d1;maxaveragebitrate\x3d128000;maxplaybackrate\x3d48000;stereo\x3d1\r\n";a=a.replace(b[0],c)}}return a},m=function(a){if(b.video&&b.maxVideoBW){a=a.replace(/b=AS:.*\r\n/g,"");var c=a.match(/m=video.*\r\n/);
null==c&&(c=a.match(/m=video.*\n/));if(c&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=a.replace(c[0],d)}}b.audio&&b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/),null==c&&(c=a.match(/m=audio.*\n/)),c&&0<c.length&&(d=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],d)));return a},q,w=function(a){a.sdp=m(a.sdp);a.sdp=a.sdp.replace(/a=ice-options:google-ice\r\n/g,"");b.callback(a);q=a},u=function(c){c.sdp=m(c.sdp);c.sdp=c.sdp.replace(/a=ice-options:google-ice\r\n/g,"");b.callback(c);(q=c)?
a.peerConnection.setLocalDescription(q):L.Logger.error("[tk-sdk]localDesc is not exist!")};a.updateSpec=function(a){if(a.maxVideoBW||a.maxAudioBW){a.maxVideoBW&&(L.Logger.debug("[tk-sdk]Maxvideo Requested",a.maxVideoBW,"limit",b.limitMaxVideoBW),a.maxVideoBW>b.limitMaxVideoBW&&(a.maxVideoBW=b.limitMaxVideoBW),b.maxVideoBW=a.maxVideoBW);a.maxAudioBW&&(a.maxAudioBW>b.limitMaxAudioBW&&(a.maxAudioBW=b.limitMaxAudioBW),b.maxAudioBW=a.maxAudioBW);if(!q){L.Logger.error("[tk-sdk]localDesc is not exist!");
return}q.sdp=m(q.sdp);a.Sdp?L.Logger.error("[tk-sdk]Cannot update with renegotiation in Firefox, try without renegotiation"):(L.Logger.debug("[tk-sdk]Updating without renegotiation, newVideoBW:",b.maxVideoBW,", newAudioBW:",b.maxAudioBW),b.callback({type:"updatestream",sdp:q.sdp}))}if(a.minVideoBW||void 0!==a.slideShowMode||void 0!==a.muteStream||void 0!==a.qualityLayer)L.Logger.debug("[tk-sdk]MinVideo Changed to ",a.minVideoBW),L.Logger.debug("[tk-sdk]SlideShowMode Changed to ",a.slideShowMode),
L.Logger.debug("[tk-sdk]muteStream changed to ",a.muteStream),b.callback({type:"updatestream",config:a})};a.createOffer=function(b){!0!==b&&(p(),a.mediaConstraints={offerToReceiveAudio:!1,offerToReceiveVideo:!1,mozDontOfferDataChannel:!0});a.peerConnection.createOffer(w,l,a.mediaConstraints)};a.addStream=function(b){a.peerConnection.addStream(b)};a.removeStream=function(b){a.peerConnection.removeStream(b)};b.remoteCandidates=[];b.remoteDescriptionSet=!1;a.close=function(){try{a&&a.peerConnection&&
"closed"!==a.peerConnection.signalingState&&a.peerConnection&&a.peerConnection.close&&(a.peerConnection.close(),a.state="closed")}catch(h){L.Logger.error("[tk-sdk]peerConnection close error:",h)}};a.processSignalingMessage=function(c){if("offer"===c.type)c.sdp=m(c.sdp),TK.isHiFi&&(c.sdp=f(c.sdp)),a.peerConnection.setRemoteDescription(new e(c),function(){a.peerConnection.createAnswer(u,function(a){L.Logger.error("[tk-sdk]Error",a)},a.mediaConstraints);b.remoteDescriptionSet=!0},function(a){L.Logger.error("[tk-sdk]Error setting Remote Description",
a)});else if("answer"===c.type)q?(TK.isHiFi&&(c.sdp=f(c.sdp)),L.Logger.debug("[tk-sdk]Set remote and local description"),L.Logger.debug("[tk-sdk]Local Description to set",q.sdp),L.Logger.debug("[tk-sdk]Remote Description to set",c.sdp),c.sdp=m(c.sdp),a.peerConnection.setLocalDescription(q,function(){a.peerConnection.setRemoteDescription(new e(c),function(){b.remoteDescriptionSet=!0;for(L.Logger.debug("[tk-sdk]Remote Description successfully set");0<b.remoteCandidates.length&&k;)L.Logger.debug("[tk-sdk]Setting stored remote candidates"),
a.peerConnection.addIceCandidate(b.remoteCandidates.shift());for(;0<b.localCandidates.length;)L.Logger.debug("[tk-sdk]Sending Candidate from list"),b.callback({type:"candidate",candidate:b.localCandidates.shift()})},function(a){L.Logger.error("[tk-sdk]Error Setting Remote Description",a)})},function(a){L.Logger.error("[tk-sdk]Failure setting Local Description",a)})):L.Logger.error("[tk-sdk]localDesc is not exist!");else if("candidate"===c.type)try{var h="object"===typeof c.candidate?c.candidate:L.Utils.toJsonParse(c.candidate);
h.candidate=h.candidate.replace(/ generation 0/g,"");h.candidate=h.candidate.replace(/ udp /g," UDP ");h.sdpMLineIndex=parseInt(h.sdpMLineIndex);var p=new d(h);if(b.remoteDescriptionSet&&k)for(a.peerConnection.addIceCandidate(p);0<b.remoteCandidates.length;)L.Logger.debug("[tk-sdk]Setting stored remote candidates"),a.peerConnection.addIceCandidate(b.remoteCandidates.shift());else b.remoteCandidates.push(p)}catch(V){L.Logger.error("[tk-sdk]Error parsing candidate",c.candidate,V)}};return a};window.TK=window.TK||{};
window.TkWebkitRTCPeerConnection=function(b,a){b&&b.iceTransportPolicy&&(b.iceTransports=b.iceTransportPolicy);b=new webkitRTCPeerConnection(b,a);var c=b.getStats.bind(b);b.getStats=function(a,b,l){var d=arguments;if(0<arguments.length&&"function"===typeof a)return c(a,b);var e=function(a){var b={};a.result().forEach(function(a){var c={id:a.id,timestamp:(new Date(a.timestamp)).getTime(),type:a.type};a.names().forEach(function(b){c[b]=a.stat(b)});b[c.id]=c});return b};if(2<=arguments.length)return c.apply(this,
[function(a){d[1](e(a))},arguments[0]])};return b};
TK.TkChromeStableStack=function(b){var a={},c=window.TkWebkitRTCPeerConnection;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.iceServers&&(a.pcConfig.iceServers=b.iceServers);void 0===b.audio&&(b.audio=!0);void 0===b.video&&(b.video=!0);a.mediaConstraints={mandatory:{OfferToReceiveVideo:b.video,OfferToReceiveAudio:b.audio}};var e=function(a){L.Logger.error("[tk-sdk]Error in Stack ",a)};a.peerConnection=new c(a.pcConfig,a.con);var d=function(a){var b="a\x3dssrc-group:SIM";
a.forEach(function(a){b+=" "+a});return b+"\r\n"},l=function(a){if(!b.video||!b.simulcast)return a;var c=a.match(/a=ssrc-group:FID ([0-9]*) ([0-9]*)\r?\n/);if(!c||0>=c.length)return a;var e=b.simulcast.numSpatialLayers||2;var f=parseInt(c[1]),u=parseInt(c[2]),m=a.match(new RegExp("a\x3dssrc:"+c[1]+" cname:(.*)\r?\n"))[1],k=a.match(new RegExp("a\x3dssrc:"+c[1]+" msid:(.*)\r?\n"))[1],p=a.match(new RegExp("a\x3dssrc:"+c[1]+" mslabel:(.*)\r?\n"))[1],l=a.match(new RegExp("a\x3dssrc:"+c[1]+" label:(.*)\r?\n"))[1];
a.match(new RegExp("a\x3dssrc:"+c[1]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});a.match(new RegExp("a\x3dssrc:"+c[2]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});for(var q=[f],w=[u],R=1;R<e;R++)q.push(f+1E3*R),w.push(u+1E3*R);e=d(q);for(var ba in q)f=q[ba],u=w[ba],e+="a\x3dssrc-group:FID "+f+" "+u+"\r\n";for(ba in q)f=q[ba],u=w[ba],e+="a\x3dssrc:"+f+" cname:"+m+"\r\na\x3dssrc:"+f+" msid:"+k+"\r\na\x3dssrc:"+f+" mslabel:"+p+"\r\na\x3dssrc:"+f+" label:"+l+"\r\na\x3dssrc:"+u+
" cname:"+m+"\r\na\x3dssrc:"+u+" msid:"+k+"\r\na\x3dssrc:"+u+" mslabel:"+p+"\r\na\x3dssrc:"+u+" label:"+l+"\r\n";return a.replace(c[0],e+"a\x3dx-google-flag:conference\r\n")},p=function(a){if(TK.isHiFi){a=a.replace(/a=fmtp:111 minptime=10;useinbandfec=1;maxaveragebitrate=128000;maxplaybackrate=48000;stereo=1\r\n/g,"");var b=a.match(/a=rtpmap:111.*\r\n/);null==b&&(b=a.match(/a=rtpmap:111.*\n/));if(b&&0<b.length){var c=b[0]+"a\x3dfmtp:111 minptime\x3d10;useinbandfec\x3d1;maxaveragebitrate\x3d128000;maxplaybackrate\x3d48000;stereo\x3d1\r\n";
a=a.replace(b[0],c)}}return a},k=function(a){if(b.video&&b.maxVideoBW){a=a.replace(/b=AS:.*\r\n/g,"");var c=a.match(/m=video.*\r\n/);null==c&&(c=a.match(/m=video.*\n/));if(c&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=a.replace(c[0],d)}}b.audio&&b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/),null==c&&(c=a.match(/m=audio.*\n/)),c&&0<c.length&&(d=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],d)));return a};a.close=function(){try{a&&a.peerConnection&&"closed"!==a.peerConnection.signalingState&&
a.peerConnection&&a.peerConnection.close&&(a.peerConnection.close(),a.state="closed")}catch(u){L.Logger.error("[tk-sdk]peerConnection close error:",u)}};b.localCandidates=[];a.peerConnection.onicecandidate=function(a){a.candidate?(a.candidate.candidate.match(/a=/)||(a.candidate.candidate="a\x3d"+a.candidate.candidate),a={sdpMLineIndex:a.candidate.sdpMLineIndex,sdpMid:a.candidate.sdpMid,candidate:a.candidate.candidate}):(L.Logger.debug("[tk-sdk]Gathered all candidates. Sending END candidate"),a={sdpMLineIndex:-1,
sdpMid:"end",candidate:"end"});b.remoteDescriptionSet?b.callback({type:"candidate",candidate:a}):(b.localCandidates.push(a),L.Logger.debug("[tk-sdk]Storing candidate: ",b.localCandidates.length,a))};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.target.iceConnectionState)};
var f,m,q=function(a,c){a||(c.sdp=l(c.sdp));c.sdp=k(c.sdp);a=c.sdp;var d=a.match(/a=rtpmap:(.*)opus.*\r\n/);null!==d&&(a=a.replace(d[0],d[0]+"a\x3drtcp-fb:"+d[1]+"nack\r\n"));c.sdp=a;c.sdp=c.sdp.replace(/a=ice-options:google-ice\r\n/g,"");c.sdp=c.sdp.replace(/a=rtcp-fb:\d+ transport-cc\r\n/g,"");b.callback({type:c.type,sdp:c.sdp});f=c},w=function(c){c.sdp=k(c.sdp);b.callback({type:c.type,sdp:c.sdp});(f=c)?a.peerConnection.setLocalDescription(c):L.Logger.error("[tk-sdk]localDesc is not exist!")};a.updateSpec=
function(c,d){if(c.maxVideoBW||c.maxAudioBW){c.maxVideoBW&&(L.Logger.debug("[tk-sdk]Maxvideo Requested:",c.maxVideoBW,"limit:",b.limitMaxVideoBW),c.maxVideoBW>b.limitMaxVideoBW&&(c.maxVideoBW=b.limitMaxVideoBW),b.maxVideoBW=c.maxVideoBW);c.maxAudioBW&&(c.maxAudioBW>b.limitMaxAudioBW&&(c.maxAudioBW=b.limitMaxAudioBW),b.maxAudioBW=c.maxAudioBW);if(!f){L.Logger.error("[tk-sdk]localDesc is not exist!");return}f.sdp=k(f.sdp);c.Sdp||c.maxAudioBW?(L.Logger.debug("[tk-sdk]Updating with SDP renegotiation",
b.maxVideoBW,b.maxAudioBW),a.peerConnection.setLocalDescription(f,function(){m.sdp=k(m.sdp);TK.isHiFi&&(m.sdp=p(m.sdp));a.peerConnection.setRemoteDescription(new RTCSessionDescription(m),function(){b.remoteDescriptionSet=!0;b.callback({type:"updatestream",sdp:f.sdp})})},function(a){L.Logger.error("[tk-sdk]Error updating configuration",a);d("error")})):(L.Logger.debug("[tk-sdk]Updating without SDP renegotiation, newVideoBW:",b.maxVideoBW,"newAudioBW:",b.maxAudioBW),b.callback({type:"updatestream",
sdp:f.sdp}))}if(c.minVideoBW||void 0!==c.slideShowMode||void 0!==c.muteStream||void 0!==c.qualityLayer)L.Logger.debug("[tk-sdk]MinVideo Changed to ",c.minVideoBW),L.Logger.debug("[tk-sdk]SlideShowMode Changed to ",c.slideShowMode),L.Logger.debug("[tk-sdk]muteStream changed to ",c.muteStream),b.callback({type:"updatestream",config:c})};a.createOffer=function(b){!0!==b&&(a.mediaConstraints={mandatory:{OfferToReceiveVideo:!1,OfferToReceiveAudio:!1}});a.peerConnection.createOffer(q.bind(null,b),e,a.mediaConstraints)};
a.addStream=function(b){b?a.peerConnection.addStream(b):L.Logger.error("[tk-sdk]chromeStableStack addStream : stream is not exist!")};a.removeStream=function(b){a.peerConnection.removeStream(b)};a.getStats=function(b){if(b&&"function"===typeof b)if(a.peerConnection&&a.peerConnection.getStats)try{a.peerConnection.getStats(void 0,function(a){b(a,void 0)},function(a){L.Logger.error("[tk-sdk]that.peerConnection.getStats error:",a);b(void 0,-2)})}catch(h){L.Logger.error("[tk-sdk]that.peerConnection.getStats error:",
h),b(void 0,-3)}else b(void 0,-1)};b.remoteCandidates=[];b.remoteDescriptionSet=!1;a.processSignalingMessage=function(c,d){L.Logger.debug("[tk-sdk]Process Signaling Message ",L.Utils.toJsonStringify(c));if(c.sdp&&"answer"===c.type){var e=c.sdp,h=e.indexOf("udp");if(-1!==h){var u="";d&&(u+="stream sdp info:stream id:"+d.getID()+" , extensionId is "+d.extensionId+", attrs is "+L.Utils.toJsonStringify(d.getAttributes())+". \n");u+="udp info:"+(window.__TkSdkBuild__?L.Utils.encrypt(e.substr(h,58)):e.substr(h,
58));L.Logger.info(u)}}if("offer"===c.type)c.sdp=k(c.sdp),TK.isHiFi&&(c.sdp=p(c.sdp)),a.peerConnection.setRemoteDescription(new RTCSessionDescription(c),function(){a.peerConnection.createAnswer(w,function(a){L.Logger.error("[tk-sdk]createAnswer Error: ",a)},a.mediaConstraints);b.remoteDescriptionSet=!0},function(a){L.Logger.error("[tk-sdk]Error setting Remote Description",a)});else if("answer"===c.type)f?(TK.isHiFi&&(c.sdp=p(c.sdp)),L.Logger.debug("[tk-sdk]Set remote and local description"),L.Logger.debug("[tk-sdk]Remote Description",
c.sdp),L.Logger.debug("[tk-sdk]Local Description",f.sdp),c.sdp=k(c.sdp),m=c,a.peerConnection.setLocalDescription(f,function(){a.peerConnection.setRemoteDescription(new RTCSessionDescription(c),function(){b.remoteDescriptionSet=!0;for(L.Logger.debug("[tk-sdk]Candidates to be added: ",b.remoteCandidates.length,b.remoteCandidates);0<b.remoteCandidates.length;)a.peerConnection.addIceCandidate(b.remoteCandidates.shift());for(L.Logger.debug("[tk-sdk]Local candidates to send:",b.localCandidates.length);0<
b.localCandidates.length;)b.callback({type:"candidate",candidate:b.localCandidates.shift()})})})):L.Logger.error("[tk-sdk]localDesc is not exist!");else if("candidate"===c.type)try{var l="object"===typeof c.candidate?c.candidate:L.Utils.toJsonParse(c.candidate);if("end"!==l.candidate){l.candidate=l.candidate.replace(/a=/g,"");l.sdpMLineIndex=parseInt(l.sdpMLineIndex);var q=new RTCIceCandidate(l);b.remoteDescriptionSet?a.peerConnection.addIceCandidate(q):b.remoteCandidates.push(q)}}catch(Z){L.Logger.error("[tk-sdk]Error parsing candidate",
c.candidate)}};return a};window.TK=window.TK||{};
TK.BowserStack=function(b){var a={},c=webkitRTCPeerConnection;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.stunServerUrl&&a.pcConfig.iceServers.push({url:b.stunServerUrl});(b.turnServer||{}).url&&a.pcConfig.iceServers.push({username:b.turnServer.username,credential:b.turnServer.password,url:b.turnServer.url});void 0===b.audio&&(b.audio=!0);void 0===b.video&&(b.video=!0);a.mediaConstraints={offerToReceiveVideo:b.video,offerToReceiveAudio:b.audio};a.peerConnection=
new c(a.pcConfig,a.con);b.remoteDescriptionSet=!1;var e=function(a){if(TK.isHiFi){a=a.replace(/a=fmtp:111 minptime=10;useinbandfec=1;maxaveragebitrate=128000;maxplaybackrate=48000;stereo=1\r\n/g,"");var b=a.match(/a=rtpmap:111.*\r\n/);null==b&&(b=a.match(/a=rtpmap:111.*\n/));if(b&&0<b.length){var c=b[0]+"a\x3dfmtp:111 minptime\x3d10;useinbandfec\x3d1;maxaveragebitrate\x3d128000;maxplaybackrate\x3d48000;stereo\x3d1\r\n";a=a.replace(b[0],c)}}return a},d=function(a){if(b.maxVideoBW){var c=a.match(/m=video.*\r\n/);
null==c&&(c=a.match(/m=video.*\n/));if(c&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=a.replace(c[0],d)}}b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/),null==c&&(c=a.match(/m=audio.*\n/)),c&&0<c.length&&(d=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],d)));return a};a.close=function(){try{a&&a.peerConnection&&"closed"!==a.peerConnection.signalingState&&a.peerConnection&&a.peerConnection.close&&(a.peerConnection.close(),a.state="closed")}catch(m){L.Logger.error("[tk-sdk]peerConnection close error:",
m)}};b.localCandidates=[];a.peerConnection.onicecandidate=function(c){c.candidate?(c.candidate.candidate.match(/a=/)||(c.candidate.candidate="a\x3d"+c.candidate.candidate),b.remoteDescriptionSet?b.callback({type:"candidate",candidate:c.candidate}):b.localCandidates.push(c.candidate)):L.Logger.debug("End of candidates.",a.peerConnection.localDescription)};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};
var l=function(a){L.Logger.debug("Error in Stack ",a)},p,k=function(c){c.sdp=d(c.sdp);L.Logger.debug("Set local description",c.sdp);(p=c)?a.peerConnection.setLocalDescription(p,function(){L.Logger.debug("The final LocalDesc",a.peerConnection.localDescription);b.callback(a.peerConnection.localDescription)},l):L.Logger.error("[tk-sdk]localDesc is not exist!")},f=function(c){c.sdp=d(c.sdp);b.callback(c);(p=c)?a.peerConnection.setLocalDescription(c):L.Logger.error("[tk-sdk]localDesc is not exist!")};
a.createOffer=function(b){!0===b?a.peerConnection.createOffer(k,l,a.mediaConstraints):a.peerConnection.createOffer(k,l)};a.addStream=function(b){a.peerConnection.addStream(b)};b.remoteCandidates=[];a.processSignalingMessage=function(c){L.Logger.debug("Process Signaling Message",c);if("offer"===c.type)c.sdp=d(c.sdp),TK.isHiFi&&(c.sdp=e(c.sdp)),a.peerConnection.setRemoteDescription(new RTCSessionDescription(c)),a.peerConnection.createAnswer(f,null,a.mediaConstraints),b.remoteDescriptionSet=!0;else if("answer"===
c.type)TK.isHiFi&&(c.sdp=e(c.sdp)),L.Logger.debug("Set remote description",c.sdp),c.sdp=d(c.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(c),function(){b.remoteDescriptionSet=!0;for(L.Logger.debug("Candidates to be added: ",b.remoteCandidates.length);0<b.remoteCandidates.length;)L.Logger.debug("Candidate :",b.remoteCandidates[b.remoteCandidates.length-1]),a.peerConnection.addIceCandidate(b.remoteCandidates.shift(),function(){},l);for(;0<b.localCandidates.length;)b.callback({type:"candidate",
candidate:b.localCandidates.shift()})},function(){L.Logger.warning("Error Setting Remote Description")});else if("candidate"===c.type){L.Logger.debug("Message with candidate");try{var k="object"===typeof c.candidate?c.candidate:L.Utils.toJsonParse(c.candidate);k.candidate=k.candidate.replace(/a=/g,"");k.sdpMLineIndex=parseInt(k.sdpMLineIndex);k.sdpMLineIndex="audio"===k.sdpMid?0:1;var p=new RTCIceCandidate(k);L.Logger.debug("Remote Candidate",p);b.remoteDescriptionSet?a.peerConnection.addIceCandidate(p,
function(){},l):b.remoteCandidates.push(p)}catch(u){L.Logger.error("[tk-sdk]Error parsing candidate",c.candidate)}}};return a};window.TK=window.TK||{};
TK.ChromeCanaryStack=function(b){var a={},c=webkitRTCPeerConnection;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.stunServerUrl&&a.pcConfig.iceServers.push({url:b.stunServerUrl});(b.turnServer||{}).url&&a.pcConfig.iceServers.push({username:b.turnServer.username,credential:b.turnServer.password,url:b.turnServer.url});if(void 0===b.audio||b.nop2p)b.audio=!0;if(void 0===b.video||b.nop2p)b.video=!0;a.mediaConstraints={mandatory:{OfferToReceiveVideo:b.video,OfferToReceiveAudio:b.audio}};
a.roapSessionId=103;a.peerConnection=new c(a.pcConfig,a.con);a.peerConnection.onicecandidate=function(c){L.Logger.debug("[tk-sdk]PeerConnection: ",b.sessionId);c.candidate?a.iceCandidateCount+=1:(L.Logger.debug("[tk-sdk]State: "+a.peerConnection.iceGatheringState),void 0===a.ices&&(a.ices=0),a.ices+=1,1<=a.ices&&a.moreIceComing&&(a.moreIceComing=!1,a.markActionNeeded()))};var e=function(a){var c;if(b.maxVideoBW&&(c=a.match(/m=video.*\r\n/))&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=
a.replace(c[0],d)}b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/))&&0<c.length&&(d=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],d));return a};a.processSignalingMessage=function(b){L.Logger.debug("[tk-sdk]Activity on conn "+a.sessionId);b=L.Utils.toJsonParse(b);a.incomingMessage=b;"new"===a.state?"OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+
b.messageType+" in state "+a.state):"offer-sent"===a.state?"ANSWER"===b.messageType?(b={sdp:b.sdp,type:"answer"},L.Logger.debug("[tk-sdk]Received ANSWER: ",b.sdp),b.sdp=e(b.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.sendOK(),a.state="established"):"pr-answer"===b.messageType?(b={sdp:b.sdp,type:"pr-answer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b))):"offer"===b.messageType?a.error("Not written yet"):a.error("Illegal message for this state: "+
b.messageType+" in state "+a.state):"established"===a.state&&("OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+b.messageType+" in state "+a.state))};a.addStream=function(b){a.peerConnection.addStream(b);a.markActionNeeded()};a.removeStream=function(b){a.peerConnection.removeStream(b)};a.removeStream=function(){a.markActionNeeded()};a.close=
function(){try{a&&a.peerConnection&&"closed"!==a.peerConnection.signalingState&&a.peerConnection&&a.peerConnection.close&&(a.peerConnection.close(),a.state="closed")}catch(d){L.Logger.error("[tk-sdk]peerConnection close error:",d)}};a.markActionNeeded=function(){a.actionNeeded=!0;a.doLater(function(){a.onstablestate()})};a.doLater=function(a){window.setTimeout(a,1)};a.onstablestate=function(){if(a.actionNeeded){if("new"===a.state||"established"===a.state)a.peerConnection.createOffer(function(b){b.sdp=
e(b.sdp);L.Logger.debug("[tk-sdk]Changed",b.sdp);b.sdp!==a.prevOffer?(a.peerConnection.setLocalDescription(b),a.state="preparing-offer",a.markActionNeeded()):L.Logger.debug("[tk-sdk]Not sending a new offer")},null,a.mediaConstraints);else if("preparing-offer"===a.state){if(a.moreIceComing)return;a.prevOffer=a.peerConnection.localDescription.sdp;L.Logger.debug("[tk-sdk]Sending OFFER: "+a.prevOffer);a.sendMessage("OFFER",a.prevOffer);a.state="offer-sent"}else if("offer-received"===a.state)a.peerConnection.createAnswer(function(b){a.peerConnection.setLocalDescription(b);
a.state="offer-received-preparing-answer";a.iceStarted?a.markActionNeeded():(L.Logger.debug("[tk-sdk]"+(new Date).getTime()+": Starting ICE in responder"),a.iceStarted=!0)},null,a.mediaConstraints);else if("offer-received-preparing-answer"===a.state){if(a.moreIceComing)return;var b=a.peerConnection.localDescription.sdp;a.sendMessage("ANSWER",b);a.state="established"}else a.error("Dazed and confused in state "+a.state+", stopping here");a.actionNeeded=!1}};a.sendOK=function(){a.sendMessage("OK")};
a.sendMessage=function(b,c){var d={};d.messageType=b;d.sdp=c;"OFFER"===b?(d.offererSessionId=a.sessionId,d.answererSessionId=a.otherSessionId,d.seq=a.sequenceNumber+=1,d.tiebreaker=Math.floor(429496723*Math.random()+1)):(d.offererSessionId=a.incomingMessage.offererSessionId,d.answererSessionId=a.sessionId,d.seq=a.incomingMessage.seq);a.onsignalingmessage(L.Utils.toJsonStringify(d))};a.error=function(a){throw"Error in RoapOnJsep: "+a;};a.sessionId=a.roapSessionId+=1;a.sequenceNumber=0;a.actionNeeded=
!1;a.iceStarted=!1;a.moreIceComing=!0;a.iceCandidateCount=0;a.onsignalingmessage=b.callback;a.peerConnection.onopen=function(){if(a.onopen)a.onopen()};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.currentTarget.iceConnectionState)};a.onaddstream=null;a.onremovestream=
null;a.state="new";a.markActionNeeded();return a};window.TK=window.TK||{};
TK.ChromeRoapStack=function(b){var a={},c=webkitRTCPeerConnection;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.stunServerUrl&&a.pcConfig.iceServers.push({url:b.stunServerUrl});(b.turnServer||{}).url&&a.pcConfig.iceServers.push({username:b.turnServer.username,credential:b.turnServer.password,url:b.turnServer.url});if(void 0===b.audio||b.nop2p)b.audio=!0;if(void 0===b.video||b.nop2p)b.video=!0;a.mediaConstraints={mandatory:{OfferToReceiveVideo:b.video,OfferToReceiveAudio:b.audio}};
a.roapSessionId=103;a.peerConnection=new c(a.pcConfig,a.con);a.peerConnection.onicecandidate=function(c){L.Logger.debug("[tk-sdk]PeerConnection: ",b.sessionId);c.candidate?a.iceCandidateCount+=1:(L.Logger.debug("[tk-sdk]onicecandidate state: "+a.peerConnection.iceGatheringState),void 0===a.ices&&(a.ices=0),a.ices+=1,1<=a.ices&&a.moreIceComing&&(a.moreIceComing=!1,a.markActionNeeded()))};var e=function(a){var c;if(b.maxVideoBW&&(c=a.match(/m=video.*\r\n/))&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+
"\r\n";a=a.replace(c[0],d)}b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/))&&0<c.length&&(d=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],d));return a};a.processSignalingMessage=function(b){L.Logger.debug("[tk-sdk]Activity on conn "+a.sessionId);b=L.Utils.toJsonParse(b);a.incomingMessage=b;"new"===a.state?"OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+
b.messageType+" in state "+a.state):"offer-sent"===a.state?"ANSWER"===b.messageType?(b={sdp:b.sdp,type:"answer"},L.Logger.debug("[tk-sdk]Received ANSWER: ",b.sdp),b.sdp=e(b.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.sendOK(),a.state="established"):"pr-answer"===b.messageType?(b={sdp:b.sdp,type:"pr-answer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b))):"offer"===b.messageType?a.error("Not written yet"):a.error("Illegal message for this state: "+
b.messageType+" in state "+a.state):"established"===a.state&&("OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+b.messageType+" in state "+a.state))};a.addStream=function(b){a.peerConnection.addStream(b);a.markActionNeeded()};a.removeStream=function(b){a.peerConnection.removeStream(b)};a.removeStream=function(){a.markActionNeeded()};a.close=
function(){try{a&&a.peerConnection&&"closed"!==a.peerConnection.signalingState&&a.peerConnection&&a.peerConnection.close&&(a.peerConnection.close(),a.state="closed")}catch(d){L.Logger.error("[tk-sdk]peerConnection close error:",d)}};a.markActionNeeded=function(){a.actionNeeded=!0;a.doLater(function(){a.onstablestate()})};a.doLater=function(a){window.setTimeout(a,1)};a.onstablestate=function(){if(a.actionNeeded){if("new"===a.state||"established"===a.state)a.peerConnection.createOffer(function(b){b.sdp=
e(b.sdp);L.Logger.debug("[tk-sdk]Changed",b.sdp);b.sdp!==a.prevOffer?(a.peerConnection.setLocalDescription(b),a.state="preparing-offer",a.markActionNeeded()):L.Logger.debug("[tk-sdk]Not sending a new offer")},null,a.mediaConstraints);else if("preparing-offer"===a.state){if(a.moreIceComing)return;a.prevOffer=a.peerConnection.localDescription.sdp;L.Logger.debug("[tk-sdk]Sending OFFER: "+a.prevOffer);a.sendMessage("OFFER",a.prevOffer);a.state="offer-sent"}else if("offer-received"===a.state)a.peerConnection.createAnswer(function(b){a.peerConnection.setLocalDescription(b);
a.state="offer-received-preparing-answer";a.iceStarted?a.markActionNeeded():(L.Logger.debug("[tk-sdk]"+(new Date).getTime()+": Starting ICE in responder"),a.iceStarted=!0)},null,a.mediaConstraints);else if("offer-received-preparing-answer"===a.state){if(a.moreIceComing)return;var b=a.peerConnection.localDescription.sdp;a.sendMessage("ANSWER",b);a.state="established"}else a.error("Dazed and confused in state "+a.state+", stopping here");a.actionNeeded=!1}};a.sendOK=function(){a.sendMessage("OK")};
a.sendMessage=function(b,c){var d={};d.messageType=b;d.sdp=c;"OFFER"===b?(d.offererSessionId=a.sessionId,d.answererSessionId=a.otherSessionId,d.seq=a.sequenceNumber+=1,d.tiebreaker=Math.floor(429496723*Math.random()+1)):(d.offererSessionId=a.incomingMessage.offererSessionId,d.answererSessionId=a.sessionId,d.seq=a.incomingMessage.seq);a.onsignalingmessage(L.Utils.toJsonStringify(d))};a.error=function(a){throw"Error in RoapOnJsep: "+a;};a.sessionId=a.roapSessionId+=1;a.sequenceNumber=0;a.actionNeeded=
!1;a.iceStarted=!1;a.moreIceComing=!0;a.iceCandidateCount=0;a.onsignalingmessage=b.callback;a.peerConnection.onopen=function(){if(a.onopen)a.onopen()};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.currentTarget.iceConnectionState)};a.onaddstream=null;a.onremovestream=
null;a.state="new";a.markActionNeeded();return a};window.TK=window.TK||{};TK.nativeEntry=function(){var b=document.getElementById("window.tknative");b&&b.nodeName&&"embed"===b.nodeName.toLowerCase()||(b=document.createElement("embed"),document.body.appendChild(b),b.setAttribute("id","window.tknative"),b.setAttribute("mainentry",!0),b.setAttribute("hidden",!0),b.setAttribute("type","application/x-ppapi-proxy"));return b};
TK.nativePeerConnection=function(b){var a={},c={},e=b.audio,d=b.video,l=b.screen,p=!0;void 0===l&&(l=!1);a.onicecandidate=null;a.onaddstream=null;a.onremovestream=null;a.oniceconnectionstatechange=null;var k=function(){if(!b.cnnId)throw Error("Invalid native-peer-connection ID");return b.media?b.cnnId+":file":b.screen?b.cnnId+":screen":b.cnnId};window.tknative.addEventListener("message",function(b){var d=b.data.name;if(b.data.connectionId==k()){if("onLocalDescription"===d){var e={};e.sdp=b.data.sdp;
e.type="offer";"function"===typeof c.createOffer_suc&&c.createOffer_suc(e);delete c.createOffer_suc;delete c.createOffer_fai}"onIceCandidate"===d&&a.onicecandidate&&(e={candidate:{}},e.candidate.sdpMLineIndex=b.data.sdpMLineIndex,e.candidate.sdpMid=b.data.sdpMid,e.candidate.candidate=b.data.candidate,a.onicecandidate(e));if("onIceStatusChanged"===d){b=b.data.state;if(1==b)a.oniceconnectionstatechange("checking");if(2==b)a.oniceconnectionstatechange("connected");if(3==b)a.oniceconnectionstatechange("completed");
if(4==b)a.oniceconnectionstatechange("failed");if(5==b)a.oniceconnectionstatechange("disconnected");if(6==b)a.oniceconnectionstatechange("closed")}if("onAddStream"===d)a.onaddstream({stream:{}})}},!1);a.close=function(){window.tknative.postMessage({command:"closeConnection",streamId:k().toString(),offerToSend:p,type:Number(b.media?1:b.screen?2:0)})};a.createOffer=function(a,b,q){q&&(p=!1);window.tknative.postMessage({command:"createOffer",streamId:k().toString(),includeLocalMedia:p,hasAudio:e,hasVideo:d,
hasScreen:l,offerToSend:p});c.createOffer_suc=a;c.createOffer_fai=b};a.setRemoteDescription=function(a,b,c){window.tknative.postMessage({command:"setRemoteDescription",sdpAnswer:a.sdp,streamId:k().toString()});b&&"function"===typeof b&&b()};a.addIceCandidate=function(a){window.tknative.postMessage({command:"setIceCandidate",candidate:a.candidate,sdpMid:0,sdpMLineIndex:a.sdpMLineIndex,streamId:k().toString()})};a.addStream=function(a){window.tknative.postMessage({command:"addStream",streamId:k().toString(),
type:Number(b.media?1:b.screen?2:0)})};a.removeStream=function(a){window.tknative.postMessage({command:"removeStream",streamId:k().toString(),type:Number(b.media?1:b.screen?2:0)})};a.setLocalDescription=function(a){};a.getStats=function(a){a&&"function"===typeof a&&a(void 0,-1)};return a};window.TK=window.TK||{};
TK.TkNativeStack=function(b){var a={},c=TK.nativePeerConnection;a.isNative=!0;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.iceServers&&(a.pcConfig.iceServers=b.iceServers);void 0===b.audio&&(b.audio=!0);void 0===b.video&&(b.video=!0);a.mediaConstraints={mandatory:{OfferToReceiveVideo:b.video,OfferToReceiveAudio:b.audio}};var e=function(a){L.Logger.error("Error in Stack ",a)};a.peerConnection=new c(b);var d=function(a){var b="a\x3dssrc-group:SIM";a.forEach(function(a){b+=
" "+a});return b+"\r\n"},l=function(a){if(!b.video||!b.simulcast)return a;var c=a.match(/a=ssrc-group:FID ([0-9]*) ([0-9]*)\r?\n/);if(!c||0>=c.length)return a;var e=b.simulcast.numSpatialLayers||2;var f=parseInt(c[1]),k=parseInt(c[2]),p=a.match(new RegExp("a\x3dssrc:"+c[1]+" cname:(.*)\r?\n"))[1],m=a.match(new RegExp("a\x3dssrc:"+c[1]+" msid:(.*)\r?\n"))[1],l=a.match(new RegExp("a\x3dssrc:"+c[1]+" mslabel:(.*)\r?\n"))[1],q=a.match(new RegExp("a\x3dssrc:"+c[1]+" label:(.*)\r?\n"))[1];a.match(new RegExp("a\x3dssrc:"+
c[1]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});a.match(new RegExp("a\x3dssrc:"+c[2]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});for(var w=[f],Q=[k],X=1;X<e;X++)w.push(f+1E3*X),Q.push(k+1E3*X);e=d(w);for(var R in w)f=w[R],k=Q[R],e+="a\x3dssrc-group:FID "+f+" "+k+"\r\n";for(R in w)f=w[R],k=Q[R],e+="a\x3dssrc:"+f+" cname:"+p+"\r\na\x3dssrc:"+f+" msid:"+m+"\r\na\x3dssrc:"+f+" mslabel:"+l+"\r\na\x3dssrc:"+f+" label:"+q+"\r\na\x3dssrc:"+k+" cname:"+p+"\r\na\x3dssrc:"+k+" msid:"+
m+"\r\na\x3dssrc:"+k+" mslabel:"+l+"\r\na\x3dssrc:"+k+" label:"+q+"\r\n";return a.replace(c[0],e+"a\x3dx-google-flag:conference\r\n")},p=function(a){if(TK.isHiFi){a=a.replace(/a=fmtp:111 minptime=10;useinbandfec=1;maxaveragebitrate=128000;maxplaybackrate=48000;stereo=1\r\n/g,"");var b=a.match(/a=rtpmap:111.*\r\n/);null==b&&(b=a.match(/a=rtpmap:111.*\n/));if(b&&0<b.length){var c=b[0]+"a\x3dfmtp:111 minptime\x3d10;useinbandfec\x3d1;maxaveragebitrate\x3d128000;maxplaybackrate\x3d48000;stereo\x3d1\r\n";
a=a.replace(b[0],c)}}return a},k=function(a){if(b.video&&b.maxVideoBW){a=a.replace(/b=AS:.*\r\n/g,"");var c=a.match(/m=video.*\r\n/);null==c&&(c=a.match(/m=video.*\n/));if(c&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=a.replace(c[0],d)}}b.audio&&b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/),null==c&&(c=a.match(/m=audio.*\n/)),c&&0<c.length&&(d=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],d)));return a};a.close=function(){try{a&&a.peerConnection&&"closed"!==a.peerConnection.signalingState&&
a.peerConnection&&a.peerConnection.close&&(a.peerConnection.close(),a.state="closed")}catch(w){L.Logger.error("[tk-sdk]peerConnection close error:",w)}};b.localCandidates=[];a.peerConnection.onicecandidate=function(a){a.candidate?(a.candidate.candidate.match(/a=/)||(a.candidate.candidate="a\x3d"+a.candidate.candidate),a={sdpMLineIndex:a.candidate.sdpMLineIndex,sdpMid:a.candidate.sdpMid,candidate:a.candidate.candidate}):(L.Logger.debug("Gathered all candidates. Sending END candidate"),a={sdpMLineIndex:-1,
sdpMid:"end",candidate:"end"});b.remoteDescriptionSet?b.callback({type:"candidate",candidate:a}):(b.localCandidates.push(a),L.Logger.debug("Storing candidate: ",b.localCandidates.length,a))};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b)};var f,m=function(a,c){a||(c.sdp=
l(c.sdp));c.sdp=k(c.sdp);a=c.sdp;var d=a.match(/a=rtpmap:(.*)opus.*\r\n/);null!==d&&(a=a.replace(d[0],d[0]+"a\x3drtcp-fb:"+d[1]+"nack\r\n"));c.sdp=a;c.sdp=c.sdp.replace(/a=ice-options:google-ice\r\n/g,"");b.callback({type:c.type,sdp:c.sdp});f=c},q=function(c){c.sdp=k(c.sdp);b.callback({type:c.type,sdp:c.sdp});(f=c)?a.peerConnection.setLocalDescription(c):L.Logger.error("[tk-sdk]localDesc is not exist!")};a.updateSpec=function(c,d){if(c.maxVideoBW||c.maxAudioBW){c.maxVideoBW&&(L.Logger.debug("Maxvideo Requested:",
c.maxVideoBW,"limit:",b.limitMaxVideoBW),c.maxVideoBW>b.limitMaxVideoBW&&(c.maxVideoBW=b.limitMaxVideoBW),b.maxVideoBW=c.maxVideoBW,L.Logger.debug("Result",b.maxVideoBW));c.maxAudioBW&&(c.maxAudioBW>b.limitMaxAudioBW&&(c.maxAudioBW=b.limitMaxAudioBW),b.maxAudioBW=c.maxAudioBW);if(!f){L.Logger.error("[tk-sdk]localDesc is not exist!");return}f.sdp=k(f.sdp);c.Sdp||c.maxAudioBW?(L.Logger.debug("Updating with SDP renegotiation",b.maxVideoBW,b.maxAudioBW),(void 0).sdp=k((void 0).sdp),TK.isHiFi&&((void 0).sdp=
p((void 0).sdp)),a.peerConnection.setRemoteDescription(void 0,function(){b.remoteDescriptionSet=!0;b.callback({type:"updatestream",sdp:f.sdp})})):(L.Logger.debug("Updating without SDP renegotiation, newVideoBW:",b.maxVideoBW,"newAudioBW:",b.maxAudioBW),b.callback({type:"updatestream",sdp:f.sdp}))}if(c.minVideoBW||void 0!==c.slideShowMode||void 0!==c.muteStream||void 0!==c.qualityLayer)L.Logger.debug("MinVideo Changed to ",c.minVideoBW),L.Logger.debug("SlideShowMode Changed to ",c.slideShowMode),L.Logger.debug("muteStream changed to ",
c.muteStream),b.callback({type:"updatestream",config:c})};a.createOffer=function(b){a.peerConnection.createOffer(m.bind(null,b),e,b)};a.addStream=function(b){a.peerConnection.addStream(b)};a.removeStream=function(b){a.peerConnection.removeStream(b)};b.remoteCandidates=[];b.remoteDescriptionSet=!1;a.processSignalingMessage=function(c){L.Logger.debug("Process Signaling Message",c);if("offer"===c.type)c.sdp=k(c.sdp),TK.isHiFi&&(c.sdp=p(c.sdp)),a.peerConnection.setRemoteDescription(c.sdp,q,function(a){L.Logger.error("Error: ",
a)});else if("answer"===c.type)f?(TK.isHiFi&&(c.sdp=p(c.sdp)),L.Logger.debug("Set remote and local description"),L.Logger.debug("Remote Description",c.sdp),L.Logger.debug("Local Description",f.sdp),c.sdp=k(c.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(c),function(){b.remoteDescriptionSet=!0;for(L.Logger.debug("Candidates to be added: ",b.remoteCandidates.length,b.remoteCandidates);0<b.remoteCandidates.length;)a.peerConnection.addIceCandidate(b.remoteCandidates.shift());for(L.Logger.debug("Local candidates to send:",
b.localCandidates.length);0<b.localCandidates.length;)b.callback({type:"candidate",candidate:b.localCandidates.shift()})})):L.Logger.error("[tk-sdk]localDesc is not exist!");else if("candidate"===c.type)try{var d="object"===typeof c.candidate?c.candidate:L.Utils.toJsonParse(c.candidate);if("end"!==d.candidate){d.candidate=d.candidate.replace(/a=/g,"");d.sdpMLineIndex=parseInt(d.sdpMLineIndex);var e=new RTCIceCandidate(d);b.remoteDescriptionSet?a.peerConnection.addIceCandidate(e):b.remoteCandidates.push(e)}}catch(r){L.Logger.error("Error parsing candidate",
c.candidate)}};return a};window.TK=window.TK||{};TK.sessionId=103;
TK.Connection=function(b,a){var c={};b.sessionId=TK.sessionId+=1;c.browser=TK.getBrowser();if(!0===a)L.Logger.debug("Talk-Client Stack"),c=TK.TkNativeStack(b);else if("mozilla"===c.browser)L.Logger.debug("[tk-sdk]Firefox Stack"),c=TK.FirefoxStack(b);else if("bowser"===c.browser)L.Logger.debug("[tk-sdk]Bowser Stack"),c=TK.BowserStack(b);else if("chrome-stable"===c.browser||"electron"===c.browser)L.Logger.debug("[tk-sdk]Chrome Stable Stack"),c=TK.TkChromeStableStack(b);else throw L.Logger.error("[tk-sdk]No stack available for this browser"),
"WebRTC stack not available";c.updateSpec||(c.updateSpec=function(a,b){L.Logger.error("[tk-sdk]Update Configuration not implemented in this browser");b&&b("unimplemented")});return c};
TK.getBrowser=function(){var b="none";null!==window.navigator.userAgent.match("Firefox")?b="mozilla":null!==window.navigator.userAgent.match("Bowser")?b="bowser":null!==window.navigator.userAgent.match("Chrome")?(b="chrome-stable",null!==window.navigator.userAgent.match("Electron")&&(b="electron")):null!==window.navigator.userAgent.match("Safari")?b="bowser":null!==window.navigator.userAgent.match("AppleWebKit")&&(b="bowser");return b};window.TK=window.TK||{};TK.Stream=function(b,a){return!0===a?TK.NativeStream(b):TK.StreamInner(b)};
TK.StreamInner=function(b){var a=TK.EventDispatcher(b),c="destroy";void 0!==b.video&&"number"===typeof b.video&&(b.video=0!==b.video);void 0!==b.audio&&"number"===typeof b.audio&&(b.audio=0!==b.audio);a.classInstanceName="Stream";a.stream=b.stream;a.mediaStreamClone=a.stream&&"function"===typeof a.stream.clone?a.stream.clone():a.stream;a.url=b.url;a.recording=b.recording;a.room=b.room;a.playing=!1;a.local=!1;a.video=b.video;a.audio=b.audio;a.screen=b.screen;a.videoSize=b.videoSize;a.videoFrameRate=
b.videoFrameRate;a.extensionId=b.extensionId;a.desktopStreamId=b.desktopStreamId;a.videoMuted=!1;a.audioMuted=!1;a.attributes=b.attributes||{};a.isTkNative=!1;a.checkMyAudioAndVideoEnable=b.checkMyAudioAndVideoEnable;a.isInit=!1;var e={isWaiting:!1};void 0===a.attributes.type&&L.Logger.error("[tk-sdk]create stream spec.attributes.type is not exist , call video stream type must is video!");if(!(void 0===a.videoSize||a.videoSize instanceof Array&&4===a.videoSize.length))throw Error("Invalid Video Size");
if(void 0===b.local||!0===b.local)a.local=!0;a.getID=function(){return a.local&&!b.streamID?"local":b.streamID};a.id=a.getID();a.publisherId=function(){return b.extensionId.replace(new RegExp(":"+b.attributes.type,"g"),"")};a.getAttributes=function(){return b.attributes};a.setAttributes=function(b){a.updateLocalAttributes(b)};a.updateLocalAttributes=function(a){if(a&&"object"===typeof a)for(var c in a)b.attributes[c]=a[c]};a.hasAudio=function(){return b.audio};a.changeAudio=function(a){b.audio=a};
a.hasVideo=function(){return b.video};a.changeVideo=function(a){b.video=a};a.hasData=function(){return b.data};a.changeData=function(a){b.data=a};a.hasScreen=function(){return b.screen};a.hasMedia=function(){return!1};a.changeScreen=function(a){b.screen=a};a.sendData=function(){L.Logger.error("[tk-sdk]Failed to send data. This Stream object has not that channel enabled.")};a.init=function(c,d,e){d=d||{};if(TK.isPlayback)e&&"function"===typeof e&&e({type:"access-denied",stream:a});else if("video"===
a.getAttributes().type&&a.local)if(a.isIniting||a.isInit)e&&"function"===typeof e&&e({type:"access-denied",stream:a});else{d.initDeviceId&&("object"===typeof d.initDeviceId?(d.initDeviceId.videoinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,d.initDeviceId.videoinput),d.initDeviceId.audioinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,d.initDeviceId.audioinput),d.initDeviceId.audiooutput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,
d.initDeviceId.audiooutput)):L.Logger.warning("[tk-sdk]stream.init options.initDeviceId must is json , key is (videoinput | audioinput | audiooutput )!"));try{a.isIniting=!0;L.Logger.debug("[tk-sdk]Requested access to local media");var f=function(b){L.Logger.debug("[tk-sdk]User has granted access to local media.");a.mediaStreamClone=a.stream&&"function"===typeof a.stream.clone?a.stream.clone():a.stream;var c=void 0;b&&void 0!==b.getUserMediaFailureCode&&(c=b.getUserMediaFailureCode);a.stream=b;a.mediaStreamClone=
a.stream&&"function"===typeof a.stream.clone?a.stream.clone():a.stream;h=TK.StreamEvent({type:"access-accepted",stream:a,message:{getUserMediaFailureCode:c}});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(h);e&&"function"===typeof e&&e({type:"access-accepted",stream:a,message:{getUserMediaFailureCode:c}});a.stream.getTracks().forEach(function(b){b.onended=function(){a.stream.getTracks().forEach(function(a){a.onended=null});h=TK.StreamEvent({type:"stream-ended",stream:a,message:b.kind});a.dispatchEvent(h)}})},
k=function(b){L.Logger.error("[tk-sdk]Failed to get access to local media. Error name was "+b.name+".");var c=L.Constant.accessDenied.streamFail,d=TK.StreamEvent({type:"access-denied",stream:a,message:{code:c,msg:b}});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(d);e&&"function"===typeof e&&e({type:"access-denied",stream:a,message:{code:c,msg:b}})},p={dispatchEvent:c,isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:TK.isInnerVersions,isStopLocalStream:!0};if(L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)&&
L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)){var u={audio:b.audio?{sourceId:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)}:!1,video:b.video?{sourceId:L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)}:!1};TK.DeviceMgr.getUserMedia(f,k,u,p)}else TK.DeviceMgr.enumerateDevices(function(a){a={audio:b.audio?{sourceId:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)}:!1,video:b.video?{sourceId:L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)}:
!1};TK.DeviceMgr.getUserMedia(f,k,a,p)},{isSetlocalStorage:!0})}catch(r){c=L.Constant.accessDenied.ohterError;d="[tk-sdk]Failed to get access to local media. Error was "+r+".";L.Logger.error(d);var h=TK.StreamEvent({type:"access-denied",stream:a,message:{code:c,msg:d}});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(h);e&&"function"===typeof e&&e({type:"access-denied",stream:a,message:{code:c,msg:d}})}}else L.Logger.warning("[tk-sdk]stream init must is localStream and stream type must is video!"),e&&
"function"===typeof e&&e({type:"access-denied",stream:a})};a.close=function(){a.local&&(a.room&&a.room.unpublish&&a.room.unpublish(a),a.hide(),void 0!==a.stream&&a.stream.getTracks().forEach(function(a){a.onended=null;a.stop()}),a.stream=null,a.stream=void 0,a.mediaStreamClone=a.stream&&"function"===typeof a.stream.clone?a.stream.clone():a.stream,a.isInit=!1,a.isIniting=!1)};a.play=function(b,d){function f(){d=d||{};a.elementID=b;if(void 0!==b)if(a.player&&a.stop(),"living"!==c)L.Logger.warning("[tk-sdk]stream.play:player life state not is living , not play stream!");
else{var f=new TK.VideoPlayer({id:a.extensionId.replace(new RegExp(":"+a.getAttributes().type,"g"),""),stream:a,elementID:b,options:d,bundleId:a.extensionId});a.player=f;a.playing=!0;e.isWaiting&&a.player.startIntervalGetRealtimeVolume&&a.player.startIntervalGetRealtimeVolume(e.onSuccess,e.interval,e.onFailure)}}c="living";!a.local||"video"!==a.getAttributes().type||a.isInit||TK.isPlayback?f():(L.Logger.info("[tk-sdk]stream.play:my stream is not init , call stream init start!"),a.init(!0,void 0,function(a){L.Logger.info("[tk-sdk]stream.play:my stream is not init , call stream init finshed , result is :",
L.Utils.toJsonStringify(a));f()}))};a.stop=function(){c="destroy";a.playing&&(void 0!==a.player&&a.player.destroy(),a.player=void 0,a.playing=!1)};a.updateVideoPlayerOptions=function(b){a.player&&a.player.updateVideoPlayerOptions&&a.player.updateVideoPlayerOptions(b)};a.show=function(){void 0!==a.player&&a.player.showVideo()};a.hide=function(){void 0!==a.player&&a.player.hideVideo()};a.setMute=function(b){void 0!==a.player&&a.player.setMute&&a.player.setMute(b)};a.setVolume=function(b){void 0!==a.player&&
a.player.setVolume&&("number"!==typeof b?L.Logger.error("[tk-sdk]Stream setVolume volume type must is number!"):a.player.setVolume(b))};a.getVolume=function(b){if(void 0!==a.player&&a.player.getVolume)return a.player.getVolume(b)};a.startIntervalGetRealtimeVolume=function(b,c,d){void 0!==a.player&&a.player.startIntervalGetRealtimeVolume&&a.player.startIntervalGetRealtimeVolume(b,c,d);e.isWaiting=!0;e.onSuccess=b;e.onFailure=d;e.interval=c};a.stopIntervalGetRealtimeVolume=function(){void 0!==a.player&&
a.player.stopIntervalGetRealtimeVolume&&a.player.stopIntervalGetRealtimeVolume();e={isWaiting:!1}};a.hideLoading=function(){void 0!==a.player&&a.player.hideLoading&&a.player.hideLoading()};a.showLoading=function(){void 0!==a.player&&a.player.showLoading&&a.player.showLoading()};var d=function(){if(void 0!==a.player&&void 0!==a.stream){var b=a.player.video,c=document.defaultView.getComputedStyle(b),d=parseInt(c.getPropertyValue("width"),10),e=parseInt(c.getPropertyValue("height"),10),l=parseInt(c.getPropertyValue("left"),
10);c=parseInt(c.getPropertyValue("top"),10);var w="object"===typeof a.elementID&&"function"===typeof a.elementID.appendChild?a.elementID:document.getElementById(a.elementID);var u=document.defaultView.getComputedStyle(w);w=parseInt(u.getPropertyValue("width"),10);u=parseInt(u.getPropertyValue("height"),10);var h=document.createElement("canvas");h.id="testing";h.width=w;h.height=u;h.setAttribute("style","display: none");h.getContext("2d").drawImage(b,l,c,d,e);return h}return null};a.getVideoFrameURL=
function(a){var b=d();return null!==b?a?b.toDataURL(a):b.toDataURL():null};a.getVideoFrame=function(){var a=d();return null!==a?a.getContext("2d").getImageData(0,0,a.width,a.height):null};a.checkOptions=function(b,c){if(!0===c){if(b.video||b.audio||b.screen)L.Logger.warning("[tk-sdk]Cannot update type of subscription"),b.video=void 0,b.audio=void 0,b.screen=void 0}else!1===a.local&&(!0===b.video&&!1===a.hasVideo()&&(L.Logger.warning("[tk-sdk]Trying to subscribe to video when there is no video, won't subscribe to video"),
b.video=!1),!0===b.audio&&!1===a.hasAudio()&&(L.Logger.warning("[tk-sdk]Trying to subscribe to audio when there is no audio, won't subscribe to audio"),b.audio=!1));!1!==a.local||a.hasVideo()||!0!==b.slideShowMode||(L.Logger.warning("[tk-sdk]Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),b.slideShowMode=!1)};a.updateMuteToServer=function(b){if(a.room&&a.room.p2p)L.Logger.warning("[tk-sdk]muteAudio is not implemented in p2p streams"),b("error");else if(void 0!==
a.pc&&a.pc.updateSpec){var c={muteStream:{video:a.videoMuted,audio:a.audioMuted}};a.checkOptions(c,!0);a.pc.updateSpec(c,b)}};a._setQualityLayer=function(b,c,d){a.room&&a.room.p2p?(L.Logger.warning("[tk-sdk]setQualityLayer is not implemented in p2p streams"),d("error")):(b={qualityLayer:{spatialLayer:b,temporalLayer:c}},a.checkOptions(b,!0),a.pc.updateSpec(b,d))};var l=function(b,c,d){!0!==c&&(c=!1);b="string"===typeof b?[b]:b;b=b instanceof Array?b:[];a.room&&a.room.sendControlMessage&&0<b.length&&
a.room.sendControlMessage(a,"control",{name:"controlhandlers",enable:d,publisherSide:c,handlers:b})};a.disableHandlers=function(a,b){l(a,b,!1)};a.enableHandlers=function(a,b){l(a,b,!0)};a.updateConfiguration=function(b,c){if(void 0!==b)if(a.pc)if(a.checkOptions(b,!0),a.local)if(a.room&&a.room.p2p)for(var d in a.pc)a.pc[d].updateSpec(b,c);else a.pc.updateSpec(b,c);else a.pc.updateSpec(b,c);else c("This stream has no peerConnection attached, ignoring")};a.muteVideo=function(b,c){L.Logger.debug("[tk-sdk]call muteVideo , video muted state:"+
b+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));a.videoMuted=b;void 0!==a.peerConnectionStream&&a.peerConnectionStream&&a.peerConnectionStream.getTracks&&a.peerConnectionStream.getTracks().forEach(function(a){"video"===a.kind&&(a.enabled=!b)});a.updateMuteToServer(c)};a.muteAudio=function(b,c){L.Logger.debug("[tk-sdk]call muteAudio , audio muted state:"+b+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+
L.Utils.toJsonStringify(a.getAttributes()));a.audioMuted=b;void 0!==a.peerConnectionStream&&a.peerConnectionStream&&a.peerConnectionStream.getTracks&&a.peerConnectionStream.getTracks().forEach(function(a){"audio"===a.kind&&(a.enabled=!b)});a.updateMuteToServer(c)};return a};window.TK=window.TK||{};
TK.NativeStream=function(b){var a=TK.EventDispatcher(b),c="destroy";a.classInstanceName="Stream";a.stream=b.stream;a.mediaStreamClone=a.stream&&"function"===typeof a.stream.clone?a.stream.clone():a.stream;a.url=b.url;a.recording=b.recording;a.room=b.room;a.playing=!1;a.local=!1;a.video=b.video;a.audio=b.audio;a.screen=b.screen;a.media=b.media;a.videoSize=b.videoSize;a.videoFrameRate=b.videoFrameRate;a.extensionId=b.extensionId;a.desktopStreamId=b.desktopStreamId;a.path=b.path;a.videoMuted=!1;a.audioMuted=
!1;a.isTkNative=!0;a.checkMyAudioAndVideoEnable=b.checkMyAudioAndVideoEnable;a.pushVideoMuted=!0;a.pushAudioMuted=!0;a.isInit=!1;if(!(void 0===a.videoSize||a.videoSize instanceof Array&&4===a.videoSize.length))throw Error("Invalid Video Size");if(void 0===b.local||!0===b.local)a.local=!0;if(b.screen&&b.media)throw Error("Wrong stream type which contains both media and screen");a.path||(a.path="");var e=function(){return a.media?1:a.screen?2:0};a.getID=function(){return a.local&&!b.streamID?"local":
b.streamID};a.publisherId=function(){return b.extensionId.replace(new RegExp(":"+b.attributes.type,"g"),"")};a.getAttributes=function(){return b.attributes};a.setAttributes=function(b){a.updateLocalAttributes(b)};a.updateLocalAttributes=function(a){if(a&&"object"===typeof a)for(var c in a)b.attributes[c]=a[c]};a.hasAudio=function(){return b.audio};a.hasVideo=function(){return b.video};a.hasData=function(){return b.data};a.hasScreen=function(){return b.screen};a.hasMedia=function(){return b.media};
a.sendData=function(){L.Logger.error("[tk-sdk]Failed to send data. This Stream object has not that channel enabled.")};a.init=function(c,d,e){d=d||{};if(TK.isPlayback)e&&"function"===typeof e&&e({type:"access-denied",stream:a});else if("video"===a.getAttributes().type&&a.local)if(a.isIniting||a.isInit)e&&"function"===typeof e&&e({type:"access-denied",stream:a});else{d.initDeviceId&&("object"===typeof d.initDeviceId?(d.initDeviceId.videoinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,
d.initDeviceId.videoinput),d.initDeviceId.audioinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,d.initDeviceId.audioinput),d.initDeviceId.audiooutput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,d.initDeviceId.audiooutput)):L.Logger.warning("[tk-sdk]stream.init options.initDeviceId must is json , key is (videoinput | audioinput | audiooutput )!"));try{if(b.audio||b.video){a.isIniting=!0;L.Logger.debug("[tk-sdk]Requested access to local media");var f=b.video;
!0===f||!0===b.screen?(f=!0===f?{}:f,void 0!==a.videoSize&&(f.mandatory=f.mandatory||{},f.mandatory.minWidth=a.videoSize[0],f.mandatory.minHeight=a.videoSize[1],f.mandatory.maxWidth=a.videoSize[2],f.mandatory.maxHeight=a.videoSize[3]),void 0!==a.videoFrameRate&&(f.optional=f.optional||[],f.optional.push({minFrameRate:a.videoFrameRate[0]}),f.optional.push({maxFrameRate:a.videoFrameRate[1]}))):!0===b.screen&&void 0===f&&(f=!0);var k={video:f,audio:b.audio,fake:b.fake,screen:b.screen,extensionId:a.extensionId,
desktopStreamId:a.desktopStreamId},l=function(b){L.Logger.debug("[tk-sdk]User has granted access to local media.");a.stream=b;a.mediaStreamClone=a.stream&&"function"===typeof a.stream.clone?a.stream.clone():a.stream;h=TK.StreamEvent({type:"access-accepted",stream:a});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(h);e&&"function"===typeof e&&e({type:"access-accepted",stream:a})},u=function(b){var c=TK.StreamEvent({type:"access-denied",stream:a,message:b});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(c);
e&&"function"===typeof e&&e({type:"access-denied",message:b,stream:a})};L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)&&L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)?TK.DeviceMgr.getUserMedia(l,u,k,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!0,isStopLocalStream:!0}):TK.DeviceMgr.enumerateDevices(function(a){TK.DeviceMgr.getUserMedia(l,u,k,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!0,isStopLocalStream:!0})},{isSetlocalStorage:!0})}else{L.Logger.warning("[tk-sdk]The stream has no audio and video needs to be initialized.");
var h=TK.StreamEvent({type:"access-denied",stream:a,message:"The stream has no audio and video needs to be initialized."});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(h);e&&"function"===typeof e&&e({type:"access-denied",stream:a,message:"The stream has no audio and video needs to be initialized."})}}catch(r){h=TK.StreamEvent({type:"access-denied",stream:a,message:r}),a.isInit=!0,a.isIniting=!1,a.dispatchEvent(h),e&&"function"===typeof e&&e({type:"access-denied",message:r,stream:a})}}else L.Logger.warning("[tk-sdk]stream init must is localStream and stream type must is video!"),
e&&"function"===typeof e&&e({type:"access-denied",stream:a})};a.close=function(){a.local&&(a.room&&a.room.unpublish&&a.room.unpublish(a),a.hide(),a.stream=void 0,a.mediaStreamClone=a.stream&&"function"===typeof a.stream.clone?a.stream.clone():a.stream)};a.create=function(){a.local?window.tknative.postMessage({command:"playStream",connectionId:b.extensionId.toString(),isLocal:!0,type:Number(e()),args:{path:a.path.toString()}}):window.tknative.postMessage({command:"playStream",connectionId:b.extensionId.toString(),
isLocal:!1,type:Number(e())})};a.destroy=function(){a.local?window.tknative.postMessage({command:"stopStream",connectionId:b.extensionId.toString(),isLocal:!0,type:Number(e())}):window.tknative.postMessage({command:"stopStream",connectionId:b.extensionId.toString(),isLocal:!1,type:Number(e())})};a.play=function(d,k){function f(){k=k||{};a.elementID=d;if(void 0!==d){a.player&&a.stop();if("living"!==c){L.Logger.warning("[tk-sdk]stream.play:player life state not is living , not play stream!");return}var f=
new TK.NativeVideoPlayer({id:b.extensionId,stream:a,elementID:d,options:k,bundleId:a.extensionId});a.player=f;a.playing=!0;TK.isOnlyAudioRoom&&a.player.hideVideo();a.local?window.tknative.postMessage({command:"playStream",connectionId:b.extensionId.toString(),isLocal:!0,type:Number(e()),args:{path:a.path.toString()}}):window.tknative.postMessage({command:"playStream",connectionId:b.extensionId.toString(),isLocal:!1,type:Number(e())})}a&&a.getAttributes&&a.getAttributes()&&"video"===a.getAttributes().type&&
a.extensionId&&a.checkMyAudioAndVideoEnable&&"function"===typeof a.checkMyAudioAndVideoEnable&&a.checkMyAudioAndVideoEnable(a.extensionId)}c="living";!a.local||"video"!==a.getAttributes().type||a.isInit||TK.isPlayback?f():(L.Logger.info("[tk-sdk]stream.play:my stream is not init , call stream init start!"),a.init(!0,void 0,function(a){L.Logger.info("[tk-sdk]stream.play:my stream is not init , call stream init finshed , result is :",L.Utils.toJsonStringify(a));f()}))};a.stop=function(){c="destroy";
a.playing&&(void 0!==a.player&&a.player.destroy(),a.player=void 0,a.playing=!1,a.local?window.tknative.postMessage({command:"stopStream",connectionId:b.extensionId.toString(),isLocal:!0,type:Number(e())}):window.tknative.postMessage({command:"stopStream",connectionId:b.extensionId.toString(),isLocal:!1,type:Number(e())}))};a.updateVideoPlayerOptions=function(b){a.player&&a.player.updateVideoPlayerOptions&&a.player.updateVideoPlayerOptions(b)};a.show=function(){void 0!==a.player&&a.player.showVideo()};
a.hide=function(){void 0!==a.player&&a.player.hideVideo()};a.setMute=function(b){void 0!==a.player&&a.player.setMute&&a.player.setMute(b)};a.setVolume=function(b){void 0!==a.player&&a.player.setVolume&&("number"!==typeof b?L.Logger.error("[tk-sdk]Stream setVolume volume type must is number!"):a.player.setVolume(b))};a.getVolume=function(b){if(void 0!==a.player&&a.player.getVolume)return a.player.getVolume(b)};a.startIntervalGetRealtimeVolume=function(b,c,d){void 0!==a.player&&a.player.startIntervalGetRealtimeVolume&&
a.player.startIntervalGetRealtimeVolume(b,c,d)};a.stopIntervalGetRealtimeVolume=function(){void 0!==a.player&&a.player.stopIntervalGetRealtimeVolume&&a.player.stopIntervalGetRealtimeVolume()};a.hideLoading=function(){void 0!==a.player&&a.player.hideLoading&&a.player.hideLoading()};a.showLoading=function(){void 0!==a.player&&a.player.showLoading&&a.player.showLoading()};var d=function(){if(void 0!==a.player&&void 0!==a.stream){var b=a.player.video,c=document.defaultView.getComputedStyle(b),d=parseInt(c.getPropertyValue("width"),
10),e=parseInt(c.getPropertyValue("height"),10),l=parseInt(c.getPropertyValue("left"),10);c=parseInt(c.getPropertyValue("top"),10);var w="object"===typeof a.elementID&&"function"===typeof a.elementID.appendChild?a.elementID:document.getElementById(a.elementID);var u=document.defaultView.getComputedStyle(w);w=parseInt(u.getPropertyValue("width"),10);u=parseInt(u.getPropertyValue("height"),10);var h=document.createElement("canvas");h.id="testing";h.width=w;h.height=u;h.setAttribute("style","display: none");
h.getContext("2d").drawImage(b,l,c,d,e);return h}return null};a.getVideoFrameURL=function(a){var b=d();return null!==b?a?b.toDataURL(a):b.toDataURL():null};a.getVideoFrame=function(){var a=d();return null!==a?a.getContext("2d").getImageData(0,0,a.width,a.height):null};a.checkOptions=function(b,c){if(!0===c){if(b.video||b.audio||b.screen)L.Logger.warning("[tk-sdk]Cannot update type of subscription"),b.video=void 0,b.audio=void 0,b.screen=void 0}else!1===a.local&&(!0===b.video&&!1===a.hasVideo()&&(L.Logger.warning("[tk-sdk]Trying to subscribe to video when there is no video, won't subscribe to video"),
b.video=!1),!0===b.audio&&!1===a.hasAudio()&&(L.Logger.warning("[tk-sdk]Trying to subscribe to audio when there is no audio, won't subscribe to audio"),b.audio=!1));!1!==a.local||a.hasVideo()||!0!==b.slideShowMode||(L.Logger.warning("[tk-sdk]Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),b.slideShowMode=!1)};a.updateMuteToServer=function(b){if(a.room&&a.room.p2p)L.Logger.warning("[tk-sdk]muteAudio is not implemented in p2p streams"),b("error");else if(void 0!==
a.pc&&a.pc.updateSpec){var c={muteStream:{video:a.videoMuted,audio:a.audioMuted}};a.checkOptions(c,!0);a.pc.updateSpec(c,b)}};a._setQualityLayer=function(b,c,d){a.room&&a.room.p2p?(L.Logger.warning("[tk-sdk]setQualityLayer is not implemented in p2p streams"),d("error")):(b={qualityLayer:{spatialLayer:b,temporalLayer:c}},a.checkOptions(b,!0),a.pc.updateSpec(b,d))};a.pushVideo=function(b){a.pushVideoMuted!=b&&(a.pushVideoMuted=b,window.tknative.postMessage({command:"pushVideo",enable:b}))};a.pushAudio=
function(b){a.pushAudioMuted!=b&&(a.pushAudioMuted=b,window.tknative.postMessage({command:"pushAudio",enable:b}))};var l=function(b,c,d){!0!==c&&(c=!1);b="string"===typeof b?[b]:b;b=b instanceof Array?b:[];a.room&&a.room.sendControlMessage&&0<b.length&&a.room.sendControlMessage(a,"control",{name:"controlhandlers",enable:d,publisherSide:c,handlers:b})};a.disableHandlers=function(a,b){l(a,b,!1)};a.enableHandlers=function(a,b){l(a,b,!0)};a.updateConfiguration=function(b,c){if(void 0!==b)if(a.pc)if(a.checkOptions(b,
!0),a.local)if(a.room&&a.room.p2p)for(var d in a.pc)a.pc[d].updateSpec(b,c);else a.pc.updateSpec(b,c);else a.pc.updateSpec(b,c);else c("This stream has no peerConnection attached, ignoring")};a.muteVideo=function(b,c){a.videoMuted=b;!0===a.local&&window.tknative.postMessage({command:"enableVideo",enable:!b});a.updateMuteToServer(c)};a.muteAudio=function(b,c){a.audioMuted=b;!0===a.local&&window.tknative.postMessage({command:"enableAudio",enable:!b});void 0===a.stream&&L.Logger.warning("[tk-sdk]not deviceStream to muteAudio");
a.updateMuteToServer(c)};return a};window.TK=window.TK||{};TK.MSG_TO_ALLUSER="__all";TK.MSG_TO_ALLEXCEPTSENDER="__allExceptSender";TK.MSG_TO_ALLEXCEPTAUDITOR="__allExceptAuditor";TK.MSG_TO_NONEUSER="__None";TK.STREAM_VIDEO="video";TK.STREAM_MEDIA="media";TK.STREAM_SCREEN="screen";TK.STREAM_FILE="file";TK.LOG_DEBUG=0;TK.LOG_TRACE=1;TK.LOG_INFO=2;TK.LOG_WARNING=3;TK.LOG_ERROR=4;TK.LOG_NONE=5;TK.REC_TYPE_RECFILE="0";TK.REC_TYPE_VIDEOLIST="1";TK.REC_TYPE_MP3="2";TK.REC_TYPE_MIXVIDEO="3";TK.nativeCallSeq=0;TK.waitNativeToCallbackList={};
TK.SDKTYPE="pc";TK.isInnerVersions=!1;TK.isHiFi=!1;TK.isOnlyAudioRoom=!1;TK.needOnlyAudioRoom=0;TK.isRetainPublishstateOnOnlyAudioRoom=!1;TK.APPVERSION="customer";window.tknative=void 0;TK.SDKVERSIONS="2.2.0.6";TK.SDKVERSIONSTIME="2018062000";TK.getSdkVersion=function(){return TK.SDKVERSIONS};TK.NativeInfo=function(){try{var b={};return b=talk_window}catch(a){return null}};
TK.CheckNativeInterfaceAvailable=function(){window.tknative=window.tknative||TK.nativeEntry();return!L.Utils.isNull(window.tknative)&&L.Utils.isFunction(window.tknative.postMessage)?!0:!1};
TK.Initialize=function(b,a){try{if(b){if(TK.isTkNative=!0,TK.isTkMacNative=a,window.tknative=window.tknative||TK.nativeEntry(),TK.NativeProxy.initialize(),TK.DeviceMgr=null,TK.DeviceMgr=TK.NativeAVMgr(),window.tknative.postMessage({command:"maximizeNativeClient"}),l=void 0,d=TK.NativeInfo())l=d.clientversion}else{TK.isTkNative=!1;TK.isTkMacNative=!1;var c=document.getElementById("window.tknative");if(c&&c.nodeName&&"embed"===c.nodeName.toLowerCase()){var e=c.parentNode;e&&e.removeChild(c)}var d=TK.NativeInfo(),
l=void 0;d&&d.maxmizeWindow&&"function"===typeof d.maxmizeWindow&&(d.maxmizeWindow(),l=d.clientversion)}TK.clientversion=l;TK.subscribe_from_native=TK.isTkNative&&!TK.isTkMacNative&&2018031E3<=l;L.Logger.info("[tk-sdk]isClient:"+TK.isTkNative+",clientVersion:"+l)}catch(p){L.Logger.error("[tk-sdk]Initialize error:",p)}};
TK.Room=function(b){function a(a){I=a.web_protocol||I;x=a.web_host||x;z=a.web_port||z;ya=a.doc_protocol||ya;pa=a.doc_host||pa;qa=a.doc_port||qa;db=a.socket_protocol||db;eb=a.socket_host||eb;fb=a.socket_port||fb;ta=a.backup_doc_protocol||ta;ja=a.backup_doc_host||ja;ka=a.backup_doc_port||ka;void 0===pa&&(pa=x);void 0===qa&&(qa=z);void 0===ja&&(ja=x);void 0===ka&&(ka=z);gb||(pa=x,qa=z);hb||(ja=x,ka=z);O&&O.changeCommonWhiteBoardConfigration&&O.changeCommonWhiteBoardConfigration({webAddress:I+"://"+x+
":"+z,docAddress:ya+"://"+pa+":"+qa,backupDocAddress:ta+"://"+ja+":"+ka});a=TK.RoomEvent({type:"room-updateWebAddressInfo",message:{protocol:I,web_protocol:I,web_host:x,web_port:z,doc_protocol:ya,doc_host:pa,doc_port:qa,backup_doc_protocol:ta,backup_doc_host:ja,backup_doc_port:ka}});g.dispatchEvent(a);a=TK.RoomEvent({type:"room-serveraddress-update",message:{protocol:I,web_protocol:I,web_host:x,web_port:z,doc_protocol:ya,doc_host:pa,doc_port:qa,backup_doc_protocol:ta,backup_doc_host:ja,backup_doc_port:ka}});
g.dispatchEvent(a)}function c(a,b,c){function t(a){E(x,z,function(b,c){L.Logger.debug("[tk-sdk]reconnected room:step2GetFileList result \x3d "+b+" , message:"+L.Utils.toJsonStringify(c));if(0===b){U=[];if(c&&Array.isArray(c)&&c.length){b=0;for(var t=c.length;b<t;b++){var d=c[b];d&&U.push({fileid:Number(d.fileid),companyid:d.companyid,filename:d.filename,uploaduserid:d.uploaduserid,uploadusername:d.uploadusername,downloadpath:d.downloadpath,swfpath:d.swfpath,filetype:d.filetype&&"string"===typeof d.filetype?
d.filetype.toLocaleLowerCase():d.filetype,pagenum:Number(d.pagenum),dynamicppt:Number(d.dynamicppt),filecategory:Number(d.filecategory),fileprop:Number(d.fileprop),type:Number(d.type)})}}c=TK.RoomEvent({type:"room-files",message:U});g.dispatchEvent(c)}else L.Logger.info("[tk-sdk]"+e+":step2GetFileList code is "+b);"function"===typeof a&&a()})}var d=aa;a=a||{};a.source=a.source||"unknown source";var e=a.source;V(x,z,function(a,F){if(0!==a)L.Logger.error("[tk-sdk]"+e+":step2GetConfig failure --\x3e result and responseText:",
a,F);else{if(d!==aa||"forceReconnect room"===e){g.needReconnectSocket=!0;ua&&g.stopIntervalRtcStatsrObserver();v.rtcStatsrObserverTimer&&g.stopIntervalRtcStatsrObserverByStream(v);TK.isTkNative&&(za=!1,window.tknative.postMessage({command:"nativeClear"}));try{g.socket&&g.socket.disconnect&&g.socket.disconnect()}catch(Mb){L.Logger.debug("[tk-sdk]"+e+":Socket already disconnected , disconnect errorInfo:",Mb)}g.socket=void 0;if("select service reconnect"===e||"forceReconnect room"===e)m(),a=TK.RoomEvent({type:"room-disconnected",
message:"select service reconnect , need socket disconnect"}),g.dispatchEvent(a)}"forceReconnect room"===e?t(function(){L.Logger.info("[tk-sdk]"+e+":room socket force reconnect room  ,room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(aa):aa)+"! ");Z()}):d!==aa?t(function(){L.Logger.info("[tk-sdk]"+e+":room socket url  changed  , old room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(d):d)+"  , now room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(aa):aa)+"! ");Z()}):(L.Logger.info("[tk-sdk]"+
e+":room socket url not change  , room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(aa):aa)+"! "),"reconnected room"===e?t(function(){C(b,c)}):"select service reconnect"===e&&(L.Logger.warning("[tk-sdk]room uri is not change , no need to perform a reload server"),ha&&n&&n.id&&A[n.id]&&P!==n.servername&&g.changeUserProperty(n.id,"__all",{servername:P})))}})}function e(a,b){a=a||M;b=b||P;if("object"===typeof a&&L.Utils.getJsonLength(a)&&void 0!==b)for(var c in a)a[c].isUseServer=b===c?!0:!1}
function d(){if(!/(192.168.|127.0.0.1|127.17.|localhost)/g.test(x)&&P)if(void 0!==x){var b=x.indexOf(".");0<b?(b=x.substring(0,b),b=new RegExp(b),Sa=x,b=x.replace(b,P),b!==x?(L.Logger.info("[tk-sdk]changeWebRequest host , old host is "+(window.__TkSdkBuild__?L.Utils.encrypt(Sa):Sa)+", now host is "+(window.__TkSdkBuild__?L.Utils.encrypt(b):b)),a({web_host:b})):L.Logger.info("[tk-sdk]changeWebRequest host , host is not change ,   host is "+(window.__TkSdkBuild__?L.Utils.encrypt(x):x))):L.Logger.error("[tk-sdk]web request host not find first dot , cannot address to replace , current host is "+
(window.__TkSdkBuild__?L.Utils.encrypt(x):x)+" ! ")}else L.Logger.error("[tk-sdk]web request host is not exist , cannot call changeWebRequestAddress ! ")}function l(a,b,c){a=a||n.publishstate;b=b||{hasvideo:n.hasvideo,disablevideo:n.disablevideo};c=c||{hasaudio:n.hasaudio,disableaudio:n.disableaudio};a>TK.PUBLISH_STATE_NONE&&(k(b.hasvideo&&!b.disablevideo&&(a===TK.PUBLISH_STATE_VIDEOONLY||a===TK.PUBLISH_STATE_BOTH)),p(c.hasaudio&&!c.disableaudio&&(a===TK.PUBLISH_STATE_AUDIOONLY||a===TK.PUBLISH_STATE_BOTH)))}
function p(a){v.muteAudio(!a,function(a){if(void 0!==v.getID()||"local"!==v.getID())L.Logger.debug("[tk-sdk]Sending message",a),a=oa(a),la("signaling_message",{streamId:v.getID(),msg:a})})}function k(a){TK.isOnlyAudioRoom&&(a=!1);v.muteVideo(!a,function(a){if(void 0!==v.getID()||"local"!==v.getID())L.Logger.debug("[tk-sdk]Sending message",a),a=oa(a),la("signaling_message",{streamId:v.getID(),msg:a})})}function f(a,b,c){"failed"===b&&(void 0===a.reconnectionNumber&&(a.reconnectionNumber=0),0!==g.state&&
a&&3>a.reconnectionNumber?"publish"===c?a.extensionId===n.id?(L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3eunpublish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.unpublish(a,function(b){setTimeout(function(){b||L.Logger.warning("[tk-sdk]oniceconnectionstatechange failed: unpublish in not success , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())+
" !");if(n.publishstate>TK.PUBLISH_STATE_NONE)L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3epublish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.reconnectionNumber++,g.publish(a,{reconnection:!0});else{L.Logger.warning("[tk-sdk]oniceconnectionstatechange failed --\x3emy publishstate is 0 , not need afresh publish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));
var t=TK.StreamEvent({type:"stream-reconnection-failed",message:{reconnectionNumber:a.reconnectionNumber,source:c,isCompleted:a.isCompleted,code:L.Constant.streamReconnection.midwayReconnectionChangePublishstate_0},stream:a});g.dispatchEvent(t)}},1E3)},{reconnection:!0})):(g.unpublish(a),L.Logger.info("[tk-sdk]publish stream stream.extensionId !\x3d _myself.id   , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))):"subscribe"===c&&(L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3eunsubscribe , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.unsubscribe(a,function(b){setTimeout(function(){b||L.Logger.warning("[tk-sdk]oniceconnectionstatechange failed: unsubscribe in not success , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())+" !");g.remoteStreams[a.getID()]?(a.reconnectionNumber++,L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3estream-removed(initiative) , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),delete Y[a.publisherId()+":"+a.getAttributes().type],a.getAttributes().type===TK.STREAM_VIDEO?Ta(a):Aa(a,!1),L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3esubscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.subscribe(a,{reconnection:!0})):L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3eremoteStreams does not contain streams , not need afresh subscribe , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)},{reconnection:!0})):3<=a.reconnectionNumber&&("publish"===c?a.extensionId===n.id&&n.publishstate>TK.PUBLISH_STATE_NONE?g.changeUserProperty(a.extensionId,"__all",{publishstate:TK.PUBLISH_STATE_NONE}):g.unpublish(a):"subscribe"===c&&g.unsubscribe(a),a.isCompleted||n.udpstate===L.Constant.udpState.notOnceSuccess||g.changeUserProperty(n.id,"__all",{udpstate:L.Constant.udpState.notOnceSuccess}),
L.Logger.info("[tk-sdk]stream-reconnection-failed , source is "+c+", isCompleted is "+a.isCompleted+", reconnectionNumber is "+a.reconnectionNumber+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),b=TK.StreamEvent({type:"stream-reconnection-failed",message:{reconnectionNumber:a.reconnectionNumber,source:c,isCompleted:a.isCompleted,code:a.isCompleted?L.Constant.streamReconnection.midwayReconnectionNotSuccess:L.Constant.streamReconnection.notOnceSuccess},
stream:a}),g.dispatchEvent(b)))}function m(){var a;TK.isOnlyAudioRoom=!1;TK.needOnlyAudioRoom=0;for(a in g.remoteStreams)if(g.remoteStreams.hasOwnProperty(a)){var b=g.remoteStreams[a];ib(b);delete g.remoteStreams[a];b&&!b.failed&&(L.Logger.info("[tk-sdk]_resetRoomState--\x3estream-removed(), stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),delete Y[b.publisherId()+":"+b.getAttributes().type],b.getAttributes().type===TK.STREAM_VIDEO?
Ta(b):Aa(b,!1))}g.remoteStreams={};for(a in g.localStreams)if(g.localStreams.hasOwnProperty(a)){b=g.localStreams[a];if(g.p2p)for(var c in b.pc)b.pc[c].close();else b.pc.close();g.localStreams[a]&&(g.localStreams[a].isPublishing=!1,g.localStreams[a].isUnpublishing=!1,g.localStreams[a].peerConnectionStream=void 0);delete g.localStreams[a]}v&&v.pc&&v.pc.close&&v.pc.close();A&&(u(S),w(A));n&&(n.publishstate=TK.PUBLISH_STATE_NONE,n._videopublished_=!1,n._audiopublished_=!1,n._videoplayed_=!1,n._audioplayed_=
!1);ca={};Y={};L.Utils.isNull(N[n.id])?L.Utils.isNull(N[n.id])?N={}:(b=N._local_default_extension_id_,N={},N._local_default_extension_id_=b):(b=N[n.id],N={},N[n.id]=b);v&&(v.isPublishing=!1,v.isUnpublishing=!1);ha=!1;O&&O.changeCommonWhiteBoardConfigration&&O.changeCommonWhiteBoardConfigration({isConnectedRoom:ha})}function q(a){L.Logger.debug("[tk-sdk]setStatus to: "+a);J!=a&&(J=a,6==J?(S[n.role]||(S[n.role]={}),S[n.role][n.id]=n,A[n.id]=n,n.publishstate>TK.PUBLISH_STATE_NONE&&(l(n.publishstate),
g.publish(v))):8==J?m():0==J&&m())}function w(a){if(y)for(b in a)a[b].playbackLeaved=!0;else for(var b in a)delete a[b]}function u(a){if(!y)for(var b in a)delete a[b]}function h(a,b,c,d,e,f){var t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");t.open(a,b,c);t.setRequestHeader("Content-Type",f?f:"application/x-www-form-urlencoded;charset\x3dutf-8");t.send(d);t.onreadystatechange=e;return t}function r(a,b,c,d){a=Number(a);b=Number(b);c=Number(c);d=Number(d);void 0!==
c&&void 0!==d&&"number"===typeof Number(c)&&"number"===typeof Number(d)?(c=Number(c),d=Number(d),ia=c,ma=d,Ka=c,Ua=d):(a+=1,ia=Va[a][0],ma=Va[a][1],Ka=Va[a][0],Ua=Va[a][1]);na=10>b?10:30<b?30:b;ub=10>b?10:30<b?30:b;La=K(ia,na);va.setAVMgrProperty({room_video_width:ia,room_video_height:ma,room_video_fps:na});L.Logger.info("[tk-sdk]video config[_room_video_width * _room_video_height  , _room_video_fps , _room_video_maxbps]:"+ia+"*"+ma+", "+na+", "+La)}function K(a,b){return 80>=a?20>b?64:96:176>=a?
20>b?128:192:320>=a?20>b?256:384:640>=a?20>b?384:512:1280>=a?15>b?1024:15<=b&&20>=b?1280:1536:15>b?1280:15<=b&&20>=b?1536:2048}function V(b,c,d){q(2);if(void 0==W)d(3,null);else{L.Logger.debug("[tk-sdk]Going to getConfig");c=I+"://"+b+":"+c+"/ClientAPI/getconfig?ts\x3d"+(new Date).getTime();var t=h("POST",c,!0,"serial\x3d"+W+"\x26userrole\x3d"+n.role,function(){if(4==t.readyState)if(200==t.status){var c=L.Utils.toJsonParse(t.responseText);L.Logger.debug("[tk-sdk]getConfig resp \x3d ",L.Utils.toJsonStringify(c));
vb=c;var e=b,F="8889";if(void 0===jb||void 0===kb){if(void 0!==c.courseserver){var Da=c.courseserver;null!==Da&&void 0!==Da&&0<Da.length&&(e=Da)}void 0!==c.courseserverport&&(F=/https/g.test(I)?Number(c.courseserverport):Number(c.courseserverport)+1)}else e=jb,F=kb;a({socket_host:e,socket_port:F});Ma?c.LiveDocServerAddr&&(gb=c.LiveDocServerAddr,a({doc_host:c.LiveDocServerAddr})):c.ClassDocServerAddr&&(gb=c.ClassDocServerAddr,a({doc_host:c.ClassDocServerAddr}));Ma?c.LiveDocServerAddrBackup&&(hb=c.LiveDocServerAddrBackup,
a({backup_doc_host:c.LiveDocServerAddrBackup})):c.ClassDocServerAddrBackup&&(hb=c.ClassDocServerAddrBackup,a({backup_doc_host:c.ClassDocServerAddrBackup}));aa=db+"://"+eb+":"+fb;T(e,wb);L.Logger.debug("[tk-sdk]_room_uri \x3d "+aa);d(c?0:3,t.responseText)}else L.Logger.error("[tk-sdk]getConfig fail[readyState-status]:",t.readyState,t.status),d(3,t.responseText)})}}function E(a,b,c){if(void 0===W)c(3,void 0);else if(xb){L.Logger.debug("[tk-sdk]Going to getFileList");a=I+"://"+a+":"+b+"/ClientAPI/getroomfile?ts\x3d"+
(new Date).getTime();var t=h("POST",a,!0,"serial\x3d"+W,function(){if(4==t.readyState)if(200==t.status){var a=L.Utils.toJsonParse(t.responseText);L.Logger.debug("[tk-sdk]getFileList resp \x3d ",L.Utils.toJsonStringify(a));var b=a.result,d;0==b&&void 0!==a.roomfile?d=a.roomfile:L.Logger.info("[tk-sdk]getFileList resp.roomfile is not exist , nRet:"+b);c(b,d)}else L.Logger.error("[tk-sdk]getFileList fail[readyState-status]:",t.readyState,t.status),c(3,void 0)})}else c(-1,void 0)}function T(a,b){yb&&
(b=I+"://"+a+":"+b+"/where.html?ts\x3d"+(new Date).getTime(),Wa=Ma||/(192.168.|127.0.0.1|127.17.|localhost)/g.test(a)?!1:!0,$.ajax({url:b,type:"get",async:!1}).done(function(a){L.Logger.info("[tk-sdk]getFalsificationIp resp :",window.__TkSdkBuild__?L.Utils.encrypt("object"===typeof a?L.Utils.toJsonStringify(a):a):"object"===typeof a?L.Utils.toJsonStringify(a):a);"string"===typeof a&&(a=L.Utils.toJsonParse(a));a&&"object"===typeof a?(a.name&&"string"===typeof a.name&&(P=zb=cb(a.name)),a.selfip&&"string"===
typeof a.selfip&&(Ab=cb(a.selfip)),a.nochange?(Wa=!1,L.Logger.info("[tk-sdk]no strings change SDP  , ipFalsificationName is "+zb)):a.ip&&"string"===typeof a.ip&&(Xa=cb(a.ip))):L.Logger.warning("[tk-sdk]getFalsificationIp resp not is json")}).fail(function(a){L.Logger.error("[tk-sdk]getFalsificationIp fail:",a)}))}function Z(){L.Logger.debug("[tk-sdk]step3Connect");3<=J||(q(3),L.Logger.info("[tk-sdk]socket connect address:"+(window.__TkSdkBuild__?L.Utils.encrypt(aa):aa)),ha=!1,O&&O.changeCommonWhiteBoardConfigration&&
O.changeCommonWhiteBoardConfigration({isConnectedRoom:ha}),Nb(aa,D._handler_connectSocketSuccess,function(a){L.Logger.error("[tk-sdk]Not Connected! Error: "+a);a=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.ROOMCONNECTERROR,error:a}});g.dispatchEvent(a)}))}function C(a,b){if(!(5<=J))if(void 0==n.id||void 0==W)L.Logger.error("[tk-sdk]Invalid status",n,W);else{q(5);n&&(P&&(n.servername=P),n.udpstate=L.Constant.udpState.ok);var c={},t;for(t in n)"id"!=t&&"watchStatus"!=t&&(c[t]=
n[t]);c={userId:n.id,roomId:W,maxVideo:wa,videofps:na,videowidth:ia,videoheight:ma,properties:c,roomtype:H.roomtype,version:2,vcodec:"number"===typeof Ya?Ya:0};if(y){if(!Za){L.Logger.error("[tk-sdk]The playback file address does not exist!");return}c.recordfilepath=Za}L.Logger.info("joinRoom params info:"+(window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(c)):L.Utils.toJsonStringify(c)));da("joinRoom",c,a,b)}}function Q(a,b,c){L.Logger.debug("[tk-sdk]Going to webInterfaceGetserver");a=
I+"://"+a+":"+b+"/ClientAPI/getserverarea?ts\x3d"+(new Date).getTime();$.ajax({url:a,type:"post",async:!0}).done(function(a){L.Logger.info("[tk-sdk]webInterfaceGetserver resp \x3d ",window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(a)):L.Utils.toJsonStringify(a));a=L.Utils.toJsonParse(a);var b=a.result;M={};if(0==b&&void 0!==a.serverarealist)for(var t in a.serverarealist){var d=a.serverarealist[t];M[d.serverareaname]=d}else L.Logger.info("[tk-sdk]webInterfaceGetserver resp.serverarealist is not exist , nRet:"+
b);c(b,L.Utils.toJsonStringify(a))}).fail(function(a){L.Logger.error("[tk-sdk]webInterfaceGetserver fail[readyState-status]:",a);c(3,void 0)})}function X(a,b,c){var t=void 0,d=!1,e=I+"://"+x+":"+z+"/ClientAPI/uploaddocument?ts\x3d"+(new Date).getTime();if(a)return a&&"object"===typeof a&&"function"===typeof a.get?t=a.get("fieltype"):a&&"object"===typeof a&&void 0!==a.fieltype&&(t=a.fieltype),a&&"object"===typeof a&&"function"===typeof a.get?d=1===Number(a.get("writedb")):a&&"object"===typeof a&&void 0!==
a.writedb&&(d=1===Number(a.writedb)),$.ajax({url:e,dataType:"json",type:"POST",data:a,async:!0,processData:!1,contentType:!1,xhr:function(){var a=$.ajaxSettings.xhr();if(a.upload)return c&&"function"===typeof c&&(L.Utils.removeEvent(a.upload,"progress",Ra.bind(g,c),!1),L.Utils.addEvent(a.upload,"progress",Ra.bind(g,c),!1)),a}}).done(function(a){L.Logger.debug("[tk-sdk]uploadFile resp \x3d ",L.Utils.toJsonStringify(a));var c=a.result;if(0===c&&d){var e=L.Utils.toJsonParse(L.Utils.toJsonStringify(a));
delete e.result;e.filetype=e.filetype||t;R(e,!1)}b&&"function"===typeof b&&b(c,a)}).fail(function(a,c,t){L.Logger.error("[tk-sdk]uploadFile fail[ jqXHR , textStatus , errorThrown ]:",a,c,t);b&&"function"===typeof b&&b(3,void 0)});L.Logger.error("[tk-sdk]uploadFile formData is required!")}function R(a,b){if(a&&"object"===typeof a){var c=Number(a.fileprop),t=a.filetype&&"string"===typeof a.filetype?a.filetype.toLocaleLowerCase():a.filetype,d=1===c||2===c;c=3===c;var e=!d&&!c,F=/(mp3|mp4|webm)/g.test(t);
a={name:"DocumentChange",id:"DocumentChange",toID:b?"__all":"__allExceptSender",data:L.Utils.toJsonStringify({isDel:b,isGeneralFile:e,isMedia:F,isDynamicPPT:d,isH5Document:c,action:"",mediaType:F?t:"",filedata:{fileid:Number(a.fileid),currpage:1,pagenum:Number(a.pagenum),filetype:t,filename:a.filename,swfpath:d||c?a.downloadpath:a.swfpath,pptslide:1,pptstep:0,steptotal:0,filecategory:void 0!==a.filecategory?Number(a.filecategory):0}}),save:!1};g.pubMsg(a)}}function ba(a,b){var c=I+"://"+x+":"+z+"/ClientAPI/delroomfile?ts\x3d"+
(new Date).getTime();void 0===a||null===a?L.Logger.error("[tk-sdk]deleteFile fileid is required!"):$.ajax({url:c,dataType:"json",type:"POST",anync:!1,data:{serial:H.serial,fileid:a}}).done(function(c){L.Logger.debug("[tk-sdk]deleteFile resp \x3d ",L.Utils.toJsonStringify(c));var t=c.result,d;a:{for(d=0;d<U.length;d++)if(U[d].fileid==a){d={file:U[d],index:d};break a}d=void 0}0===t&&d&&d.file&&"object"===typeof d.file&&(d=L.Utils.toJsonParse(L.Utils.toJsonStringify(d.file)),R(d,!0));b&&"function"===
typeof b&&b(t,c)}).fail(function(a,c,t){L.Logger.error("[tk-sdk]deleteFile fail[ jqXHR , textStatus , errorThrown ]:",a,c,t);b(3,void 0)})}function sa(){TK.DeviceMgr.getUserMedia(function(a){if(v.stream){for(var b in a)/^customdata_/g.test(b)&&(v.stream[b]=a[b]);var c=v.stream.getTracks();for(b=0;b<c.length;b++){var t=c[b];t.stop();v.stream.removeTrack(t)}a=a.getTracks();for(b=0;b<a.length;b++)t=a[b],v.stream.addTrack(t)}else v.stream=a;v.mediaStreamClone=v.stream&&"function"===typeof v.stream.clone?
v.stream.clone():v.stream;v.player&&v.player.changeMediaStreamUrl(v.stream);var d=void 0!==n.publishstate&&null!==n.publishstate?n.publishstate:TK.PUBLISH_STATE_NONE;d>TK.PUBLISH_STATE_NONE&&g.unpublish(v,function(a,b){p(!0);k(!0);n._audiopublished_=!1;n._videopublished_=!1;void 0!==a&&(l(n.publishstate),d>TK.PUBLISH_STATE_NONE&&g.publish(v))})},void 0,void 0,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!1,isStopLocalStream:!1})}function tb(a){clearTimeout(g._deviceChangeCallbackTimer);
g._deviceChangeCallbackTimer=setTimeout(function(){if(ha&&n&&void 0!==n.id&&A[n.id]&&!y){var a=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),b=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput);TK.DeviceMgr.enumerateDevices(function(c){c=c.hasdevice;var t={},d=!1,e=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),F=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput);n.hasvideo!==c.videoinput&&(t.hasvideo=c.videoinput,d=!0);n.hasaudio!==
c.audioinput&&(t.hasaudio=c.audioinput,d=!0);d?(L.Logger.info("[tk-sdk]change device:my old device info  [hasvideo , hasaudio] is ["+n.hasvideo+" ,"+n.hasaudio+"] , change device property is "+L.Utils.toJsonStringify(t)),0===g.changeUserProperty(n.id,"__all",t)&&(void 0!==t.hasvideo&&n.hasvideo!==t.hasvideo&&(n.hasvideo=t.hasvideo),void 0!==t.hasaudio&&n.hasaudio!==t.hasaudio&&(n.hasaudio=t.hasaudio)),v&&(v.hasVideo()!==n.hasvideo&&v.changeVideo(n.hasvideo),v.hasAudio()!==n.hasaudio&&v.changeAudio(n.hasaudio)),
sa()):a===e&&b===F||sa()},{isSetlocalStorage:!0})}var c=document.getElementsByTagName("audio"),t=document.getElementsByTagName("video"),d=[];if(c&&0<c.length)for(var e=0;e<c.length;e++)d.push(c[e]);if(t&&0<t.length)for(e=0;e<t.length;e++)d.push(t[e]);0<d.length&&TK.DeviceMgr.setElementSinkIdToAudioouputDevice(d);g.dispatchEvent({type:"device_change"})},250)}function oa(a){if(!Wa||!Xa)return a;if("offer"===a.type||"candidate"===a.type){var b=L.Utils.toJsonStringify(a),c=/(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))/g;
c.test(b)&&(a=L.Utils.toJsonParse(b.replace(c,"254.254.254.254")))}return a}function Qa(a,b){var c=!1,t=!1;t=a.getID()!==v.getID();var d=0,e={frameWidth:0,frameHeight:0},F=0,f=0,g=0,h=0,r=0,k=0,m=0,u=0,l=0,q=0,p=0,n=0,w=0,K=0,ba=0,V=0,E=0,T=0,R=0,X=0,Z=0,Q=g=0,C=0,x=0,y=C=0,sa=0,A=0,z=0,B=0,J=0,D=0,G=0,H=Q=0,I=0,M=0,N=0,O=function(a){"ssrc"===a.type&&"video"===a.mediaType?/send/g.test(a.id)?(n=Number(a.bytesSent),w=Number(a.packetsSent),m=Number(a.googRtt),K=Number(a.packetsLost),u=Number(a.googFrameWidthSent),
l=Number(a.googFrameHeightSent),p=Number(a.googFrameRateSent),q=a.timestamp,t=!1):/recv/g.test(a.id)&&(ba=Number(a.bytesReceived),X=Number(a.packetsReceived),V=Number(a.googCurrentDelayMs),Z=Number(a.packetsLost),E=Number(a.googFrameWidthReceived),T=Number(a.googFrameHeightReceived),R=Number(a.googFrameRateReceived),q=a.timestamp,t=!0):"ssrc"===a.type&&"audio"===a.mediaType&&(/send/g.test(a.id)?(z=Number(a.bytesSent),B=Number(a.packetsSent),A=Number(a.googRtt),J=Number(a.packetsLost),G=Number(a.googJitterReceived),
D=a.timestamp,t=!1):/recv/g.test(a.id)&&(H=Number(a.bytesReceived),I=Number(a.packetsReceived),M=Number(a.googCurrentDelayMs),N=Number(a.packetsLost),G=Number(a.googJitterReceived),D=a.timestamp,t=!0))};if(b&&"object"===typeof b&&b.forEach)b.forEach(function(a,b){O(a)});else for(var P in b)O(b[P]);a.report||(a.report={},c=!0);a.report.timestamp=a.report.timestamp||q;a.report.audioTimestamp=a.report.audioTimestamp||D;t?(a.report.bytesReceived=a.report.bytesReceived||ba,a.report.packetsReceived=a.report.packetsReceived||
X,a.report.audioBytesReceived=a.report.audioBytesReceived||H,a.report.audioPacketsReceived=a.report.audioPacketsReceived||I):(a.report.bytesSent=a.report.bytesSent||n,a.report.packetsSent=a.report.packetsSent||w,a.report.audioBytesSent=a.report.audioBytesSent||z,a.report.audioPacketsSent=a.report.audioPacketsSent||B);if(!c)return t?(g=8*(ba-a.report.bytesReceived),e.frameWidth=isNaN(u)?0:E,e.frameHeight=isNaN(l)?0:T,F=R,d=V,k=isNaN(d)?0:d,f=Z/X*100,r=X,h=Z,Q=8*(H-a.report.audioBytesReceived),C=M,
sa=isNaN(C)?0:C,y=G,x=I,C=N):(g=8*(n-a.report.bytesSent),e.frameWidth=isNaN(u)?0:u,e.frameHeight=isNaN(l)?0:l,F=p,d=m,k=isNaN(d)?0:Math.round(d/2),f=K/w*100,r=w,h=K,Q=8*(z-a.report.audioBytesSent),C=A,sa=isNaN(C)?0:Math.round(C/2),y=G,x=B,C=J),g=g/((q-a.report.timestamp)/1E3)/1024,Q=Q/((D-a.report.audioTimestamp)/1E3)/1024,t?(a.report.bytesReceived=ba,a.report.packetsReceived=X,a.report.audioBytesReceived=H,a.report.audioPacketsReceived=I):(a.report.bytesSent=n,a.report.packetsSent=w,a.report.audioBytesSent=
z,a.report.audioPacketsSent=B),a.report.timestamp=q,a.report.audioTimestamp=D,{kbps:isNaN(g)?0:Math.round(g),frameRatio:e,frameRate:isNaN(F)?0:Math.round(F),packetsLost:isNaN(f)?0:100>=Math.round(f)?Math.round(f):100,rtt:isNaN(d)?0:d,video:{bitsPerSecond:isNaN(g)?0:Math.round(g),packetsLost:isNaN(h)?0:h,totalPackets:isNaN(r)?0:r,currentDelay:isNaN(k)?0:k,frameRate:isNaN(F)?0:Math.round(F),farmeWidth:e.frameWidth,farmeHeight:e.frameHeight,timestamp:q},audio:{bitsPerSecond:isNaN(Q)?0:Math.round(Q),
packetsLost:isNaN(C)?0:C,totalPackets:isNaN(x)?0:x,currentDelay:isNaN(sa)?0:sa,jitter:isNaN(y)?0:y,timestamp:D}}}function Ra(a,b){var c=Math.floor(100*b.loaded/b.total);a&&"function"===typeof a&&a(b,c)}function cb(a){return a.replace(/(^\s*)|(\s*$)/g,"")}function Bb(a,b,c){var t={},d=a.result;if(0===d){y&&(a.nickname="playback",a.roomrole=-1,a.thirdid=lb()+":playback");var e=a.room;var F=a.pullinfo;e.roomtype=Number(e.roomtype);e.maxvideo=parseInt(e.maxvideo);a.roomrole=Number(a.roomrole);var f={},
Da={};if(F&&F.data&&F.data.pullConfigureList){var g=F.data.pullConfigureList,h;for(h in g){var k=g[h];f[k.pullProtocol]=k.pullUrlList}}if(F&&F.data&&F.data.pushConfigureInfo)for(h in F=F.data.pushConfigureInfo,F)g=F[h],Da[g.pushProtocol]=g.pushUrl;e.pullConfigure=f;e.pushConfigure=Da;H=e;mb=e.roomname;$a=e.roomtype;Ma=10===$a;wa=e.maxvideo;Ya=void 0!==e.vcodec&&null!==e.vcodec&&"number"===typeof Number(e.vcodec)?Number(e.vcodec):Ya;t.properties={};t.properties.role=a.roomrole;t.properties.nickname=
a.nickname;f=a.thirdid;t.id=void 0!==f&&"0"!=f&&""!=f?f:c?c:lb();"string"!==typeof t.id&&(t.id=""+t.id);f=void 0;L.Utils.isNull(n.id)||!L.Utils.isNull(c)&&""!==c||(f=n.id);n=TK.RoomUser(t);L.Utils.isNull(f)||(n.id=f);L.Utils.isNull(v)||(v.extensionId=n.id);L.Utils.isNull(N._local_default_extension_id_)||(c=N._local_default_extension_id_,delete N._local_default_extension_id_,N[n.id]=c);y?(n.hasvideo=!1,n.hasaudio=!1):(L.Logger.info("[tk-sdk]call enumerateDevices to checkroom set myself.hasvideo and  myself.hasaudio start!"),
va.enumerateDevices(function(a){L.Logger.info("[tk-sdk]call enumerateDevices to checkroom set myself.hasvideo and  myself.hasaudio finshed!");a=a.hasdevice;n.hasvideo=a.videoinput;n.hasaudio=a.audioinput}));y?(W=e.serial+"_"+n.id)&&-1===W.indexOf(":playback")&&(W+=":playback"):W=e.serial;y||(r(e.videotype,e.videoframerate,e.videowidth,e.videoheight),Ma&&3===a.roomrole&&(yb=!1));Na=a?"string"===typeof a?a:L.Utils.toJsonStringify(a):"";TK.isTkNative&&!za&&(za=!0,window.tknative.postMessage({command:"initNative",
localId:n.id.toString(),width:Number(ia),height:Number(ma),fps:Number(na),roomInfo:Na,webAddr:x.toString(),webPort:z.toString()}));L.Logger.info("[tk-sdk]"+(y?"initPlaybackInfo to checkroom finshed--\x3e":"")+"_room_max_videocount:"+wa,"my id:"+n.id,"room id:"+W,"room properties chairmancontrol is:"+(H.chairmancontrol?window.__TkSdkBuild__?L.Utils.encrypt(H.chairmancontrol):H.chairmancontrol:void 0))}else L.Logger.warning("[tk-sdk]checkroom failure code is "+d);L.Logger.info("[tk-sdk]checkroom finshed!");
b(d,t,a)}function ab(a){if(a.extensionId&&a.extensionId!==n.id&&A[a.extensionId]&&"video"===a.getAttributes().type&&a.stream){var b=A[a.extensionId];if(b.publishstate!==TK.PUBLISH_STATE_NONE)switch(b.publishstate){case TK.PUBLISH_STATE_VIDEOONLY:TK.DeviceMgr.enabledStreamVideoTrack(a.stream,!0);TK.DeviceMgr.enabledStreamAudioTrack(a.stream,!1);break;case TK.PUBLISH_STATE_AUDIOONLY:TK.DeviceMgr.enabledStreamVideoTrack(a.stream,!1);TK.DeviceMgr.enabledStreamAudioTrack(a.stream,!0);break;case TK.PUBLISH_STATE_BOTH:TK.DeviceMgr.enabledStreamVideoTrack(a.stream,
!0);TK.DeviceMgr.enabledStreamAudioTrack(a.stream,!0);break;case TK.PUBLISH_STATE_MUTEALL:TK.DeviceMgr.enabledStreamVideoTrack(a.stream,!1),TK.DeviceMgr.enabledStreamAudioTrack(a.stream,!1)}}}function ea(){if(void 0===TK.nativeCallSeq||"number"!==typeof TK.nativeCallSeq)TK.nativeCallSeq=0;return++TK.nativeCallSeq}function lb(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function ib(a){void 0!==a.stream&&(a.hide(),
a.pc&&(a.pc.close(),delete a.pc),a.local&&a.stream.stop(),delete a.stream)}function Cb(a,b){a.local?da("sendDataStream",{id:a.getID(),msg:b}):L.Logger.error("[tk-sdk]You can not send data through a remote stream")}function Db(a,b){a&&"object"===typeof b&&(g.remoteStreams[a.getID()]?(a.local&&a.updateLocalAttributes(b),da("updateStreamAttributes",{id:a.getID(),attrs:b})):L.Logger.warning("[tk-sdk]You can not update attributes to server, because the stream does not exist on the server."))}function Nb(a,
d,e){var t=function(a,b){a.pc=TK.Connection({callback:function(c){c=oa(c);la("signaling_message",{streamId:a.getID(),peerSocket:b,msg:c})},iceServers:g.iceServers,maxAudioBW:G.maxAudioBW,maxVideoBW:"screen"===a.getAttributes().type?G.maxScreenBW:"file"===a.getAttributes().type?G.maxLocalFileMediaBW:G.maxVideoBW,limitMaxAudioBW:G.maxAudioBW,limitMaxVideoBW:"screen"===a.getAttributes().type?G.maxScreenBW:"file"===a.getAttributes().type?G.maxLocalFileMediaBW:G.maxVideoBW,cnnId:a.extensionId},a.isTkNative);
a.pc.onaddstream=function(b){g.remoteStreams[a.getID()]?(L.Logger.debug("[tk-sdk]Stream subscribed"),a.stream=b.stream,a.mediaStreamClone=a.stream&&"function"===typeof a.stream.clone?a.stream.clone():a.stream,ua&&g.rtcStatsrObserver(a),a.extensionId!==n.id&&"video"===a.getAttributes().type&&ab(a),L.Logger.info("[tk-sdk]createRemotePc(stream.pc.onaddstream), stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),"video"===a.getAttributes().type&&
(Ea(a),b=g.getUser(a.publisherId()),void 0!==b&&(b._audiopublished_=!a.audioMuted,b._videopublished_=!a.videoMuted))):L.Logger.info("[tk-sdk]createRemotePc(stream.pc.onaddstream):remoteStreams does not contain streams ,stream  subscribe  information does not need to be passed to the interface layer , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))}};g.state=1;g.socket=io.connect(aa,{secure:!0,reconnection:!0,transports:["websocket"]});
g.socket.on("connect",function(){L.Logger.debug("[tk-sdk]tk connectd");g.state=2;q(4);if(0===bb||g.needReconnectSocket)g.socket.on("onAddStream",function(a){var b=!1,c=!1;"media"===a.attributes.type?b=!0:a.attributes.type&&(b=a.extensionId.replace(new RegExp(":"+a.attributes.type,"g"),"")===n.id?!1:!0);TK.subscribe_from_native&&b&&(c=!0);c=TK.Stream({streamID:a.id,local:!1,audio:a.audio,video:a.video,data:a.data,screen:a.screen,attributes:a.attributes,extensionId:a.extensionId,room:g,checkMyAudioAndVideoEnable:function(a){n&&
n.id&&(a=a||n.id,a===n.id&&(TK.isTkNative&&(p(!0),k(!0)),n.publishstate>TK.PUBLISH_STATE_NONE&&l()))}},c);for(var t in g.remoteStreams)g.remoteStreams[t]&&g.remoteStreams[t].extensionId===c.extensionId&&delete g.remoteStreams[t];g.remoteStreams[a.id]=c;c.extensionId===n.id&&(g.publishedDefaultStream=c);b&&g.subscribe(c);ua&&a.extensionId===n.id&&g.rtcStatsrObserver(c);"video"===c.getAttributes().type&&n.id===c.extensionId&&(l(n.publishstate),y||Eb());L.Logger.info("[tk-sdk]stream-added , stream id:"+
c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes()));c.publisherId()===n.id&&("video"===c.getAttributes().type?(Ea(v),n._audiopublished_=!v.audioMuted,n._videopublished_=!v.videoMuted):Aa(c,!0))}),g.socket.on("signaling_message_mediaserver",function(a){L.Logger.debug("[tk-sdk]signaling_message_mediaserver",a);var c=a.mess;if(Wa&&Xa&&"answer"===c.type){var t=L.Utils.toJsonStringify(c),d=Xa,e=/(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))/g;
e.test(t)&&(c=L.Utils.toJsonParse(t.replace(e,d)))}a.mess=c;a.peerId?(c=g.remoteStreams[a.peerId],!b.autoSubscribeAV&&a&&a.mess&&"started"===a.mess.type&&(c.video&&c.muteVideo(!0),c.audio&&c.muteAudio(!0))):c=g.localStreams[a.streamId];a&&a.mess&&"ready"===a.mess.type&&(c.isCompleted=!0,c.reconnectionNumber=0,n.udpstate!==L.Constant.udpState.ok&&g.changeUserProperty(n.id,"__all",{udpstate:L.Constant.udpState.ok}),TK.isTkNative&&TK.subscribe_from_native&&c&&c.hideLoading&&c.hideLoading());c&&!c.failed&&
(c.pc&&c.pc.processSignalingMessage?c.pc.processSignalingMessage(a.mess,c):L.Logger.warning("stream.pc is not exist , Can't call processSignalingMessage method!"))}),g.socket.on("signaling_message_peer",function(a){var b=g.localStreams[a.streamId];L.Logger.debug("signaling_message_peer",a);b&&!b.failed?b.pc[a.peerSocket].processSignalingMessage(a.msg):(b=g.remoteStreams[a.streamId],b.pc||t(b,a.peerSocket),b.pc&&b.pc.processSignalingMessage?b.pc.processSignalingMessage(a.msg):L.Logger.warning("stream.pc is not exist , Can't call processSignalingMessage method!"))}),
g.socket.on("publish_me",function(a){var b=g.localStreams[a.streamId];void 0===b.pc&&(b.pc={});b.pc[a.peerSocket]=TK.Connection({callback:function(b){b=oa(b);la("signaling_message",{streamId:a.streamId,peerSocket:a.peerSocket,msg:b})},audio:b.hasAudio(),video:b.hasVideo(),media:b.hasMedia(),iceServers:g.iceServers,cnnId:b.extensionId},TK.isTkNative);b.pc[a.peerSocket].oniceconnectionstatechange=function(c){"failed"===c&&(b.pc[a.peerSocket].close(),delete b.pc[a.peerSocket])};b.pc[a.peerSocket].addStream(b.stream);
b.pc[a.peerSocket].createOffer()}),g.socket.on("onBandwidthAlert",function(a){L.Logger.debug("[tk-sdk]Bandwidth Alert on",a.streamID,"message",a.message,"BW:",a.bandwidth);if(a.streamID){var b=g.remoteStreams[a.streamID];b&&!b.failed&&(a=TK.StreamEvent({type:"bandwidth-alert",stream:b,message:a.message,bandwidth:a.bandwidth}),g.dispatchEvent(a))}}),g.socket.on("onDataStream",function(a){a=TK.StreamEvent({type:"stream-data",message:a.msg,stream:g.remoteStreams[a.id]});g.dispatchEvent(a)}),g.socket.on("onUpdateAttributeStream",
function(a){var b=g.remoteStreams[a.id],c=TK.StreamEvent({type:"stream-attributes-update",attrs:a.attrs,stream:b});void 0!==b?(b.updateLocalAttributes(a.attrs),g.dispatchEvent(c)):L.Logger.warning("[tk-sdk]onUpdateAttributeStream stream invalid",a)}),g.socket.on("publish_failed",function(a){L.Logger.warning("[tk-sdk]stream-publish_mediaserver_failed server info: "+L.Utils.toJsonStringify(a));var b=g.localStreams[a.streamId];g.localStreams[a.streamId]&&(g.localStreams[a.streamId].peerConnectionStream=
void 0);delete g.localStreams[a.streamId];b?(a=TK.StreamEvent({type:"stream-publish_mediaserver_failed",stream:b}),L.Logger.info("[tk-sdk]stream-publish_mediaserver_failed , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),g.dispatchEvent(a)):L.Logger.warning("[tk-sdk]stream-publish_mediaserver_failed stream is not exist , server info: "+L.Utils.toJsonStringify(a))}),g.socket.on("subscribe_failed",function(a){L.Logger.warning("[tk-sdk]stream-subscribe_mediaserver_failed server info: "+
L.Utils.toJsonStringify(a));var b=g.remoteStreams[a.streamId];b?(a=TK.StreamEvent({type:"stream-subscribe_mediaserver_failed",stream:b}),L.Logger.info("[tk-sdk]stream-subscribe_mediaserver_failed , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),g.dispatchEvent(a)):L.Logger.warning("[tk-sdk]stream-publish_mediaserver_failed stream is not exist , server info: "+L.Utils.toJsonStringify(a))}),g.socket.on("onRemoveStream",function(a){var b=
g.remoteStreams[a.id];b&&b.failed?L.Logger.debug("[tk-sdk]Received onRemoveStream for a stream that we already marked as failed ",a.id):b?(g.localStreams[a.id]&&(g.localStreams[a.id].peerConnectionStream=void 0),b&&b.stop&&b.stop(),delete g.remoteStreams[a.id],delete g.localStreams[a.id],ib(b),L.Logger.info("[tk-sdk]stream-removed , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),delete Y[b.publisherId()+":"+b.getAttributes().type],
"video"===b.getAttributes().type?(Ea(b,!0),a=g.getUser(b.publisherId()),void 0!==a&&(a._audiopublished_=!1,a._videopublished_=!1)):Aa(b,!1)):L.Logger.debug("[tk-sdk]Received a removeStream for",a.id,"and it has not been registered here, ignoring.")}),g.socket.on("disconnect",function(a){g.needReconnectSocket||(L.Logger.debug("[tk-sdk]Socket disconnected, lost connection to TKController",a),0!==g.state&&(q(8),g.state=0,ua&&g.stopIntervalRtcStatsrObserver(),v.rtcStatsrObserverTimer&&g.stopIntervalRtcStatsrObserverByStream(v),
TK.isTkNative&&(za=!1,window.tknative.postMessage({command:"nativeClear"})),a=TK.RoomEvent({type:"room-disconnected",message:"unexpected-disconnection"}),g.dispatchEvent(a)))}),g.socket.on("connection_failed",function(a){L.Logger.debug("[tk-sdk]Socket connection_failed , arg is "+L.Utils.toJsonStringify(a))}),g.socket.on("error",function(a){L.Logger.error("[tk-sdk]Cannot connect to Controller");e&&e("Cannot connect to TKController (socket.io error)",a)}),g.socket.on("reconnecting",function(a){L.Logger.debug("[tk-sdk]reconnecting info:",
a);a=TK.RoomEvent({type:"room-reconnecting",message:{number:a,info:"room-reconnecting number:"+a}});g.dispatchEvent(a)}),g.socket.on("participantLeft",D._handler_participantLeft),g.socket.on("participantJoined",D._handler_participantJoined),g.socket.on("participantPublished",D._handler_participantPublished),g.socket.on("participantEvicted",function(a){a=a||{};L.Logger.info("[tk-sdk]user evicted room  , user info: "+L.Utils.toJsonStringify(n)+" , participantEvicted  messages:"+L.Utils.toJsonStringify(a));
g.leaveroom(!0);a=TK.RoomEvent({type:"room-participant_evicted",message:a,user:n});g.dispatchEvent(a)}),g.socket.on("sendMessage",D._handler_sendMessage),g.socket.on("msgList",function(a){L.Logger.debug("[tk-sdk]msgList info:",L.Utils.toJsonStringify(a));a=TK.RoomEvent({type:"room-msglist",message:a});g.dispatchEvent(a)}),g.socket.on("pubMsg",D._handler_pubMsg),g.socket.on("delMsg",D._handler_delMsg),g.socket.on("setProperty",D._handler_setProperty),g.socket.on("playback_clearAll",D._handler_playback_clearAll),
g.socket.on("duration",D._handler_duration),g.socket.on("playbackEnd",D._handler_playbackEnd),g.socket.on("playback_updatetime",D._handler_playback_updatetime),g.socket.on("forceReconnect",function(){L.Logger.info("[tk-sdk]service notice forceReconnect , call reconnected room! ");c({source:"forceReconnect room"},d,e)}),bb++,L.Logger.info("[tk-sdk]connected room  , current connected number is "+bb+"! "),g.needReconnectSocket||L.Logger.info("[tk-sdk]Reconnect Socket ,  join room start! "),g.needReconnectSocket=
!1,C(d,e);else{L.Logger.info("[tk-sdk]reconnected room! ");var a=TK.RoomEvent({type:"room-reconnected"});g.dispatchEvent(a);c({source:"reconnected room"},d,e)}})}function da(a,b,c,d){L.Logger.debug("[tk-sdk]sendMessageSocket",a,b);g.socket.emit(a,b,function(a,t){"success"===a?(L.Logger.debug("[tk-sdk]sendMessageSocket success",b,t),c&&c(t)):"error"===a?d&&d(t):c&&c(a,t)})}function la(a,b,c,d){0!==g.state?g.socket.emit(a,b,c,function(a,b){d&&d(a,b)}):L.Logger.warning("[tk-sdk]Trying to send a message over a disconnected Socket")}
function Ba(a){var b=!1;a&&a.getAttributes&&a.getAttributes()&&a.extensionId&&("media"===a.getAttributes().type?b=!1:a.getAttributes().type&&(b=new RegExp(":"+a.getAttributes().type,"g"),a=a.extensionId.replace(b,""),b=a===n.id||"_local_default_extension_id_"===a));return b}function fa(a,b){var c=void 0;if("media"===b)for(var t in g.remoteStreams){var d=g.remoteStreams[t];if(d.extensionId===a+":"+b){c=d;break}}else if(b)if(a===n.id||"_local_default_extension_id_"===a)c="video"===b?v:Y[a+":"+b];else for(t in g.remoteStreams)if(d=
g.remoteStreams[t],"video"===b){if(d.extensionId===a){c=d;break}}else if(d.extensionId===a+":"+b){c=d;break}return c}function ra(a,b,c){c=c||{};b.playInfo=b.playInfo||{video:!1,audio:!1};void 0!==c.video&&(TK.isOnlyAudioRoom&&(c.video=!1),b.playInfo.video=c.video);void 0!==c.audio&&(b.playInfo.audio=c.audio);b&&b.player?a!==b.player.elementID?(b.stop(),b.play(a,c),N[b.extensionId]=b):"object"===typeof c&&b.updateVideoPlayerOptions(c):(b.play(a,c),N[b.extensionId]=b);b.video&&(b.playInfo.video?(b.updateVideoPlayerOptions(c),
b.show()):b.hide());"video"!==b.getAttributes().type&&b.audio&&(b.playInfo.audio?b.setMute(!1):b.setMute(!0));Ba(b)||(b.video&&b.muteVideo(!b.playInfo.video),b.audio&&b.muteAudio(!b.playInfo.audio))}function Ha(a,b){b=b||{};a.playInfo=a.playInfo||{video:!1,audio:!1};void 0!==b.video&&a.playInfo.video&&b.video&&(a.playInfo.video=!b.video,a.video&&(a.playInfo.video?a.show():a.hide()),Ba(a)||a.video&&a.muteVideo(!a.playInfo.video));void 0!==b.audio&&a.playInfo.audio&&b.audio&&(a.playInfo.audio=!b.audio,
"video"!==a.getAttributes().type&&a.audio&&(a.playInfo.audio?a.setMute(!1):a.setMute(!0)),Ba(a)||a.audio&&a.muteAudio(!a.playInfo.audio));a&&a.stop&&!a.playInfo.video&&!a.playInfo.audio&&(a.stop(),delete N[a.extensionId])}function Ob(a,b){return"string"!==typeof a?a:a.replace(new RegExp(":"+b,"g"))}function Fa(a,b){var c={};b=b||{};var t={type:a};if(b.attributes&&"object"===typeof b.attributes)for(var d in b.attributes)"type"!==d&&(t[d]=b.attributes[d]);c.audio=b.audio||!1;c.video=b.video||!1;c.data=
!1;c.attributes=t;switch(a){case "video":c.screen=!1;c.media=!1;c.extensionId=L.Utils.isNull(n.id)?"_local_default_extension_id_":n.id;break;case "screen":c.screen=!0;c.media=!1;c.extensionId=n.id+":"+a;break;case "file":c.screen=!1,c.media=!0,c.path=b.path,c.extensionId=n.id+":"+a}b=TK.Stream(c,TK.isTkNative);return Y[n.id+":"+a]=b}function nb(a,b){if(TK.isOnlyAudioRoom!==a){TK.isOnlyAudioRoom=a;if(TK.isOnlyAudioRoom)for(var c in g.remoteStreams)a=g.remoteStreams[c],"file"===a.getAttributes().type&&
a.extensionId===n.id+":file"?g.unpublishLocalFile(a):"screen"===a.getAttributes().type&&a.extensionId===n.id+":screen"?g.unpublishScreen(a):"media"===a.getAttributes().type&&a.extensionId===n.id+":media"&&!0===a.video&&g.unpublishMedia(a);v&&(n.publishstate>TK.PUBLISH_STATE_NONE?g.unpublish(v,function(a){n.publishstate>TK.PUBLISH_STATE_NONE&&(TK.isOnlyAudioRoom?n.publishstate===TK.PUBLISH_STATE_AUDIOONLY?g.publish(v):TK.isRetainPublishstateOnOnlyAudioRoom?n.publishstate===TK.PUBLISH_STATE_VIDEOONLY||
n.publishstate===TK.PUBLISH_STATE_MUTEALL?n.publishstate===TK.PUBLISH_STATE_MUTEALL?g.publish(v):g.changeUserProperty(n.id,"__all",{publishstate:TK.PUBLISH_STATE_MUTEALL}):g.changeUserProperty(n.id,"__all",{publishstate:TK.PUBLISH_STATE_AUDIOONLY}):g.changeUserProperty(n.id,"__all",{publishstate:TK.PUBLISH_STATE_AUDIOONLY}):n.publishstate===TK.PUBLISH_STATE_BOTH?g.publish(v):TK.isRetainPublishstateOnOnlyAudioRoom?n.publishstate===TK.PUBLISH_STATE_VIDEOONLY||n.publishstate===TK.PUBLISH_STATE_MUTEALL?
g.publish(v):g.changeUserProperty(n.id,"__all",{publishstate:TK.PUBLISH_STATE_BOTH}):g.changeUserProperty(n.id,"__all",{publishstate:TK.PUBLISH_STATE_BOTH}));TK.isOnlyAudioRoom?(v.hide(),v.playInfo=v.playInfo||{video:!1,audio:!1},v.playInfo.video=!1):(v.show(),v.playInfo=v.playInfo||{video:!1,audio:!1},v.playInfo.video=!0)}):TK.isOnlyAudioRoom?(v.hide(),v.playInfo=v.playInfo||{video:!1,audio:!1},v.playInfo.video=!1):(v.show(),v.playInfo=v.playInfo||{video:!1,audio:!1},v.playInfo.video=!0));b=TK.RoomEvent({type:"room-audiovideostate-switched",
message:{fromId:b,onlyAudio:TK.isOnlyAudioRoom}});g.dispatchEvent(b)}}function Fb(a){"string"===typeof a&&(a=L.Utils.toJsonParse(a));a&&a.data&&"string"===typeof a.data&&(a.data=L.Utils.toJsonParse(a.data));var b=a.fromID,c=a.data;a:{for(a=0;a<U.length;a++)if(U[a].fileid==c.filedata.fileid){a={file:U[a],index:a};break a}a=void 0}if(c.isDel)a&&a.file&&(U.splice(a.index,1),b=TK.RoomEvent({type:"room-delete-file",message:{fileid:a.file.fileid,fileinfo:a.file,fromID:b}}),g.dispatchEvent(b));else{var t=
A[b],d=c.filedata;c={fileid:Number(d.fileid),companyid:H.companyid,filename:d.filename,uploaduserid:b,uploadusername:t?t.nickname:"",downloadpath:d.swfpath,swfpath:d.swfpath,filetype:d.filetype&&"string"===typeof d.filetype?d.filetype.toLocaleLowerCase():d.filetype,pagenum:Number(d.pagenum),dynamicppt:c.isDynamicPPT?1:0,filecategory:Number(d.filecategory),fileprop:c.isDynamicPPT?2:c.isH5Document?3:0,type:0};if(a){t={};d=!1;for(var e in c)a.file[e]!==c[e]&&(a.file[e]=c[e],t[e]=c[e],d=!0);d&&(b=TK.RoomEvent({type:"room-update-file",
message:{fileid:c.fileid,updateFileinfo:t,fromID:b}}),g.dispatchEvent(b))}else U.push(c),b=TK.RoomEvent({type:"room-add-file",message:{fileid:c.fileid,fromID:b}}),g.dispatchEvent(b)}}function Ea(a,b){if("video"===a.getAttributes().type){void 0===b&&(b=!1);var c=g.getUser(a.publisherId());if(c){void 0===c._audiopublished_&&(c._audiopublished_=!1);void 0===c._videopublished_&&(c._videopublished_=!1);var t=c.publishstate,d=t===TK.PUBLISH_STATE_AUDIOONLY||t===TK.PUBLISH_STATE_BOTH;t=t===TK.PUBLISH_STATE_VIDEOONLY||
t===TK.PUBLISH_STATE_BOTH;a.audio&&(c._audiopublished_!==d||b&&c._audiopublished_)&&(d={userId:a.publisherId(),published:b?!1:d,type:a.getAttributes().type},d=TK.RoomEvent({type:"room-useraudiostate-changed",message:d}),g.dispatchEvent(d));a.video&&(c._videopublished_!==t||b&&c._videopublished_)&&(d={userId:a.publisherId(),published:b?!1:t,type:a.getAttributes().type},a=TK.RoomEvent({type:"room-uservideostate-changed",message:d}),g.dispatchEvent(a))}}}function Ta(a){if("video"===a.getAttributes().type){var b=
g.getUser(a.publisherId());b&&(b._audiopublished_=!1,b._videopublished_=!1,a.audio&&(b={userId:a.publisherId(),published:!1,type:a.getAttributes().type},b=TK.RoomEvent({type:"room-useraudiostate-changed",message:b}),g.dispatchEvent(b)),a.video&&(b={userId:a.publisherId(),published:!1,type:a.getAttributes().type},a=TK.RoomEvent({type:"room-uservideostate-changed",message:b}),g.dispatchEvent(a)))}}function Aa(a,b){if(a&&void 0!==b){var c=void 0,t={};a.getAttributes().type===TK.STREAM_MEDIA?(c="room-usermediastate-changed",
t.duration=a.getAttributes().duration):a.getAttributes().type===TK.STREAM_SCREEN?c="room-userscreenstate-changed":a.getAttributes().type===TK.STREAM_FILE&&(c="room-userfilestate-changed");void 0!==c&&(t.userId=a.publisherId(),t.published=b,t.type=a.getAttributes().type,t.attributes=a.getAttributes(),t.attributes.video=a.hasVideo(),t.attributes.audio=a.hasAudio(),a=TK.RoomEvent({type:c,message:t}),g.dispatchEvent(a))}}function ob(a){Oa&&(ra(Ia.elementId,v,Ia.options),Oa=!1,Ia={});pb&&(n.publishstate>
TK.PUBLISH_STATE_NONE?qb(v):v.isPublishing=!1,pb=!1);L.Utils.isNull(a)||L.Utils.isNull(a.type)||"access-denied"===a.type&&L.Utils.isNull(a.message)||(L.Utils.isNull(a.stream)||delete a.stream,a=TK.RoomEvent(a),g.dispatchEvent(a))}function Pb(){var a=I+"://"+x+":"+z+"/ClientAPI/equipment?ts\x3d"+(new Date).getTime(),b="",c=!0,d="PC",e=L.Utils.getBrowserInfo();d=TK.isTkNative?TK.isTkMacNative?"MacClient":"WindowClient":"Mac"===L.Utils.detectOS()?"MacPC":"WindowPC";d={companyid:H.companyid,serial:H.serial,
peerId:n.id,peerName:n.nickname,devicetype:d,systemversion:TK.isTkNative&&TK.clientversion?TK.clientversion:e.info.browserName+" "+e.info.browserVersion,version:TK.APPVERSION,sdkVersion:TK.SDKVERSIONS,appType:"webpageApp",deviceName:TK.isTkNative?d:e.info.browserName,OSVersion:L.Utils.detectOS(),CpuArchitecture:"x86",ip:Ab};for(var f in d)c?c=!1:b+="\x26",b=b+f+"\x3d"+d[f];var g=h("POST",a,!0,b,function(){4===g.readyState&&(200===g.status?L.Logger.debug("[tk-sdk]equipment resp : "+g.responseText):
L.Logger.error("[tk-sdk]equipment fail[readyState-status]:",g.readyState,g.status))})}function Eb(){function a(){d&&f&&0===e&&(d=!1,b())}function b(){var a=I+"://"+x+":"+z+"/ClientAPI/networkequipment?ts\x3d"+(new Date).getTime();$.ajax({url:a,dataType:"json",type:"POST",async:!0,data:{companyid:H.companyid,serial:H.serial,statistical:c}}).done(function(a){L.Logger.debug("[tk-sdk]networkequipment resp \x3d ",L.Utils.toJsonStringify(a))}).fail(function(a,b,c){L.Logger.error("[tk-sdk]networkequipment fail[ jqXHR , textStatus , errorThrown ]:",
a,b,c)})}var c=[],d=!1,e=0,f=!1,h;for(h in g.remoteStreams){var r=g.remoteStreams[h];"video"===r.getAttributes().type&&A[r.extensionId]&&(d=!0,e++,function(b){g.rtcStatsrObserver(b,function(t){e--;t&&A[b.extensionId]&&(t={video:t.video,audio:t.audio,cpuOccupancy:0,peerId:A[b.extensionId].id,peerName:A[b.extensionId].nickname,streamId:b.getID()},c.push(t),a());b=void 0})}(r))}f=!0;a()}function qb(a,b,c){L.Logger.info("[tk-sdk]calling publish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+
", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));b=b||{};b.maxVideoBW=b.maxVideoBW||G.defaultVideoBW;b.maxVideoBW>G.maxVideoBW&&(b.maxVideoBW=G.maxVideoBW);"screen"===a.getAttributes().type?b.maxVideoBW=G.maxScreenBW:"file"===a.getAttributes().type&&(b.maxVideoBW=G.maxLocalFileMediaBW);void 0===b.minVideoBW&&(b.minVideoBW=0);b.minVideoBW>G.maxVideoBW&&(b.minVideoBW=G.maxVideoBW);b.simulcast=b.simulcast||b._simulcast||!1;a&&void 0===g.localStreams[a.getID()]?a.hasAudio()||a.hasVideo()||a.hasScreen()?
void 0===a.url&&void 0===a.recording&&(a.failed&&delete a.failed,clearTimeout(a._publishTimer),a._publishTimer=setTimeout(function(){g.unpublish(a,function(b){setTimeout(function(){b||L.Logger.warning("[tk-sdk]publish timeout 15s: unpublish in not success , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())+" !");if(a.extensionId===n.id)if(3>a.timeoutRePublishNumber)void 0===a.timeoutRePublishNumber&&(a.timeoutRePublishNumber=0),n.publishstate>
TK.PUBLISH_STATE_NONE?(L.Logger.info("[tk-sdk]publish timeout 15s--\x3epublish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.timeoutRePublishNumber++,g.publish(a,{timeoutPublishReconnection:!0})):L.Logger.warning("[tk-sdk]publish timeout 15s--\x3emy publishstate is 0 , not need afresh publish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));else{L.Logger.info("[tk-sdk]publish timeout 15s--\x3erePublish number \x3e 3 , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));a.extensionId===n.id&&n.publishstate>TK.PUBLISH_STATE_NONE&&g.changeUserProperty(a.extensionId,"__all",{publishstate:TK.PUBLISH_STATE_NONE});var d=TK.StreamEvent({type:"stream-publish-fail",stream:a,message:{code:"publishTimeout",errorCode:-1,timeoutRePublishNumber:a.timeoutRePublishNumber,timeoutPublishReconnection:!0}});g.dispatchEvent(d);c&&c(void 0,void 0)}else d=TK.StreamEvent({type:"stream-publish-fail",
stream:a,message:{code:"publishTimeout",errorCode:-1}}),g.dispatchEvent(d),L.Logger.info("[tk-sdk]publish timeout 15s--\x3e publish stream stream.extensionId !\x3d _myself.id   , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)})},15E3),L.Logger.debug("[tk-sdk]Publishing to ms Normally, is createOffer",b.createOffer,a.extensionId),la("publish",{state:"ms",data:a.hasData(),audio:a.hasAudio(),video:a.hasVideo()&&!TK.isOnlyAudioRoom,
screen:a.hasScreen(),minVideoBW:b.minVideoBW,attributes:a.getAttributes(),extensionId:a.extensionId,createOffer:b.createOffer,metadata:b.metadata,scheme:b.scheme},void 0,function(d,t){a.isPublishing=!1;clearTimeout(a._publishTimer);if(0!=d)if(L.Logger.error("[tk-sdk]Error when publishing the stream: ",d,t),L.Logger.info("[tk-sdk]stream-publish-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.extensionId===n.id)if(3>a.publishReconnectionNumber)void 0===
a.publishReconnectionNumber&&(a.publishReconnectionNumber=0),g.unpublish(a,function(b){setTimeout(function(){n.publishstate>TK.PUBLISH_STATE_NONE?(L.Logger.info("[tk-sdk]stream-publish-fail:publish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.publishReconnectionNumber++,g.publish(a,{publishReconnection:!0})):L.Logger.warning("[tk-sdk]stream-publish-fail:my publishstate is 0 , not need afresh publish , stream id:"+a.getID()+
" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)},{publishReconnection:!0});else{a.extensionId===n.id&&n.publishstate>TK.PUBLISH_STATE_NONE?g.changeUserProperty(a.extensionId,"__all",{publishstate:TK.PUBLISH_STATE_NONE}):g.unpublish(a);var e=TK.StreamEvent({type:"stream-publish-fail",stream:a,message:{code:"publishFail",errorCode:d,publishReconnectionNumber:a.publishReconnectionNumber,publishReconnection:!0,hasdata:!1}});g.dispatchEvent(e);c&&c(void 0,
d)}else L.Logger.info("[tk-sdk]stream-publish-fail:publish stream stream.extensionId !\x3d _myself.id   , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.unpublish(a),e=TK.StreamEvent({type:"stream-publish-fail",stream:a,message:{code:"publishFail",errorCode:d,id:t,hasdata:!1}}),g.dispatchEvent(e),c&&c(void 0,d);else L.Logger.debug("[tk-sdk]Stream assigned an Id, starting the publish process , stream id:"+a.getID()+" , extensionId is "+
a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.publishReconnectionNumber=0,a.timeoutRePublishNumber=0,b.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.getID=function(){return t},a.id=a.getID(),a.hasData()&&(a.sendData=function(b){Cb(a,b)}),a.setAttributes=function(b){Db(a,b)},g.localStreams[t]=a,a.room=g,a.pc=TK.Connection({callback:function(b){L.Logger.debug("[tk-sdk]Sending message",b);b=oa(b);la("signaling_message",{streamId:a.getID(),msg:b},void 0,function(){})},
iceServers:g.iceServers,maxAudioBW:b.maxAudioBW,maxVideoBW:b.maxVideoBW,limitMaxAudioBW:b.maxAudioBW,limitMaxVideoBW:b.maxVideoBW,simulcast:b.simulcast,audio:a.hasAudio(),video:a.hasVideo(),screen:a.hasScreen(),media:a.hasMedia(),cnnId:n.id},TK.isTkNative),a.peerConnectionStream=a.mediaStreamClone||(a.stream&&a.stream.clone&&"function"===typeof a.stream.clone?a.stream.clone():a.stream),a.pc.addStream(a.peerConnectionStream),a.pc.oniceconnectionstatechange=function(b){L.Logger.info("[tk-sdk]publish ice state:"+
b+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));"failed"===b&&0!==g.state&&a&&!a.failed&&(a.failed=!0,L.Logger.warning("[tk-sdk]Publishing Stream",a.getID(),"has failed after successful ICE checks , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),f(a,b,"publish"))},b.createOffer||a.pc.createOffer(),c&&c(!0,t)})):(L.Logger.error("[tk-sdk]Either screen or audio or video is at least one true for streaming",
a),c&&c(void 0,"Either screen or audio or video is at least one true for streaming")):(L.Logger.error("[tk-sdk]Trying to publish invalid stream , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),c&&c(void 0,"Trying to publish invalid stream"))}function rb(a,b){var c=b?"audioinput":"videoinput";if(1>a.length){L.Logger.error("[tk-sdk] "+c+" devices are un-available. reason: maybe NotReadable");var d=TK.RoomEvent({type:"device-failure",
message:{kind:c}},{code:TK_ERR.DEVICE_ERROR_UnknownError});g.dispatchEvent(d)}else TK.DeviceMgr.getUserMedia(function(a){a.getTracks().forEach(function(a){a.stop()});a=null;L.Logger.info("[tk-sdk] "+c+" devices are available");a=TK.RoomEvent({type:"device-success",message:{kind:c}});g.dispatchEvent(a)},function(d){switch(d.name){case "NotAllowedError":case "PermissionDeniedError":L.Logger.error("[tk-sdk] "+c+" devices are un-available. reason: NotAllowed");d=TK.RoomEvent({type:"device-failure",message:{kind:c}},
{code:window.TK_ERR.DEVICE_ERROR_NotAllowedError});g.dispatchEvent(d);return}a.splice(0,1);rb(a,b)},{video:b?!1:a[0].deviceId,audio:b?a[0].deviceId:!1})}function Pa(){0!==g.state&&L.Logger.warning("[tk-sdk]Room already connected",g.state);if(void 0===x||void 0===z||void 0===n)return L.Logger.warning("[tk-sdk]web_host or web_port or myself is undefined , web_host is "+x+" , web_port is "+z+",myself is "+n),-1;if(!H)return L.Logger.warning("[tk-sdk]No checkroom cannot joinroom , room_properties is "+
H),-1;g.needReconnectSocket=!0;TK.default_stream=v;n.publishstate!==TK.PUBLISH_STATE_NONE&&(n.publishstate=TK.PUBLISH_STATE_NONE);v.checkMyAudioAndVideoEnable=function(a){n&&n.id&&(a=a||n.id,a===n.id&&(TK.isTkNative&&(p(!0),k(!0)),n.publishstate>TK.PUBLISH_STATE_NONE&&l()))};if(Ca&&Ca.userProperties&&"object"===typeof Ca.userProperties)for(var a in Ca.userProperties)void 0===n[a]&&(n[a]=Ca.userProperties[a]);B&&B.group&&(Array.isArray(B.group)?n.group=B.group:L.Logger.warning("[tk-sdk]joinroomOptions.group must is a array!"));
L.Logger.info("[tk-sdk]joinroom:my device info  [hasvideo , hasaudio] is ["+n.hasvideo+" ,"+n.hasaudio+"]");L.Logger.debug("[tk-sdk]joinroom:my room user",n);A={};S={};V(x,z,function(a,b){0!==a?(L.Logger.error("[tk-sdk]step2GetConfig failure --\x3e result and responseText:",a,b),a=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.GETCONFIGERROR,error:a}}),g.dispatchEvent(a)):E(x,z,function(a,b){L.Logger.debug("[tk-sdk]step2GetFileList result \x3d "+a+" , message:"+L.Utils.toJsonStringify(b));
if(0===a){U=[];if(b&&Array.isArray(b)&&b.length){a=0;for(var c=b.length;a<c;a++){var d=b[a];d&&U.push({fileid:Number(d.fileid),companyid:d.companyid,filename:d.filename,uploaduserid:d.uploaduserid,uploadusername:d.uploadusername,downloadpath:d.downloadpath,swfpath:d.swfpath,filetype:d.filetype&&"string"===typeof d.filetype?d.filetype.toLocaleLowerCase():d.filetype,pagenum:Number(d.pagenum),dynamicppt:Number(d.dynamicppt),filecategory:Number(d.filecategory),fileprop:Number(d.fileprop),type:Number(d.type)})}}b=
TK.RoomEvent({type:"room-files",message:U});g.dispatchEvent(b)}else L.Logger.info("[tk-sdk]step2GetFileList code is "+a);Z()})})}function Qb(){var a=void 0;y?(v=a=Fa("video",{video:!1,audio:!1,attributes:{}}),delete Y[n.id+":video"],Pa()):B&&"object"===typeof B&&void 0!==B.video&&void 0!==B.audio?(L.Utils.isNull(v)&&(v=a=Fa("video",{video:B.video,audio:B.audio,attributes:{}}),delete Y[n.id+":video"]),void 0===n.hasvideo||void 0===n.hasaudio?(L.Logger.info("[tk-sdk]call enumerateDevices to joinroom set myself.hasvideo and  myself.hasaudio start!"),
va.enumerateDevices(function(a){L.Logger.info("[tk-sdk]call enumerateDevices to joinroom set myself.hasvideo and  myself.hasaudio finshed!");a=a.hasdevice;n.hasvideo=a.videoinput;n.hasaudio=a.audioinput;Pa()})):Pa()):void 0===n.hasvideo||void 0===n.hasaudio?(L.Logger.info("[tk-sdk]call enumerateDevices to joinroom set myself.hasvideo and  myself.hasaudio and create my stream start!"),va.enumerateDevices(function(b){L.Logger.info("[tk-sdk]call enumerateDevices to joinroom set myself.hasvideo and  myself.hasaudio and create my stream finshed!");
b=b.hasdevice;n.hasvideo=b.videoinput;n.hasaudio=b.audioinput;L.Utils.isNull(v)&&(v=a=Fa("video",{video:B&&"object"===typeof B&&void 0!==B.video?B.video:n.hasvideo,audio:B&&"object"===typeof B&&void 0!==B.audio?B.audio:n.hasaudio,attributes:{}}),delete Y[n.id+":video"]);Pa()})):(L.Utils.isNull(v)&&(v=a=Fa("video",{video:B&&"object"===typeof B&&void 0!==B.video?B.video:n.hasvideo,audio:B&&"object"===typeof B&&void 0!==B.audio?B.audio:n.hasaudio,attributes:{}})),Pa())}function Gb(a){if(v){v.hasVideo()!==
n.hasvideo&&v.changeVideo(n.hasvideo);v.hasAudio()!==n.hasaudio&&v.changeAudio(n.hasaudio);if(v.stream){for(var b in a)/^customdata_/g.test(b)&&(v.stream[b]=a[b]);var c=v.stream.getTracks();for(b=0;b<c.length;b++){var d=c[b];v.stream.removeTrack(d)}a=a.getTracks();for(b=0;b<a.length;b++)d=a[b],v.stream.addTrack(d)}else v.stream=a;v.mediaStreamClone=v.stream&&"function"===typeof v.stream.clone?v.stream.clone():v.stream;v.player&&v.player.changeMediaStreamUrl(v.stream);if(ha&&n&&void 0!=n.id&&A[n.id]){var t=
n.publishstate;t>TK.PUBLISH_STATE_NONE&&g.unpublish(v,function(a,b){p(!0);k(!0);l(n.publishstate);t>TK.PUBLISH_STATE_NONE&&g.publish(v)})}}else L.Logger.warning("[tk-sdk]changeLocalDeviceToLocalstream local stream is not exist!")}b=b||{};if("object"!==typeof b)L.Logger.error("[tk-sdk]TK.Room roomOptios must is json!");else{b.autoSubscribeAV=void 0!==b.autoSubscribeAV?b.autoSubscribeAV:!0;L.Logger.info("[tk-sdk-version]sdk-version:"+TK.SDKVERSIONS+" , sdk-time: "+TK.SDKVERSIONSTIME);var G={},g=TK.EventDispatcher(G),
I="https",ya="https",db="https",ta="https",x=void 0,Hb=void 0,Sa=void 0,Ib=void 0,z=void 0,pa=void 0,qa=void 0,eb=void 0,fb=void 0,ja=void 0,ka=void 0,aa=void 0,W=void 0,$a=0,mb=void 0,H=void 0,ia=320,ma=240,na=15,Ka=320,Ua=240,ub=15,La=256,wa=6,vb=void 0,jb=void 0,kb=void 0,v=void 0,n={},M={},P=void 0,va=TK.DeviceMgr,Wa=!1,yb=!0,Xa=void 0,zb=void 0,y=!1,xb=!0,Za=void 0,sb=3E3,ua=!1,wb=8080,bb=0,ha=!1,Jb=!0,D={},za=!1,gb=void 0,hb=void 0,Ma=!1,Na="",Y={},O=void 0,N={},B={},Ca={},Kb=!1,Ja=TK.NativeProxy,
Ga={},Ab="0.0.0.0",Ya=0,xa=window.TK.ROOM_MODE.NORMAL_ROOM,U=[];g.remoteStreams={};g.localStreams={};g.roomID="";g.socket={};g.p2p=!1;g.state=0;var A={},S={},ca={},pb=!1,Oa=!1,Ia={},Va=[[80,60],[200,150],[320,240],[640,480],[1280,720],[1920,1080]],J=0;TK.default_stream=v;TK.isPlayback=y;g.init=function(a){L.Logger.warning("[tk-sdk] room-sdk initializing. ",a);L.Utils.isNull(a)&&L.Logger.error("[tk-sdk] the appKey can not be empty when initializing room-sdk");a={video:!0,audio:!0};var b=function(){TK.DeviceMgr.getDevices(function(a){var b=
a.devices;a=b.audioinput;b=b.videoinput;if(0===a.length){L.Logger.error("[tk-sdk] audioinput devices are un-available. reason: NotFound");var c=TK.RoomEvent({type:"device-failure",message:{kind:"audioinput"}},{code:window.TK_ERR.DEVICE_ERROR_NotFoundError});g.dispatchEvent(c)}0===b.length&&(L.Logger.error("[tk-sdk] videoinput devices are un-available. reason: NotFound"),c=TK.RoomEvent({type:"device-failure",message:{kind:"videoinput"}},{code:window.TK_ERR.DEVICE_ERROR_NotFoundError}),g.dispatchEvent(c));
0<a.length&&rb(a,!0);0<b.length&&rb(b,!1)})},c=function(a){a.getTracks().forEach(function(a){a.stop()});a=null;b()},d=function(a){L.Logger.warning("[tk-sdk] failed to getUserMedia when initilize the room sdk.",a);b()};TK.isTkNative||TK.DeviceMgr.getUserMedia(c,d,a)};g.isOnlyAudioRoom=function(){return TK.isOnlyAudioRoom};g.updateProtocol=function(b){wb=/https/g.test(b)?8080:81;a({web_protocol:b,doc_protocol:b,socket_protocol:b,backup_doc_protocol:b})};g.updateRequestServerListPermission=function(a){Jb=
a};g.setIsGetFileList=function(a){xb=a};g.setIsGetRtcStatsrObserver=function(a){ua=a};g.setRtcStatsrObserverTimer=function(a){sb=a};g.setLogIsDebug=function(a,b){a=a||!1;void 0!==b&&(a=0===b?!0:!1);TK.tkLogPrintConfig({debug:a},{development:a,logLevel:void 0!==b&&"number"===typeof b?b:a?L.Constant.LOGLEVEL.DEBUG:L.Constant.LOGLEVEL.INFO},{webrtcLogDebug:a})};g.updateRoomMaxVideocount=function(a){wa=a;L.Logger.info("[tk-sdk]updateRoomMaxVideocount --\x3e update room_max_videocount to "+wa)};g.getWhiteboardManagerInstance=
function(){return O};g.getFileList=function(){return U};g.getFileinfo=function(a){for(var b=void 0,c=0,d=U.length;c<d;c++)if(U[c]&&U[c].fileid==a){b=U[c];break}return b};g.getAllRoleList=function(){return S};g.getConfigInfo=function(){return vb};g.getAVMgr=function(){return va};g.getDeviceMgr=function(){return va};g.getRoomMaxVideocount=function(){return wa};g.getServerName=function(){return P};g.getWebAddressInfo=function(){return{web_protocol:I,web_host:x,web_port:z,doc_protocol:ya,doc_host:pa,
doc_port:qa,backup_doc_protocol:ta,backup_doc_host:ja,backup_doc_port:ka}};g.getRoomType=function(){return $a};g.getRoomName=function(){return mb};g.getRoomProperties=function(){return H};g.getMySelf=function(){return n};g.getMyStream=function(){return v};g.getUser=function(a){if(void 0!==a)return A[a]};g.getUsers=function(){return A};g.getSpecifyRoleList=function(a){return void 0===a?(L.Logger.error("[tk-sdk]getSpecifyRoleList specifyRoleIdentification is not exist!"),{}):S[a]||{}};g.isBeyondMaxVideo=
function(){var a=0,b;for(b in A)if(A[b].publishstate!==TK.PUBLISH_STATE_NONE&&++a>=wa)return!0;return!1};g.changeUserProperty=function(a,b,c){if(6!=J)return 2;if(!TK.isOnlyAudioRoom||void 0===c.publishstate||c.publishstate!==TK.PUBLISH_STATE_VIDEOONLY&&c.publishstate!==TK.PUBLISH_STATE_BOTH){if(void 0===c||void 0===a)return L.Logger.error("[tk-sdk]changeUserProperty properties or id is not exist!"),4;var d={};d.id=a;d.toID=b||"__all";if(A[a]){if(c&&"object"===typeof c)return d.properties=c,da("setProperty",
d),0;L.Logger.error("[tk-sdk]properties must be json , user id: "+a+"!")}else L.Logger.error("[tk-sdk]user is not exist , user id: "+a+"!")}else L.Logger.warning("[tk-sdk]The publishstate of a pure audio room cannot be "+c.publishstate+"!")};g.changeUserPublish=function(a,b){if(6!=J)return 2;if(void 0===a)return 4;a===n.id&&(n.publishstate=b);g.changeUserProperty(a,"__all",{publishstate:b});return 0};g.changeMyDisableVideoState=function(a){if("boolean"!==typeof a)L.Logger.warning("[tk-sdk]changeMyDisableVideoState:disablevideo must boolean !");
else return g.changeUserProperty(n.id,"__all",{disablevideo:a}),0};g.changeMyDisableAudioState=function(a){if("boolean"!==typeof a)L.Logger.warning("[tk-sdk]changeMyDisableAudioState:disableaudio must boolean !");else return g.changeUserProperty(n.id,"__all",{disableaudio:a}),0};g.sendMessage=function(a,b,c){if(6!=J)return 2;var d={};d.toID=b||"__all";b={};"string"===typeof a&&(a=L.Utils.toJsonParse(a));if("object"===typeof a)for(var t in a)b[t]=a[t];else b.msg=a;"string"===typeof c&&(c=L.Utils.toJsonParse(c));
if(c&&"object"===typeof c)for(t in c)b[t]=c[t];d.message=L.Utils.toJsonStringify(b);da("sendMessage",d);return 0};g.pubMsg=function(a){if(6!=J)return 2;if(1===arguments.length&&a&&"object"===typeof a){var b=a.name||a.msgName;var c=a.id||a.msgId;var d=a.toID||a.toId;var t=a.data;var e=a.save;var f=a.expiresabs;var g=a.associatedMsgID;var h=a.associatedUserID;var r=a.expires;var k=a.type;var m=a.write2DB;var u=a.actions;var l=a.do_not_replace}else b=arguments[0],c=arguments[1],d=arguments[2],t=arguments[3],
e=arguments[4],f=arguments[5],g=arguments[6],h=arguments[7],r=arguments[8],k=arguments[9],m=arguments[10],u=arguments[11],l=arguments[12];var q={};q.name=b;q.id=c||q.name;q.toID=d||"__all";q.data=t;e||(q.do_not_save="");void 0!==r&&"number"===typeof r&&(q.expires=r);void 0!==f&&"number"===typeof f&&(q.expiresabs=f);void 0!==g&&(q.associatedMsgID=g);void 0!==h&&(q.associatedUserID=h);void 0!==k&&(q.type=k);void 0!==m&&"boolean"===typeof m&&(q.write2DB=m);void 0!==u&&(q.actions=u);void 0!==l&&(q.do_not_replace=
l);if(void 0===q.name||null===q.name)L.Logger.error("[tk-sdk]pubMsg name is must exist!");else return"DocumentChange"===q.name&&"__allExceptSender"===q.toID&&(b=L.Utils.toJsonParse(L.Utils.toJsonStringify(q)),b.fromID=n.id,b&&b.data&&"string"===typeof b.data&&(b.data=L.Utils.toJsonParse(b.data)),b&&b.data&&"string"===typeof b.data&&(b.data=L.Utils.toJsonParse(b.data)),Fb(b)),da("pubMsg",q),0};g.delMsg=function(a){if(6!=J)return 2;if(1===arguments.length&&a&&"object"===typeof a){var b=a.name||a.msgName;
var c=a.id||a.msgId;var d=a.toID||a.toId;var t=a.data}else b=arguments[0],c=arguments[1],d=arguments[2],t=arguments[3];var e={};e.name=b;e.id=c||e.name;e.toID=d||"__all";e.data=t;if(void 0===e.name||null===e.name)L.Logger.error("[tk-sdk]delMsg name is must exist!");else if(void 0===e.id||null===e.id)L.Logger.error("[tk-sdk]delMsg id is must exist!");else return da("delMsg",e),0};g.evictUser=function(a,b){L.Logger.debug("[tk-sdk]evictUser",a);if(6!=J)return 2;var c={};c.id=a;if(b&&"object"===typeof b)for(var d in b)c[d]=
b[d];da("evictParticipant",c);return 0};g.joinroom=function(a,b,c,d,e,f,h,r){B="object"===typeof e?e:{};Ca=Ca||{};Ca.userProperties=f;B.video=!0;B.audio=!0;jb=h;kb=r;e={serial:B.serial,password:B.password||""};c&&(e.nickname=c);L.Logger.info("[tk-sdk]call joinroom start!");g.checkroom(a,b,B.checkroomParamsUrl||e,function(a,b,c){b=TK.RoomEvent({type:"room-checkroom",message:{ret:a,userinfo:b,roominfo:c}});g.dispatchEvent(b);0===a?Qb():(a=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.CHECKROOMERROR,
error:a}}),g.dispatchEvent(a))},d)};g.leaveroom=function(a){a=a||!1;L.Logger.debug("[tk-sdk]leaveroom:Disconnection requested");q(8);try{g.socket&&g.socket.disconnect&&g.socket.disconnect()}catch(F){L.Logger.debug("[tk-sdk]Socket already disconnected , disconnect errorInfo:",F)}g.socket=void 0;ha=!1;O&&O.changeCommonWhiteBoardConfigration&&O.changeCommonWhiteBoardConfigration({isConnectedRoom:ha});a=TK.RoomEvent({type:"room-leaveroom",message:a});g.dispatchEvent(a)};g.publish=function(a,b,c){if(6!=
J)return L.Logger.warning("[tk-sdk]publish with wrong room status",J),2;if(a.isPublishing)c(void 0,void 0);else return a.isPublishing=!0,"video"!==a.getAttributes().type||!Ba(a)||a.isInit||y||a.isIniting?"video"===a.getAttributes().type&&Ba(a)&&a.isIniting?pb=!0:qb(a,b,c):(L.Logger.info("[tk-sdk]publish:my stream is not init , call stream init start!"),a.init(!0,void 0,function(d){L.Logger.info("[tk-sdk]publish:my stream is not init , call stream init finshed , result is :",L.Utils.toJsonStringify(d));
ob(d);n.publishstate>TK.PUBLISH_STATE_NONE&&qb(a,b,c)})),0};g.publishMedia=function(a,b,c){if(6!=J)return L.Logger.warning("[tk-sdk]publish with wrong room status",J),2;if(TK.isOnlyAudioRoom&&a.video)L.Logger.warning("[tk-sdk]only audio room not execute method publishMedia method !");else if(L.Logger.info("[tk-sdk]calling mediaPublish stream , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),b=b||{},a&&void 0===g.remoteStreams[a.getID()]){if(a.hasAudio()||
a.hasVideo()){if(void 0!==a.url||void 0!==a.recording){a.failed&&delete a.failed;if(a.url){var d="url";var t=a.url}else d="recording",t=a.recording;L.Logger.debug("[tk-sdk]Checking publish options for",a.getID());a.checkOptions(b);la("publish",{state:d,data:a.hasData(),audio:a.hasAudio(),video:a.hasVideo()&&!TK.isOnlyAudioRoom,attributes:a.getAttributes(),extensionId:a.extensionId,metadata:b.metadata,createOffer:b.createOffer},t,function(d,t){if(0==d)L.Logger.debug("[tk-sdk]mediaStream published , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),b.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.getID=function(){return t},a.id=a.getID(),a.sendData=function(b){Cb(a,b)},a.setAttributes=function(b){Db(a,b)},a.room=g,c&&c(t);else{L.Logger.error("[tk-sdk]Error when publishing mediaStream",d,t);var e=TK.StreamEvent({type:"stream-publish-fail",stream:a,message:{errorCode:d,id:t,hasdata:!1}});L.Logger.info("[tk-sdk]stream-publish-fail , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));g.dispatchEvent(e);c&&c(void 0,d)}})}return 0}L.Logger.error("[tk-sdk]Audio and video in the media file stream at least one is true",a);c&&c(void 0,"Audio and video in the media file stream at least one is true")}else L.Logger.error("[tk-sdk]Trying to publish invalid mediaStream",a),c&&c(void 0,"Trying to publish invalid mediaStrea")};g.unpublish=function(a,b,c){if(6!=J)return 2;c=c||{};L.Logger.info("[tk-sdk]calling unpublish , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));if(a&&!a.isUnpublishing&&g.localStreams[a.getID()])return a.isUnpublishing=!0,da("unpublish",a.getID(),function(d,e){a.isUnpublishing=!1;a.isPublishing=!1;0!==d?(L.Logger.error("[tk-sdk]Error unpublishing stream, stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()),e),d=TK.StreamEvent({type:"stream-unpublish-fail",stream:a,message:{error:e}}),
L.Logger.info("[tk-sdk]stream-unpublish-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.dispatchEvent(d),b&&b(void 0,e)):(L.Logger.debug("[tk-sdk]Stream unpublished  , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),c.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.room=void 0,(a.hasAudio()||a.hasVideo()||a.hasScreen())&&void 0===a.url&&(a.pc&&
a.pc.close(),a.pc=void 0),g.localStreams[a.getID()]&&(g.localStreams[a.getID()].peerConnectionStream=void 0),delete g.localStreams[a.getID()],a.getID=function(){return"local"},a.id=a.getID(),a.sendData=function(){},a.setAttributes=function(){},a.failed&&delete a.failed,b&&b(!0))}),0;L.Logger.error("[tk-sdk]unpublish error:","Cannot unpublish, stream does not exist or is not local");var d=TK.StreamEvent({type:"stream-unpublish-fail",stream:a,message:{error:"Cannot unpublish, stream does not exist or is not local"}});
L.Logger.info("[tk-sdk]stream-unpublish-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));g.dispatchEvent(d);b&&b(void 0,"Cannot unpublish, stream does not exist or is not local")};g.unpublishMedia=function(a,b,c){if(6!=J)return 2;L.Logger.info("[tk-sdk]calling unpublishMedia , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));da("unpublish",a.getID(),function(c,
d){0!==c?(L.Logger.error("[tk-sdk]Error unpublishing stream",d),c=TK.StreamEvent({type:"stream-unpublish-fail",stream:a,message:{error:d}}),L.Logger.info("[tk-sdk]stream-unpublish-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.dispatchEvent(c),b&&b(void 0,d)):(L.Logger.debug("[tk-sdk]meidaStream unpublished , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),
a.failed&&delete a.failed,b&&b(!0))});return 0};g.startServerRecord=function(a){a=a||{};var b=L.Utils.isNull(a.recordType)?TK.REC_TYPE_RECFILE:a.recordType;b!==TK.REC_TYPE_RECFILE&&b!==TK.REC_TYPE_VIDEOLIST&&b!==TK.REC_TYPE_MP3&&b!==TK.REC_TYPE_MIXVIDEO&&(b=TK.REC_TYPE_VIDEOLIST);var c=void 0!==a.recordChat&&"boolean"===typeof a.recordChat?a.recordChat:!0,d=L.Utils.isNull(a.convert)?0:a.convert;a=L.Utils.isNull(a.layout)?0:a.layout;b={name:"ClassBegin",id:"ClassBegin",toID:"__all",data:{recordtype:b,
convert:d,layout:a},save:!0};c&&(b.data.recordchat=!0);b.data=L.Utils.toJsonStringify(b.data);g.pubMsg(b)};g.stopServerRecord=function(){var a={name:"ClassBegin",id:"ClassBegin",toID:"__all",data:{}};a.data=L.Utils.toJsonStringify(a.data);g.delMsg(a)};g.sendControlMessage=function(a,b,c){a&&a.getID()&&(b={type:b||"control",action:c},la("signaling_message",{streamId:a.getID(),msg:b}))};g.subscribe=function(a,b,c){if(6!=J)return L.Logger.warning("[tk-sdk]subscribe when not ready"),2;clearTimeout(a._subscribeTimer);
a._subscribeTimer=setTimeout(function(){g.unsubscribe(a,function(b){setTimeout(function(){b||L.Logger.warning("[tk-sdk]subscribe timeout 15s: unsubscribe in not success , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())+" !");if(g.remoteStreams[a.getID()])if(3>a.timeoutReSubcribeNumber)L.Logger.info("[tk-sdk]subscribe timeout 15s--\x3esubscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),
void 0===a.timeoutReSubcribeNumber&&(a.timeoutReSubcribeNumber=0),a.timeoutReSubcribeNumber++,L.Logger.info("[tk-sdk]subscribe timeout 15s--\x3estream-removed(initiative) , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),delete Y[a.publisherId()+":"+a.getAttributes().type],a.getAttributes().type===TK.STREAM_VIDEO?Ta(a):Aa(a,!1),g.subscribe(a,{timeoutSubscribeReconnection:!0});else{L.Logger.info("[tk-sdk]subscribe timeout 15s--\x3ereSubscribe number \x3e 3 , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));var d=TK.StreamEvent({type:"stream-subscribe-fail",stream:a,message:{code:"subscribeTimeout",hasdata:!1,timeoutReSubcribeNumber:a.timeoutReSubcribeNumber,hasRemoteStream:void 0!==g.remoteStreams[a.getID()]}});g.dispatchEvent(d);c&&c(void 0,void 0)}else L.Logger.info("[tk-sdk]subscribe timeout 15s--\x3eremoteStreams does not contain streams , not need afresh subscribe , stream id:"+a.getID()+" , extensionId is "+
a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)},{timeoutSubscribeReconnection:!0})},15E3);b=b||{};if(!a||a.local||a.failed){var d="Error on subscribe";a?a.local?(L.Logger.warning("[tk-sdk]Cannot subscribe to local stream, you should subscribe to the remote version of your local stream"),d="Local copy of stream"):a.failed&&(L.Logger.warning("[tk-sdk]Cannot subscribe to failed stream, you should wait a new stream-added event."),d="Failed stream"):(L.Logger.warning("[tk-sdk]Cannot subscribe to invalid stream",
a),d="Invalid or undefined stream");c&&c(void 0,d)}else{if(a.hasVideo()||a.hasAudio()||a.hasScreen())a.hasVideo()||a.hasScreen()||(b.video=!1),a.hasAudio()||(b.audio=!1),b.maxVideoBW=b.maxVideoBW||G.defaultVideoBW,b.maxVideoBW>G.maxVideoBW&&(b.maxVideoBW=G.maxVideoBW),"screen"===a.getAttributes().type?b.maxVideoBW=G.maxScreenBW:"file"===a.getAttributes().type&&(b.maxVideoBW=G.maxLocalFileMediaBW),L.Logger.debug("[tk-sdk]Checking subscribe options for",a.getID()),a.checkOptions(b),la("subscribe",{streamId:a.getID(),
audio:b.audio,video:b.video,data:b.data,browser:TK.getBrowser(),createOffer:b.createOffer,metadata:b.metadata,slideShowMode:b.slideShowMode},void 0,function(d,e){clearTimeout(a._subscribeTimer);0!==d?(L.Logger.error("[tk-sdk]Error subscribing to stream ",e),L.Logger.info("[tk-sdk]stream-subscribe-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.remoteStreams[a.getID()]?3>a.subscribeReconnectionNumber?(void 0===a.subscribeReconnectionNumber&&
(a.subscribeReconnectionNumber=0),g.unsubscribe(a,function(b){setTimeout(function(){g.remoteStreams[a.getID()]?(a.subscribeReconnectionNumber++,L.Logger.info("[tk-sdk]stream-subscribe-fail--\x3estream-removed(initiative) , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),delete Y[a.publisherId()+":"+a.getAttributes().type],a.getAttributes().type===TK.STREAM_VIDEO?Ta(a):Aa(a,!1),g.subscribe(a,{subscribeReconnection:!0})):L.Logger.info("[tk-sdk]stream-subscribe-fail(subscribe-fail):  failed --\x3eremoteStreams does not contain streams , not need afresh subscribe , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)},{subscribeReconnection:!0})):(g.unsubscribe(a),d=TK.StreamEvent({type:"stream-subscribe-fail",error:e,message:{code:"subscribeFail",stream:a,hasdata:!1,subscribeReconnectionNumber:a.subscribeReconnectionNumber,hasRemoteStream:void 0!==g.remoteStreams[a.getID()]}}),g.dispatchEvent(d),c&&c(void 0,e)):L.Logger.info("[tk-sdk]stream-subscribe-fail:remoteStreams does not contain streams , not need afresh subscribe , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))):(L.Logger.debug("[tk-sdk]Subscriber added"),a.subscribeReconnectionNumber=0,a.timeoutReSubcribeNumber=0,b.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.pc=TK.Connection({callback:function(b){L.Logger.debug("[tk-sdk]Sending message ",b);b=oa(b);var c="chrome-stable";a.pc&&a.pc.browser&&(c=a.pc.browser);la("signaling_message",{streamId:a.getID(),msg:b,browser:c},void 0,function(){})},
nop2p:!0,audio:b.audio,video:b.video,screen:!1,maxAudioBW:b.maxAudioBW,maxVideoBW:b.maxVideoBW,limitMaxAudioBW:b.maxAudioBW,limitMaxVideoBW:b.maxVideoBW,iceServers:g.iceServers,cnnId:a.extensionId},a.isTkNative),a.pc.onaddstream=function(b){g.remoteStreams[a.getID()]?(L.Logger.debug("[tk-sdk]Stream subscribed"),a.stream=b.stream,a.mediaStreamClone=a.stream&&"function"===typeof a.stream.clone?a.stream.clone():a.stream,ua&&g.rtcStatsrObserver(a),a.extensionId!==n.id&&"video"===a.getAttributes().type&&
ab(a),L.Logger.info("[tk-sdk]stream-subscribed , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.getAttributes().type===TK.STREAM_VIDEO?(Ea(a),b=g.getUser(a.publisherId()),void 0!==b&&(b._audiopublished_=!a.audioMuted,b._videopublished_=!a.videoMuted)):Aa(a,!0)):L.Logger.info("[tk-sdk]stream-subscribe:remoteStreams does not contain streams ,stream  subscribe  information does not need to be passed to the interface layer , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},a.pc.oniceconnectionstatechange=function(b){L.Logger.info("[tk-sdk]subscribe ice state:"+b+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));"failed"===b&&0!==g.state&&a&&!a.failed&&(a.failed=!0,L.Logger.warning("[tk-sdk]Subscribing stream",a.getID(),"has failed after successful ICE checks , stream id:"+a.getID()+" , extensionId is "+
a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),f(a,b,"subscribe"))},a.pc.createOffer(!0),c&&c(!0))});else if(a.hasData()&&!1!==b.data)la("subscribe",{streamId:a.getID(),data:b.data,metadata:b.metadata},void 0,function(b,d){0!==b?(L.Logger.error("[tk-sdk]Error subscribing to stream ",d),b=TK.StreamEvent({type:"stream-subscribe-fail",stream:a,message:{error:d,hasdata:!0}}),L.Logger.info("[tk-sdk]stream-subscribe-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+
", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.dispatchEvent(b),c&&c(void 0,d)):g.remoteStreams[a.getID()]?(L.Logger.debug("[tk-sdk]Stream subscribed"),a.extensionId!==n.id&&"video"===a.getAttributes().type&&ab(a),L.Logger.info("[tk-sdk]stream-subscribed , stream id:"+a.getID()+" , hasData is "+a.hasData()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),"video"===a.getAttributes().type?(Ea(a),d=g.getUser(a.publisherId()),void 0!==d&&(d._audiopublished_=
!a.audioMuted,d._videopublished_=!a.videoMuted)):Aa(a,!0),c&&c(!0)):(L.Logger.info("[tk-sdk]stream-subscribe:remoteStreams does not contain streams ,stream  subscribe  information does not need to be passed to the interface layer , stream id:"+a.getID()+" , hasData is "+a.hasData()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),c&&c(!1))});else{L.Logger.warning("[tk-sdk]There's nothing to subscribe to");c&&c(void 0,"Nothing to subscribe to");return}L.Logger.debug("[tk-sdk]Subscribing to: "+
a.getID());return 0}};g.unsubscribe=function(a,b,c){void 0!==g.socket&&a&&!a.local&&(c=c||{},da("unsubscribe",a.getID(),function(d,e){0!==d?(d=TK.StreamEvent({type:"stream-unsubscribe-fail",stream:a,message:{error:e}}),L.Logger.info("[tk-sdk]stream-unsubscribe-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.dispatchEvent(d),b&&b(void 0,e)):(c.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.failed&&delete a.failed,
ib(a),b&&b(!0))},function(){L.Logger.error("[tk-sdk]Error calling unsubscribe.")}))};g.getStreamStats=function(a,b){L.Logger.warning("[tk-sdk]getStreamStats method is not support!")};g.getStreamsByAttribute=function(a,b){var c=[],d;for(d in g.remoteStreams)if(g.remoteStreams.hasOwnProperty(d)){var e=g.remoteStreams[d];void 0!==e.getAttributes()&&void 0!==e.getAttributes()[a]&&e.getAttributes()[a]===b&&c.push(e)}return c};g.seekPlayback=function(a){if(y)try{a=Number(a),g.socket.emit("seekPlayback",
a)}catch(F){L.Logger.error("[tk-sdk]The seek posttion must be a number, in milliseconds !")}else L.Logger.warning("[tk-sdk]No playback environment!")};g.pausePlayback=function(){y?g.socket.emit("pausePlayback"):L.Logger.warning("[tk-sdk]No playback environment!")};g.playPlayback=function(){y?g.socket.emit("Playback"):L.Logger.warning("[tk-sdk]No playback environment!")};g.initPlaybackInfo=function(b,c,d,e,f){var t=function(){if(d){if("string"===typeof d)try{d=L.Utils.toJsonParse(d)}catch(Rb){L.Logger.error("[tk-sdk]params type must is json! ");
return}if(void 0===d.roomtype||void 0===d.serial||void 0===d.recordfilepath)L.Logger.error("[tk-sdk]The params must be included [roomtype , serial , recordfilepath] ! ");else{q(1);a({web_host:b,web_port:c});var t={room:{roomtype:d.roomtype,maxvideo:void 0!==d.maxvideo?d.maxvideo:1E4,roomrole:-1,serial:d.serial,roomname:d.roomname||"Play Back",recordfilepath:d.recordfilepath,domain:d.domain,host:d.host||b,companyid:d.companyid||-1},nickname:"playback",roomrole:-1,thirdid:lb()+":playback"},f={};var h=
t.room;h.roomtype=Number(h.roomtype);h.maxvideo=parseInt(h.maxvideo);h.roomrole=Number(h.roomrole);H=h;W=h.serial;mb=h.roomname;$a=h.roomtype;wa=h.maxvideo;Za=h.recordfilepath;f.properties={};f.properties.role=t.roomrole;f.properties.nickname=t.nickname;f.properties.hasvideo=!1;f.properties.hasaudio=!1;f.id=t.thirdid;y=!0;TK.isPlayback=y;n=TK.RoomUser(f);y&&(W=W+"_"+n.id)&&-1===W.indexOf(":playback")&&(W+=":playback");g.setIsGetFileList(!1);ua=!1;Na=t?"string"===typeof t?t:L.Utils.toJsonStringify(t):
"";TK.isTkNative&&!za&&(za=!0,window.tknative.postMessage({command:"initNative",localId:n.id.toString(),width:Number(ia),height:Number(ma),fps:Number(na),roomInfo:Na,webAddr:x.toString(),webPort:z.toString()}));L.Logger.info("[tk-sdk]initPlaybackInfo--\x3e_room_max_videocount:"+wa+" , my id:"+n.id+" , room id:"+W,"room properties chairmancontrol is:"+(H.chairmancontrol?window.__TkSdkBuild__?L.Utils.encrypt(H.chairmancontrol):H.chairmancontrol:void 0));e&&"function"===typeof e&&e(0,f,t)}}else L.Logger.error("[tk-sdk]params is required ,params type is json !")};
f?t():d&&"object"===typeof d?d.recordfilepath?(q(1),a({web_host:b,web_port:c}),y=!0,TK.isPlayback=y,Za=d.recordfilepath,g.setIsGetFileList(!1),ua=!1,d.playback=!0,L.Logger.info("[tk-sdk]initPlaybackInfo to checkroom start , params is "+(window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(d)):L.Utils.toJsonStringify(d))+"!"),f=d.recordfilepath+"room.json",/room.json/g.test(d.recordfilepath)&&(f=d.recordfilepath),/https:/g.test(window.location.protocol)&&!/https:/g.test(f)&&(f=f.replace(/http:/g,
"https:").replace(/:\d+/g,"")),$.ajax({url:f,dataType:"json",type:"GET",async:!0}).done(function(a){L.Logger.debug("[tk-sdk]getPlaybackRoomJson resp \x3d ",L.Utils.toJsonStringify(a));a&&"object"===typeof a?Bb(a,function(a,b,c){0===a?e&&"function"===typeof e&&e(a,b,c):t()}):(L.Logger.error("[tk-sdk]getPlaybackRoomJson resp must is json , call oldInitPlaybackInterface handler!"),t())}).fail(function(a,b,c){L.Logger.error("[tk-sdk]getPlaybackRoomJson fail[ jqXHR , textStatus , errorThrown ]:",a,b,c);
t()})):L.Logger.error("[tk-sdk]params.recordfilepath is required !"):L.Logger.error("[tk-sdk]params is required ,params type is json !")};g.checkroom=function(b,c,d,e,f,r){q(1);a({web_host:b,web_port:c});L.Utils.getJsonLength(M)||y||g.requestServerList(x,z,void 0,{checkroom:!0});b=I+"://"+x+":"+z+"/ClientAPI/checkroom?ts\x3d"+(new Date).getTime();c=!0;r="";if("string"===typeof d)r=d,y&&(r+="\x26playback\x3dtrue"),r+="\x26clientType\x3d"+(TK.isTkNative?4:1);else{y&&(d.playback=!0);d.clientType=TK.isTkNative?
4:1;for(var t in d)c?c=!1:r+="\x26",r=r+t+"\x3d"+d[t]}L.Logger.debug("[tk-sdk]Going to checkroom",r);L.Logger.info("[tk-sdk]call checkroom start!");var k=h("POST",b,!0,r,function(){L.Logger.debug("[tk-sdk]Http status ",k.readyState);if(4==k.readyState)if(200==k.status){L.Logger.debug("[tk-sdk]checkroom resp : "+k.responseText);var a=L.Utils.toJsonParse(k.responseText);Bb(a,e,f)}else L.Logger.error("[tk-sdk]checkroom fail[readyState-status]:",k.readyState,k.status),e(3,k.responseText)})};g.controlMedia=
function(a,b){g.socket.emit("controlmedia",a,b)};g.changeLocalDeviceToLocalstream=function(a,b,c){a=a||{};TK.DeviceMgr.changeLocalDeviceToLocalstream(Gb,a,b,c)};va.onDevicesSetted=function(a){Gb(a)};va.onDeviceChanged=function(a){Kb&&tb(a)};g.getUploadFileParams=function(a,b,c,d){a={serial:H.serial,userid:n.id,sender:n.nickname,conversion:1,isconversiondone:0,writedb:(void 0!==c?c:1)?1:0,fileoldname:a,fieltype:b,alluser:1};d&&(a.codeid=d);return a};g.docUploadFileDataInfo=function(a,b){var c=I+"://"+
x+":"+z+"/ClientAPI/docupdateinfo?ts\x3d"+(new Date).getTime();if(a)return $.ajax({url:c,dataType:"json",type:"POST",data:{fileid:a},async:!0}).done(function(a){L.Logger.debug("[tk-sdk]docUploadFileDataInfo resp \x3d ",L.Utils.toJsonStringify(a));b&&"function"===typeof b&&b(a.status,a)}).fail(function(a,c,d){L.Logger.error("[tk-sdk]docUploadFileDataInfo fail[ jqXHR , textStatus , errorThrown ]:",a,c,d);b(3,void 0)});L.Logger.error("[tk-sdk]docUploadFileDataInfo fileId is required!")};g.uploadFile=
function(a,b,c){return X(a,b,c)};g.deleteFile=function(a,b){ba(a,b)};g.stopIntervalRtcStatsrObserver=function(){clearInterval(g._rtcStatsrObserverTimer);g._rtcStatsrObserverTimer=null};g.startIntervalRtcStatsrObserver=function(){TK.isTkNative?L.Logger.warning("[tk-sdk]Client not support startIntervalRtcStatsrObserver method!"):(clearInterval(g._rtcStatsrObserverTimer),g._rtcStatsrObserverTimer=setInterval(function(){for(var a in g.remoteStreams){var b=g.remoteStreams[a];b.extensionId===n.id&&g.localStreams[b.getID()]&&
(b=v);b&&b.pc&&g.rtcStatsrObserver(b)}},sb))};g.stopIntervalRtcStatsrObserverByStream=function(a){a?(clearInterval(a.rtcStatsrObserverTimer),a.rtcStatsrObserverTimer=null):L.Logger.error("[tk-sdk]stream is not exist!")};g.startIntervalRtcStatsrObserverByStream=function(a,b){TK.isTkNative?L.Logger.warning("[tk-sdk]Client not support startIntervalRtcStatsrObserverByStream method!"):(b=b||sb,a?(clearInterval(a.rtcStatsrObserverTimer),a.rtcStatsrObserverTimer=setInterval(function(){a&&a.pc&&g.rtcStatsrObserver(a)},
b)):L.Logger.error("[tk-sdk]stream is not exist!"))};g.rtcStatsrObserver=function(a,b){if(TK.isTkNative)L.Logger.warning("[tk-sdk]Client not support rtcStatsrObserver method!"),"function"===typeof b&&b(void 0);else if(a)if(a.extensionId===n.id&&g.localStreams[a.getID()]&&(a=v),a.pc)if(a&&a.pc)if(!0===a.pc.isNative){L.Logger.debug("[tk-sdk]pc.getStats has not been implemented currently!");clearTimeout(g._rtcStatsrObserverTimer);clearTimeout(a.rtcStatsrObserverTimer);g._rtcStatsrObserverTimer=null;
a.rtcStatsrObserverTimer=null;"function"===typeof b&&b(void 0);var c=TK.StreamEvent({type:"stream-rtcStats-failed",stream:a,message:{error:"[tk_client]pc.getStats has not been implemented currently!",code:L.Constant.getStats.nativeFailure,isNative:a.pc.isNative}});g.dispatchEvent(c)}else if(a.pc.getStats)try{a.pc.getStats(function(c,d){void 0===d||-1!==d&&-2!==d&&-3!==d?(c=Qa(a,c))?(a.networkStatus=c,"function"===typeof b&&b(c),c=TK.StreamEvent({type:"stream-rtcStats",stream:a,message:{networkStatus:c}},
!1),g.dispatchEvent(c,!1)):g.rtcStatsrObserver(a,b):(L.Logger.error("[tk-sdk]pc.getStats -\x3e getStats not exist!"),clearTimeout(a.rtcStatsrObserverTimer),a.rtcStatsrObserverTimer=null,"function"===typeof b&&b(void 0),c=TK.StreamEvent({type:"stream-rtcStats-failed",stream:a,message:{error:"pc.getStats -\x3e getStats not exist!",code:-1===d?L.Constant.getStats.peerConnectionNotGetStats:-2===d?L.Constant.getStats.getStatsFailure:L.Constant.getStats.getStatsError,isNative:a.pc.isNative}}),g.dispatchEvent(c))})}catch(Lb){"function"===
typeof b&&b(void 0),L.Logger.error("[tk-sdk]pc.getStats error:",Lb)}else L.Logger.error("[tk-sdk]pc.getStats is not exist!"),clearTimeout(a.rtcStatsrObserverTimer),a.rtcStatsrObserverTimer=null,"function"===typeof b&&b(void 0),c=TK.StreamEvent({type:"stream-rtcStats-failed",stream:a,message:{error:"pc.getStats is not exist!",code:L.Constant.getStats.pcNotGetStats,isNative:a.pc.isNative}}),g.dispatchEvent(c);else"function"===typeof b&&b(void 0);else L.Logger.error("[tk-sdk]stream.pc is not exist , stream id and extensionId:"+
a.getID()+","+a.extensionId+"!"),"function"===typeof b&&b(void 0);else L.Logger.error("[tk-sdk]stream is not exist!"),"function"===typeof b&&b(void 0)};g.addOndevicechange=function(){if(TK.isTkNative)L.Logger.warning("[tk-sdk]Client not support addOndevicechange method!");else if(!y){var a=function(a){tb(a)};TK&&TK.DeviceMgr&&TK.DeviceMgr.addOndevicechange?TK.DeviceMgr.addOndevicechange(a)&&g.dispatchEvent({type:"add_device_change_listener"}):L.Logger.error("TK.DeviceMgr no initialization is done!")}};
g.removeOndevicechange=function(){TK.isTkNative?L.Logger.warning("[tk-sdk]Client not support removeOndevicechange method!"):TK&&TK.DeviceMgr&&TK.DeviceMgr.removeOndevicechange?TK.DeviceMgr.removeOndevicechange()&&g.dispatchEvent({type:"remove_device_change_listener"}):L.Logger.error("TK.DeviceMgr no initialization is done!")};g.setAutoProcessDeviceChangeEvent=function(a){"boolean"===typeof a&&(Kb=a)};g.startRecordStream=function(a,b,c){if(6!=J)return 2;if(void 0===a||void 0===a.getID())return 4;var d=
{};d.streamId=a.getID();d.convert=b.convert||0;da("startRecordStream",d,function(a,b){L.Logger.debug("startRecordStream",a,b);c(a,b)});return 0};g.stopRecordStream=function(a,b,c){if(6!=J)return 2;if(void 0===a||void 0===a.getID())return 4;c={};c.streamId=a.id;da("stopRecordStream",c,function(a){L.Logger.debug("stopRecordStream",a);b(a)});return 0};g.requestServerList=function(a,b,c,d){if(Jb)if(g.webInterfaceGetservering)L.Logger.info("[tk-sdk]requestServerList  interface is being requested and cannot be executed again requestServerList"),
c&&"function"===typeof c&&(e(M,P),c(M,-2));else{if(L.Utils.getJsonLength(M))return c&&"function"===typeof c&&(e(M,P),c(M,-1)),M;if(void 0===a||null===a||void 0===b||null===b)L.Logger.error("[tk-sdk]first requestServerList web_host or web_port is not exist!");else{Hb=a;Ib=b;L.Logger.debug("[tk-sdk]Going to requestServerList");var f=!1,t=function(){if(f){e(M,P);L.Logger.info("[tk-sdk]requestServerList finshed , serverName is "+P+" , serverlist info : ",window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(M)):
L.Utils.toJsonStringify(M));var a=TK.RoomEvent({type:"room-serverlist",message:{serverList:M,serverName:P}});g.dispatchEvent(a);c&&"function"===typeof c&&c(M,0)}};g.webInterfaceGetservering=!0;L.Utils.getJsonLength(M)?(g.webInterfaceGetservering=!1,f=!0,t()):Q(a,b,function(a,b){g.webInterfaceGetservering=!1;f=!0;t()})}}else c&&"function"===typeof c&&c(void 0,-2)};g.switchServerByName=function(a){if(!L.Utils.getJsonLength(M))return L.Logger.error("[tk-sdk]selectServerByName --\x3e service list not request  , list is not exist!"),
!1;if(!M[a])return L.Logger.error("[tk-sdk]selectServerByName --\x3e the service list  has no option name  "+a+"!"),!1;void 0!==x&&void 0!==z?0<bb?(P=a,e(M,P),d(),Sa!==x?c({source:"select service reconnect"}):L.Logger.info("[tk-sdk]web request host is not change , not need reconnect service!")):L.Logger.error("[tk-sdk]selectServerByName--\x3eThe room has no connection success and cannot perform a reswitch server! "):L.Logger.error("[tk-sdk]selectServerByName--\x3eweb request host and port is not exist , cannot perform a reswitch server! ");
return!0};g.selectServerToCheckroom=function(b,c,f,h,r){b=b||P;L.Utils.getJsonLength(M)?M[b]?(P=b,e(M,P),a({web_host:Hb,web_port:Ib}),void 0!==x&&void 0!==z?(d(),g.checkroom(x,z,c,f,h,r)):L.Logger.error("[tk-sdk]web request host and port is not exist , cannot call checkroom ! ")):(L.Logger.error("[tk-sdk]selectServerToCheckroom --\x3ethe service list  has no option name  "+b+"!"),f&&"function"===typeof f&&f(-2,void 0,void 0)):(L.Logger.error("[tk-sdk]selectServerToCheckroom --\x3eservice list not request  , list is not exist!"),
f&&"function"===typeof f&&f(-2,void 0,void 0))};g.stopStreamTracksFromDefaultStream=function(){v&&v.stream?TK.DeviceMgr.stopStreamTracks?TK.DeviceMgr.stopStreamTracks(v.stream):L.Logger.warning("[tk-sdk] TK.DeviceMgr.stopStreamTracks is not exist , inexecutable stopStreamTracksFromDefaultStream"):L.Logger.warning("[tk-sdk] defaultstream.stream is not exist , inexecutable stopStreamTracksFromDefaultStream")};g.enableLocalAudioOrVideo=function(a){a&&"object"===typeof a?(void 0!==a.video&&"boolean"===
typeof a.video&&k(a.video),void 0!==a.audio&&"boolean"===typeof a.audio&&p(a.audio)):L.Logger.error("[tk-sdk]enableLocalAudioOrVideo enables must is json . enables \x3d {video , audio} !")};g.publishVideo=function(){TK.isOnlyAudioRoom?L.Logger.warning("[tk-sdk]only audio room not execute method publishVideo method !"):n.publishstate!==TK.PUBLISH_STATE_VIDEOONLY&&n.publishstate!==TK.PUBLISH_STATE_BOTH&&g.changeUserPublish(n.id,n.publishstate===TK.PUBLISH_STATE_MUTEALL||n.publishstate===TK.PUBLISH_STATE_NONE?
TK.PUBLISH_STATE_VIDEOONLY:TK.PUBLISH_STATE_BOTH)};g.unpublishVideo=function(){TK.isOnlyAudioRoom?L.Logger.warning("[tk-sdk]only audio room not execute method unpublishVideo method !"):n.publishstate===TK.PUBLISH_STATE_NONE?L.Logger.warning("[tk-sdk]Local streams are not published and cannot be executed unpublishVideo."):n.publishstate!==TK.PUBLISH_STATE_AUDIOONLY&&g.changeUserPublish(n.id,n.publishstate===TK.PUBLISH_STATE_BOTH?TK.PUBLISH_STATE_AUDIOONLY:TK.PUBLISH_STATE_NONE)};g.publishAudio=function(){n.publishstate!==
TK.PUBLISH_STATE_AUDIOONLY&&n.publishstate!==TK.PUBLISH_STATE_BOTH&&g.changeUserPublish(n.id,n.publishstate===TK.PUBLISH_STATE_MUTEALL||n.publishstate===TK.PUBLISH_STATE_NONE?TK.PUBLISH_STATE_AUDIOONLY:TK.PUBLISH_STATE_BOTH)};g.unpublishAudio=function(){n.publishstate===TK.PUBLISH_STATE_NONE?L.Logger.warning("[tk-sdk]Local streams are not published and cannot be executed unpublishAudio."):n.publishstate!==TK.PUBLISH_STATE_VIDEOONLY&&g.changeUserPublish(n.id,n.publishstate===TK.PUBLISH_STATE_BOTH?
TK.PUBLISH_STATE_VIDEOONLY:TK.PUBLISH_STATE_NONE)};g.playStream=function(a,b,c){c=c||{};if(a)if(b)if("object"!==typeof c)L.Logger.error("[tk-sdk]playStream method options not is json!");else{var d=fa(b,"video");d?(void 0===c.video&&void 0===c.audio&&(c.video=void 0!==c.video&&"boolean"===typeof c.video?c.video:!0,c.audio=void 0!==c.audio&&"boolean"===typeof c.audio?c.audio:!0),!Ba(d)||"video"!==d.getAttributes().type||d.isInit||y?ra(a,d,c):(L.Logger.info("[tk-sdk]playStream:my stream is not init , call stream init start!"),
v.init(!0,void 0,function(b){L.Logger.info("[tk-sdk]playStream:my stream is not init , call stream init finshed , result is :",L.Utils.toJsonStringify(b));ra(a,d,c);ob(b)}))):L.Logger.warning("[tk-sdk]playStream: user is not stream  , user id is "+b)}else L.Logger.error("[tk-sdk]playStream method userid is not exist!");else L.Logger.error("[tk-sdk]playStream method elementId is not exist!")};g.unplayStream=function(a,b){b=b||{};if(a)if("object"!==typeof b)L.Logger.error("[tk-sdk]unplayStream method options not is json!");
else{var c=N[a];c?(void 0===b.video&&void 0===b.audio&&(b.video=void 0!==b.video&&"boolean"===typeof b.video?b.video:!0,b.audio=void 0!==b.audio&&"boolean"===typeof b.audio?b.audio:!0),Ha(c,b)):L.Logger.warning("[tk-sdk]unplayStream: user is not stream  , user id is "+a)}else L.Logger.error("[tk-sdk]unplayStream method userid is not exist!")};g.playShareMedia=function(a,b,c){c=c||{};if(a)if(b)if("object"!==typeof c)L.Logger.error("[tk-sdk]playShareMedia method options not is json!");else{var d=fa(b,
"media");d?(void 0===c.video&&void 0===c.audio&&(c.video=void 0!==c.video&&"boolean"===typeof c.video?c.video:!0,c.audio=void 0!==c.audio&&"boolean"===typeof c.audio?c.audio:!0),ra(a,d,c)):L.Logger.warning("[tk-sdk]playShareMedia: user is not stream  , user id is "+b)}else L.Logger.error("[tk-sdk]playShareMedia method userid is not exist!");else L.Logger.error("[tk-sdk]playShareMedia method elementId is not exist!")};g.unplayShareMedia=function(a,b){b=b||{};if(a)if("object"!==typeof b)L.Logger.error("[tk-sdk]unplayShareMedia method options not is json!");
else{var c=N[a+":media"];c?(void 0===b.video&&void 0===b.audio&&(b.video=void 0!==b.video&&"boolean"===typeof b.video?b.video:!0,b.audio=void 0!==b.audio&&"boolean"===typeof b.audio?b.audio:!0),Ha(c,b)):L.Logger.warning("[tk-sdk]unplayShareMedia: user is not stream  , user id is "+a)}else L.Logger.error("[tk-sdk]unplayShareMedia method userid is not exist!")};g.playRemoteMediaFile=function(a,b,c,d){if(a)if(b)if(c&&"object"!==typeof c)L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] playRemoteMediaFile method options is not json!");
else{var e=fa(a,TK.STREAM_FILE);e?(c=c||{},c.audio=!0,c.video=!0,ra(b,e,c)):(L.Utils.isFunction(d)&&d("could not find media stream"),L.Logger.error("[tk-sdk] playRemoteMediaFile: user has not stream, user id is "+a))}else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] playRemoteMediaFile method got invalid elementId!");else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] playRemoteMediaFile method got invalid userId!")};g.unplayRemoteMediaFile=function(a,
b){if(a){var c=N[a+TK.STREAM_FILE];c?Ha(c,{audio:!0,video:!0}):(L.Utils.isFunction(b)&&b("could not find media stream"),L.Logger.warning("[tk-sdk] unplayRemoteMediaFile: user has not stream, user id is "+a))}else L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] unplayRemoteMediaFile method got invalid userId!")};g.playRemoteScreen=function(a,b,c,d){if(a)if(b)if(c&&"object"!==typeof c)L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] playRemoteScreen method options is not json!");
else{var e=fa(a,TK.STREAM_SCREEN);e?(c=c||{},c.audio=!0,c.video=!0,ra(b,e,c)):(L.Utils.isFunction(d)&&d("could not find media stream"),L.Logger.error("[tk-sdk] playRemoteScreen: user has not stream, user id is "+a))}else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] playRemoteScreen method got invalid elementId!");else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] playRemoteScreen method got invalid userId!")};g.unplayRemoteScreen=function(a,b){if(a){var c=
N[a+TK.STREAM_SCREEN];c?Ha(c,{audio:!0,video:!0}):(L.Utils.isFunction(b)&&b("could not find media stream"),L.Logger.warning("[tk-sdk] unplayRemoteScreen: user has not stream, user id is "+a))}else L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] unplayRemoteScreen method got invalid userId!")};g.updateVideoPlayerOptions=function(a,b,c){"object"!==typeof a?L.Logger.error("[tk-sdk] updateVideoPlayerOptions method options muset is json!"):(c=fa(b,c||TK.STREAM_VIDEO))?c.updateVideoPlayerOptions(a):
L.Logger.warning("[tk-sdk] updateVideoPlayerOptions: user is not stream  , user id is "+b)};g.setRemoteAudioVolume=function(a,b,c){"number"!==typeof a?L.Logger.error("[tk-sdk] setRemoteAudioVolume method volume muset is number!"):(c=fa(b,c||TK.STREAM_VIDEO))?c.setVolume(a):L.Logger.warning("[tk-sdk] setRemoteAudioVolume: user is not stream  , user id is "+b)};g.getAudioVolume=function(a,b,c){L.Utils.isFunction(b)?(c=fa(a,c||TK.STREAM_VIDEO))?c.getVolume(b):L.Logger.warning("[tk-sdk] getAudioVolume: user has not stream, user id is "+
a):L.Logger.warning("[tk-sdk] getAudioVolume: onVolume is not function")};g.registerAudioVolumeListener=function(a,b,c,d,e){L.Utils.isNull(a)?(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] registerAudioVolumeListener: userId is invalid")):"number"!==typeof b?(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] registerAudioVolumeListener: msInterval is invalid")):L.Utils.isFunction(c)?(50>b&&(b=50),(e=fa(a,e||TK.STREAM_VIDEO))?e.startIntervalGetRealtimeVolume(function(a,
b){"_local_default_extension_id_"!==b||L.Utils.isNull(n.id)||(b=n.id);L.Utils.isFunction(c)&&c(a,b)},b,d):(L.Utils.isFunction(d)&&d("TK_NO_THIS_STREAM"),L.Logger.error("[tk-sdk] registerAudioVolumeListener: user has not stream, user id is "+a))):(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] registerAudioVolumeListener: onVolume is not function"))};g.unregisterAudioVolumeListener=function(a,b){(b=fa(a,b||TK.STREAM_VIDEO))?b.stopIntervalGetRealtimeVolume():L.Logger.warning("[tk-sdk] unregisterAudioVolumeListener: user has not stream, user id is "+
a)};g.switchOnlyAudioRoom=function(a){var b={};a?(TK.needOnlyAudioRoom=1,a={name:"OnlyAudioRoom",id:"OnlyAudioRoom",toID:"__all",data:b,save:!0},g.pubMsg(a)):(TK.needOnlyAudioRoom=2,a={name:"OnlyAudioRoom",id:"OnlyAudioRoom",toID:"__all",data:b},g.delMsg(a))};g.startShareMedia=function(a,b,c,d,e){function f(){L.Logger.info("[tk-sdk]calling startShareMedia  , url is "+a+" , isVideo is "+b+" , toID is "+c+", attrs is "+L.Utils.toJsonStringify(d));la("publish",{state:"url",data:r.data,audio:r.audio,
video:r.video&&!TK.isOnlyAudioRoom,attributes:r.attributes,extensionId:r.extensionId,metadata:void 0,createOffer:void 0},r.url,function(a,b){if(0==a)L.Logger.debug("[tk-sdk]mediaStream published , stream id:"+b+" , extensionId is "+r.extensionId+", attrs is "+L.Utils.toJsonStringify(r.attributes)),e&&e(b);else{L.Logger.error("[tk-sdk]Error when publishing mediaStream",a,b);var c=TK.StreamEvent({type:"stream-publish-fail",userid:Ob(r.extensionId,"media"),message:{errorCode:a,id:b,hasdata:!1}});L.Logger.info("[tk-sdk]stream-publish-fail , stream id:"+
b+" , extensionId is "+r.extensionId+", attrs is "+L.Utils.toJsonStringify(r.attributes));g.dispatchEvent(c);e&&e(void 0,a)}})}if(6!==J)return L.Logger.warning("[tk-sdk]startShareMedia with wrong room status",J),e&&"function"===typeof e&&e(void 0),2;if(a)if(TK.isOnlyAudioRoom&&b)L.Logger.warning("[tk-sdk]only audio room not execute method startShareMedia to video media !"),e&&"function"===typeof e&&e(void 0);else{var t={type:"media"};b=void 0!==b?b:!1;void 0!==c&&(t.toID=c);if(d&&"object"===typeof d)for(var h in d)"toID"!==
h&&"type"!==h&&(t[h]=d[h]);var r={audio:!0,video:b,url:a,extensionId:n.id+":media",attributes:t};t=!1;for(h in g.remoteStreams){var k=g.remoteStreams[h];k&&"media"===k.getAttributes().type&&(t=!0,g.stopShareMedia(function(a){f()}))}t||f()}else L.Logger.error("[tk-fake-sdk]startShareMedia url can not be empty!"),e&&"function"===typeof e&&e(void 0)};g.stopShareMedia=function(a){function b(b){L.Logger.info("[tk-sdk]calling stopShareMedia , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+
L.Utils.toJsonStringify(b.getAttributes()));da("unpublish",b.getID(),function(c,d){0!==c?(L.Logger.error("[tk-sdk]Error unpublishing stream",d),c=TK.StreamEvent({type:"stream-unpublish-fail",stream:b,message:{error:d}}),L.Logger.info("[tk-sdk]stream-unpublish-fail , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),g.dispatchEvent(c),a&&a(void 0,d)):(L.Logger.debug("[tk-sdk]meidaStream unpublished , stream id:"+b.getID()+" , extensionId is "+
b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),b.failed&&delete b.failed,a&&a(!0))})}if(6!==J)return L.Logger.warning("[tk-sdk]stopShareMedia with wrong room status",J),a&&"function"===typeof a&&a(void 0),2;var c=!1,d;for(d in g.remoteStreams){var e=g.remoteStreams[d];e&&"media"===e.getAttributes().type&&(c=!0,b(e))}c||a&&"function"===typeof a&&a(void 0)};g.getShareMediaController=function(){return{play:function(){for(var a in g.remoteStreams){var b=g.remoteStreams[a];"media"===
b.getAttributes().type&&g.controlMedia(b.getID(),{type:"pause",pause:!1})}},pause:function(){for(var a in g.remoteStreams){var b=g.remoteStreams[a];"media"===b.getAttributes().type&&g.controlMedia(b.getID(),{type:"pause",pause:!0})}},seek:function(a){0>a&&(a=0);1<a&&(a=1);for(var b in g.remoteStreams){var c=g.remoteStreams[b];if("media"===c.getAttributes().type){var d=parseInt(a*c.getAttributes().duration);d>c.getAttributes().duration&&(d=c.getAttributes().duration);g.controlMedia(c.getID(),{type:"seek",
pos:d})}}}}};g.getShareFileController=function(){return{play:function(){var a=fa(n.id,"file");a&&"file"===a.getAttributes().type&&(g.controlMedia(a.getID(),{type:"pause",pause:!1}),g.pauseLocalFileStream(!1))},pause:function(){var a=fa(n.id,"file");a&&"file"===a.getAttributes().type&&(g.controlMedia(a.getID(),{type:"pause",pause:!0}),g.pauseLocalFileStream(!0))},seek:function(a){0>a&&(a=0);1<a&&(a=1);var b=fa(n.id,"file");if(b&&"file"===b.getAttributes().type){var c=parseInt(a*b.getAttributes().duration);
c>b.getAttributes().duration&&(c=b.getAttributes().duration);g.controlMedia(b.getID(),{type:"seek",pos:c});g.seekLocalFileStream(a)}}}};g.getPlaybackController=function(){var a=this;return{play:function(){a.playPlayback()},pause:function(){a.pausePlayback()},seek:function(b){0>b&&(b=0);1<b&&(b=1);Ga&&void 0!==Ga.endTime&&void 0!==Ga.startTime&&(b=Ga.startTime+parseInt(b*(Ga.endTime-Ga.startTime)),a.seekPlayback(b))}}};g.registerRoomWhiteBoardDelegate=function(a){if(a&&"TKWhiteBoardManager"===a.className&&
"function"===typeof a.registerRoomDelegate){if(O=a)O.registerRoomDelegate&&O.registerRoomDelegate(g),O.changeCommonWhiteBoardConfigration&&(a={},I&&x&&void 0!==z&&(a.webAddress=I+"://"+x+":"+z),ya&&pa&&void 0!==qa&&(a.webAddress=I+"://"+x+":"+z),ta&&ja&&void 0!==ka&&(a.webAddress=ta+"://"+ja+":"+ka),void 0!==n.id&&(a.myUserId=n.id),void 0!==n.nickname&&(a.myName=n.nickname),void 0!==n.role&&(a.myRole=n.role),a.isPlayback=y,O.changeCommonWhiteBoardConfigration(a))}else L.Logger.warning("[tk-sdk]register whiteboardManagerInstance not is a TKWhiteBoardManager instance class , cannot execute registerRoomWhiteBoardDelegate method.")};
g.playVideo=function(a,b,c,d){L.Logger.info("[tk-sdk] playVideo. userId:",a,";elementId:",b,";options:",c);""===a&&(a=L.Utils.isNull(n.id)?"_local_default_extension_id_":n.id);if(a)if(b){if(!L.Utils.isNull(n.id)&&a===n.id||"_local_default_extension_id_"===a){var e=N[a];if(!L.Utils.isNull(e)){L.Utils.isFunction(d)&&d("TK_ERR_OPERATION_IN_PROGRESS");L.Logger.error("[tk-sdk] video has been played already");return}}"_local_default_extension_id_"===a&&L.Utils.isNull(v)&&(v=Fa("video",{video:!0,audio:!0,
attributes:{}}));for(var f in ca){if("_local_default_extension_id_"===f)break;if(f===a){var t=g.getUser(a);if(void 0===t){L.Utils.isFunction(d)&&d("TK_ERR_NO_THIS_USER");L.Logger.error("[tk-sdk]playVideo method got invalid user!");return}if(!t._videoplayed_&&void 0!==t._audioplayed_&&!0===t._audioplayed_&&(f=ca[f],void 0!==f&&f!==b)){L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG");L.Logger.error("[tk-sdk]playVideo method got invalid elementId!");return}break}}c&&"object"!==typeof c?(L.Utils.isFunction(d)&&
d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk]playVideo method options is not json!")):(e=fa(a,"video"))?(c=c||{},t=g.getUser(a),void 0!==t?(t._videoplayed_=!0,ca[a]=b):"_local_default_extension_id_"===a&&(ca[a]=b),Ba(e)&&"video"===e.getAttributes().type&&!y?(c.audio=!1,c.video=!0,e.isInit||e.isIniting?!e.isInit&&e.isIniting?(Oa=!0,Ia.elementId=b,Ia.options=c):ra(b,e,c):(L.Logger.info("[tk-sdk] playVideo:local stream has not been initialized, initialize stream now!"),v.init(!0,void 0,function(a){L.Logger.info("[tk-sdk] initialize stream finished, result is :",
L.Utils.toJsonStringify(a));ra(b,e,c);ob(a)}))):(a=!0,e.playInfo&&e.playInfo.audio||(a=!1),c.audio=a,c.video=!0,ra(b,e,c))):(L.Utils.isFunction(d)&&d("could not find media stream"),L.Logger.error("[tk-sdk]playVideo: user has not stream, user id is "+a))}else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk]playVideo method got invalid elementId!");else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk]playVideo method got invalid userId!")};g.unplayVideo=
function(a,b){L.Logger.info("[tk-sdk] unplayVideo. userId:",a);""===a&&(a=L.Utils.isNull(n.id)?"_local_default_extension_id_":n.id);if(a){var c=g.getUser(a);void 0!==c?(c._videoplayed_=!1,(void 0===c._audioplayed_||void 0!==c._audioplayed_&&!1===c._audioplayed_)&&delete ca[a],c.id===n.id&&delete ca._local_default_extension_id_):"_local_default_extension_id_"===a&&(delete ca._local_default_extension_id_,L.Utils.isNull(n.id)||delete ca[n.id]);(!L.Utils.isNull(n.id)&&n.id===a||"_local_default_extension_id_"===
a)&&Oa&&(Oa=!1,Ia={});(c=N[a])?(a=!1,c.playInfo&&c.playInfo.audio||(a=!0),Ha(c,{audio:a,video:!0})):(L.Utils.isFunction(b)&&b("could not find media stream"),L.Logger.warning("[tk-sdk]unplayVideo: user has not stream, user id is "+a))}else L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk]unplayVideo method got invalid userId!")};g.playAudio=function(a,b,c){L.Logger.info("[tk-sdk] playAudio. userId:",a,";elementId:",b);if(a)if(b){var d=fa(a,"video");if(d)if(Ba(d)&&!y)L.Utils.isFunction(c)&&
c("play local audio are not allowed!");else{for(var e in ca)if(e===a){var f=g.getUser(a);if(void 0===f){L.Utils.isFunction(c)&&c("TK_ERR_NO_THIS_USER");L.Logger.error("[tk-sdk]playAudio method got invalid user!");return}if(!f._audioplayed_&&void 0!==f._videoplayed_&&!0===f._videoplayed_&&(e=ca[e],void 0!==e&&e!==b)){L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG");L.Logger.error("[tk-sdk]playAudio method got invalid elementId!");return}break}f=g.getUser(a);void 0!==f&&(f._audioplayed_=!0,ca[a]=b);a=
{};c=!0;d.playInfo&&d.playInfo.video||(c=!1);a.audio=!0;a.video=c;ra(b,d,a)}else L.Utils.isFunction(c)&&c("could not find media stream"),L.Logger.error("[tk-sdk]playAudio: user has not stream, user id is "+a)}else L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk]playAudio method got invalid elementId!");else L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk]playAudio method got invalid userId!")};g.unplayAudio=function(a,b){L.Logger.info("[tk-sdk] unplayAudio. userId:",
a);if(a){var c=g.getUser(a);void 0!==c&&(c._audioplayed_=!1,(void 0===c._videoplayed_||void 0!==c._videoplayed_&&!1===c._videoplayed_)&&delete ca[a]);(c=N[a])?(a=!1,c.playInfo&&c.playInfo.video||(a=!0),Ha(c,{audio:!0,video:a})):(L.Utils.isFunction(b)&&b("could not find media stream"),L.Logger.warning("[tk-sdk]unplayAudio: user has not stream, user id is "+a))}else L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk]unplayAudio method got invalid userId!")};g.getVideoProfile=function(a,
b){H?L.Utils.isFunction(a)&&a({width:ia,height:ma,maxfps:na}):(L.Utils.isFunction(b)&&b("[tk-sdk] please call this method after join room success"),L.Logger.error("[tk-sdk] please call getVideoProfile method after join room success"))};g.setVideoProfile=function(a,b){H?"object"!==typeof a?(L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] setVideoProfile method got invalid arguments")):a.hasOwnProperty("width")&&a.hasOwnProperty("height")&&a.hasOwnProperty("maxfps")?"number"!==
typeof a.width||"number"!==typeof a.height||"number"!==typeof a.maxfps?(L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] setVideoProfile method got invalid arguments")):(a.width*a.height>Ka*Ua&&(b=a.width*a.height/(Ka*Ua),a.width=Math.floor(a.width/b),a.height=Math.floor(a.height/b)),a.maxfps>ub&&(a.maxfps=Ka),ia=parseInt(1>a.width?1:a.width),ma=parseInt(1>a.height?1:a.height),na=parseInt(a.maxfps),va.setAVMgrProperty({room_video_width:ia,room_video_height:ma,room_video_fps:na}),
sa(),L.Logger.info("[tk-sdk]setVideoProfile [_room_video_width * _room_video_height, _room_video_fps, _room_video_maxbps]:"+ia+"*"+ma+", "+na+", "+La)):(L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] setVideoProfile method got invalid arguments")):(L.Utils.isFunction(b)&&b("TK_ERR_NOT_JOINED"),L.Logger.error("[tk-sdk] please call setVideoProfile method after join room success"))};g.getRoomUserNum=function(a,b,c){if(ha){L.Utils.isFunction(a)||(L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),
L.Logger.error("[tk-sdk] The parameter onSuccess of method getRoomUserNum must be a function"));var d={companyid:H.companyid,serial:H.serial};void 0!==b&&Array.isArray(b)&&(d.role="["+b.join(",")+"]");b=I+"://"+x+":"+z+"/ClientAPI/getroomusernum?ts\x3d"+(new Date).getTime();$.ajax({url:b,dataType:"json",type:"POST",async:!0,data:d}).done(function(b){L.Logger.debug("[tk-sdk]getroomusernum resp \x3d ",L.Utils.toJsonStringify(b));0===b.result?a(L.Utils.isNumber(Number(b.num))?Number(b.num):0):(L.Logger.warning("[tk-sdk]getroomusernum interface request fail , code is "+
b.result),L.Utils.isFunction(c)&&c("TK_ERR_HTTP_REQUEST_FAILED"))}).fail(function(a,b,d){L.Logger.error("[tk-sdk]getroomusernum fail[ jqXHR , textStatus , errorThrown ]:",a,b,d);L.Utils.isFunction(c)&&c("TK_ERR_HTTP_REQUEST_FAILED")})}else L.Utils.isFunction(c)&&c("TK_ERR_NOT_JOINED"),L.Logger.error("[tk-sdk] please call getRoomUserNum method after join room success")};g.getRoomUsers=function(a,b,c,d,e){if(ha){L.Utils.isFunction(a)||(L.Utils.isFunction(e)&&e("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] The parameter onSuccess of method getRoomUsers must be a function"));
var f={companyid:H.companyid,serial:H.serial};void 0!==b&&L.Utils.isNumber(b)&&(f.start=b);void 0!==c&&L.Utils.isNumber(c)&&(f.max=c);void 0!==d&&Array.isArray(d)&&(f.role="["+d.join(",")+"]");b=I+"://"+x+":"+z+"/ClientAPI/getroomusers?ts\x3d"+(new Date).getTime();$.ajax({url:b,dataType:"json",type:"GET",async:!0,data:f}).done(function(b){L.Logger.debug("[tk-sdk]getroomusers resp \x3d ",L.Utils.toJsonStringify(b));0===b.result?a(Array.isArray(b.userlist)?b.userlist:[]):(L.Logger.warning("[tk-sdk]getroomusers interface request fail , code is "+
b.result),L.Utils.isFunction(e)&&e("TK_ERR_HTTP_REQUEST_FAILED"))}).fail(function(a,b,c){L.Logger.error("[tk-sdk]getroomusers fail[ jqXHR , textStatus , errorThrown ]:",a,b,c);L.Utils.isFunction(e)&&e("TK_ERR_HTTP_REQUEST_FAILED")})}else L.Utils.isFunction(e)&&e("TK_ERR_NOT_JOINED"),L.Logger.error("[tk-sdk] please call getRoomUsers method after join room success")};g.getNativeInterface=function(a){if(TK.isTkNative)return Ja;L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED");L.Logger.error("[tk-sdk] getNativeInterface method must be called in the native environment!")};
g.unpublishLocalFile=function(a,b,c){if(TK.isTkNative){if(6!=J)return 2;L.Logger.info("[tk-sdk]calling unpublishLocalFile , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));return g.unpublish(a,b,c)}L.Logger.warning("[tk-sdk]unpublishLocalFile method must be in the client environment!")};g.getValidWindowList=function(a,b){if(TK.isTkNative)if(void 0===a||null===a||"function"!==typeof b)L.Logger.error("[tk-sdk] getValidWindowList function got wrong arguments");
else{var c=ea();TK.waitNativeToCallbackList[c]=b;window.tknative.postMessage({command:"getValidWindowList",type:Number(a),seq:c})}else L.Logger.warning("[tk-sdk]getValidWindowList method must be in the client environment!")};g.updateWindowSource=function(a){TK.isTkNative?(a.id||(a.id=0),a.x||(a.x=0),a.y||(a.y=0),a.width||(a.width=0),a.height||(a.height=0),a.mixMic||(a.mixMic=!1),a.mixSpk||(a.mixSpk=!1),a.type||(a.type=0),window.tknative.postMessage({command:"updateWindowSource",id:Number(a.id),left:Number(a.x),
top:Number(a.y),width:Number(a.width),height:Number(a.height),mixMic:a.mixMic,mixSpk:a.mixSpk,type:Number(a.type)})):L.Logger.warning("[tk-sdk]updateWindowSource method must be in the client environment!")};g.getMonitorCount=function(a){if(TK.isTkNative)if("function"!==typeof a)L.Logger.error("[tk-sdk] getMonitorCount function got wrong arguments");else{var b=ea();TK.waitNativeToCallbackList[b]=a;window.tknative.postMessage({command:"getMonitorCount",seq:b})}else L.Logger.warning("[tk-sdk]getMonitorCount method must be in the client environment!")};
g.enableViceMonitor=function(){TK.isTkNative?(TK.subscribe_from_native=!0,window.tknative.postMessage({command:"enableViceMonitor"})):L.Logger.warning("[tk-sdk]enableViceMonitor method must be in the client environment!")};g.exchangeClientPosition=function(){TK.isTkNative?window.tknative.postMessage({command:"exchangeClientPosition"}):L.Logger.warning("[tk-sdk]enableViceMonitor method must be in the client environment!")};g.nativeUploadFile=function(a,b,c,d){TK.isTkNative?"string"!==typeof a||"string"!==
typeof b||""===a||""===b?("function"===typeof d&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] uploadFile function got wrong arguments")):"string"!==typeof c?("function"===typeof d&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] uploadFile function got wrong arguments")):(d=ea(),window.tknative.postMessage({command:"uploadFile",seq:d,uri:a,filename:b,params:c})):("function"===typeof d&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk]uploadFile method must be in the client environment!"))};
g.nativeDownloadFile=function(a,b,c){TK.isTkNative?"string"!==typeof a||"string"!==typeof b||""===a||""===b?("function"===typeof c&&c("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] downloadFile function got wrong arguments")):(c=ea(),window.tknative.postMessage({command:"downloadFile",seq:c,uri:a,filename:b})):("function"===typeof c&&c("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk]downloadFile method must be in the client environment!"))};g.takeSnapshot=function(a,b,c){if(TK.isTkNative)if(b)if("function"!==
typeof c)L.Logger.error("[tk-sdk] takeSnapshot function got wrong arguments");else{var d=ea();TK.waitNativeToCallbackList[d]=c;window.tknative.postMessage({command:"takeSnapshot",needMin:a,fileName:b,requestId:d})}else L.Logger.error("[tk-sdk] takeSnapshot function got wrong arguments");else L.Logger.warning("[tk-sdk]takeSnapshot method must be in the client environment!")};g.startLocalRecord=function(a,b){if(TK.isTkNative)if(a&&"function"===typeof b){var c=ea();TK.waitNativeToCallbackList[c]=b;window.tknative.postMessage({command:"startLocalRecord",
args:a,seq:c})}else L.Logger.error("[tk-sdk] startRecordScreen function got wrong arguments");else L.Logger.warning("[tk-sdk]startLocalRecord method must be in the client environment!")};g.pauseLocalRecord=function(a,b){if(TK.isTkNative)if(a&&"function"===typeof b){var c=ea();TK.waitNativeToCallbackList[c]=b;window.tknative.postMessage({command:"pauseLocalRecord",args:a,seq:c})}else L.Logger.error("[tk-sdk] pauseLocalRecord function got wrong arguments");else L.Logger.warning("[tk-sdk]pauseLocalRecord method must be in the client environment!")};
g.stopLocalRecord=function(a){TK.isTkNative?window.tknative.postMessage({command:"stopLocalRecord",args:a}):L.Logger.warning("[tk-sdk]stopLocalRecord method must be in the client environment!")};g.browseForLocalFolder=function(a,b){if(TK.isTkNative)if("object"!==typeof a||"function"!==typeof b)L.Logger.error("[tk-sdk] browseForLocalFolder function got wrong arguments ,param must is json , callback must is function! ");else{var c=ea();TK.waitNativeToCallbackList[c]=b;window.tknative.postMessage({command:"browseForFolder",
args:a,seq:c})}else L.Logger.warning("[tk-sdk]browseForLocalFolder method must be in the client environment!")};g.getOpenLocalFileName=function(a,b){if(TK.isTkNative)if("object"!==typeof a||"function"!==typeof b)L.Logger.error("[tk-sdk] getOpenLocalFileName function got wrong arguments ,param must is json , callback must is function! ");else{var c=ea();TK.waitNativeToCallbackList[c]=b;window.tknative.postMessage({command:"getOpenFileName",args:a,seq:c})}else L.Logger.warning("[tk-sdk]getOpenLocalFileName method must be in the client environment!")};
g.getSaveLocalFileName=function(a,b){if(TK.isTkNative)if("object"!==typeof a||"function"!==typeof b)L.Logger.error("[tk-sdk] getSaveLocalFileName function got wrong arguments ,param must is json , callback must is function! ");else{var c=ea();TK.waitNativeToCallbackList[c]=b;window.tknative.postMessage({command:"getSaveFileName",args:a,seq:c})}else L.Logger.warning("[tk-sdk]getSaveLocalFileName method must be in the client environment!")};g.getLocalFileStreamPlayerPosition=function(a){if(TK.isTkNative)if("function"!==
typeof a)L.Logger.error("[tk-sdk] getFileStreamPlayerPosition function got wrong arguments , must is function!");else{var b=ea();TK.waitNativeToCallbackList[b]=a;window.tknative.postMessage({command:"getMediaPlayPos",seq:b})}else L.Logger.warning("[tk-sdk]getLocalFileStreamPlayerPosition method must be in the client environment!")};g.getLocalFileMediaInfo=function(a,b){if(TK.isTkNative)if(a&&"function"===typeof b){var c=ea();TK.waitNativeToCallbackList[c]=b;window.tknative.postMessage({command:"getMediaFileInfo",
seq:c,file:a})}else L.Logger.error("[tk-sdk] getLocalFileMediaInfo function got wrong arguments!");else L.Logger.warning("[tk-sdk]getLocalFileMediaInfo method must be in the client environment!")};g.pauseLocalFileStream=function(a){TK.isTkNative?"boolean"!==typeof a?L.Logger.error("[tk-sdk] pauseLocalFileStream function got wrong arguments , must is boolean!"):window.tknative.postMessage({command:"pauseMediaFile",pause:a}):L.Logger.warning("[tk-sdk]pauseLocalFileStream method must be in the client environment!")};
g.seekLocalFileStream=function(a){TK.isTkNative?"number"!==typeof a?L.Logger.error("[tk-sdk] seekLocalFileStream function got wrong arguments , must is number!"):(1<a&&(a=1),window.tknative.postMessage({command:"seekMediaFile",pos:a})):L.Logger.warning("[tk-sdk]seekLocalFileStream method must be in the client environment!")};g.getRecordingPath=function(a,b){TK.isTkNative?"function"===typeof a&&(b=ea(),TK.waitNativeToCallbackList[b]=a,window.tknative.postMessage({command:"getRecordingPath",seq:b})):
("function"===typeof b&&b("TK_ERR_NOT_INITIALIZED"),L.Logger.error("[tk-sdk] getRecordingPath method must be called in the native environment!"))};g.setRecordingPath=function(a,b){TK.isTkNative?"object"!==typeof a?("function"===typeof b&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] setRecordingPath function got wrong arguments!")):window.tknative.postMessage({command:"setRecordingPath",args:a}):("function"===typeof b&&b("TK_ERR_NOT_INITIALIZED"),L.Logger.error("[tk-sdk] setRecordingPath method must be called in the native environment!"))};
g.startupFileTransmitter=function(a,b,c){TK.isTkNative?"object"!==typeof a?("function"===typeof c&&c("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] startupFileTransmitter function got wrong arguments!")):"function"===typeof b&&(c=ea(),TK.waitNativeToCallbackList[c]=b,window.tknative.postMessage({command:"startupFileTransmitter",args:a,seq:c})):("function"===typeof c&&c("TK_ERR_NOT_INITIALIZED"),L.Logger.error("[tk-sdk] startupFileTransmitter method must be called in the native environment!"))};g.listenCloseEvent=
function(){if(TK.isTkNative)try{talk_window&&talk_window.listenCloseEvent?talk_window.listenCloseEvent():L.Logger.error("[tk-sdk]talk_window.listenCloseEvent is not exist!")}catch(t){L.Logger.error("[tk-sdk] listenCloseEvent function can not be called")}else L.Logger.warning("[tk-sdk]listenCloseEvent method must be in the client environment!")};g.shutdownNativeClient=function(){TK.isTkNative?window.tknative.postMessage({command:"shutdownNativeClient"}):L.Logger.warning("[tk-sdk]shutdownNativeClient method must be in the client environment!")};
g.closeWindow=function(){try{talk_window&&talk_window.closeWindow?talk_window.closeWindow():L.Logger.error("[tk-sdk]talk_window.closeWindow is not exist!")}catch(t){L.Logger.error("[tk-sdk] closeWindow function can not be called")}};g.clientAudioMediaPlayer=function(a,b,c){TK.isTkNative?2018031E3>TK.clientversion?L.Logger.warning("[tk-sdk]Current version client is not support clientAudioMediaPlayer method ,please update the latest client !"):(c=c||{},b?(a=a.replace(/(https:)/g,"http:").replace(/:443/g,
":80"),L.Logger.info("[tk-sdk]clientAudioMediaPlayer url is "+a+" , action is "+b+" , options is"+L.Utils.toJsonStringify(c)),c.audioUrl=a,window.tknative.postMessage({command:"clientAudioMediaPlayer",action:b,options:c})):L.Logger.error("[tk-sdk]clientAudioMediaPlayer action is not exist!")):L.Logger.warning("[tk-sdk]clientAudioMediaPlayer method must be in the client environment!")};g.clientPreloadMediaFile=function(a){TK.isTkNative?2018031E3>TK.clientversion?L.Logger.warning("[tk-sdk]Current version client is not support clientPreloadMediaFile method ,please update the latest client !"):
Array.isArray(a)?a&&0<a.length&&window.tknative.postMessage({command:"clientPreloadMediaFile",urlArray:a}):L.Logger.error("[tk-sdk]clientPreloadMediaFile args must is array!"):L.Logger.warning("[tk-sdk]clientPreloadMediaFile method must be in the client environment!")};g.clientOpenBrowserUrl=function(a){TK.isTkNative?2018031E3>TK.clientversion?L.Logger.warning("[tk-sdk]Current version client is not support clientOpenBrowserUrl method ,please update the latest client !"):a?window.tknative.postMessage({command:"clientOpenBrowserUrl",
url:a}):L.Logger.error("[tk-sdk]clientOpenBrowserUrl url is not exist!"):L.Logger.warning("[tk-sdk]clientOpenBrowserUrl method must be in the client environment!")};g.liveSimulateServerCommunicationInterface=function(a){if(D["_handler_"+a]&&"function"===typeof D["_handler_"+a]){for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);D["_handler_"+a].apply(null,b)}};g.initBroadcast=function(a,b,c,d,e){TK.isTkNative?a?(b||(b=10),c||(c=3),d&&e?window.tknative.postMessage({command:"initBroadcast",
url:a.toString(),fps:Number(b),key_sec:Number(c),width:Number(d),height:Number(e)}):L.Logger.error("[tk-sdk]argument width or height of initBroadcast function not exist!")):L.Logger.error("[tk-sdk]argument url of initBroadcast function not exist!"):L.Logger.warning("[tk-sdk]initBroadcast method must be in the client environment!")};g.updateBroadcast=function(a,b,c,d){a||(a=10);b||(b=3);c&&d?window.tknative.postMessage({command:"updateBroadcast",fps:Number(a),key_sec:Number(b),width:Number(c),height:Number(d)}):
L.Logger.error("[tk-sdk]argument width or height of updateBroadcast function not exist!")};g.uninitBroadcast=function(){TK.isTkNative?window.tknative.postMessage({command:"uninitBroadcast"}):L.Logger.warning("[tk-sdk]uninitBroadcast method must be in the client environment!")};g.startBroadcast=function(a){TK.isTkNative?a?window.tknative.postMessage({command:"startBroadcast",streamId:a}):L.Logger.error("[tk-sdk]argument extensionId of startBroadcast function not exist!"):L.Logger.warning("[tk-sdk]startBroadcast method must be in the client environment!")};
g.stopBroadcast=function(){TK.isTkNative?window.tknative.postMessage({command:"stopBroadcast"}):L.Logger.warning("[tk-sdk]stopBroadcast method must be in the client environment!")};D._handler_participantLeft=function(a,b){L.Logger.debug("[tk-sdk]participantLeft userid:"+a);var c=A[a];void 0===c?L.Logger.error("[tk-sdk]participantLeft user is not exist , userid is "+a+"!"):(L.Logger.info("[tk-sdk]user leave room  , user info: "+L.Utils.toJsonStringify(c)),y&&void 0!==b&&(c.leaveTs=b),S[c.role]||(S[c.role]=
{}),y?A[a]&&(A[a].playbackLeaved=!0):(delete S[c.role][a],delete A[a],delete ca[a]),y&&"object"===typeof a&&(c.leaveTs=a.ts),a=TK.RoomEvent({type:"room-participant_leave",user:c}),g.dispatchEvent(a))};D._handler_participantJoined=function(a){L.Logger.debug("[tk-sdk]participantJoined userinfo:"+L.Utils.toJsonStringify(a));var b=TK.RoomUser(a);L.Logger.info("[tk-sdk]user join room  , user info: "+L.Utils.toJsonStringify(b));S[b.role]||(S[b.role]={});S[b.role][b.id]=b;A[b.id]=b;y&&A[b.id]&&delete A[b.id].playbackLeaved;
y&&"object"===typeof a&&(b.joinTs=a.ts);a=TK.RoomEvent({type:"room-participant_join",user:b});g.dispatchEvent(a)};D._handler_participantPublished=function(a){L.Logger.debug("[tk-sdk]participantPublished userinfo:"+L.Utils.toJsonStringify(a));if(xa===window.TK.ROOM_MODE.BIG_ROOM){var b=TK.RoomUser(a);S[b.role]||(S[b.role]={});S[b.role][b.id]=b;A[b.id]=b;y&&A[b.id]&&delete A[b.id].playbackLeaved;y&&"object"===typeof a&&(b.joinTs=a.ts)}};D._handler_sendMessage=function(a){L.Logger.debug("[tk-sdk]room-text-message info:"+
(a&&"object"===typeof a?L.Utils.toJsonStringify(a):a));if(a&&a.hasOwnProperty("message")){var b=a.fromID,c=n;if(10===H.roomtype)c=void 0;else if(void 0!==b&&(c=A[a.fromID]),!c){L.Logger.error("[tk-sdk]user is not exist , user id:"+a.fromID+", message from room-text-message!");return}y&&(b=!1,a&&a.message&&"string"===typeof a.message&&(a.message=L.Utils.toJsonParse(a.message),b=!0),a.message.ts=a.ts,b&&"object"===typeof a.message&&(a.message=L.Utils.toJsonStringify(a.message)));a&&a.message&&"string"===
typeof a.message&&(a.message=L.Utils.toJsonParse(a.message));a=TK.RoomEvent({type:"room-text-message",user:c,message:a.message});g.dispatchEvent(a)}else L.Logger.error("[tk-sdk]room-text-message messages or messages.message is not exist!")};D._handler_pubMsg=function(a){L.Logger.debug("[tk-sdk]pubMsg info:",L.Utils.toJsonStringify(a));a&&"string"===typeof a&&(a=L.Utils.toJsonParse(a));a.data&&"string"===typeof a.data&&(a.data=L.Utils.toJsonParse(a.data));if("OnlyAudioRoom"===a.name)nb(!0,a.fromID);
else{"DocumentChange"===a.name&&Fb(a);if("BigRoom"===a.name){xa=window.TK.ROOM_MODE.BIG_ROOM;var b=TK.RoomEvent({type:"room-mode-changed",message:{roomMode:xa}});g.dispatchEvent(b)}b=TK.RoomEvent({type:"room-pubmsg",message:a});g.dispatchEvent(b)}};D._handler_delMsg=function(a){L.Logger.debug("[tk-sdk]delMsg info:",L.Utils.toJsonStringify(a));a&&"string"===typeof a&&(a=L.Utils.toJsonParse(a));a.data&&"string"===typeof a.data&&(a.data=L.Utils.toJsonParse(a.data));if("OnlyAudioRoom"===a.name)nb(!1,
a.fromID);else{if("BigRoom"===a.name){xa=window.TK.ROOM_MODE.NORMAL_ROOM;var b=TK.RoomEvent({type:"room-mode-changed",message:{roomMode:xa}});g.dispatchEvent(b)}b=TK.RoomEvent({type:"room-delmsg",message:a});g.dispatchEvent(b)}};D._handler_setProperty=function(a){L.Logger.debug("[tk-sdk]setProperty info:",L.Utils.toJsonStringify(a));var b=a.id;if(a.hasOwnProperty("properties")){var c=a.properties,d=A[b];if(n.id===b)if(d=n,c.hasOwnProperty("publishstate")){var f=c.publishstate;L.Logger.debug("[tk-sdk]onChangeMyPublishState "+
n.publishstate+" to "+f);f>TK.PUBLISH_STATE_NONE?(l(f),v&&void 0===g.localStreams[v.getID()]&&!v.isPublishing&&g.publish(v)):v&&!v.isUnpublishing&&g.localStreams[v.getID()]&&g.unpublish(v);n.publishstate=f;if(!(!0!==n._audiopublished_&&!0!==n._videopublished_&&n.publishstate>TK.PUBLISH_STATE_NONE)&&(!0!==n._audiopublished_&&!0!==n._videopublished_||n.publishstate!==TK.PUBLISH_STATE_NONE)){Ea(v);var h=n.publishstate,r=h===TK.PUBLISH_STATE_AUDIOONLY||h===TK.PUBLISH_STATE_BOTH;h=h===TK.PUBLISH_STATE_VIDEOONLY||
h===TK.PUBLISH_STATE_BOTH;n._audiopublished_=r;n._videopublished_=h}}else c.hasOwnProperty("disablevideo")?(f=c.disablevideo,L.Logger.debug("[tk-sdk]onChangeMyDisableVideoState "+n.disablevideo+" to "+f),n.disablevideo!=f&&(n.disablevideo=f,n.publishstate>TK.PUBLISH_STATE_NONE&&l())):c.hasOwnProperty("disableaudio")?(f=c.disableaudio,L.Logger.debug("[tk-sdk]onChangeMyDisableAudioState "+n.disableaudio+" to "+f),n.disableaudio!=f&&(n.disableaudio=f,n.publishstate>TK.PUBLISH_STATE_NONE&&l())):c.hasOwnProperty("hasaudio")?
v.audio=c.hasaudio:c.hasOwnProperty("hasvideo")&&(v.video=c.hasvideo);if(void 0===d)L.Logger.error("[tk-sdk]setProperty user is not exist , userid is "+b+"!");else{f=d.servername;for(var k in c)"id"!=k&&"watchStatus"!=k&&(d[k]=c[k]);if(n.id!==d.id&&c.hasOwnProperty("publishstate"))for(k in g.remoteStreams)r=g.remoteStreams[k],r.extensionId!==n.id&&r.extensionId===d.id&&"video"===r.getAttributes().type&&(ab(r),!0!==d._audiopublished_&&!0!==d._videopublished_&&d.publishstate>TK.PUBLISH_STATE_NONE||
(!0===d._audiopublished_||!0===d._videopublished_)&&d.publishstate===TK.PUBLISH_STATE_NONE||(Ea(r),h=d.publishstate,r=h===TK.PUBLISH_STATE_AUDIOONLY||h===TK.PUBLISH_STATE_BOTH,h=h===TK.PUBLISH_STATE_VIDEOONLY||h===TK.PUBLISH_STATE_BOTH,d._audiopublished_=r,d._videopublished_=h));d=TK.RoomEvent({type:"room-userproperty-changed",user:d,message:c},{fromID:a.fromID});g.dispatchEvent(d);n.id===b&&c.hasOwnProperty("servername")&&(n.id!==a.fromID?c.servername&&c.servername!==f&&g.switchServerByName(c.servername):
c.servername&&c.servername!==f&&(P=c.servername,e(M,P)))}}};D._handler_playback_clearAll=function(){if(y){xa=window.TK.ROOM_MODE.NORMAL_ROOM;var a=TK.RoomEvent({type:"room-mode-changed",message:{roomMode:xa}});g.dispatchEvent(a);a=TK.RoomEvent({type:"room-playback-clear_all"});g.dispatchEvent(a);y?(void 0!=A&&(u(S),w(A)),null!=n&&(n.publishstate=TK.PUBLISH_STATE_NONE)):L.Logger.error("[tk-sdk]No playback environment, no execution playbackClearAll!")}else L.Logger.warning("[tk-sdk]No playback environment!")};
D._handler_duration=function(a){if(y){var b=TK.RoomEvent({type:"room-playback-duration",message:a});Ga=a;g.dispatchEvent(b)}else L.Logger.warning("[tk-sdk]No playback environment!")};D._handler_playbackEnd=function(){if(y){var a=TK.RoomEvent({type:"room-playback-playbackEnd"});g.dispatchEvent(a)}else L.Logger.warning("[tk-sdk]No playback environment!")};D._handler_playback_updatetime=function(a){y?(a=TK.RoomEvent({type:"room-playback-playback_updatetime",message:a}),g.dispatchEvent(a)):L.Logger.warning("[tk-sdk]No playback environment!")};
D._handler_connectSocketSuccess=function(a,b){TK.isTkNative&&!za&&(za=!0,window.tknative.postMessage({command:"initNative",localId:n.id.toString(),width:Number(ia),height:Number(ma),fps:Number(na),roomInfo:Na,webAddr:x.toString(),webPort:z.toString()}));var c=b.roominfo;a=b.msglist;var d=b.userlist,e=[];var f=c.streams||[];g.p2p=c.p2p;var h=c.id;g.iceServers=c.iceServers;G.defaultVideoBW=La;G.maxVideoBW=La;G.defaultScreenBW=K(1280,20);G.maxScreenBW=K(1280,20);G.defaultLocalFileMediaBW=K(640,30);G.maxLocalFileMediaBW=
K(640,30);A={};S={};q(6);for(var r in f)if(f.hasOwnProperty(r)){c=f[r];var m=!1;TK.subscribe_from_native&&(m=!0);m=TK.Stream({streamID:c.id,local:!1,audio:c.audio,video:c.video,data:c.data,screen:c.screen,attributes:c.attributes,extensionId:c.extensionId,room:g,checkMyAudioAndVideoEnable:function(a){n&&n.id&&(a=a||n.id,a===n.id&&(TK.isTkNative&&(p(!0),k(!0)),n.publishstate>TK.PUBLISH_STATE_NONE&&l()))}},m);e.push(m);g.remoteStreams[c.id]=m;L.Logger.info("[tk-sdk]room-connected --\x3e stream info , stream id:"+
m.getID()+" , extensionId is "+m.extensionId+", attrs is "+L.Utils.toJsonStringify(m.getAttributes()));g.subscribe(m)}for(r in d)d.hasOwnProperty(r)&&(f=TK.RoomUser(d[r]),void 0!==f&&(S[f.role]||(S[f.role]={}),S[f.role][f.id]=f,A[f.id]=f,y&&A[f.id]&&delete A[f.id].playbackLeaved,L.Logger.info("[tk-sdk]room-connected --\x3e user info: "+L.Utils.toJsonStringify(f))));L.Logger.info("[tk-sdk]room-connected --\x3e myself info: "+L.Utils.toJsonStringify(n));r=[];a&&"string"===typeof a&&(a=L.Utils.toJsonParse(a));
a.hasOwnProperty("OnlyAudioRoom")?(nb(!0,a.OnlyAudioRoom.fromID),2===TK.needOnlyAudioRoom&&g.switchOnlyAudioRoom(!1)):1===TK.needOnlyAudioRoom&&g.switchOnlyAudioRoom(!0);xa=a.hasOwnProperty("BigRoom")?window.TK.ROOM_MODE.BIG_ROOM:window.TK.ROOM_MODE.NORMAL_ROOM;d=TK.RoomEvent({type:"room-mode-changed",message:{roomMode:xa}});g.dispatchEvent(d);for(var u in a)a.hasOwnProperty(u)&&r.push(a[u]);r.sort(function(a,b){return void 0!==a&&a.hasOwnProperty("seq")&&void 0!==b&&b.hasOwnProperty("seq")?a.seq-
b.seq:0});g.roomID=h;ha=!0;L.Logger.debug("[tk-sdk]Connected to room "+g.roomID);L.Logger.debug("[tk-sdk]connected response:",L.Utils.toJsonStringify(b));L.Logger.info("[tk-sdk]room-connected ,streams length is "+e.length+" , signalling list length "+r.length);O&&O.changeCommonWhiteBoardConfigration&&O.changeCommonWhiteBoardConfigration({webAddress:I+"://"+x+":"+z,docAddress:ya+"://"+pa+":"+qa,backupDocAddress:ta+"://"+ja+":"+ka,myUserId:n.id,myName:n.nickname,myRole:n.role,isConnectedRoom:ha,isPlayback:y});
ua&&(g.stopIntervalRtcStatsrObserver(),g.startIntervalRtcStatsrObserver());y||(Pb(),clearTimeout(g._networkequipmentTimer),g._networkequipmentTimer=setInterval(function(){Eb()},6E4),g.startIntervalRtcStatsrObserverByStream(v,2E3));b=TK.RoomEvent({type:"room-connected",streams:e,message:r});g.dispatchEvent(b)};Ja.onNativeStartShareMediaFile=function(a,b,c){var d=Y[n.id+":file"];L.Utils.isNull(d)?(d=Fa("file",a),b?d.play(b):(d.create(),Ja.pauseShareMediaFile(!0)),L.Logger.info("[tk-sdk]calling localFilePublish stream , stream id:"+
d.getID()+" , extensionId is "+d.extensionId+", attrs is "+L.Utils.toJsonStringify(d.getAttributes())),d&&void 0===g.remoteStreams[d.getID()]?g.publish(d,void 0,function(a,b){a||L.Utils.isFunction(c)&&c(b)}):(L.Logger.error("[tk-sdk]Trying to publish invalid LocalFileStream",d),L.Utils.isFunction(c)&&c(void 0,"Trying to publish invalid LocalFileStream"))):(L.Utils.isFunction(c)&&c("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.error("[tk-sdk]Share media file in progress."))};Ja.onNativeStopShareMediaFile=
function(a){var b=Y[n.id+":file"];L.Utils.isNull(b)?(L.Utils.isFunction(a)&&a("TK_ERR_OPERATION_TERMINATED"),L.Logger.warning("[tk-sdk]Could not find the specify stream while stop sharing media file.")):(b.stop(),L.Logger.info("[tk-sdk]calling unpublishLocalFile , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),g.unpublish(b,function(b,c){b||L.Utils.isFunction(a)&&a(c)}),delete Y[n.id+":file"])};Ja.onNativeStartShareScreen=function(a,
b){var c=Y[n.id+":screen"];L.Utils.isNull(c)?(c=Fa("screen",a),L.Logger.info("[tk-sdk]calling screenPublish stream , stream id:"+c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes())),c&&!c.failed&&void 0===g.remoteStreams[c.getID()]?g.publish(c,void 0,function(a,c){a||L.Utils.isFunction(b)&&b(c)}):(L.Logger.error("[tk-sdk]Trying to publish invalid screenStream",c),L.Utils.isFunction(b)&&b(void 0,"Trying to publish invalid screenStream"))):(L.Utils.isFunction(b)&&
b("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.error("[tk-sdk]Share screen in progress."))};Ja.onNativeStopShareScreen=function(a){var b=Y[n.id+":screen"];L.Utils.isNull(b)?(L.Utils.isFunction(a)&&a("TK_ERR_OPERATION_TERMINATED"),L.Logger.warning("[tk-sdk]Could not find the specify stream while stop sharing screen.")):(L.Logger.info("[tk-sdk]calling unpublishScreen , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),g.unpublish(b,function(b,
c){b||L.Utils.isFunction(a)&&a(c)}),delete Y[n.id+":screen"])};window.onNativeWindowClose=function(){if(TK.isTkNative){var a=TK.RoomEvent({type:"room-client-close"});g.dispatchEvent(a)}else L.Logger.warning("[tk-sdk]window.onNativeWindowClose method must be in the client environment!")};TK&&TK.coreEventController&&(TK.coreEventController.addEventListener("getUserMedia_success",function(a){g.dispatchEvent(a)}),TK.coreEventController.addEventListener("getUserMedia_failure",function(a){g.dispatchEvent(a)}),
TK.coreEventController.addEventListener("getUserMedia_failure_reGetOnlyAudioStream",function(a){g.dispatchEvent(a)}));return TK.roomInstance=g}};window.TK=window.TK||{};TK.PUBLISH_STATE_NONE=0;TK.PUBLISH_STATE_AUDIOONLY=1;TK.PUBLISH_STATE_VIDEOONLY=2;TK.PUBLISH_STATE_BOTH=3;TK.PUBLISH_STATE_MUTEALL=4;TK.RoomUser=function(b){if(void 0==b||void 0===b.properties)L.Logger.warning("[tk-sdk]Invalidate user info",a,c);else{var a=b.id,c=b.properties;L.Logger.debug("[tk-sdk]RoomUser",a,c);b={};b.id=a;b.watchStatus=0;for(var e in c)"id"!=e&&"watchStatus"!=e&&(b[e]=c[e]);b.publishstate=b.publishstate||TK.PUBLISH_STATE_NONE;return b}};window.L=window.L||{};window.TK=window.TK||{};
L.Logger=function(b){var a="",c=!1;var e=function(a,e){try{switch(e){case b.Logger.DEBUG:c?console.warn.apply(console,a):console.debug.apply(console,a);break;case b.Logger.TRACE:console.trace.apply(console,a);break;case b.Logger.INFO:c?console.warn.apply(console,a):console.info.apply(console,a);break;case b.Logger.WARNING:console.warn.apply(console,a);break;case b.Logger.ERROR:console.error.apply(console,a);break;case b.Logger.NONE:console.warn("log level is none!");break;default:c?console.warn.apply(console,
a):console.log.apply(console,a)}}catch(p){console.log.apply(console,a)}};return{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,setLogDevelopment:function(a){c=a},enableLogPanel:function(){b.Logger.panel=document.createElement("textarea");b.Logger.panel.setAttribute("id","licode-logs");b.Logger.panel.setAttribute("style","width: 100%; height: 100%; display: none");b.Logger.panel.setAttribute("rows",20);b.Logger.panel.setAttribute("cols",20);b.Logger.panel.setAttribute("readOnly",!0);document.body.appendChild(b.Logger.panel)},
setLogLevel:function(a){a>b.Logger.NONE?a=b.Logger.NONE:a<b.Logger.DEBUG&&(a=b.Logger.DEBUG);b.Logger.logLevel=a},setOutputFunction:function(a){e=a},setLogPrefix:function(b){a=b},print:function(c){var d=a;if(!(c<b.Logger.logLevel)){c===b.Logger.DEBUG?d=d+"DEBUG("+(new Date).toLocaleString()+")":c===b.Logger.TRACE?d=d+"TRACE("+(new Date).toLocaleString()+")":c===b.Logger.INFO?d=d+"INFO("+(new Date).toLocaleString()+")":c===b.Logger.WARNING?d=d+"WARNING("+(new Date).toLocaleString()+")":c===b.Logger.ERROR&&
(d=d+"ERROR("+(new Date).toLocaleString()+")");d+=":";for(var p=[],k=0;k<arguments.length;k++)p[k]=arguments[k];p=p.slice(1);p=[d].concat(p);if(void 0!==b.Logger.panel){d="";for(k=0;k<p.length;k++)d+=p[k];b.Logger.panel.value=b.Logger.panel.value+"\n"+d}else e.apply(b.Logger,[p,c])}},debug:function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.Logger.print.apply(b.Logger,[b.Logger.DEBUG].concat(a))},trace:function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.Logger.print.apply(b.Logger,
[b.Logger.TRACE].concat(a))},info:function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.Logger.print.apply(b.Logger,[b.Logger.INFO].concat(a))},warning:function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.Logger.print.apply(b.Logger,[b.Logger.WARNING].concat(a))},error:function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.Logger.print.apply(b.Logger,[b.Logger.ERROR].concat(a))}}}(L);
TK.tkLogPrintConfig=function(b,a,c){a=a||{};b=b||{};c=c||{};var e=void 0!=a.logLevel?a.logLevel:0;b=void 0!=b.debug?b.debug:!0;c=void 0!=c.webrtcLogDebug?c.webrtcLogDebug:!0;L.Logger.setLogDevelopment(void 0!=a.development?a.development:!0);L.Logger.setLogLevel(e);L.Utils.localStorage&&L.Utils.localStorage.setItem("debug",b?"*":"none");window.webrtcLogDebug=c};TK.Logger=L.Logger;window.L=window.L||{};
L.Base64=function(){var b,a,c;var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");var d=[];for(c=0;c<e.length;c+=1)d[e[c]]=c;var l=function(c){b=c;a=0};var p=function(){if(!b||a>=b.length)return-1;var c=b.charCodeAt(a)&255;a+=1;return c};var k=function(){if(!b)return-1;for(;;){if(a>=b.length)return-1;var c=b.charAt(a);a+=1;if(d[c])return d[c];if("A"===c)return 0}};var f=function(a){a=a.toString(16);1===a.length&&(a="0"+a);return unescape("%"+a)};return{encodeBase64:function(a){var b;
l(a);a="";var c=Array(3);var d=0;for(b=!1;!b&&-1!==(c[0]=p());)c[1]=p(),c[2]=p(),a+=e[c[0]>>2],-1!==c[1]?(a+=e[c[0]<<4&48|c[1]>>4],-1!==c[2]?(a+=e[c[1]<<2&60|c[2]>>6],a+=e[c[2]&63]):(a+=e[c[1]<<2&60],a+="\x3d",b=!0)):(a+=e[c[0]<<4&48],a+="\x3d",a+="\x3d",b=!0),d+=4,76<=d&&(a+="\n",d=0);return a},decodeBase64:function(a){var b;l(a);a="";var c=Array(4);for(b=!1;!b&&-1!==(c[0]=k())&&-1!==(c[1]=k());)c[2]=k(),c[3]=k(),a+=f(c[0]<<2&255|c[1]>>4),-1!==c[2]?(a+=f(c[1]<<4&255|c[2]>>2),-1!==c[3]?a+=f(c[2]<<
6&255|c[3]):b=!0):b=!0;return a}}}(L);window.TK=window.TK||{};
TK.VideoPlayer=function(b){b.options=b.options||{};b.options.mirror=b.options.mirror||!1;b.options.mode=b.options.mode||window.TK_VIDEO_MODE.ASPECT_RATIO_CONTAIN;var a=void 0!==b.options.audioPlayer?b.options.audioPlayer:b.stream&&b.stream.hasVideo&&b.stream.hasAudio?!b.stream.hasVideo()&&b.stream.hasAudio():!1,c=TK.EventDispatcher({}),e=100,d=void 0,l=void 0,p=void 0,k=void 0,f=!1,m=!1!==b.options.loader,q=void 0;c.id=b.id;c.local=b.stream.local;c.videoPlayerMediaStreamClone=b.stream.stream;c.type=
b.stream&&b.stream.getAttributes&&b.stream.getAttributes()?b.stream.getAttributes().type:void 0;c.elementID=b.elementID;c.isAudioPlayer=a;c.bundleId=b.bundleId;c.destroy=function(){try{c.video&&(L.Utils.mediaPause(c.video),c.video.src="",c.video.srcObject=null),c.audio&&(L.Utils.mediaPause(c.audio),c.audio.src="",c.audio.srcObject=null),c.div&&c.container.removeChild(c.div),c.stopIntervalGetRealtimeVolume()}catch(r){L.Logger.error("[tk-sdk]videoplayer destroy error , removeChild method error info:",
r)}};c.videoPlayerMediaStreamClone&&"object"===typeof c.videoPlayerMediaStreamClone&&c.videoPlayerMediaStreamClone.playbackquUrl?(L.Logger.debug("[tk-sdk]Creating palyback URL from stream "+c.videoPlayerMediaStreamClone),c.videoPlayerMediaStreamCloneUrl=c.videoPlayerMediaStreamClone.playbackquUrl):c.videoPlayerMediaStreamClone&&(L.Logger.debug("[tk-sdk]Creating URL from stream "+c.videoPlayerMediaStreamClone),c.videoPlayerMediaStreamCloneUrl=(window.URL||webkitURL).createObjectURL(c.videoPlayerMediaStreamClone));
c.div=document.createElement("div");c.div.setAttribute("id","player_"+c.id);c.div.setAttribute("class","Talk_player");c.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"+(a?"  display: none;":" "));!1!==b.options.loader&&(c.loader=document.createElement("div"),c.loader.setAttribute("id","back_"+c.id),c.loader.setAttribute("class","Talk_loader"),c.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,R0lGODlhgACAAPIEAAAA/5mZmbu7u93d3f///////wAAAAAAACH5BAUFAAUAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAgACAAAAD/li63P4wykmrvTjrzbv/oEaMRGieaEaSaeu66/rOdBezda5P97j/wEWvFCzmhsbkDKlsFgbQwYfZCVgDTk006qFurtfsZbu19argsJhC5nK8mbR6LWm7Reev3Eqf2O8YcBZ7c30Qf1J4N3p7hmx/ijEahFiOfpAqeRiUlo92mYubhJ2enxeCEpSVpHWYFqgRnKyXrhSwD6qzpWSnmhSyurRtr76po8G7ZRW3DcDIraY8xRDOzxGIiRLMCrnWyYAQ2wXV3oeI0qGx5OUP5+g4xo10AvQCIe7a8OryH2Af9fVA4AuxLk6aDgATfqgF4hgafhkSSuzAsB9EgwUpSNzI/mFYCjkcVBXCsJHjBmUt/DESibDkRHbURI7U4NIkTG4yZ3Ko+bJcTp0eeCr09pOPC6EAkRVdNQNpQFJLfzil1ylqkKmOijZBmlXmGp5dMyapGfbivJ6GzDpKChXozbdw48qdS7eu3bt48+rdy7cv36XdfAJ2yGBw4GeGqyU+rGuxM8eEG0MGuWAyZaWWVeLMbBQzZ6bjOAvOjMsyTNJ+U6tezbq169ewY8ueTbv2DM2WcFe9nJZ3H8ZigDth2VsskJxljdfQWtxrEKvJieuAnps5DeqssJ/QLvnnR+tEwXvgHt77ePNzxYtyPsmtxc4YpcdXHlM3wYMr6ZfWvx+/0onI6wE4iIAB2neeb+2pNaCB8zEYEoEFgpaghPk5WJl7myG40m8QXmhhhv7VJVxhCnpY4k3KdQjih6OduCJ89blYnoYOqPgijG/pZ+ONFLKjo4w8ysXfjkHmOCSQPPboGY0xskgiktUReWOETkbJZJMY1iglh1CaWOWTV+7W5ZQNZtlciBds6eWXWYw4gZpJLolmmmOuaWZwddqp5C95GgGnng/N2RabWob5pqDZ3bkPonTiqNqftpEZ6YSETiqppY0yiimWjm4aj6KemhjqqJ4mAAAh+QQFBQAFACwKAAIAVwAwAAAD/li63P4wvkGHvDjrPSvlYChKnjeeKFdWaet26yu/6zffZ23hPKj3I4FQkPqhCEhCazhEGUfJJIrJzNVO0eiJ2hw9Q1lpkCv0XkVhsYjc9Z1BafWaLfpu4soUm+iOweMueyF2GXgvgipvGoaHiBqEEnh5jWSJfouAM3t8GZAQkjiOGJ4PjKF0nYqRmTyiJKoRpq2oF6QMsrO0EbYKoEAKrjAlGLg9m7WwDb6/wLoQl7GsEAHUAYHOwsTSD9XVS9hH2w3d5HqVMuLj5OVjXDPpDOvy7W3oWRjy83NlPFoZ+fqYCQQYUOAvgusMMkPITiEQht0cpqAWAaI3iSAiVrRoJw2jhoYbIXrEB1KCyJEmS15AiDKlxg0EW4a8mDGhzJkdRby8Oa1aAgAh+QQFBQAFACwfAAIAVwAwAAAD/li63P5LSAGrvTjrNuf+YKh1nWieIumhbFupkivPBUzR+GnnfLj3ooAwwPqdBshBazhEGUXJJIrJ1MGOUamJ2jQ9QVltkCv0XqFh5IncBX01afGYnDqD40u2z76JK/N0bnxweC5sRB9vF34zh4gjg4uMjXobihWTlJUZlw9+fzSHlpGYhTminKSepqebF50NmTyor6qxrLO0L7YLn0ALuhCwCrJAjrUqkrjGrsIkGMW/BcEPJcphLgTaBBjUKNEh29vdgTLLIOLpF80s5xrp8ORVONgi8PcZ8zlRJvf40tL8/QPYQ+BAgjgMxkPIQ6E6BmUYonAo7oE+iRsojoNAKgVjRo3cKnDxiAGkvDYkIVDUMDJlBYUfWrp8YBBEx5kvF9pEiZPmRhEJAAAh+QQFBQAFACw8AAIAQgBCAAAD/lgVHPowykmrna3dzXvNmSeOFqiRaGoyaTuujitv8Gx/661HtSv8gt2jlwIChYtc0XjcEUnMpu4pikpv1I71astytkGh9wJGJk3QrXlcKa+VWjeSPZHP4Rtw+I2OW81DeBZ2fCB+UYCBfWRqiQp0CnqOj4J1jZOQkpOUIYx/m4oxg5cuA6YDO4Qop6c6pKusrDevIrG2rkwptrupXB67vKAbwMHCFcTFxhLIt8oUzLHOE9Cy0hHUrdbX2KjaENzey9Dh08jkz8Tnx83q66bt8PHy8/T19vf4+fr6BP3+/wADAjQmsKDBf6AOKjS4aaHDgZMeSiTQcKLDhBYPEswoA1BBAgAh+QQFBQAFACxOAAoAMABXAAAD91i6vPGhyUkrhdDqfXHm4OZ9YSmNpKmiqVqykbuysgvX5o2HcLxzup8oKLQQix0UcqhcVo5ORi+aHFEn02sDeuWqBGCBkbYLh5/NmnldxajX7LbPBK+PH7K6narfO/t+SIBwfINmUYaHf4lghYyOhlqJWgqDlAuAlwyBmpVnnaChoqOkpaanqKmqKgOtrq+wsbA1srW2ry63urasu764Jr/CA73Du7nGt7TJsqvOz9DR0tPU1TIE2ASl2dyi3N/aneDf4uPklObj6OngWuzt7u/d8fLY9PXr9eFX+vtV1/jkAHwnB89AcwXnuEiXUOHCc1jI7JhHIQEAIfkEBQUABQAsTgAfADAAVwAAA/IYulv+MErI5mPY6omD7somOmDIgeNXmmeVSqtrye8VN3V+07m4873ZjxXcDInF1i9pPDKbw6dqKZ3Gqr4rNlvaplDeFzBMLpvP6LR6zW673/C3YE6v2+92Jn7Prxf7gHxBgYR5PYWIAoOJhH+MfXqPeHGUlZaXmJmam5xnA58DlKCjb6OmoWynpqmqq2mtqq+wp2iztLW2pLi5n7u8sryonsEiBMYEScQWx8fJucvMzc6w0NHIT9QT1tLYrtrb11K6GuDha+XmauVu6Ozgb+tt8fLv9PVs8+f56vf4/fzb4P1L086eNYEH3SVUyA1hui0JAAAh+QQFBQAFACw8ADwAQgBCAAAD+Vi63P5QhUmrvTbqHbH/FSdyYPmN6GOuWepKbPy+sTy7tXnP+bn/wKBwSCwaj8ikcslsOp/QqHRaEFgF1Nd1mx1tv9iuBvwVR8hgswNNVjPYbXcVXpbP6Vf7HR928/N2f1Z6gkYDhwM3f0SIiIp4Q42NO3SRkodAbJaXiZl1EQShBBycmEFcGqKipKVPqqobpaZMr6uxrU21oay4S7qjvJe5uiOytMQixr7Iyb1Ivyiync/MzZxK0NHKR9na19S1L9tF3d7C3NXmkujh4uNC5SnvQfHy30T16o7k6S7n/O12TGL3So+DfHYQylHohqEahw8LGnwAa2KDBAAh+QQFBQAFACwfAE4AVwAwAAAD/hga1f4wykmrW8xSnLX/IKeAj0ie6CUup5m+34qRLmxv8uzVd1/mHE3QR/wBdRNkcXkcSkbLqLHZkVpx1Op1q8pyv9MmeJzVUghowlXAFry8lnRa2m6/xRW5fFmvw45xemh8fWw3OXmCg0WFdodOE4qLFQOVAxqNhj1KEpJqFpaWmJljBZ6fFKGhFpmaX54aqqKspK+woLKXtLVbt7iyHq1cvr+qH8JXxJS5x7xRysvAzY1SpyC5usHIRdDRxiDbPtbXzODhN93eqyTnMOnqs+zO7pIo2CjtKO/wlSn5IONO3MP3z8M+ftlOFNRQ78VAf9ReNEzxkGAhG4JsVLToJgjjHI3lYPgp5WEjyS8mT25JqdIKy5ZRXsIsInMmEWk2UcbL6SABACH5BAUFAAUALAoATgBXADAAAAP+WLrcTpC4Sau9M+iAZ/xdKIabNhZfKp0sW5qimra0+HKdrNb8dWM6WW+YeVmCQqKSYaQgd8uoouR5gqTYKW5hvWa/jW4ETFaIIeXyOa3u0gbwwZcKtL7jcOzv8qzh8VE3MBVBPX9xgYJ1Xn6HeUuCg4RjQ46PFgKZAhiRW2yWcheampyRbAWgoRWjoz6dn5YYrKSuimWpsrObtbZgoB26u7xNX7/AuiSmxbHHs8m9UsbNrDbKUbghwdXWStLTrdt73d65zuHilcwi2iOvROTftO3cjY4s7PPQd/b3yC70J7CdwJdP3wh42fz9MyhCXT9zLQA25NeC4AmJEwHVsHgmkVg9VTQ4dpR0CpPCkmxEovyiciWWli6jwIypZCZNIhBvkgEnJQEAIfkEBQUABQAsAgA8AEIAQgAAA/VYRdz+8KlJq72Yxs1d/uDVjVxogmQqnaylvkQrT7A63/V47/m2/8CgcEgsGo/IpHLJbDqf0Kh0Sj0NroOqDMvVmrjgrDcTBo8v5fCZki6vC233Oq4+0832O/at3+f7fICBdzsChgJGeoWHhkV0P4yMRG1BkYeOeECWl5hXQ5uNIAGjAVKgiKKko1CnqBmqqk+nIbCkTq20taVNs7m1vKAnurtLvb6wTMbHsUq4wrrFwSzDzcrLtknW16tI2tvERt6pv0fi48jh5h/U6Zs77EXSN/BE8jP09ZFA+PmhP/xvJgAMWGBgQINvEK5ReIZhQ3QEMTBLAAAh+QQFBQAFACwCAB8AMABXAAAD9Vi6TE4syrmCvZeW97SPWEhx5GeG2USupoZa48q2EqrJMl2nNz7rwI3vF6QNicXPsZQ0LjvN1hMa9UwdVdM1q11ypcMvGCd2MstmCHrNbrvf8Lh8Tq/b762Bfs/v+/tRf4KDfEmEh4NFiIuAQYyPA4qQi4aThIGWf3ibnJ2en6ChoqOkJgKnAnioq3Wrrqlyr65xsq9vtbJtuLlsu7ZrvrPAwai6xKe9x7DDxG7HTRgezUk2FL5RLwHWtVnZGr9V2drfxVzidOdz4uNy6e3ucfBw8vPe6vbv+PH69fxv9G4ABvQ38AU6gWwQJjRYh2A/HnaimUgAACH5BAkFAAUALAIACgAwAFcAAAP3WLrc/otIAqu9bU7Mu9KaJ1bgNp5MaaKnurKiS8GtS4/yjdt6J889TC4oHBItxiOJp4Qkm44nNCKdFqrTnzXKhAy+gx62AAbrsOX0rctIu2HshXvOKlXmdFTIgs9P+35QgG9/g2VbhodWiWaFjIiPkINbcoCUlXiXbYSam1+doKGio6SlpqeoqToCrK2ur7CvMLG0ta4otrm1J7q9siO+wQK8wr24xbazyLGqzc7P0NHS09TPAdcBo9jboNve2Zff3pTi31bl4lDo6U3r5kru4/Dx2Or01+334PP0U/cs3Cr0Q/HugTsY5SCgu5FQoTwaCwXW04EuAQA7")  no-repeat center center ;background-size: cover;z-index:1;'));
c.video=a?document.createElement("audio"):document.createElement("video");c.video.setAttribute("id","stream"+c.id);c.video.setAttribute("class","Talk_stream");c.video.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000; "+(b.options.mirror?" -webkit-transform: rotateY(180deg); -moz-transform: rotateY(180deg);-o-transform: rotateY(180deg);-ms-transform: rotateY(180deg);transform: rotateY(180deg);":"")+(b.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?" -webkit-object-fit:cover; -moz-object-fit:cover;-o-object-fit:cover;-ms-object-fit:cover;object-fit:cover;":
""));c.video.setAttribute("autoplay","autoplay");c.video.setAttribute("webkit-playsinline","true");c.video.setAttribute("x-webkit-airplay","true");c.video.setAttribute("playsinline","true");c.video.setAttribute("x5-video-player-type","h5");c.video.setAttribute("x5-video-player-fullscreen","true");c.videoSupernatant=document.createElement("div");c.videoSupernatant.setAttribute("class","Talk_stream_videoSupernatant");c.videoSupernatant.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:transparent;left:0;top:0;");
c.updateVideoPlayerOptions=function(a){a&&"object"===typeof a&&(void 0!==a.mirror&&(b.options.mirror=a.mirror,c.video.style.webkitTransform=a.mirror?"rotateY(180deg)":"",c.video.style.mozTransform=a.mirror?"rotateY(180deg)":"",c.video.style.oTransform=a.mirror?"rotateY(180deg)":"",c.video.style.msTransform=a.mirror?"rotateY(180deg)":"",c.video.style.transform=a.mirror?"rotateY(180deg)":""),void 0!==a.mode&&(b.options.mode=a.mode,c.video.style.webkitObjectFit=a.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?
"cover":"",c.video.style.mozObjectFit=a.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",c.video.style.oObjectFit=a.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",c.video.style.msObjectFit=a.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",c.video.style.objectFit=a.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":""),void 0!=a.loader&&(b.options.loader=a.loader,m=!1!==b.options.loader))};c.showVideoContainer=function(){c.container&&(c.container.style.display="block")};
c.hideVideoContainer=function(){c.container&&(c.container.style.display="none")};c.showVideo=function(){c.video&&(c.video.style.display="block");m&&c.loader&&(c.loader.style.display="")};c.hideVideo=function(){c.video&&(c.video.style.display="none");m&&c.loader&&(c.loader.style.display="none")};c.changeMediaStreamUrl=function(a){if(c.video&&a&&(c.videoPlayerMediaStreamClone=a,c.videoPlayerMediaStreamClone&&"object"===typeof c.videoPlayerMediaStreamClone&&c.videoPlayerMediaStreamClone.playbackquUrl?
(L.Logger.debug("[tk-sdk]Creating palyback URL from stream:",c.videoPlayerMediaStreamClone),c.videoPlayerMediaStreamCloneUrl=c.videoPlayerMediaStreamClone.playbackquUrl):c.videoPlayerMediaStreamClone&&(L.Logger.debug("[tk-sdk]Creating URL from stream: ",c.videoPlayerMediaStreamClone),c.videoPlayerMediaStreamCloneUrl=(window.URL||webkitURL).createObjectURL(c.videoPlayerMediaStreamClone)),c.videoPlayerMediaStreamClone&&void 0!==c.video.srcObject?(c.video.srcObject=c.videoPlayerMediaStreamClone,c.video.load()):
c.videoPlayerMediaStreamCloneUrl&&(c.video.src=c.videoPlayerMediaStreamCloneUrl,c.video.load()),void 0!==l&&void 0!==p&&void 0!==k)){a=k;var b=p,d=q;c.stopIntervalGetRealtimeVolume();c.startIntervalGetRealtimeVolume(a,b,d)}};c.setMute=function(a){"boolean"!==typeof a?L.Logger.error("[tk-sdk]Stream setMute isMute type must is boolean!"):(c.local&&"video"===c.type?(L.Logger.debug("[tk-sdk]videoPlayer setMute:local video must is mute!"),f=!0):f=a,c.video&&void 0!==c.video.muted&&(c.video.muted=f),c.audio&&
void 0!==c.audio.muted&&(c.audio.muted=f))};c.setVolume=function(a){"number"!==typeof a?L.Logger.error("[tk-sdk]Stream setVolume volume type must is number!"):(c.local&&"video"===c.type?(L.Logger.debug("[tk-sdk]videoPlayer setVolume:local video must is mute , volume must is 0!"),e=0):e=a,c.video&&void 0!==c.video.volume&&(c.video.volume=e/100),c.audio&&void 0!==c.audio.volume&&(c.audio.volume=e/100))};c.getVolume=function(a){if(a&&"function"===typeof a){if(c.video&&void 0!==c.video.volume)return a(parseInt(100*
c.video.volume)),parseInt(100*c.video.volume);L.Logger.warning("[tk-sdk]videoPlayer getVolume failure , video is not exist!");a(e);return e}L.Logger.warning("[tk-sdk]videoPlayer getVolume callback is not exist , callback must is function!");return e};c.startIntervalGetRealtimeVolume=function(a,b,e){if("function"!==typeof a)L.Logger.warning("[tk-sdk]setIntervalGetRealtimeVolume intervalCallback must is function!");else if(c.videoPlayerMediaStreamClone&&c.videoPlayerMediaStreamClone.getAudioTracks&&
c.videoPlayerMediaStreamClone.getAudioTracks().length){p="number"===typeof b?b:100;k=a;q=e;try{window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,TK.audioContext=TK.audioContext||new window.AudioContext}catch(E){L.Logger.error("[tk-sdk]setIntervalGetRealtimeVolume:Web Audio API(audioContext) not supported")}try{d&&d.stop&&(d.stop(),d=void 0),TK.audioContext&&c.videoPlayerMediaStreamClone&&TK.DeviceMgr&&TK.DeviceMgr.getsSoundMeterInstance?
(d=TK.DeviceMgr.getsSoundMeterInstance(TK.audioContext))&&d.connectToSource?d.connectToSource(c.videoPlayerMediaStreamClone,function(a){a?(L.Logger.error("[tk-sdk]setIntervalGetRealtimeVolume connectToSource error:",a),void 0!==q&&L.Utils.isFunction(q)&&q(a,c.bundleId)):(d.instant&&d.instant.toFixed?(a=Math.floor(100*d.instant.toFixed(2)),void 0!==k&&L.Utils.isFunction(k)&&k(a,c.bundleId)):void 0!==k&&L.Utils.isFunction(k)&&k(0,c.bundleId),clearInterval(l),l=setInterval(function(){if(d.instant&&d.instant.toFixed){var a=
Math.floor(100*d.instant.toFixed(2));void 0!==k&&L.Utils.isFunction(k)&&k(a,c.bundleId)}else void 0!==k&&L.Utils.isFunction(k)&&k(0,c.bundleId)},p))}):void 0!==k&&L.Utils.isFunction(k)&&k(0,c.bundleId):void 0!==k&&L.Utils.isFunction(k)&&k(0,c.bundleId)}catch(E){L.Logger.error("[tk-sdk]setIntervalGetRealtimeVolume error :",E),void 0!==q&&L.Utils.isFunction(q)&&q(E,c.bundleId)}}else L.Logger.warning("[tk-sdk]setIntervalGetRealtimeVolume audio track is empty!")};c.stopIntervalGetRealtimeVolume=function(){d&&
d.stop&&d.stop();clearInterval(l);q=k=p=l=d=void 0};c.hideLoading=function(){m=!1;c.loader&&(c.loader.style.display="none");c.div.style.backgroundColor="transparent"};c.showLoading=function(){m=!0;c.loader&&(c.loader.style.display="");c.div.style.backgroundColor=""};TK.isOnlyAudioRoom&&c.hideVideo();c.local&&"video"===c.type&&(c.setVolume(0),c.setMute(!0));c.container=void 0!==c.elementID?"object"===typeof c.elementID&&"function"===typeof c.elementID.appendChild?c.elementID:document.getElementById(c.elementID):
document.body;c.container.appendChild(c.div);c.loader&&c.div.appendChild(c.loader);c.div.appendChild(c.video);c.div.appendChild(c.videoSupernatant);c.containerWidth=0;c.containerHeight=0;c.videoPlayerMediaStreamClone&&void 0!==c.video.srcObject?(c.video.srcObject=c.videoPlayerMediaStreamClone,c.video.load()):c.videoPlayerMediaStreamCloneUrl&&(c.video.src=c.videoPlayerMediaStreamCloneUrl,c.video.load());var w=function(){c.video&&0!==c.video.readyState&&c.audio&&(c.div&&c.div.removeChild&&c.audio&&
(c.audio.src="",c.audio.srcObject=null,c.div.removeChild(c.audio)),c.audio=void 0)};c.video.oncanplay=function(a){c.hideLoading();c.video.oncanplay=void 0;c.video.onloadeddata=void 0;c.video.onloadedmetadata=void 0;w()};c.video.onloadeddata=function(a){c.hideLoading();c.video.oncanplay=void 0;c.video.onloadeddata=void 0;c.video.onloadedmetadata=void 0;w()};c.video.onloadedmetadata=function(a){c.hideLoading();c.video.oncanplay=void 0;c.video.onloadeddata=void 0;c.video.onloadedmetadata=void 0;w()};
c.video.onreadystatechange=function(a){w()};if(c.videoPlayerMediaStreamClone){if("object"!==typeof c.videoPlayerMediaStreamClone||!c.videoPlayerMediaStreamClone.playbackquUrl){var u=c.videoPlayerMediaStreamClone.getVideoTracks?c.videoPlayerMediaStreamClone.getVideoTracks():void 0;u&&0<u.length||(L.Logger.warning("[tk-sdk]TK.VideoPlayer stream is not videoTracks , hide video element , VideoPlayer id is "+c.id+"!"),c.hideVideo())}}else L.Logger.warning("[tk-sdk]TK.VideoPlayer stream is not exist , hide video element , VideoPlayer id is "+
c.id+"!"),c.hideVideo();var h=function(){try{if(a||!c.video||0!==c.video.readyState||c.local||setTimeout(function(){if(c&&c.video&&0===c.video.readyState&&c.videoPlayerMediaStreamCloneUrl&&c.div){c.audio=document.createElement("audio");c.audio.setAttribute("id","stream_temp_audio_"+c.id);c.audio.setAttribute("autoplay","autoplay");c.audio.style.display="none";c.div.appendChild(c.audio);var a=c.videoPlayerMediaStreamClone&&c.videoPlayerMediaStreamClone.clone?c.videoPlayerMediaStreamClone.clone():void 0,
b=c.videoPlayerMediaStreamCloneUrl;if(a&&a.getVideoTracks&&a.getVideoTracks()&&0<a.getVideoTracks().length){b=window.URL||webkitURL;for(var d=a.getVideoTracks().length-1;0<=d;d--){var e=a.getVideoTracks()[d];a.removeTrack(e)}b=b.createObjectURL(a)}a&&void 0!==c.audio.srcObject?(c.audio.srcObject=a,c.audio.load()):b&&(c.audio.src=b,c.audio.load());c.local&&"video"===c.type&&(c.setVolume(0),c.setMute(!0));var f=function(){if(c.audio&&c.audio.play){var a=L.Utils.mediaPlay(c.audio);a&&a.catch&&a.catch(function(a){L.Logger.warning("[tk-sdk]audio.play method catch error , videoPlayer id is "+
c.id+" , error info:"+a)})}};(a=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput))?TK.DeviceMgr.setElementSinkIdToAudioouputDevice(c.audio,a,function(){f()}):f()}},250),c.video&&c.video.play){var b=L.Utils.mediaPlay(c.video);b&&b.catch&&b.catch(function(a){L.Logger.warning("[tk-sdk]video.play method catch error , videoPlayer id is "+c.id+" , error info:"+a)})}}catch(K){L.Logger.warning("[tk-sdk]video.play method error , videoPlayer id is "+c.id+" !")}};u=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);
c.video&&u?TK.DeviceMgr.setElementSinkIdToAudioouputDevice(c.video,u,function(){h()}):h();return c};window.TK=window.TK||{};
TK.NativeVideoPlayer=function(b){b.options=b.options||{};b.options.bar=void 0!==b.options.bar?b.options.bar:!1;b.options.mirror=b.options.mirror||!1;b.options.mode=b.options.mode||window.TK_VIDEO_MODE.ASPECT_RATIO_CONTAIN;var a=void 0!==b.options.audioPlayer?b.options.audioPlayer:!1,c=TK.EventDispatcher({}),e=100,d=!1,l=!1!==b.options.loader,p=0,k=void 0,f=void 0,m=void 0;c.id=b.id;c.local=b.stream.local;c.videoPlayerMediaStreamClone=b.stream.stream;c.type=b.stream&&b.stream.getAttributes&&b.stream.getAttributes()?
b.stream.getAttributes().type:void 0;c.elementID=b.elementID;var q=function(a){if(TK.isTkNative){var b=a.data.name;"onNativeNotification"===b?(a=a.data.arg,"object"!==typeof a||"onRemoteAudioVolume"!==a.name||L.Utils.isNull(a.args)||(a=a.args,b=a.type,""!==b&&(a.id=a.id+":"+b),a.id===c.id&&(p=a.volume))):"onMicVolumeReport"===b&&c.local&&(p=a.data.volume)}};TK.isTkNative&&window.tknative.addEventListener("message",q,!1);c.destroy=function(){c.parentNode.removeChild(c.div)};c.div=document.createElement("div");
c.div.setAttribute("id","player_"+c.id);c.div.setAttribute("class","Talk_player");c.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"+(a?"  display: none;":" "));!1!==b.options.loader&&(c.loader=document.createElement("div"),c.loader.setAttribute("id","back_"+c.id),c.loader.setAttribute("class","Talk_loader"),c.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,R0lGODlhgACAAPIEAAAA/5mZmbu7u93d3f///////wAAAAAAACH5BAUFAAUAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAgACAAAAD/li63P4wykmrvTjrzbv/oEaMRGieaEaSaeu66/rOdBezda5P97j/wEWvFCzmhsbkDKlsFgbQwYfZCVgDTk006qFurtfsZbu19argsJhC5nK8mbR6LWm7Reev3Eqf2O8YcBZ7c30Qf1J4N3p7hmx/ijEahFiOfpAqeRiUlo92mYubhJ2enxeCEpSVpHWYFqgRnKyXrhSwD6qzpWSnmhSyurRtr76po8G7ZRW3DcDIraY8xRDOzxGIiRLMCrnWyYAQ2wXV3oeI0qGx5OUP5+g4xo10AvQCIe7a8OryH2Af9fVA4AuxLk6aDgATfqgF4hgafhkSSuzAsB9EgwUpSNzI/mFYCjkcVBXCsJHjBmUt/DESibDkRHbURI7U4NIkTG4yZ3Ko+bJcTp0eeCr09pOPC6EAkRVdNQNpQFJLfzil1ylqkKmOijZBmlXmGp5dMyapGfbivJ6GzDpKChXozbdw48qdS7eu3bt48+rdy7cv36XdfAJ2yGBw4GeGqyU+rGuxM8eEG0MGuWAyZaWWVeLMbBQzZ6bjOAvOjMsyTNJ+U6tezbq169ewY8ueTbv2DM2WcFe9nJZ3H8ZigDth2VsskJxljdfQWtxrEKvJieuAnps5DeqssJ/QLvnnR+tEwXvgHt77ePNzxYtyPsmtxc4YpcdXHlM3wYMr6ZfWvx+/0onI6wE4iIAB2neeb+2pNaCB8zEYEoEFgpaghPk5WJl7myG40m8QXmhhhv7VJVxhCnpY4k3KdQjih6OduCJ89blYnoYOqPgijG/pZ+ONFLKjo4w8ysXfjkHmOCSQPPboGY0xskgiktUReWOETkbJZJMY1iglh1CaWOWTV+7W5ZQNZtlciBds6eWXWYw4gZpJLolmmmOuaWZwddqp5C95GgGnng/N2RabWob5pqDZ3bkPonTiqNqftpEZ6YSETiqppY0yiimWjm4aj6KemhjqqJ4mAAAh+QQFBQAFACwKAAIAVwAwAAAD/li63P4wvkGHvDjrPSvlYChKnjeeKFdWaet26yu/6zffZ23hPKj3I4FQkPqhCEhCazhEGUfJJIrJzNVO0eiJ2hw9Q1lpkCv0XkVhsYjc9Z1BafWaLfpu4soUm+iOweMueyF2GXgvgipvGoaHiBqEEnh5jWSJfouAM3t8GZAQkjiOGJ4PjKF0nYqRmTyiJKoRpq2oF6QMsrO0EbYKoEAKrjAlGLg9m7WwDb6/wLoQl7GsEAHUAYHOwsTSD9XVS9hH2w3d5HqVMuLj5OVjXDPpDOvy7W3oWRjy83NlPFoZ+fqYCQQYUOAvgusMMkPITiEQht0cpqAWAaI3iSAiVrRoJw2jhoYbIXrEB1KCyJEmS15AiDKlxg0EW4a8mDGhzJkdRby8Oa1aAgAh+QQFBQAFACwfAAIAVwAwAAAD/li63P5LSAGrvTjrNuf+YKh1nWieIumhbFupkivPBUzR+GnnfLj3ooAwwPqdBshBazhEGUXJJIrJ1MGOUamJ2jQ9QVltkCv0XqFh5IncBX01afGYnDqD40u2z76JK/N0bnxweC5sRB9vF34zh4gjg4uMjXobihWTlJUZlw9+fzSHlpGYhTminKSepqebF50NmTyor6qxrLO0L7YLn0ALuhCwCrJAjrUqkrjGrsIkGMW/BcEPJcphLgTaBBjUKNEh29vdgTLLIOLpF80s5xrp8ORVONgi8PcZ8zlRJvf40tL8/QPYQ+BAgjgMxkPIQ6E6BmUYonAo7oE+iRsojoNAKgVjRo3cKnDxiAGkvDYkIVDUMDJlBYUfWrp8YBBEx5kvF9pEiZPmRhEJAAAh+QQFBQAFACw8AAIAQgBCAAAD/lgVHPowykmrna3dzXvNmSeOFqiRaGoyaTuujitv8Gx/661HtSv8gt2jlwIChYtc0XjcEUnMpu4pikpv1I71astytkGh9wJGJk3QrXlcKa+VWjeSPZHP4Rtw+I2OW81DeBZ2fCB+UYCBfWRqiQp0CnqOj4J1jZOQkpOUIYx/m4oxg5cuA6YDO4Qop6c6pKusrDevIrG2rkwptrupXB67vKAbwMHCFcTFxhLIt8oUzLHOE9Cy0hHUrdbX2KjaENzey9Dh08jkz8Tnx83q66bt8PHy8/T19vf4+fr6BP3+/wADAjQmsKDBf6AOKjS4aaHDgZMeSiTQcKLDhBYPEswoA1BBAgAh+QQFBQAFACxOAAoAMABXAAAD91i6vPGhyUkrhdDqfXHm4OZ9YSmNpKmiqVqykbuysgvX5o2HcLxzup8oKLQQix0UcqhcVo5ORi+aHFEn02sDeuWqBGCBkbYLh5/NmnldxajX7LbPBK+PH7K6narfO/t+SIBwfINmUYaHf4lghYyOhlqJWgqDlAuAlwyBmpVnnaChoqOkpaanqKmqKgOtrq+wsbA1srW2ry63urasu764Jr/CA73Du7nGt7TJsqvOz9DR0tPU1TIE2ASl2dyi3N/aneDf4uPklObj6OngWuzt7u/d8fLY9PXr9eFX+vtV1/jkAHwnB89AcwXnuEiXUOHCc1jI7JhHIQEAIfkEBQUABQAsTgAfADAAVwAAA/IYulv+MErI5mPY6omD7somOmDIgeNXmmeVSqtrye8VN3V+07m4873ZjxXcDInF1i9pPDKbw6dqKZ3Gqr4rNlvaplDeFzBMLpvP6LR6zW673/C3YE6v2+92Jn7Prxf7gHxBgYR5PYWIAoOJhH+MfXqPeHGUlZaXmJmam5xnA58DlKCjb6OmoWynpqmqq2mtqq+wp2iztLW2pLi5n7u8sryonsEiBMYEScQWx8fJucvMzc6w0NHIT9QT1tLYrtrb11K6GuDha+XmauVu6Ozgb+tt8fLv9PVs8+f56vf4/fzb4P1L086eNYEH3SVUyA1hui0JAAAh+QQFBQAFACw8ADwAQgBCAAAD+Vi63P5QhUmrvTbqHbH/FSdyYPmN6GOuWepKbPy+sTy7tXnP+bn/wKBwSCwaj8ikcslsOp/QqHRaEFgF1Nd1mx1tv9iuBvwVR8hgswNNVjPYbXcVXpbP6Vf7HR928/N2f1Z6gkYDhwM3f0SIiIp4Q42NO3SRkodAbJaXiZl1EQShBBycmEFcGqKipKVPqqobpaZMr6uxrU21oay4S7qjvJe5uiOytMQixr7Iyb1Ivyiync/MzZxK0NHKR9na19S1L9tF3d7C3NXmkujh4uNC5SnvQfHy30T16o7k6S7n/O12TGL3So+DfHYQylHohqEahw8LGnwAa2KDBAAh+QQFBQAFACwfAE4AVwAwAAAD/hga1f4wykmrW8xSnLX/IKeAj0ie6CUup5m+34qRLmxv8uzVd1/mHE3QR/wBdRNkcXkcSkbLqLHZkVpx1Op1q8pyv9MmeJzVUghowlXAFry8lnRa2m6/xRW5fFmvw45xemh8fWw3OXmCg0WFdodOE4qLFQOVAxqNhj1KEpJqFpaWmJljBZ6fFKGhFpmaX54aqqKspK+woLKXtLVbt7iyHq1cvr+qH8JXxJS5x7xRysvAzY1SpyC5usHIRdDRxiDbPtbXzODhN93eqyTnMOnqs+zO7pIo2CjtKO/wlSn5IONO3MP3z8M+ftlOFNRQ78VAf9ReNEzxkGAhG4JsVLToJgjjHI3lYPgp5WEjyS8mT25JqdIKy5ZRXsIsInMmEWk2UcbL6SABACH5BAUFAAUALAoATgBXADAAAAP+WLrcTpC4Sau9M+iAZ/xdKIabNhZfKp0sW5qimra0+HKdrNb8dWM6WW+YeVmCQqKSYaQgd8uoouR5gqTYKW5hvWa/jW4ETFaIIeXyOa3u0gbwwZcKtL7jcOzv8qzh8VE3MBVBPX9xgYJ1Xn6HeUuCg4RjQ46PFgKZAhiRW2yWcheampyRbAWgoRWjoz6dn5YYrKSuimWpsrObtbZgoB26u7xNX7/AuiSmxbHHs8m9UsbNrDbKUbghwdXWStLTrdt73d65zuHilcwi2iOvROTftO3cjY4s7PPQd/b3yC70J7CdwJdP3wh42fz9MyhCXT9zLQA25NeC4AmJEwHVsHgmkVg9VTQ4dpR0CpPCkmxEovyiciWWli6jwIypZCZNIhBvkgEnJQEAIfkEBQUABQAsAgA8AEIAQgAAA/VYRdz+8KlJq72Yxs1d/uDVjVxogmQqnaylvkQrT7A63/V47/m2/8CgcEgsGo/IpHLJbDqf0Kh0Sj0NroOqDMvVmrjgrDcTBo8v5fCZki6vC233Oq4+0832O/at3+f7fICBdzsChgJGeoWHhkV0P4yMRG1BkYeOeECWl5hXQ5uNIAGjAVKgiKKko1CnqBmqqk+nIbCkTq20taVNs7m1vKAnurtLvb6wTMbHsUq4wrrFwSzDzcrLtknW16tI2tvERt6pv0fi48jh5h/U6Zs77EXSN/BE8jP09ZFA+PmhP/xvJgAMWGBgQINvEK5ReIZhQ3QEMTBLAAAh+QQFBQAFACwCAB8AMABXAAAD9Vi6TE4syrmCvZeW97SPWEhx5GeG2USupoZa48q2EqrJMl2nNz7rwI3vF6QNicXPsZQ0LjvN1hMa9UwdVdM1q11ypcMvGCd2MstmCHrNbrvf8Lh8Tq/b762Bfs/v+/tRf4KDfEmEh4NFiIuAQYyPA4qQi4aThIGWf3ibnJ2en6ChoqOkJgKnAnioq3Wrrqlyr65xsq9vtbJtuLlsu7ZrvrPAwai6xKe9x7DDxG7HTRgezUk2FL5RLwHWtVnZGr9V2drfxVzidOdz4uNy6e3ucfBw8vPe6vbv+PH69fxv9G4ABvQ38AU6gWwQJjRYh2A/HnaimUgAACH5BAkFAAUALAIACgAwAFcAAAP3WLrc/otIAqu9bU7Mu9KaJ1bgNp5MaaKnurKiS8GtS4/yjdt6J889TC4oHBItxiOJp4Qkm44nNCKdFqrTnzXKhAy+gx62AAbrsOX0rctIu2HshXvOKlXmdFTIgs9P+35QgG9/g2VbhodWiWaFjIiPkINbcoCUlXiXbYSam1+doKGio6SlpqeoqToCrK2ur7CvMLG0ta4otrm1J7q9siO+wQK8wr24xbazyLGqzc7P0NHS09TPAdcBo9jboNve2Zff3pTi31bl4lDo6U3r5kru4/Dx2Or01+334PP0U/cs3Cr0Q/HugTsY5SCgu5FQoTwaCwXW04EuAQA7")  no-repeat center center ;background-size: cover;z-index:1;'));
c.video=document.createElement("embed");c.video.setAttribute("id",c.id);c.video.setAttribute("class","Talk_stream");c.video.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000; "+(b.options.mirror?" -webkit-transform: rotateY(180deg); -moz-transform: rotateY(180deg);-o-transform: rotateY(180deg);-ms-transform: rotateY(180deg);transform: rotateY(180deg);":""));c.video.setAttribute("type","application/x-ppapi-proxy");c.videoSupernatant=document.createElement("div");
c.videoSupernatant.setAttribute("class","Talk_stream_videoSupernatant");c.videoSupernatant.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:transparent;left:0;top:0;");c.updateVideoPlayerOptions=function(a){a&&"object"===typeof a&&void 0!==a.mirror&&(b.options.mirror=a.mirror,c.video.style.webkitTransform=a.mirror?"rotateY(180deg)":"",c.video.style.mozTransform=a.mirror?"rotateY(180deg)":"",c.video.style.oTransform=a.mirror?"rotateY(180deg)":"",c.video.style.msTransform=
a.mirror?"rotateY(180deg)":"",c.video.style.transform=a.mirror?"rotateY(180deg)":"")};c.showVideo=function(){c.video&&(c.video.style.opacity=1);l&&c.loader&&(c.loader.style.display="")};c.hideVideo=function(){c.video&&(c.video.style.opacity=0);l&&c.loader&&(c.loader.style.display="none")};c.changeMediaStreamUrl=function(a){};c.setMute=function(a){"boolean"!==typeof a?L.Logger.error("[tk-sdk]Stream setMute isMute type must is boolean!"):(c.local&&"video"===c.type?(L.Logger.debug("[tk-sdk]videoPlayer setMute:local video must is mute!"),
d=!0):d=a,d?window.tknative.postMessage({command:"setEmbedVolume",connectionId:c.id,volume:0}):window.tknative.postMessage({command:"setEmbedVolume",connectionId:c.id,volume:e}))};c.setVolume=function(a){"number"!==typeof a?L.Logger.error("[tk-sdk]Stream setVolume volume type must is number!"):(a*=2.55,c.local&&"video"===c.type?(L.Logger.debug("[tk-sdk]videoPlayer setVolume:local video must is mute , volume must is 0!"),e=0):e=a,window.tknative.postMessage({command:"setEmbedVolume",connectionId:c.id,
volume:a}))};c.getVolume=function(a){if(a&&"function"===typeof a){if(TK.isTkNative)return a(e),e}else return L.Logger.warning("[tk-sdk]videoPlayer getVolume callback is not exist , callback must is function!"),e};c.startIntervalGetRealtimeVolume=function(a,b,d){"function"!==typeof a?L.Logger.warning("[tk-sdk]setIntervalGetRealtimeVolume intervalCallback must is function!"):(f="number"===typeof b?b:100,m=a,a(0),k&&clearInterval(k),k=setInterval(function(){void 0!==m&&L.Utils.isFunction(m)&&m(p,c.id)},
f))};c.stopIntervalGetRealtimeVolume=function(){k&&clearInterval(k);m=f=k=void 0;p=0};c.hideLoading=function(){l=!1;c.loader&&(c.loader.style.display="none");c.div.style.backgroundColor="transparent"};c.showLoading=function(){l=!0;c.loader&&(c.loader.style.display="");c.div.style.backgroundColor=""};TK.isOnlyAudioRoom&&c.hideVideo();c.local&&"video"===c.type&&(c.setVolume(0),c.setMute(!0));c.container=void 0!==c.elementID?"object"===typeof c.elementID&&"function"===typeof c.elementID.appendChild?
c.elementID:document.getElementById(c.elementID):document.body;c.container.appendChild(c.div);c.parentNode=c.div.parentNode;c.loader&&c.div.appendChild(c.loader);c.div.appendChild(c.video);c.div.appendChild(c.videoSupernatant);c.containerWidth=0;c.containerHeight=0;a=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);c.video&&a&&TK.DeviceMgr.setElementSinkIdToAudioouputDevice(c.video,a);c.hideLoading();return c};window.L=window.L||{};
L.Constant=function(){return{roomError:{ROOMCONNECTERROR:0,GETCONFIGERROR:1,GETFILELISTERROR:2,CHECKROOMERROR:3},getUserMedia:{SUCCESS_ONLY_VIDEO:1,SUCCESS_ONLY_AUDIO:2,SUCCESS_ALL:3,SUCCESS_NOT_ALL:4,FAILURE_ONLY_VIDEO:-1,FAILURE_ONLY_AUDIO:-2,FAILURE_ALL:-3,FAILURE_USERMEDIA_AGAIN_ONLY_GET_AUDIO:0,FAILURE_USERMEDIA_AGAIN_ONLY_GET_VIDEO:0},accessDenied:{streamFail:0,notAudioAndVideo:1,notAudioAndVideoAndScreenOrUrlNotUndefined:2,ohterError:-1},deviceStorage:{audioinput:"audioinputDeviceId",audiooutput:"audiooutputDeviceId",
videoinput:"videoinputDeviceId"},streamReconnection:{notOnceSuccess:1,midwayReconnectionNotSuccess:2,midwayReconnectionChangePublishstate_0:3},getStats:{nativeFailure:1,pcNotGetStats:2,peerConnectionNotGetStats:3,getStatsFailure:4,getStatsError:5},udpState:{ok:1,notOnceSuccess:2},localRecord:{onlyRecordAudio:0,recordAudioAndVideo:1},LOGLEVEL:{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5}}}(L);window.L=window.L||{};L.aexInstance=void 0;
(function(){var b={cipher:function(a,c){for(var d=c.length/4-1,e=[[],[],[],[]],k=0;16>k;k++)e[k%4][Math.floor(k/4)]=a[k];e=b.addRoundKey(e,c,0,4);for(k=1;k<d;k++)e=b.subBytes(e,4),e=b.shiftRows(e,4),e=b.mixColumns(e,4),e=b.addRoundKey(e,c,k,4);e=b.subBytes(e,4);e=b.shiftRows(e,4);e=b.addRoundKey(e,c,d,4);c=Array(16);for(k=0;16>k;k++)c[k]=e[k%4][Math.floor(k/4)];return c},keyExpansion:function(a){for(var c=a.length/4,e=c+6,p=Array(4*(e+1)),k=Array(4),f=0;f<c;f++)p[f]=[a[4*f],a[4*f+1],a[4*f+2],a[4*
f+3]];for(f=c;f<4*(e+1);f++){p[f]=Array(4);for(a=0;4>a;a++)k[a]=p[f-1][a];if(0==f%c)for(k=b.subWord(b.rotWord(k)),a=0;4>a;a++)k[a]^=b.rCon[f/c][a];else 6<c&&4==f%c&&(k=b.subWord(k));for(a=0;4>a;a++)p[f][a]=p[f-c][a]^k[a]}return p},subBytes:function(a,c){for(var d=0;4>d;d++)for(var e=0;e<c;e++)a[d][e]=b.sBox[a[d][e]];return a},shiftRows:function(a,b){for(var c=Array(4),d=1;4>d;d++){for(var e=0;4>e;e++)c[e]=a[d][(e+d)%b];for(e=0;4>e;e++)a[d][e]=c[e]}return a},mixColumns:function(a,b){for(b=0;4>b;b++){for(var c=
Array(4),d=Array(4),e=0;4>e;e++)c[e]=a[e][b],d[e]=a[e][b]&128?a[e][b]<<1^283:a[e][b]<<1;a[0][b]=d[0]^c[1]^d[1]^c[2]^c[3];a[1][b]=c[0]^d[1]^c[2]^d[2]^c[3];a[2][b]=c[0]^c[1]^d[2]^c[3]^d[3];a[3][b]=c[0]^d[0]^c[1]^c[2]^d[3]}return a},addRoundKey:function(a,b,c,p){for(var d=0;4>d;d++)for(var e=0;e<p;e++)a[d][e]^=b[4*c+e][d];return a},subWord:function(a){for(var c=0;4>c;c++)a[c]=b.sBox[a[c]];return a},rotWord:function(a){for(var b=a[0],c=0;3>c;c++)a[c]=a[c+1];a[3]=b;return a},sBox:[99,124,119,123,242,107,
111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,
34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],rCon:[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,
0,0,0]],Ctr:{}};b.Ctr.encrypt=function(e,d,l){d=d||"talk_2018_@beijing_20180310_talk_2018_@beijing";l=l||256;if(128!=l&&192!=l&&256!=l)return"";e=c.encode(e);d=c.encode(d);var p=l/8,k=Array(p);for(l=0;l<p;l++)k[l]=isNaN(d.charCodeAt(l))?0:d.charCodeAt(l);k=b.cipher(k,b.keyExpansion(k));k=k.concat(k.slice(0,p-16));d=Array(16);l=(new Date).getTime();p=l%1E3;var f=Math.floor(l/1E3),m=Math.floor(65535*Math.random());for(l=0;2>l;l++)d[l]=p>>>8*l&255;for(l=0;2>l;l++)d[l+2]=m>>>8*l&255;for(l=0;4>l;l++)d[l+
4]=f>>>8*l&255;p="";for(l=0;8>l;l++)p+=String.fromCharCode(d[l]);k=b.keyExpansion(k);f=Math.ceil(e.length/16);m=Array(f);for(var q=0;q<f;q++){for(l=0;4>l;l++)d[15-l]=q>>>8*l&255;for(l=0;4>l;l++)d[15-l-4]=q/4294967296>>>8*l;var w=b.cipher(d,k),u=q<f-1?16:(e.length-1)%16+1,h=Array(u);for(l=0;l<u;l++)h[l]=w[l]^e.charCodeAt(16*q+l),h[l]=String.fromCharCode(h[l]);m[q]=h.join("")}e=p+m.join("");return e=a.encode(e)};b.Ctr.decrypt=function(e,d,l){d=d||"talk_2018_@beijing_20180310_talk_2018_@beijing";l=l||
256;if(128!=l&&192!=l&&256!=l)return"";e=a.decode(e);d=c.encode(d);var p=l/8,k=Array(p);for(l=0;l<p;l++)k[l]=isNaN(d.charCodeAt(l))?0:d.charCodeAt(l);k=b.cipher(k,b.keyExpansion(k));k=k.concat(k.slice(0,p-16));d=Array(8);p=e.slice(0,8);for(l=0;8>l;l++)d[l]=p.charCodeAt(l);p=b.keyExpansion(k);k=Math.ceil((e.length-8)/16);l=Array(k);for(var f=0;f<k;f++)l[f]=e.slice(8+16*f,16*f+24);e=l;var m=Array(e.length);for(f=0;f<k;f++){for(l=0;4>l;l++)d[15-l]=f>>>8*l&255;for(l=0;4>l;l++)d[15-l-4]=(f+1)/4294967296-
1>>>8*l&255;var q=b.cipher(d,p),w=Array(e[f].length);for(l=0;l<e[f].length;l++)w[l]=q[l]^e[f].charCodeAt(l),w[l]=String.fromCharCode(w[l]);m[f]=w.join("")}e=m.join("");return e=c.decode(e)};var a={code:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d",encode:function(b,c){var d=[],e="",k=a.code;c=("undefined"==typeof c?0:c)?b.encodeUTF8():b;b=c.length%3;if(0<b)for(;3>b++;)e+="\x3d",c+="\x00";for(b=0;b<c.length;b+=3){var f=c.charCodeAt(b);var m=c.charCodeAt(b+1);var q=c.charCodeAt(b+
2);var w=f<<16|m<<8|q;f=w>>18&63;m=w>>12&63;q=w>>6&63;w&=63;d[b/3]=k.charAt(f)+k.charAt(m)+k.charAt(q)+k.charAt(w)}d=d.join("");return d=d.slice(0,d.length-e.length)+e},decode:function(b,c){c="undefined"==typeof c?!1:c;var d=[],e=a.code;var k=c?b.decodeUTF8():b;for(var f=0;f<k.length;f+=4){var m=e.indexOf(k.charAt(f));var q=e.indexOf(k.charAt(f+1));b=e.indexOf(k.charAt(f+2));var w=e.indexOf(k.charAt(f+3));var u=m<<18|q<<12|b<<6|w;m=u>>>16&255;q=u>>>8&255;u&=255;d[f/4]=String.fromCharCode(m,q,u);64==
w&&(d[f/4]=String.fromCharCode(m,q));64==b&&(d[f/4]=String.fromCharCode(m))}d=d.join("");return c?d.decodeUTF8():d}},c={encode:function(a){a=a.replace(/[\u0080-\u07ff]/g,function(a){a=a.charCodeAt(0);return String.fromCharCode(192|a>>6,128|a&63)});return a=a.replace(/[\u0800-\uffff]/g,function(a){a=a.charCodeAt(0);return String.fromCharCode(224|a>>12,128|a>>6&63,128|a&63)})},decode:function(a){a=a.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(a){a=(a.charCodeAt(0)&15)<<12|(a.charCodeAt(1)&
63)<<6|a.charCodeAt(2)&63;return String.fromCharCode(a)});return a=a.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(a){a=(a.charCodeAt(0)&31)<<6|a.charCodeAt(1)&63;return String.fromCharCode(a)})}};L.aexInstance=b.Ctr})();
L.Utils=function(){var b=void 0,a=!1,c=!1;b={handleMediaPlayOnEvent:function(a,c){try{if(L.Utils.removeEvent(a,"canplay",b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadedmetadata",b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadeddata",b.handleMediaPlayOnEvent.bind(null,a,c)),a&&a.play&&"function"===typeof a.play){var d=a.play();d&&d.catch&&"function"===typeof d.catch&&d.catch(function(b){L.Logger.error("[tk-sdk]media play err:",L.Utils.toJsonStringify(b),
c?" , media element id is "+c:" media element:",c?"":a)})}}catch(p){L.Logger.error("[tk-sdk]media play error:",L.Utils.toJsonStringify(p),c?" , media element id is "+c:" media element:",c?"":a)}},handleMediaPauseOnEvent:function(a,c){try{if(L.Utils.removeEvent(a,"canplay",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadedmetadata",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadeddata",b.handleMediaPauseOnEvent.bind(null,a,c)),a&&a.pause&&"function"===typeof a.pause){var d=
a.pause();d&&d.catch&&"function"===typeof d.catch&&d.catch(function(b){L.Logger.error("[tk-sdk]media pause err:",L.Utils.toJsonStringify(b),c?" , media element id is "+c:" media element:",c?"":a)})}}catch(p){L.Logger.error("[tk-sdk]media pause error:",L.Utils.toJsonStringify(p),c?" , media element id is "+c:" media element:",c?"":a)}}};return{addEvent:function(a,b,c,p){a.addEventListener?a.addEventListener(b,c,void 0!=p&&null!=p?p:!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c},removeEvent:function(a,
b,c,p){a.removeEventListener?a.removeEventListener(b,c,void 0!=p&&null!=p?p:!1):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null},toJsonStringify:function(a,b){if(void 0!=b&&!b||!a)return a;try{if("object"!==typeof a)return a;var c=JSON.stringify(a);c?a=c:L.Logger.debug("[tk-sdk]toJsonStringify:data is not json!")}catch(p){L.Logger.debug("[tk-sdk]toJsonStringify:data is not json!")}return a},toJsonParse:function(a,b){if(void 0!=b&&!b||!a)return a;try{if("string"!==typeof a)return a;var c=JSON.parse(a);
c?a=c:L.Logger.debug("[tk-sdk]toJsonParse:data is not json string!")}catch(p){L.Logger.debug("[tk-sdk]toJsonParse:data is not json string!")}return a},encrypt:function(a,b,c,p){if(!a)return a;c=c||TK.hexEncryptDecryptKey;p=p||TK.hexEncryptDecryptBit;b=void 0!=b?b:"talk_2018_@beijing";a=L.aexInstance.encrypt(a,c,p);return b+a+b},decrypt:function(a,b,c,p){if(!a)return a;c=c||TK.hexEncryptDecryptKey;p=p||TK.hexEncryptDecryptBit;a=a.replace(new RegExp(void 0!=b?b:"talk_2018_@beijing","gm"),"");return L.aexInstance.decrypt(a,
c,p)},mediaPlay:function(a){var c=void 0;a&&"string"===typeof a?a=document.getElementById(a):a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&a.getAttribute&&"function"===typeof a.getAttribute&&(c=a.getAttribute("id"));a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&(0!==a.readyState?b.handleMediaPlayOnEvent(a,c):(L.Utils.removeEvent(a,"canplay",b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadedmetadata",b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadeddata",
b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.addEvent(a,"canplay",b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.addEvent(a,"loadedmetadata",b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.addEvent(a,"loadeddata",b.handleMediaPlayOnEvent.bind(null,a,c))))},mediaPause:function(a){var c=void 0;a&&"string"===typeof a?a=document.getElementById(a):a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&a.getAttribute&&"function"===typeof a.getAttribute&&(c=a.getAttribute("id"));a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&
(0!==a.readyState?b.handleMediaPauseOnEvent(a,c):(L.Utils.removeEvent(a,"canplay",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadedmetadata",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadeddata",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.addEvent(a,"canplay",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.addEvent(a,"loadedmetadata",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.addEvent(a,"loadeddata",b.handleMediaPauseOnEvent.bind(null,a,
c))))},localStorage:{setItem:function(b,c){try{window.localStorage?window.localStorage.setItem?window.localStorage.setItem(b,c):L.Logger.warning("[tk-sdk]Browser does not support localStorage.setItem , key is "+b+" , value is "+c+"!"):a||(a=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage!"))}catch(l){a||(a=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage , error info:",L.Utils.toJsonStringify(l)))}},getItem:function(b){try{if(window.localStorage){if(window.localStorage.getItem)return window.localStorage.getItem(b);
L.Logger.warning("[tk-sdk]Browser does not support localStorage.getItem , key is "+b+" !");return""}a||(a=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage!"));return""}catch(d){return a||(a=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage , error info:",L.Utils.toJsonStringify(d))),""}},removeItem:function(b){try{if(window.localStorage){if(window.localStorage.removeItem)return window.localStorage.removeItem(b);L.Logger.warning("[tk-sdk]Browser does not support localStorage.removeItem , key is "+
b+" !");return""}a||(a=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage!"));return""}catch(d){return a||(a=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage , error info:",L.Utils.toJsonStringify(d))),""}}},sessionStorage:{setItem:function(a,b){try{window.sessionStorage?window.sessionStorage.setItem?window.sessionStorage.setItem(a,b):L.Logger.warning("[tk-sdk]Browser does not support sessionStorage.setItem , key is "+a+" , value is "+b+"!"):c||(c=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage!"))}catch(l){c||
(c=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage , error info:",L.Utils.toJsonStringify(l)))}},getItem:function(a){try{if(window.sessionStorage){if(window.sessionStorage.getItem)return window.sessionStorage.getItem(a);L.Logger.warning("[tk-sdk]Browser does not support sessionStorage.getItem , key is "+a+" !");return""}c||(c=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage!"));return""}catch(d){return c||(c=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage , error info:",
L.Utils.toJsonStringify(d))),""}},removeItem:function(a){try{if(window.sessionStorage){if(window.sessionStorage.removeItem)return window.sessionStorage.removeItem(a);L.Logger.warning("[tk-sdk]Browser does not support sessionStorage.removeItem , key is "+a+" !");return""}c||(c=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage!"));return""}catch(d){return c||(c=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage , error info:",L.Utils.toJsonStringify(d))),""}}},getBrowserInfo:function(){var a=
/(msie\s|trident.*rv:)([\w.]+)/,b=/edge\/(\d+).(\d+)$/,c=/(firefox)\/([\w.]+)/,p=/(opera).+version\/([\w.]+)/,k=/(chrome)\/([\w.]+)/,f=/version\/([\w.]+).*(safari)/,m=function(d){var e=a.exec(d);return e?{browser:"IE",version:e[2]||"0"}:(e=b.exec(d))?{browser:"Edge",version:e[2]||"0"}:(e=c.exec(d))?{browser:e[1]||"Firefox",version:e[2]||"0"}:(e=p.exec(d))?{browser:e[1]||"Opera",version:e[2]||"0"}:(e=k.exec(d))?{browser:e[1]||"Chrome",version:e[2]||"0"}:(e=f.exec(d))?{browser:e[2]||"Safari",version:e[1]||
"0"}:{browser:"unknown",version:"unknown"}}(window.navigator.userAgent.toLowerCase()),q=navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage||navigator.language;return{versions:function(){var a=navigator.userAgent;return{edge:-1<a.indexOf("Edge"),trident:-1<a.indexOf("Trident"),presto:-1<a.indexOf("Presto"),webKit:-1<a.indexOf("AppleWebKit"),gecko:-1<a.indexOf("Gecko")&&-1==a.indexOf("KHTML"),mobile:!!a.match(/AppleWebKit.*Mobile.*/),ios:!!a.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),
android:-1<a.indexOf("Android")||-1<a.indexOf("Linux"),iPhone:-1<a.indexOf("iPhone"),iPad:-1<a.indexOf("iPad"),webApp:-1==a.indexOf("Safari")}}(),language:q?q.toLowerCase():void 0,info:{browserName:m.browser,browserVersion:m.version,appCodeName:navigator.appCodeName,appMinorVersion:navigator.appMinorVersion,appName:navigator.appName,appVersion:navigator.appVersion,browserLanguage:navigator.browserLanguage,cookieEnabled:navigator.cookieEnabled,cpuClass:navigator.cpuClass,onLine:navigator.onLine,platform:navigator.platform,
systemLanguage:navigator.systemLanguage,userAgent:navigator.userAgent,userLanguage:navigator.userLanguage}}},getJsonLength:function(a){var b=0;if("object"===typeof a)for(var c in a)a.hasOwnProperty(c)&&++b;return b},detectOS:function(){try{var a=navigator.userAgent,b="Win32"===navigator.platform||"Windows"===navigator.platform,c="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform;if(c)return"Mac";if("X11"===navigator.platform&&
!b&&!c)return"Unix";if(-1<String(navigator.platform).indexOf("Linux"))return"Linux";if(b){if(-1<a.indexOf("Windows NT 5.0")||-1<a.indexOf("Windows 2000"))return"Win2000";if(-1<a.indexOf("Windows NT 5.1")||-1<a.indexOf("Windows XP"))return"WinXP";if(-1<a.indexOf("Windows NT 5.2")||-1<a.indexOf("Windows 2003"))return"Win2003";if(-1<a.indexOf("Windows NT 6.0")||-1<a.indexOf("Windows Vista"))return"WinVista";if(-1<a.indexOf("Windows NT 6.1")||-1<a.indexOf("Windows 7"))return"Win7";if(-1<a.indexOf("Windows NT 6.2")||
-1<a.indexOf("Windows 8"))return"Win8";if(-1<a.indexOf("Windows NT 10.0")||-1<a.indexOf("Windows 10"))return"Win10"}return"Other"}catch(p){return L.Logger.error("[tk-sdk]detectOS method error:",p),"Other"}},isFunction:function(a){return"function"===typeof a},isString:function(a){return"string"===typeof a},isNumber:function(a){return"number"===typeof a},isBoolean:function(a){return"boolean"===typeof a},isNull:function(a){return!a&&0!==a&&"boolean"!==typeof a},getFileName:function(a){if("string"!==
typeof a)return"";var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");return a.substring(Math.max(b,c)+1)}}}(L);window.TK=window.TK||{};window.TK_ERR={DEVICE_ERROR_UnknownError:1E4,DEVICE_ERROR_NotFoundError:10001,DEVICE_ERROR_NotAllowedError:10002,DEVICE_ERROR_NotReadableError:10003,DEVICE_ERROR_OverconstrainedError:10004,DEVICE_ERROR_TypeError:10005};window.TK_VIDEO_MODE={ASPECT_RATIO_CONTAIN:20001,ASPECT_RATIO_COVER:20002};window.TK.ERROR_CODE={};window.TK.ROOM_ROLE={TEACHER:0,ASSISTANT:1,STUDENT:2,AUDIT:3,PATROL:4,SYSTEM_ADMIN:10,ENTERPRISE_ADMIN:11,ADMIN:12,PLAYBACK:-1};
window.TK.ROOM_MODE={NORMAL_ROOM:"normalRoom",BIG_ROOM:"bigRoom"};window.TK=window.TK||{};TK.mediaStream=void 0;
TK.DeviceMgr=function(){function b(a,b,c){b=void 0!==b?b:!0;c=void 0!==c?c:!0;if(b&&c&&a&&a.getTracks&&"function"===typeof a.getTracks){if((a=a.getTracks())&&0<a.length)for(c=0;c<a.length;c++)a[c]&&a[c].stop&&"function"===typeof a[c].stop&&a[c].stop()}else{if(b&&a&&a.getVideoTracks&&"function"===typeof a.getVideoTracks&&(b=a.getVideoTracks())&&0<b.length)for(var d=0;d<b.length;d++)b[d]&&b[d].stop&&"function"===typeof b[d].stop&&b[d].stop();if(c&&a&&a.getAudioTracks&&"function"===typeof a.getAudioTracks&&
(a=a.getAudioTracks())&&0<a.length)for(c=0;c<a.length;c++)a[c]&&a[c].stop&&"function"===typeof a[c].stop&&a[c].stop()}}function a(a,b,c){if(TK.roomInstance){var d="",e=window.TK_ERR.DEVICE_ERROR_UnknownError;"object"===typeof a&&(d=a.name);switch(d){case "NotFoundError":case "DevicesNotFoundError":e=window.TK_ERR.DEVICE_ERROR_NotFoundError;break;case "NotAllowedError":case "PermissionDeniedError":e=window.TK_ERR.DEVICE_ERROR_NotAllowedError;break;case "NotReadableError":case "TrackStartError":e=window.TK_ERR.DEVICE_ERROR_NotReadableError;
break;case "OverconstrainedError":case "ConstraintNotSatisfiedError":e=window.TK_ERR.DEVICE_ERROR_OverconstrainedError;break;case "TypeError":e=window.TK_ERR.DEVICE_ERROR_TypeError}L.Logger.warning("[tk-sdk]device-not-available , error code is "+e+"  , kind is "+b+" , deviceId is "+c);a=TK.RoomEvent({type:"device-not-available",message:{kind:b,deviceId:c}},{code:e});TK.roomInstance.dispatchEvent(a)}}var c={room_video_width:320,room_video_height:240,room_video_fps:10,streamJson:{selectStream:void 0},
onDevicesSetted:null,onDeviceChanged:null},e=null,d=null,l=null,p=void 0;c.setAVMgrProperty=function(a){for(var b in a)c.hasOwnProperty(b)&&(c[b]=a[b])};var k=function(a,b,c){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(a).then(b).catch(c):(navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getMedia(a,b,c))},f=function(d,e,f){L.Logger.debug("[tk-sdk]checkGetUserMediaing , videoinputDeviceId:"+
e+" , audioinputDeviceId:"+f);d&&"function"===typeof d||L.Logger.error("[tk-sdk]checkGetUserMedia callback must function");var h=!1,r=!1,m,q,u=function(){h&&r&&d({videoinput:{old:e,now:m},audioinput:{old:f,now:q}})},l=function(a){L.Logger.debug("[tk-sdk]checkGetUserMedia video finshed , videoinputDeviceId:"+e+" , successVideoinputId:"+a);h=!0;m=a;u()},p=function(a){L.Logger.debug("[tk-sdk]checkGetUserMedia audio finshed , audioinputDeviceId:"+f+" , successAudioinputId:"+a);r=!0;q=a;u()};k({audio:{deviceId:{exact:f}},
video:{deviceId:{exact:e}}},function(a){b(a,!0,!0);l(e);p(f)},function(d){k({audio:!1,video:{deviceId:{exact:e}}},function(a){b(a,!0,!1);l(e)},function(d){a(d,"videoinput",e);c.enumerateDevices(function(a){if(a&&a.devices&&a.devices.videoinput){var c=a.devices.videoinput;if(c&&0<c.length){var d=c[0],e=function(a){k({audio:!1,video:{deviceId:{exact:a}}},function(d){c.shift();b(d,!0,!1);l(a)},function(a){c.shift();(d=c[0])?e(d.deviceId):l()})};d?e(d.deviceId):l()}else l()}else l()})});k({video:!1,audio:{deviceId:{exact:f}}},
function(a){b(a,!1,!0);p(f)},function(d){a(d,"audioinput",f);c.enumerateDevices(function(a){if(a&&a.devices&&a.devices.audioinput){var c=a.devices.audioinput;if(c&&0<c.length){var d=c[0],e=function(a){k({video:!1,audio:{deviceId:{exact:a}}},function(d){c.shift();b(d,!1,!0);p(a)},function(a){c.shift();(d=c[0])?e(d.deviceId):p()})};d?e(d.deviceId):p()}else p()}else p()})})})},m=function(b,d,e,f){var h=void 0,r,m={};var q=function(d){var e=h&&"string"===typeof h?L.Utils.toJsonParse(h):h;d.customdata_createID=
(new Date).getTime();d.customdata_deviceJsonId={};e&&(e.video&&"object"===typeof e.video&&(d.customdata_deviceJsonId.videoinput="object"===typeof e.video.deviceId?e.video.deviceId.exact:e.video.deviceId),e.audio&&"object"===typeof e.audio&&(d.customdata_deviceJsonId.audioinput="object"===typeof e.audio.deviceId?e.audio.deviceId.exact:e.audio.deviceId));c.streamJson.selectStream=d;e={videoTracks:!0,audioTracks:!0};if(d){var k=d.getVideoTracks?d.getVideoTracks():void 0,q=d.getAudioTracks?d.getAudioTracks():
void 0;k&&0<k.length||(e.videoTracks=!1,L.Logger.warning("[tk-sdk]getUserMedia stream is  not videoTracks  , currUserMediaConfig info:"+h+"!"));q&&0<q.length||(e.audioTracks=!1,L.Logger.warning("[tk-sdk]getUserMedia stream is  not audioTracks  , currUserMediaConfig info:"+h+"!"))}else L.Logger.error("[tk-sdk]getUserMedia stream is not exist!"),e.videoTracks=!1,e.audioTracks=!1;k=[];k.push(d);k.push(e);d.customdata_tracksInfo=e;f&&f.externalJson&&void 0!==f.externalJson.getUserMediaFailureCode&&(d.getUserMediaFailureCode=
f.externalJson.getUserMediaFailureCode);f.isNeedCheckChangeLocalStream&&f.deviceInfo.initDeviceId.audioinput!==d.customdata_deviceJsonId.audioinput&&(L.Logger.info("[tk-sdk]getUserMedia changed audioinput device , old device id is "+f.deviceInfo.initDeviceId.audioinput+" , now device id is "+d.customdata_deviceJsonId.audioinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,d.customdata_deviceJsonId.audioinput||""));f.isNeedCheckChangeLocalStream&&f.deviceInfo.initDeviceId.videoinput!==
d.customdata_deviceJsonId.videoinput&&(L.Logger.info("[tk-sdk]getUserMedia changed videoinput device , old device id is "+f.deviceInfo.initDeviceId.videoinput+" , now device id is "+d.customdata_deviceJsonId.videoinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,d.customdata_deviceJsonId.videoinput||""));f&&f.dispatchEvent&&(q=L.Constant.getUserMedia.SUCCESS_ALL,e.videoTracks||e.audioTracks?e.videoTracks?e.audioTracks||(q=L.Constant.getUserMedia.SUCCESS_ONLY_VIDEO):q=L.Constant.getUserMedia.SUCCESS_ONLY_AUDIO:
q=L.Constant.getUserMedia.SUCCESS_NOT_ALL,TK&&TK.coreEventController&&TK.coreEventController.dispatchEvent({type:"getUserMedia_success",message:{mediaStream:d,customdata_tracksInfo:e,code:q,externalJson:f.externalJson}},!1));f.isDemotionLocalStream&&(e=r&&"string"===typeof r?L.Utils.toJsonParse(r):r,m.videoinput&&!d.customdata_deviceJsonId.videoinput&&e.video&&"object"===typeof e.video&&a(m.videoinput,"videoinput","object"===typeof e.video.deviceId?e.video.deviceId.exact:e.video.deviceId),m.audioinput&&
!d.customdata_deviceJsonId.audioinput&&e.audio&&"object"===typeof e.audio&&a(m.audioinput,"audioinput","object"===typeof e.audio.deviceId?e.audio.deviceId.exact:e.audio.deviceId));b.apply(b,k)};var u=function(b){L.Logger.error("[tk-sdk]getUserMedia error info: name is "+b.name+" , message is "+b.message+" , constraintName is "+b.constraintName);var c=h&&"string"===typeof h?L.Utils.toJsonParse(h):h,e=r&&"string"===typeof r?L.Utils.toJsonParse(r):r;if(f.isDemotionLocalStream){if(c.video&&"object"===
typeof c.video&&!f.deviceInfo.demotion.videoinput){f.deviceInfo.demotion.videoinput=!0;e.video=!1;f.externalJson.getUserMediaFailureCode=L.Constant.getUserMedia.FAILURE_USERMEDIA_AGAIN_ONLY_GET_AUDIO;L.Logger.warning("[tk-sdk]Gets the data stream failed and now only gets the audio device stream , oldUserMediaConfig info:"+h+" , nowUserMediaConfig info:"+L.Utils.toJsonStringify(e)+"!");f&&f.dispatchEvent&&TK&&TK.coreEventController&&TK.coreEventController.dispatchEvent({type:"getUserMedia_failure_reGetOnlyAudioStream",
message:{errorMsg:k,code:L.Constant.getUserMedia.FAILURE_USERMEDIA_AGAIN_ONLY_GET_AUDIO,externalJson:f.externalJson}},!1);m.videoinput=b;l(e);return}if(c.audio&&"object"===typeof c.audio&&!f.deviceInfo.demotion.audioinput){f.deviceInfo.demotion.audioinput=!0;e.audio=!1;f.externalJson.getUserMediaFailureCode=L.Constant.getUserMedia.FAILURE_USERMEDIA_AGAIN_ONLY_GET_VIDEO;L.Logger.warning("[tk-sdk]Gets the data stream failed and now only gets the video device stream , oldUserMediaConfig info:"+h+" , nowUserMediaConfig info:"+
L.Utils.toJsonStringify(e)+"!");f&&f.dispatchEvent&&TK&&TK.coreEventController&&TK.coreEventController.dispatchEvent({type:"getUserMedia_failure_reGetOnlyVideoStream",message:{errorMsg:k,code:L.Constant.getUserMedia.FAILURE_USERMEDIA_AGAIN_ONLY_GET_VIDEO,externalJson:f.externalJson}},!1);m.audioinput=b;l(e);return}}var k="[tk-sdk]Gets the data stream failed[video , audio] ,currUserMediaConfig info:"+h+"!";L.Logger.warning(k);f.externalJson.getUserMediaFailureCode=L.Constant.getUserMedia.FAILURE_ALL;
f&&f.dispatchEvent&&TK&&TK.coreEventController&&TK.coreEventController.dispatchEvent({type:"getUserMedia_failure",message:{errorMsg:k,code:L.Constant.getUserMedia.FAILURE_ALL,externalJson:f.externalJson}},!1);f.isDemotionLocalStream&&(m.videoinput&&e.video&&"object"===typeof e.video&&a(m.videoinput,"videoinput","object"===typeof e.video.deviceId?e.video.deviceId.exact:e.video.deviceId),m.audioinput&&e.audio&&"object"===typeof e.audio&&a(m.audioinput,"audioinput","object"===typeof e.audio.deviceId?
e.audio.deviceId.exact:e.audio.deviceId),e.audio||e.video||(a(b,"videoinput",""),a(b,"audioinput","")));if(d&&"function"===typeof d){c=[];for(e=0;e<arguments.length;e++)c[e]=arguments[e];f&&f.externalJson&&void 0!==f.externalJson.getUserMediaFailureCode&&c.push({getUserMediaFailureCode:f.externalJson.getUserMediaFailureCode});d.apply(d,c)}};var l=function(a){h=a&&"object"===typeof a?L.Utils.toJsonStringify(a):a;r||(r=h);k(a,q,u)};l(e)},q=function(a,b){var d={video:{},audio:{}};a?(void 0!==a.audio&&
(d.audio=a.audio),void 0!==a.video&&(d.video=a.video),d.audio&&"object"===typeof d.audio&&void 0!==d.audio.sourceId&&(d.audio.deviceId=d.audio.sourceId,delete d.audio.sourceId),d.video&&"object"===typeof d.video&&void 0!==d.video.sourceId&&(d.video.deviceId=d.video.sourceId,delete d.video.sourceId)):(d.audio.deviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),d.video.deviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput));if(d.video&&"object"===typeof d.video){a=
c.room_video_width||320;var e=c.room_video_width||320,f=c.room_video_height||240,h=c.room_video_height||240,k=Number(c.room_video_fps||10),m=Number(c.room_video_fps||10);void 0===d.video.width&&(d.video.width={ideal:a,max:e});void 0===d.video.height&&(d.video.height={ideal:f,max:h});void 0===d.video.frameRate&&(d.video.frameRate={ideal:k,max:m})}b.audio.sourceId?(d.audio="object"===typeof d.audio?d.audio:{},d.audio.deviceId=b.audio.sourceId):b.audio.deviceId&&(d.audio="object"===typeof d.audio?d.audio:
{},d.audio.deviceId=b.audio.deviceId);b.video.sourceId?(d.video="object"===typeof d.video?d.video:{},d.video.deviceId=b.video.sourceId):b.video.deviceId&&(d.video="object"===typeof d.video?d.video:{},d.video.deviceId=b.video.deviceId);b.exclude&&b.exclude.audio?d.audio=!1:d.audio&&"object"===typeof d.audio&&void 0!==d.audio.deviceId&&(d.audio.deviceId="object"!==d.audio.deviceId?{exact:d.audio.deviceId}:d.audio.deviceId);b.exclude&&b.exclude.video?d.video=!1:d.video&&"object"===typeof d.video&&void 0!==
d.video.deviceId&&(d.video.deviceId="object"!==d.video.deviceId?{exact:d.video.deviceId}:d.video.deviceId);return d};c.getUserMedia=function(a,b,d,e){e=void 0!=e&&null!=e&&"object"===typeof e?e:{video:{},audio:{},exclude:{}};var h=function(){e.video=e.video||{};e.audio=e.audio||{};e.exclude=e.exclude||{};e.externalJson=e.externalJson||{};e.deviceInfo={initDeviceId:{videoinput:void 0,audioinput:void 0},demotion:{videoinput:!1,audioinput:!1}};d=q(d,e);d.audio&&"object"===typeof d.audio&&(e.deviceInfo.initDeviceId.audioinput=
"object"===typeof d.audio.deviceId?d.audio.deviceId.exact:d.audio.deviceId);d.video&&"object"===typeof d.video&&(e.deviceInfo.initDeviceId.videoinput="object"===typeof d.video.deviceId?d.video.deviceId.exact:d.video.deviceId);!e.isNeedCheckChangeLocalStream&&TK.isInnerVersions&&(d.video&&"object"===typeof d.video&&("object"===typeof d.video.deviceId?d.video.deviceId.exact||(d.video=!1):d.video.deviceId||(d.video=!1)),d.audio&&"object"===typeof d.audio&&("object"===typeof d.audio.deviceId?d.audio.deviceId.exact||
(d.audio=!1):d.audio.deviceId||(d.audio=!1)));e.isNeedCheckChangeLocalStream?f(function(c){var f=c.videoinput;c=c.audioinput;d.video&&"object"===typeof d.video&&f.old!==f.now?f.now?d.video.deviceId={exact:f.now}:d.video=!1:f.old||(d.video=!1);d.audio&&"object"===typeof d.audio&&c.old!==c.now?c.now?d.audio.deviceId={exact:c.now}:d.audio=!1:c.old||(d.audio=!1);m(a,b,d,e)},e.deviceInfo.initDeviceId.videoinput,e.deviceInfo.initDeviceId.audioinput):m(a,b,d,e)};!e.isNeedCheckChangeLocalStream||L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)&&
L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)?h():c.enumerateDevices(function(a){h()},{isSetlocalStorage:!0})};c.enumerateDevices=function(a,b){function c(c){var d=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),e=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),f=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput),h={},k={},m={hasdevice:{audioinput:!1,audiooutput:!1,videoinput:!1},devices:{audioinput:[],audiooutput:[],videoinput:[]},
useDevices:{}},q=L.Utils.getBrowserInfo();q=q&&q.language&&q.language.toLowerCase().match(/zh/g)?"chinese":"english";var u={videoinput:{label:"chinese"===q?"\u89c6\u9891\u8f93\u5165\u8bbe\u5907":"video input device ",num:0},audioinput:{label:"chinese"===q?"\u97f3\u9891\u8f93\u5165\u8bbe\u5907":"audio input device ",num:0},audiooutput:{label:"chinese"===q?"\u97f3\u9891\u8f93\u5165\u8bbe\u5907":"audio output device ",num:0}};c&&c.forEach&&c.forEach(function(a){if(a&&"communications"!=a.groupId&&"communications"!=
a.deiceId&&"\u901a\u8baf"!=a.label){var b={kind:a.kind,label:a.label,deviceId:a.deviceId,groupId:a.groupId};!b.label&&u[a.kind]&&(b.label=u[a.kind].label+ ++u[a.kind].num);"audioinput"===a.kind&&a.deviceId===d&&(m.useDevices[a.kind]=a.deviceId);"videoinput"===a.kind&&a.deviceId===e&&(m.useDevices[a.kind]=a.deviceId);"audiooutput"===a.kind&&a.deviceId===f&&(m.useDevices[a.kind]=a.deviceId);h[a.kind]=h[a.kind]||a.deviceId;m.devices[a.kind].push(b);m.hasdevice[a.kind]=!0;"default"===a.deviceId&&(k[a.kind]=
a.deviceId)}});m.useDevices.audioinput||(m.useDevices.audioinput=k.audioinput||h.audioinput||"");m.useDevices.videoinput||(m.useDevices.videoinput=k.videoinput||h.videoinput||"");m.useDevices.audiooutput||(m.useDevices.audiooutput=k.audiooutput||h.audiooutput||"");L.Utils.localStorage?b.isSetlocalStorage&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,m.useDevices.audioinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,m.useDevices.videoinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,
m.useDevices.audiooutput)):L.Logger.error("[tk-sdk]not support localStorage");L.Logger.info("[tk-sdk]enumerateDevices devicesInfo:",L.Utils.toJsonStringify(m));a&&"function"===typeof a&&a(m)}b=b||{};L.Logger.debug("[tk-sdk]call enumerateDevices!");b.isSetlocalStorage=void 0!=b.isSetlocalStorage?b.isSetlocalStorage:!1;(function(a){var b=[];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return L.Logger.error("[tk-sdk]navigator.mediaDevices.enumerateDevices method not supported."),
a&&"function"===typeof a&&a(b),null;navigator.mediaDevices.enumerateDevices().then(function(c){var d={};c.forEach(function(a){L.Logger.debug("[tk-sdk]"+a.kind+": "+a.label+" id \x3d "+a.deviceId,a);d[a.kind]=d[a.kind]||{};var c={kind:a.kind,label:a.label,deviceId:a.deviceId,groupId:a.groupId};d[a.kind][a.deviceId]=c;b.push(c)});L.Logger.debug("[tk-sdk]enumerateDevices devices:"+L.Utils.toJsonStringify(d));a&&"function"===typeof a&&a(b)}).catch(function(c){L.Logger.error("[tk-sdk]enumerateDevices error :"+
c.name+": "+c.message);a&&"function"===typeof a&&a(b);throw c;})})(function(a){c(a)})};c.getsSoundMeterInstance=function(a){if(a)return new function(a){var b=this;b.audioContext=a;b.instant=0;b.slow=0;b.clip=0;b.script=b.audioContext.createScriptProcessor(2048,1,1);b.script.onaudioprocess=function(a){a=a.inputBuffer.getChannelData(0);var c,d=0,e=0;for(c=0;c<a.length;++c)d+=a[c]*a[c],.99<Math.abs(a[c])&&(e+=1);b.instant=Math.sqrt(d/a.length);b.slow=.95*b.slow+.05*b.instant;b.clip=e/a.length};b.connectToSource=
function(a,c){L.Logger.debug("SoundMeter connecting");try{b.mic=b.audioContext.createMediaStreamSource(a),b.mic.connect(b.script),b.script.connect(b.audioContext.destination),"undefined"!==typeof c&&c(null)}catch(E){L.Logger.error("[tk-sdk]connecToSource error:",E),"undefined"!==typeof c&&c(E)}};b.stop=function(){b.mic&&b.mic.disconnect&&b.mic.disconnect();b.script&&b.script.disconnect&&b.script.disconnect()};return b}(a);L.Logger.error("[tk-sdk]getsSoundMeterInstance audioContext is not exist!")};
c.setElementSinkIdToAudioouputDevice=function(a,b,c){if(b=b||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput))if(TK.isTkNative&&TK.subscribe_from_native)b=b||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput),window.tknative.postMessage({command:"setSpeaker",deviceId:b}),c&&"function"===typeof c&&c(!1);else{var d=0,e=function(a,e,f){if(a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&b)if(a.setSinkId)try{a.setSinkId(b).then(function(){var e=a.getAttribute("id");
L.Logger.debug("[tk-sdk]Audio output device set to "+b,e?" , element id is "+e:"  element:",e?"":a);d++;d===f&&c&&"function"===typeof c&&c(!0)}).catch(function(b){var e=void 0,h=a.getAttribute("id");b&&"SecurityError"===b.name&&(e="You need to use HTTPS for selecting audio output device  ");L.Logger.warning("[tk-sdk]setSinkId error:",b,e?e:"",h?" , element id is "+h:"  element:",h?"":a);d++;d===f&&c&&"function"===typeof c&&c(!1)})}catch(ba){e=a.getAttribute("id"),L.Logger.error("[tk-sdk]setSinkId err:",
ba,e?" , element id is "+e:"  element:",e?"":a),d++,d===f&&c&&"function"===typeof c&&c(!1)}else e=a.getAttribute("id"),L.Logger.error("[tk-sdk]The browser does not support the setSinkId method,audiooutputDeviceId :",b,e?" , element id is "+e:"  element:",e?"":a),d++,d===f&&c&&"function"===typeof c&&c(!1);else d++,d===f&&c&&"function"===typeof c&&c(!1)};if(!a){a=[];var f=document.getElementsByTagName("audio"),h=document.getElementsByTagName("video");if(f&&0<f.length)for(var k=0;k<f.length;k++){var m=
f[k];a.push(m)}if(h&&0<h.length)for(k=0;k<h.length;k++)m=h[k],a.push(m)}if(a&&0<a.length)for(f=a.length,k=0;k<a.length;k++)m=a[k],e(m,k,f);else e(a,0,1)}else c&&"function"===typeof c&&c(!1)};c.changeLocalDeviceToLocalstream=function(a,b,d,e){var f={};b=b||{};for(var h in b)L.Constant.deviceStorage[h]&&b[h]!==L.Utils.localStorage.getItem(L.Constant.deviceStorage[h])&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage[h],b[h]),f[h]=!0);!f.videoinput&&!f.audioinput&&TK&&TK.default_stream&&TK.default_stream.stream&&
(b.videoinput&&TK.default_stream.stream.getVideoTracks&&TK.default_stream.stream.getVideoTracks()&&0===TK.default_stream.stream.getVideoTracks().length&&(f.videoinput=!0),b.audioinput&&TK.default_stream.stream.getAudioTracks&&TK.default_stream.stream.getAudioTracks()&&0===TK.default_stream.stream.getAudioTracks().length&&(f.audioinput=!0));f.audiooutput&&c.setElementSinkIdToAudioouputDevice(e);f.videoinput||f.audioinput?c.getUserMedia(function(b){a&&"function"===typeof a&&a(b);d&&"function"===typeof d&&
d(b,0)},function(a){d&&"function"===typeof d&&d(void 0,0)},void 0,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!1,isStopLocalStream:!1}):f.audiooutput?d&&"function"===typeof d&&d(void 0,1):d&&"function"===typeof d&&d(void 0,2)};c.addOndevicechange=function(a){if(!navigator.mediaDevices)return L.Logger.error("Browser does not support navigator.mediaDevices!"),!1;if(navigator.mediaDevices)return navigator.mediaDevices.ondevicechange=null,navigator.mediaDevices.ondevicechange=function(b){L.Logger.error("[tk-sdk]AVMgr:ondevicechange event:",
b);a&&"function"===typeof a&&a(b)},!0};c.removeOndevicechange=function(){if(!navigator.mediaDevices)return L.Logger.error("Browser does not support navigator.mediaDevices!"),!1;if(!navigator.mediaDevices.ondevicechange)return!1;navigator.mediaDevices.ondevicechange=null;return!0};var w=function(a){L.Logger.debug("[tk-sdk]DeviceMgr:onDeviceChangeEvent. event:",a);if(void 0!==c.onDeviceChanged&&null!==c.onDeviceChanged&&L.Utils.isFunction(c.onDeviceChanged))c.onDeviceChanged(a);void 0!==p&&null!==p&&
L.Utils.isFunction(p)&&p(a)};navigator.mediaDevices?navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=w):L.Logger.error("Browser does not support navigator.mediaDevices!");c.addDeviceChangeListener=function(a){p=null;p=a};c.removeDeviceChangeListener=function(){p=null};c.stopStreamTracks=function(a,c,d){b(a,c,d)};c.enabledStreamVideoTrack=function(a,b){if(a&&a.getVideoTracks&&"function"===typeof a.getVideoTracks&&(a=a.getVideoTracks())&&0<a.length)for(var c=0;c<a.length;c++)a[c].enabled!==
b&&(a[c].enabled=b)};c.enabledStreamAudioTrack=function(a,b){if(a&&a.getAudioTracks&&"function"===typeof a.getAudioTracks&&(a=a.getAudioTracks())&&0<a.length)for(var c=0;c<a.length;c++)a[c].enabled!==b&&(a[c].enabled=b)};c.playDeviceStream=function(a,b,c,d){d=d||{};a?b?(a.videoPlayer&&a.videoPlayer.destroy&&a.videoPlayer.destroy(),a.videoPlayer=TK.VideoPlayer({id:"deviceStream_"+(new Date).getTime(),stream:{stream:a},elementID:b,options:d}),"function"===typeof c&&c(a.videoPlayer)):L.Logger.error("[tk-sdk]playDeviceStream elementID can not be empty!"):
L.Logger.error("[tk-sdk]playDeviceStream stream can not be empty!")};c.unplayDeviceStream=function(a){a?a&&a.videoPlayer&&a.videoPlayer.destroy&&(a.videoPlayer.destroy(),a.videoPlayer=void 0,delete a.videoPlayer):L.Logger.error("[tk-sdk]unplayDeviceStream stream can not be empty!")};c.stopCameraTest=function(){e&&(c.unplayDeviceStream(e),c.stopStreamTracks(e),e=null)};c.startCameraTest=function(a,b,d){a?b?(c.stopCameraTest(),c.getUserMedia(function(a){e=a;c.playDeviceStream(e,b)},function(a){L.Utils.isFunction(d)&&
d(a);L.Logger.error("[tk-sdk] getUserMedia failed when test camera, failure info:",a)},{video:{sourceId:a},audio:!1})):(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("startCameraTest got invalid elementId")):(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("startCameraTest got invalid deviceId"))};c.stopMicrophoneTest=function(){l&&l.stopIntervalGetRealtimeVolume&&(l.stopIntervalGetRealtimeVolume(),l=null);d&&(c.unplayDeviceStream(d),c.stopStreamTracks(d),d=null)};c.startMicrophoneTest=
function(a,b,e,f){a?b?(c.stopMicrophoneTest(),c.getUserMedia(function(a){d=a;c.playDeviceStream(d,b,function(a){(l=a)&&l.startIntervalGetRealtimeVolume&&l.startIntervalGetRealtimeVolume(function(a){L.Utils.isFunction(e)&&e(a)})})},function(a){L.Utils.isFunction(f)&&f(a);L.Logger.error("[tk-sdk] getUserMedia failed when test microphone, failure info:",a)},{audio:{sourceId:a},video:!1})):(L.Utils.isFunction(f)&&f("TK_ERR_INVALID_ARG"),L.Logger.error("startMicrophoneTest got invalid elementId")):(L.Utils.isFunction(f)&&
f("TK_ERR_INVALID_ARG"),L.Logger.error("startMicrophoneTest got invalid deviceId"))};c.associateElementsToSpeaker=function(a,b,d){c.setElementSinkIdToAudioouputDevice(a,b,d)};c.getDevices=function(a){c.enumerateDevices(a)};c.setDevices=function(a,b){c.changeLocalDeviceToLocalstream(c.onDevicesSetted,a,function(a,c){a||0!==c||L.Utils.isFunction(b)&&b()})};return c}(TK);window.TK=window.TK||{};
TK.NativeAVMgr=function(){var b={room_video_width:320,room_video_height:240,room_video_fps:10,onMicVolumeReportCallback:void 0,onDevicesSetted:null,onDeviceChanged:null},a={},c={},e=100,d={player:null},l=null;b.setAVMgrProperty=function(a){for(var c in a)b.hasOwnProperty(c)&&(b[c]=a[c])};window.tknative.addEventListener("message",function(d){if(!L.Utils.isNull(d)&&!L.Utils.isNull(d.data)&&!L.Utils.isNull(d.data.name)){var e=d.data.name;if("onEnumerateDevices"===e){var k=function(){var b=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),
e=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),f=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);L.Logger.debug("devices in enumerateDevices(client):",d.data);var k=d.data.audioinput,m=d.data.videoinput,q=d.data.audiooutput,l=d.data.seq,p={},Z={},C={hasdevice:{audioinput:!1,audiooutput:!1,videoinput:!1},devices:{audioinput:[],audiooutput:[],videoinput:[]},useDevices:{}},Q=L.Utils.getBrowserInfo();Q=Q&&Q.language&&Q.language.toLowerCase().match(/zh/g)?"chinese":
"english";var X={videoinput:{label:"chinese"===Q?"\u89c6\u9891\u8f93\u5165\u8bbe\u5907":"video input device ",num:0},audioinput:{label:"chinese"===Q?"\u97f3\u9891\u8f93\u5165\u8bbe\u5907":"audio input device ",num:0},audiooutput:{label:"chinese"===Q?"\u97f3\u9891\u8f93\u5165\u8bbe\u5907":"audio output device ",num:0}},R=function(a){if(null!=a&&"communications"!=a.groupId&&"communications"!=a.deiceId&&"\u901a\u8baf"!=a.label){var c={kind:a.kind,label:a.label,deviceId:a.deviceId,groupId:a.groupId};
!c.label&&X[a.kind]&&(c.label=X[a.kind].label+ ++X[a.kind].num);"audioinput"===a.kind&&a.deviceId===b&&(C.useDevices[a.kind]=a.deviceId);"videoinput"===a.kind&&a.deviceId===e&&(C.useDevices[a.kind]=a.deviceId);"audiooutput"===a.kind&&a.deviceId===f&&(C.useDevices[a.kind]=a.deviceId);p[a.kind]=p[a.kind]||a.deviceId;C.devices[a.kind].push(c);C.hasdevice[a.kind]=!0;"default"===a.deviceId&&(Z[a.kind]=a.deviceId)}};Array.isArray(k)&&k.forEach(function(a){R(a)});Array.isArray(m)&&m.forEach(function(a){R(a)});
Array.isArray(q)&&q.forEach(function(a){R(a)});C.useDevices.audioinput||(C.useDevices.audioinput=Z.audioinput||p.audioinput||"");C.useDevices.videoinput||(C.useDevices.videoinput=Z.videoinput||p.videoinput||"");C.useDevices.audiooutput||(C.useDevices.audiooutput=Z.audiooutput||p.audiooutput||"");L.Utils.localStorage?c[l].isSetlocalStorage&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,C.useDevices.audioinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,C.useDevices.videoinput),
L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,C.useDevices.audiooutput)):L.Logger.error("not support localStorage");a[l]&&(a[l](C),delete a[l]);c[l]&&delete c[l]};TK.isTkNative&&TK.subscribe_from_native?k():navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(a){var b=[];a.forEach(function(a){"audiooutput"===a.kind&&b.push({kind:a.kind,label:a.label,deviceId:a.deviceId,groupId:a.groupId})});d.data.audiooutput=b;
k()}).catch(function(a){L.Logger.error("[tk-sdk]enumerateDevices error :"+a.name+": "+a.message);d.data.audiooutput=[];k()}):(L.Logger.error("[tk-sdk]navigator.mediaDevices.enumerateDevices method not supported."),d.data.audiooutput=[],k())}if("onMicVolumeReport"===e){var q=d.data.volume;if(null===q||void 0===q)return;if(a["detecte-mic-callback"]&&"function"===typeof a["detecte-mic-callback"])a["detecte-mic-callback"](q);if(b.onMicVolumeReportCallback&&"function"===typeof b.onMicVolumeReportCallback)b.onMicVolumeReportCallback(q/
100,d.data.connectionId)}"onGetSpeakerVolume"===e&&(q=d.data.volume,e=d.data.seq,"function"===typeof a[e]&&(q=Math.round(q/2.55),a[e](q),delete a[e]))}},!1);var p=function(a,c,d,e){var f=function(b){window.tknative.postMessage({command:"setCamera",deviceId:b.video.deviceId,width:Number(b.video.width),height:Number(b.video.height),fps:Number(b.video.frameRate)});window.tknative.postMessage({command:"setMicrophone",deviceId:b.audio.deviceId});a(null)};d=d||{audio:{},video:{}};if(d.screen)L.Logger.debug("[tk-sdk]Screen access requested!"),
a(null);else{var k={video:{},audio:{},screen:d.screen};"object"===typeof d.audio&&(k.audio=d.audio);e=void 0!=e&&null!=e&&"object"===typeof e?e:{video:{},audio:{},exclude:{}};e.video=e.video||{};e.audio=e.audio||{};var h=d.audio.mandatory||{sourceId:e.audio.sourceId||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)||""},m=d.video.mandatory||{sourceId:e.video.sourceId||L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)||"",idealWidth:b.room_video_width||320,maxWidth:b.room_video_width||
320,idealHeight:b.room_video_height||240,maxHeight:b.room_video_height||240};k.video.width=m.maxWidth;k.video.height=m.maxHeight;void 0!==d.video.optional?k.video.frameRate=d.video.optional[1].maxFrameRate:(c={idealFrameRate:Number(b.room_video_fps||10),maxFrameRate:Number(b.room_video_fps||10)},void 0!=c.idealFrameRate&&void 0!=c.maxFrameRate?k.video.frameRate=c.maxFrameRate:void 0!=c.frameRate&&(k.video.frameRate=c.frameRate));m.sourceId&&h.sourceId?(null!==h.sourceId&&void 0!==h.sourceId?k.audio.deviceId=
h.sourceId:k.audio=!1,null!==m.sourceId&&void 0!==m.sourceId?k.video.deviceId=m.sourceId:k.video=!1,e.exclude&&e.exclude.video?k.video=!1:e.exclude&&e.exclude.audio&&(k.audio=!1),f(k)):b.enumerateDevices(function(a){var b=a.useDevices;a=a.hasdevice;null===a.videoinput||void 0===a.videoinput||null===b.videoinput||void 0===b.videoinput||m.sourceId||(m.sourceId=b.videoinput,L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,m.sourceId));null===a.audioinput||void 0===a.audioinput||null===
b.audioinput||void 0===b.audioinput||h.sourceId||(h.sourceId=b.audioinput,L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,h.sourceId));null!==h.sourceId&&void 0!==h.sourceId?k.audio.deviceId=h.sourceId:k.audio=!1;null!==m.sourceId&&void 0!==m.sourceId?k.video.deviceId=m.sourceId:k.video=!1;e.exclude&&e.exclude.video?k.video=!1:e.exclude&&e.exclude.audio&&(k.audio=!1);f(k)})}};b.getUserMedia=function(a,b,c,d){p(a,b,c,d)};b.startDetecteMic=function(c,d){b.stopDetectMic();window.tknative.postMessage({command:"startDetecteMic",
deviceId:c});a["detecte-mic-callback"]=d};b.stopDetectMic=function(){window.tknative.postMessage({command:"stopDetecteMic"});delete a["detecte-mic-callback"]};b.startDetecteCam=function(a,c){b.stopDetecteCam();window.tknative.postMessage({command:"startDetecteCam",deviceId:a,args:c})};b.stopDetecteCam=function(){window.tknative.postMessage({command:"stopDetecteCam"})};b.enumerateDevices=function(b,d){L.Logger.debug("[tk-sdk]call enumerateDevices from client!");var f=e++;a[f]=b;b={};b.isSetlocalStorage=
void 0===d?!1:void 0!=d.isSetlocalStorage?d.isSetlocalStorage:!1;c[f]=b;window.tknative.postMessage({command:"enumerateDevices",seq:f})};b.setSpeaker=function(a){window.tknative.postMessage({command:"setSpeaker",deviceId:a})};b.getsSoundMeterInstance=function(a){if(a)return new function(a){var b=this;b.audioContext=a;b.instant=0;b.slow=0;b.clip=0;b.script=b.audioContext.createScriptProcessor(2048,1,1);b.script.onaudioprocess=function(a){a=a.inputBuffer.getChannelData(0);var c,d=0,e=0;for(c=0;c<a.length;++c)d+=
a[c]*a[c],.99<Math.abs(a[c])&&(e+=1);b.instant=Math.sqrt(d/a.length);b.slow=.95*b.slow+.05*b.instant;b.clip=e/a.length};b.connectToSource=function(a,c){L.Logger.debug("SoundMeter connecting");try{b.mic=b.audioContext.createMediaStreamSource(a),b.mic.connect(b.script),b.script.connect(b.audioContext.destination),"undefined"!==typeof c&&c(null)}catch(u){L.Logger.error(u),"undefined"!==typeof c&&c(u)}};b.stop=function(){b.mic&&b.mic.disconnect&&b.mic.disconnect();b.script&&b.script.disconnect&&b.script.disconnect()};
return b}(a);L.Logger.error("[tk-sdk]getsSoundMeterInstance audioContext is not exist!")};b.setElementSinkIdToAudioouputDevice=function(a,b,c){if(b=b||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput))if(TK.isTkNative&&TK.subscribe_from_native)b=b||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput),window.tknative.postMessage({command:"setSpeaker",deviceId:b}),c&&"function"===typeof c&&c(!1);else{var d=0,e=function(a,e,f){if(a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&
b)if(a.setSinkId)try{a.setSinkId(b).then(function(){var e=a.getAttribute("id");L.Logger.debug("[tk-sdk]Audio output device set to "+b,e?" , element id is "+e:"  element:",e?"":a);d++;d===f&&c&&"function"===typeof c&&c(!0)}).catch(function(b){var e=void 0,k=a.getAttribute("id");b&&"SecurityError"===b.name&&(e="You need to use HTTPS for selecting audio output device  ");L.Logger.warning("[tk-sdk]setSinkId error:",b,e?e:"",k?" , element id is "+k:"  element:",k?"":a);d++;d===f&&c&&"function"===typeof c&&
c(!1)})}catch(Z){e=a.getAttribute("id"),L.Logger.error("[tk-sdk]setSinkId err:",Z,e?" , element id is "+e:"  element:",e?"":a),d++,d===f&&c&&"function"===typeof c&&c(!1)}else e=a.getAttribute("id"),L.Logger.error("[tk-sdk]The browser does not support the setSinkId method,audiooutputDeviceId :",b,e?" , element id is "+e:"  element:",e?"":a),d++,d===f&&c&&"function"===typeof c&&c(!1);else d++,d===f&&c&&"function"===typeof c&&c(!1)};if(!a){a=[];var f=document.getElementsByTagName("audio"),k=document.getElementsByTagName("video");
if(f&&0<f.length)for(var m=0;m<f.length;m++){var l=f[m];a.push(l)}if(k&&0<k.length)for(m=0;m<k.length;m++)l=k[m],a.push(l)}if(a&&0<a.length)for(f=a.length,m=0;m<a.length;m++)l=a[m],e(l,m,f);else e(a,0,1)}else c&&"function"===typeof c&&c(!1)};b.changeLocalDeviceToLocalstream=function(a,c,d,e){c=c||{};var f={},k;for(k in c)L.Constant.deviceStorage[k]&&c[k]!==L.Utils.localStorage.getItem(L.Constant.deviceStorage[k])&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage[k],c[k]),f[k]=!0);f.audiooutput&&
b.setElementSinkIdToAudioouputDevice(e);f.videoinput||f.audioinput?b.getUserMedia(function(b){a&&"function"===typeof a&&a(b);d&&"function"===typeof d&&d(b)},function(a){d&&"function"===typeof d&&d(void 0)},void 0,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!1,isStopLocalStream:!1}):d&&"function"===typeof d&&d(void 0)};b.addOndevicechange=function(a){};b.removeOndevicechange=function(){};b.addDeviceChangeListener=function(a){};b.removeDeviceChangeListener=function(){};b.getSpeakerVolume=
function(b){if("function"!==typeof b)L.Logger.error("[tk-sdk] wrong arguments in funciton getSpeakerVolume");else{var c=e++;a[c]=b;window.tknative.postMessage({command:"getSpeakerVolume",seq:c})}};b.setSpeakerVolume=function(a){void 0===a||null===a||0>a||100<a?L.Logger.error("[tk-sdk] invalid arguments in funciton setSpeakerVolume"):(a=Math.round(2.55*a),window.tknative.postMessage({command:"setSpeakerVolume",volume:a}))};b.enabledStreamVideoTrack=function(a,b){if(a&&a.getVideoTracks&&"function"===
typeof a.getVideoTracks&&(a=a.getVideoTracks())&&0<a.length)for(var c=0;c<a.length;c++)a[c].enabled!==b&&(a[c].enabled=b)};b.enabledStreamAudioTrack=function(a,b){if(a&&a.getAudioTracks&&"function"===typeof a.getAudioTracks&&(a=a.getAudioTracks())&&0<a.length)for(var c=0;c<a.length;c++)a[c].enabled!==b&&(a[c].enabled=b)};b.playDeviceStream=function(a,b,c){c=c||{};a?(a=TK.NativeVideoPlayer({id:"videoinput_stream_player",stream:{stream:void 0},elementID:a,options:c}),"function"===typeof b&&b(a)):L.Logger.error("[tk-sdk]playDeviceStream elementID can not be empty!")};
b.unplayDeviceStream=function(a){a&&a&&a.destroy&&a.destroy()};b.associateElementsToSpeaker=function(a,b,c){};b.getDevices=function(a){b.enumerateDevices(a)};b.setDevices=function(a,c){b.changeLocalDeviceToLocalstream(b.onDevicesSetted,a,function(a){})};b.stopCameraTest=function(){b.unplayDeviceStream(d.player);window.tknative.postMessage({command:"stopDetecteCam"});delete d.player;d.player=null};b.startCameraTest=function(a,c,e){if(a)if(c){b.stopCameraTest();var f=void 0;b.playDeviceStream(c,function(a){d.player=
a;f=a.id});f?window.tknative.postMessage({command:"startDetecteCam",deviceId:a,args:{elementId:f}}):(L.Utils.isFunction(e)&&e("TK_ERR_INTERNAL_EXCEPTION"),L.Logger.error("startCameraTest occurred internal exception"))}else L.Utils.isFunction(e)&&e("TK_ERR_INVALID_ARG"),L.Logger.error("startCameraTest got invalid elementId");else L.Utils.isFunction(e)&&e("TK_ERR_INVALID_ARG"),L.Logger.error("startCameraTest got invalid deviceId")};b.stopMicrophoneTest=function(){b.stopDetectMic();var a=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput);
a&&window.tknative.postMessage({command:"setMicrophone",deviceId:a})};b.startMicrophoneTest=function(a,c,d,e){a?c?b.startDetecteMic(a,d):(L.Utils.isFunction(e)&&e("TK_ERR_INVALID_ARG"),L.Logger.error("startMicrophoneTest got invalid elementId")):(L.Utils.isFunction(e)&&e("TK_ERR_INVALID_ARG"),L.Logger.error("startMicrophoneTest got invalid deviceId"))};b.stopSpeakerTest=function(){if(l){var a={};a.audioUrl=l;window.tknative.postMessage({command:"clientAudioMediaPlayer",action:"stop",options:a});l=
null}(a=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput))&&b.setSpeaker(a)};b.startSpeakerTest=function(a,c,d){a?c?(b.stopSpeakerTest(),b.setSpeaker(a),a={},a.audioUrl=c,window.tknative.postMessage({command:"clientAudioMediaPlayer",action:"play",options:a}),l=c):(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("startSpeakerTest got invalid audioUrl")):(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("startSpeakerTest got invalid deviceId"))};return b};var TK=TK||{};
TK.NativeProxy=function(){function b(b,c,d){TK.isTkNative?void 0===b||null===b?("function"===typeof d&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] getShareScreenProfile function got wrong arguments")):(d=a(),TK.waitNativeToCallbackList[d]=c,window.tknative.postMessage({command:"getShareScreenProfile",args:b,seq:d})):("function"===typeof d&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk]getShareScreenProfile method must be in the client environment!"))}function a(){if(void 0===TK.nativeCallSeq||
"number"!==typeof TK.nativeCallSeq)TK.nativeCallSeq=0;return++TK.nativeCallSeq}function c(a){if(!L.Utils.isNull(a)&&!L.Utils.isNull(a.data)&&!L.Utils.isNull(a.data.name))switch(a.data.name){case "onValidWindowList":var b=a.data.seq;if(void 0===b)break;if("function"!==typeof TK.waitNativeToCallbackList[b])break;TK.waitNativeToCallbackList[b](a.data.validWindows);delete TK.waitNativeToCallbackList[b];break;case "onLog":b=a.data.level;a=a.data.log;0===b&&L.Logger.debug(a);1===b&&L.Logger.info(a);2===
b&&L.Logger.warning(a);3===b&&L.Logger.error(a);break;case "onMonitorCount":var c=a.data.count;b=a.data.seq;if(void 0===b)break;if("function"!==typeof TK.waitNativeToCallbackList[b])break;TK.waitNativeToCallbackList[b](c);delete TK.waitNativeToCallbackList[b];break;case "onTakSnapshot":b=a.data.action;c=a.data.requestId;var e=a.data.total,f=a.data.now,h=a.data.code;if("function"!==typeof TK.waitNativeToCallbackList[c])break;a=L.Utils.toJsonParse(a.data.result);TK.waitNativeToCallbackList[c](b,c,e,
f,h,a);"result"===b&&delete TK.waitNativeToCallbackList[c];break;case "onGetMediaPlayPos":c=a.data.arg;c.duration=parseInt(1E3*c.duration);1<c.pos&&(c.pos=1);c.position=parseInt(c.pos*c.duration);c.position>c.duration&&(c.position=c.duration);b=a.data.seq;if("function"!==typeof TK.waitNativeToCallbackList[b])break;TK.waitNativeToCallbackList[b](c);break;case "onNativeNotification":c=a.data.arg;"object"===typeof c&&"onMediaFileEnded"===c.name&&(a=TK.RoomEvent({type:"room-clientNotification-onMediaFileEnded",
message:{}}),d.dispatchEvent(a));break;case "onGetMediaFileInfo":c=a.data.arg;b=a.data.seq;c.duration&&(c.duration*=1E3);if("function"!==typeof TK.waitNativeToCallbackList[b])break;TK.waitNativeToCallbackList[b](c);delete TK.waitNativeToCallbackList[b];break;case "onLocalRecord":case "onGetOpenOrSaveFileName":case "onBrowseForFolder":case "onGetRecordingPath":case "onStartupFileTransmitter":case "getShareScreenProfile":c=a.data.arg,b=a.data.seq,"function"===typeof TK.waitNativeToCallbackList[b]&&
(TK.waitNativeToCallbackList[b](c),delete TK.waitNativeToCallbackList[b])}}function e(b,c,d){TK.isTkNative?L.Utils.isNull(b)?(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] getMediaFileInfo method got invalid fileName!")):(d=a(),TK.waitNativeToCallbackList[d]=c,window.tknative.postMessage({command:"getMediaFileInfo",seq:d,file:b})):(L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] getMediaFileInfo method must be called in the native environment!"))}
var d=TK.EventDispatcher({}),l=void 0,p=0,k=void 0;d.onNativeStartShareMediaFile=null;d.onNativeStopShareMediaFile=null;d.onNativeStartShareScreen=null;d.onNativeStopShareScreen=null;d.initialize=function(){window.tknative.addEventListener("message",c,!1)};d.createShareScreenWindow=function(a,b,c,e,k,h,l){TK.isTkNative?d.getValidWindowList(0,function(d){if((d=d[0])&&"object"===typeof d){d=d.id;var f=c,m=e,q=a,p=b,u=k,r=h,w=0;TK.isTkNative?window.tknative.postMessage({command:"updateWindowSource",
id:Number(d||0),left:Number(f||0),top:Number(m||0),width:Number(q||0),height:Number(p||0),mixMic:u||!1,mixSpk:r||!1,type:Number(w||0)}):L.Logger.warning("[tk-sdk] updateWindowSource method must be in the client environment!")}else L.Logger.error("[tk-sdk]createShareScreenWindow:getValidWindowList is not data!"),L.Utils.isFunction(l)&&l("TK_ERR_NOT_DATA")}):(L.Logger.error("[tk-sdk]createShareScreenWindow method must be in the client environment!"),L.Utils.isFunction(l)&&l("TK_ERR_NOT_INITIALIZED"))};
d.destroyShareScreenWindow=function(){d.createShareScreenWindow(0,0,0,0)};d.startShareScreen=function(a){if(TK.isTkNative)if(TK.isOnlyAudioRoom)L.Logger.warning("[tk-sdk]only audio room not execute method startShareScreen method !"),L.Utils.isFunction(a)&&a("TK_ERR_NOT_SUPPORT");else{var c={},e={audio:!0,video:!0,attributes:c};if(TK.isTkNative&&2018061500<=TK.clientversion)d.getValidWindowList(0,function(f){if((f=f[0])&&"object"===typeof f)b(f,function(b){b&&"object"===typeof b&&(c.videowidth=b.width,
c.videoheight=b.height,c.videofps=b.fps);if(L.Utils.isFunction(d.onNativeStartShareScreen))d.onNativeStartShareScreen(e,a)},function(b){L.Logger.warning("[tk-sdk]startShareScreen:getShareScreenProfile is failure , failure info:"+b+"!");if(L.Utils.isFunction(d.onNativeStartShareScreen))d.onNativeStartShareScreen(e,a)});else if(L.Logger.warning("[tk-sdk]startShareScreen:getValidWindowList is not data!"),L.Utils.isFunction(d.onNativeStartShareScreen))d.onNativeStartShareScreen(e,a)});else if(L.Utils.isFunction(d.onNativeStartShareScreen))d.onNativeStartShareScreen(e,
a)}else L.Logger.error("[tk-sdk]startShareScreen method must be in the client environment!"),L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED")};d.stopShareScreen=function(a){if(TK.isTkNative){if(L.Utils.isFunction(d.onNativeStopShareMediaFile))d.onNativeStopShareScreen(a);d.destroyShareScreenWindow()}else L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] stopShareScreen method must be called in the native environment!")};d.startShareMediaFile=function(a,b,c,k){k=k||{};
TK.isTkNative?L.Utils.isNull(a)?(L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] startShareMediaFile method got invalid fileName!")):L.Utils.isNull(b)?(L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] startShareMediaFile method got invalid elementId!")):e(a,function(e){var f=e.duration,m=e.width,l=e.height,q=e.video,u=e.audio;if(e.video||e.audio)if(TK.isOnlyAudioRoom&&e.video)L.Logger.error("[tk-sdk]only audio room not execute method startShareLocalMedia to video media !"),
L.Utils.isFunction(c)&&c("TK_ERR_NOT_SUPPORT");else{f={width:m,height:l,duration:f,filename:L.Utils.getFileName(a)};TK.isTkNative&&2018061500<=TK.clientversion&&(f.videowidth=m,f.videoheight=l,f.videofps=e.fps);void 0!==k.toID&&(f.toID=k.toID);if(k.attrs&&"object"===typeof k.attrs)for(var w in k.attrs)"toID"!==w&&"type"!==w&&(f[w]=k.attrs[w]);e={video:q,audio:u,attributes:f,path:a};if(L.Utils.isFunction(d.onNativeStartShareMediaFile))d.onNativeStartShareMediaFile(e,b,c);p=1}else L.Utils.isFunction(c)&&
c("TK_ERR_INVALID_FIEL"),L.Logger.error("[tk-sdk] startShareMediaFile method got invalid file!")},c):(L.Utils.isFunction(c)&&c("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] startShareMediaFile method must be called in the native environment!"))};d.stopShareMediaFile=function(a){if(TK.isTkNative){if(L.Utils.isFunction(d.onNativeStopShareMediaFile))d.onNativeStopShareMediaFile(a);p=0}else L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] stopShareMediaFile method must be called in the native environment!")};
d.pauseShareMediaFile=function(a,b,c){if(TK.isTkNative)if(L.Utils.isBoolean(a)){if(!0===a&&2!==p||!1===a&&1!==p)window.tknative.postMessage({command:"pauseMediaFile",pause:a}),p=!0===a?2:1;L.Utils.isFunction(b)&&b(!0===a?"Paused":"Sharing")}else L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] pauseShareMediaFile function got wrong arguments");else L.Utils.isFunction(c)&&c("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] pauseShareMediaFile method must be called in the native environment!")};
d.registerMediaFileProgressListener=function(b,c,e){TK.isTkNative?L.Utils.isNull(b)||0>=b||!L.Utils.isFunction(c)?(L.Utils.isFunction(e)&&e("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] registerMediaFileProgressListener function got wrong arguments")):(d.unregisterMediaFileProgressListener(),1E3>b&&(b=1E3),k=a(),TK.waitNativeToCallbackList[k]=c,l=setInterval(function(){1===p&&window.tknative.postMessage({command:"getMediaPlayPos",seq:k})},b)):(L.Utils.isFunction(e)&&e("TK_ERR_NOT_INITIALIZED"),L.Logger.error("[tk-sdk] registerMediaFileProgressListener method must be called in the native environment!"))};
d.unregisterMediaFileProgressListener=function(a){TK.isTkNative?(L.Utils.isNull(l)||(clearInterval(l),l=void 0),L.Utils.isNull(k)||(delete TK.waitNativeToCallbackList[k],k=void 0)):(L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"),L.Logger.error("[tk-sdk] unregisterMediaFileProgressListener method must be called in the native environment!"))};d.seekMediaFile=function(a,b){TK.isTkNative?L.Utils.isNumber(a)?(0>a&&(a=0),1<a&&(a=1),window.tknative.postMessage({command:"seekMediaFile",pos:a})):(L.Utils.isFunction(b)&&
b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] seekShareMediaFile function got wrong arguments")):(L.Utils.isFunction(b)&&b("TK_ERR_NOT_INITIALIZED"),L.Logger.error("[tk-sdk] seekMediaFile method must be called in the native environment!"))};d.getValidWindowList=function(b,c){if(TK.isTkNative)if(void 0===b||null===b||"function"!==typeof c)L.Logger.error("[tk-sdk] getValidWindowList function got wrong arguments");else{var d=a();TK.waitNativeToCallbackList[d]=c;window.tknative.postMessage({command:"getValidWindowList",
type:Number(b),seq:d})}else L.Logger.warning("[tk-sdk]getValidWindowList method must be in the client environment!")};d.getMonitorCount=function(b){if(TK.isTkNative)if("function"!==typeof b)L.Logger.error("[tk-sdk] getMonitorCount function got wrong arguments");else{var c=a();TK.waitNativeToCallbackList[c]=b;window.tknative.postMessage({command:"getMonitorCount",seq:c})}else L.Logger.warning("[tk-sdk]getMonitorCount method must be in the client environment!")};d.enableViceMonitor=function(){TK.isTkNative?
(TK.subscribe_from_native=!0,window.tknative.postMessage({command:"enableViceMonitor"})):L.Logger.warning("[tk-sdk] enableViceMonitor method must be in the client environment!")};d.takeSnapshot=function(b,c,d){if(TK.isTkNative)if(c)if("function"!==typeof d)L.Logger.error("[tk-sdk] takeSnapshot function got wrong arguments");else{var e=a();TK.waitNativeToCallbackList[e]=d;window.tknative.postMessage({command:"takeSnapshot",needMin:b,fileName:c,requestId:e})}else L.Logger.error("[tk-sdk] takeSnapshot function got wrong arguments");
else L.Logger.warning("[tk-sdk] takeSnapshot method must be in the client environment!")};d.startRecordScreen=function(b,c,d){if(TK.isTkNative)if(L.Utils.isNull(b)||L.Utils.isNull(b.filename))L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] startRecordScreen function got wrong arguments");else{var e={type:1,fileName:b.filename,forcepath:!0},f;for(f in b)"type"!==f&&"filename"!==f&&(e[f]=b[f]);b=a();TK.waitNativeToCallbackList[b]=function(a){"Recording"===a.action?L.Utils.isFunction(c)&&
c({filename:a.filepath}):L.Utils.isFunction(d)&&d("record screen failed")};window.tknative.postMessage({command:"startLocalRecord",args:e,seq:b})}else L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] startRecordScreen method must be called in the native environment!")};d.pauseRecordScreen=function(b,c,d){TK.isTkNative?L.Utils.isNull(b)?(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] pauseRecordScreen function got wrong arguments")):(b={type:1,
pause:b},d=a(),TK.waitNativeToCallbackList[d]=function(a){L.Utils.isFunction(c)&&c(a.action)},window.tknative.postMessage({command:"pauseLocalRecord",args:b,seq:d})):(L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] pauseRecordScreen method must be called in the native environment!"))};d.stopRecordScreen=function(a){TK.isTkNative?window.tknative.postMessage({command:"stopLocalRecord",args:{type:1}}):(L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] stopRecordScreen method must be called in the native environment!"))};
d.startRecordAudio=function(b,c,d){if(TK.isTkNative)if(L.Utils.isNull(b)||L.Utils.isNull(b.filename))L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] startRecordAudio function got wrong arguments");else{var e={type:0,fileName:b.filename,forcepath:!0},f;for(f in b)"type"!==f&&"filename"!==f&&(e[f]=b[f]);b=a();TK.waitNativeToCallbackList[b]=function(a){"Recording"===a.action?L.Utils.isFunction(c)&&c({filename:a.filepath}):L.Utils.isFunction(d)&&d("record screen failed")};window.tknative.postMessage({command:"startLocalRecord",
args:e,seq:b})}else L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] startRecordAudio method must be called in the native environment!")};d.pauseRecordAudio=function(b,c,d){TK.isTkNative?L.Utils.isNull(b)?(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] pauseRecordAudio function got wrong arguments")):(b={type:0,pause:b},d=a(),TK.waitNativeToCallbackList[d]=function(a){L.Utils.isFunction(c)&&c(a.action)},window.tknative.postMessage({command:"pauseLocalRecord",
args:b,seq:d})):(L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] pauseRecordAudio method must be called in the native environment!"))};d.stopRecordAudio=function(a){TK.isTkNative?window.tknative.postMessage({command:"stopLocalRecord",args:{type:0}}):(L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] stopRecordAudio method must be called in the native environment!"))};d.getOpenFileName=function(b,c,d){if(TK.isTkNative)if(L.Utils.isNull(b)||
L.Utils.isNull(b.caption)||L.Utils.isNull(b.filter))L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] getOpenFileName function got wrong arguments");else{var e=a();TK.waitNativeToCallbackList[e]=function(a){"Activated"===a.action?L.Utils.isFunction(d)&&(d("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.warning("[tk-sdk] getOpenFileName in progress")):L.Utils.isFunction(c)&&c(a)};window.tknative.postMessage({command:"getOpenFileName",args:b,seq:e})}else L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),
L.Logger.warning("[tk-sdk] getOpenFileName method must be called in the native environment!")};d.getSaveFileName=function(b,c,d){if(TK.isTkNative)if(L.Utils.isNull(b)||L.Utils.isNull(b.caption)||L.Utils.isNull(b.filter))L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] getSaveFileName function got wrong arguments");else{var e=a();TK.waitNativeToCallbackList[e]=function(a){"Activated"===a.action?L.Utils.isFunction(d)&&(d("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.warning("[tk-sdk] getSaveFileName in progress")):
L.Utils.isFunction(c)&&c(a)};window.tknative.postMessage({command:"getSaveFileName",args:b,seq:e})}else L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] getSaveFileName method must be called in the native environment!")};d.listenCloseEvent=function(){if(TK.isTkNative)try{talk_window&&talk_window.listenCloseEvent?talk_window.listenCloseEvent():L.Logger.error("[tk-sdk]talk_window.listenCloseEvent is not exist!")}catch(f){L.Logger.error("[tk-sdk] listenCloseEvent function can not be called")}else L.Logger.warning("[tk-sdk]listenCloseEvent method must be in the client environment!")};
d.shutdownNativeClient=function(){TK.isTkNative?window.tknative.postMessage({command:"shutdownNativeClient"}):L.Logger.warning("[tk-sdk]shutdownNativeClient method must be in the client environment!")};d.closeWindow=function(){try{talk_window&&talk_window.closeWindow?talk_window.closeWindow():L.Logger.error("[tk-sdk]talk_window.closeWindow is not exist!")}catch(f){L.Logger.error("[tk-sdk] closeWindow function can not be called")}};d.clientAudioMediaPlayer=function(a,b,c){TK.isTkNative?2018031E3>TK.clientversion?
L.Logger.warning("[tk-sdk]Current version client is not support clientAudioMediaPlayer method ,please update the latest client !"):(c=c||{},b?(L.Logger.info("[tk-sdk]clientAudioMediaPlayer url is "+a+" , action is "+b+" , options is"+L.Utils.toJsonStringify(c)),c.audioUrl=a,window.tknative.postMessage({command:"clientAudioMediaPlayer",action:b,options:c})):L.Logger.error("[tk-sdk]clientAudioMediaPlayer action is not exist!")):L.Logger.warning("[tk-sdk]clientAudioMediaPlayer method must be in the client environment!")};
d.clientPreloadMediaFile=function(a){TK.isTkNative?2018031E3>TK.clientversion?L.Logger.warning("[tk-sdk]Current version client is not support clientPreloadMediaFile method ,please update the latest client !"):Array.isArray(a)?a&&0<a.length&&window.tknative.postMessage({command:"clientPreloadMediaFile",urlArray:a}):L.Logger.error("[tk-sdk]clientPreloadMediaFile args must is array!"):L.Logger.warning("[tk-sdk]clientPreloadMediaFile method must be in the client environment!")};d.clientOpenBrowserUrl=
function(a){TK.isTkNative?2018031E3>TK.clientversion?L.Logger.warning("[tk-sdk]Current version client is not support clientOpenBrowserUrl method ,please update the latest client !"):a?window.tknative.postMessage({command:"clientOpenBrowserUrl",url:a}):L.Logger.error("[tk-sdk]clientOpenBrowserUrl url is not exist!"):L.Logger.warning("[tk-sdk]clientOpenBrowserUrl method must be in the client environment!")};d.initBroadcast=function(a,b,c,d,e){TK.isTkNative?a?(b||(b=10),c||(c=3),d&&e?window.tknative.postMessage({command:"initBroadcast",
url:a.toString(),fps:Number(b),key_sec:Number(c),width:Number(d),height:Number(e)}):L.Logger.error("[tk-sdk]argument width or height of initBroadcast function not exist!")):L.Logger.error("[tk-sdk]argument url of initBroadcast function not exist!"):L.Logger.warning("[tk-sdk]initBroadcast method must be in the client environment!")};d.updateBroadcast=function(a,b,c,d){a||(a=10);b||(b=3);c&&d?window.tknative.postMessage({command:"updateBroadcast",fps:Number(a),key_sec:Number(b),width:Number(c),height:Number(d)}):
L.Logger.error("[tk-sdk]argument width or height of updateBroadcast function not exist!")};d.uninitBroadcast=function(){TK.isTkNative?window.tknative.postMessage({command:"uninitBroadcast"}):L.Logger.warning("[tk-sdk]uninitBroadcast method must be in the client environment!")};d.startBroadcast=function(a){TK.isTkNative?a?window.tknative.postMessage({command:"startBroadcast",streamId:a}):L.Logger.error("[tk-sdk]argument extensionId of startBroadcast function not exist!"):L.Logger.warning("[tk-sdk]startBroadcast method must be in the client environment!")};
d.stopBroadcast=function(){TK.isTkNative?window.tknative.postMessage({command:"stopBroadcast"}):L.Logger.warning("[tk-sdk]stopBroadcast method must be in the client environment!")};return d}(TK);
