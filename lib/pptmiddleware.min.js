"use strict";function PPTMiddleWare(e){this.iframe=null,this.onFinished=null,this.onSlideChanged=null,this.onStepChanged=null,this.onAction=null,this.onVideoChanged=null,this.onVideoAction=null,this.onMouseLocation=null,this.fileid=null,this.isVideoPlayer=!1,this.isShowVideo=!1,this.VideoActionData=null,this.isPPTLoadFinish=!1,this.saveAction=[],this.saveVideoAction={},this.Listening(),this.init(e),this.skipPage=function(e,t,i){var a={action:"jumpToAnim",data:{slide:e,step:t,timeOffset:void 0,autoStart:void 0,initiative:i}};this.saveAction[0]=a,this.SendMessage(a)}}PPTMiddleWare.prototype.SendMessage=function(e){if(this.isPPTLoadFinish&&0<this.fileid){var t={source:"tk_dynamicPPT",data:e};t=JSON.stringify(t),window.frames[0].postMessage(t,"*")}},PPTMiddleWare.prototype.FormatData=function(e){e=e||{};for(var t in e)e.hasOwnProperty(t)&&(e.fileid=this.fileid,"slide"==t&&(e[t]=e[t]+1));return e},PPTMiddleWare.prototype.Listening=function(){var i=this;window.addEventListener("message",function(e){if(e.source!=window){var t=JSON.parse(e.data);if("tk_dynamicPPT"==t.source)switch(t.data.action){case"initEvent":if(i.isPPTLoadFinish=!0,null==i.onFinished||"function"!=typeof i.onFinished)return;i.onFinished(i.FormatData(t.data)),i.loadAction();break;case"slideChangeEvent":if(null==i.onSlideChanged||"function"!=typeof i.onSlideChanged)return;t.data.externalData&&t.data.externalData.initiative&&i.onSlideChanged(i.FormatData(t.data));break;case"stepChangeEvent":if(null==i.onStepChanged||"function"!=typeof i.onStepChanged)return;t.data.externalData&&t.data.externalData.initiative&&i.onStepChanged(i.FormatData(t.data));break;case"clickNewpptTriggerEvent":if(null==i.onAction||"function"!=typeof i.onAction)return;t.data.externalData&&t.data.externalData.initiative&&i.onAction(i.FormatData(t.data));break;case"startPlayVideoEvent":if(null==i.onAction||"function"!=typeof i.onAction)return;t.data.externalData&&t.data.externalData.initiative&&(i.isVideoPlayer=!0,i.onAction(i.FormatData(t.data)));break;case"clickNewpptVideoEvent":if(null==i.onAction||"function"!=typeof i.onAction)return;t.data.externalData&&t.data.externalData.initiative&&i.onAction(i.FormatData(t.data));break;case"allVideoAndAudio":i.isVideoPlayer=!0;break;case"getVideoData":if(null==i.onAction||"function"!=typeof i.onAction)return;t.data.action="clickNewpptVideoEvent",i.onAction(i.FormatData(t.data));break;case"MouseLocation":if(null==i.onMouseLocation||"function"!=typeof i.onMouseLocation)return;i.onMouseLocation(t.data)}}},!1)},PPTMiddleWare.prototype.init=function(e){var t=null==e||""==e?document.body:document.getElementById(e);try{this.iframe=document.createElement('<iframe name="h5FileFrame" allow="autoplay" scrolling="no" allowfullscreen ></iframe>')}catch(e){this.iframe=document.createElement("iframe"),this.iframe.allow="autoplay",this.iframe.allowfullscreen=!0,this.iframe.scrolling="no",this.iframe.width="100%",this.iframe.height="100%",this.iframe.name="h5FileFrame"}t.appendChild(this.iframe)},PPTMiddleWare.prototype.onOpenPPT=function(e,t){""!=t&&null!=t||console.error("talkcloud warning:ppt fileid is undefined or An empty string");e=e;this.fileid=t,this.iframe.src=e+(0<=e.indexOf("?")?"&fileid="+this.fileid:"?fileid="+this.fileid)},PPTMiddleWare.prototype.loadAction=function(){for(var e=this,t=this.saveAction,i=0;i<t.length;i++){var a=t[i];switch(a.action){case"jumpToAnim":this.SendMessage(a);break;case"startPlayVideoEvent":e.starTimer=setInterval(function(){e.isVideoPlayer&&(e.SendMessage(a),clearInterval(e.starTimer))},200)}}},PPTMiddleWare.prototype.setCursor=function(e,t,i){var a={action:"setCursor",iconUrl:e,offsetX:t,offsetY:i};this.SendMessage(a)},PPTMiddleWare.prototype.nextPage=function(){this.SendMessage({action:"gotoNextSlide"})},PPTMiddleWare.prototype.prevPage=function(){this.SendMessage({action:"gotoPreviousSlide"})},PPTMiddleWare.prototype.nextStep=function(){this.SendMessage({action:"gotoNextStep"})},PPTMiddleWare.prototype.prevStep=function(){this.SendMessage({action:"gotoPreviousStep"})},PPTMiddleWare.prototype.initiativeSkipPage=function(e,t){t=t||0;this.skipPage(e,t,!0)},PPTMiddleWare.prototype.passiveSkipPage=function(e,t){t=t||0;this.skipPage(e,t,!1)},PPTMiddleWare.prototype.tiggerAction=function(e){var t=this,i=e;"clickNewpptVideoEvent"===e.action?e.externalData.initiative?t.SendMessage(i):t.timer=setInterval(function(){t.isVideoPlayer&&(t.SendMessage(i),clearInterval(t.timer))},200):(t.saveAction.push(i),this.SendMessage(i))},PPTMiddleWare.prototype.videoAction=function(e){var t={action:"startPlayVideoEvent",videoStatus:e.videoStatus,externalData:{initiative:!1}};this.saveAction.push(t),this.SendMessage(t)},PPTMiddleWare.prototype.tiggerVideoAction=function(e){e.currentTime,e.duration},PPTMiddleWare.prototype.getVideoAction=function(){this.SendMessage({action:"getVideoData"})};